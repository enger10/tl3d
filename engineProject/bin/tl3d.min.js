window.__extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),window.tl3d={},function(t){var e=function(){function e(){}return e.getUItittleUrl=function(t){return"ui/load/tittle/"+t+".png"},e.getSkillUrl=function(e){return("skill/"+e+t.Util.getBaseUrl()+".txt").replace(".txt","_byte.txt")},e.getModelUrl=function(e){return"model/"+e+t.Util.getBaseUrl()+".txt"},e.getModelUIUrl=function(e){return"model/"+e+t.Util.getBaseUrl()+".txt"},e.getMapUrl=function(e){return"map/"+e+t.Util.getBaseUrl()+".txt"},e.getBaoxiangUrl=function(){return"changjing/baoxiang/100001.txt"},e.getRoleUrl=function(e){return"role/"+e+t.Util.getBaseUrl()+".txt"},e.getZipMapUrl=function(t){return"map/"+t+"/"},e.Snum=function(t){return"123"},e.getEffectUIUrl=function(t){return"ui/load/effect/"+t+".png"},e.getKeyProById=function(t){return"cc"},e}();t.UnitFunction=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.STANAD="stand",t.WALK="walk",t.DEATH="death",t.JUMP="jump",t.SIT="sit",t.INJURED="injured",t.ATTACK_01="attack_01",t.ATTACK_02="attack_02",t.ATTACK_03="attack_03",t.ATTACK_04="attack_04",t.ATTACK_05="attack_05",t.ATTACK_06="attack_06",t.ATTACK_010="attack_010",t.ATTACK_020="attack_020",t.STAND_MOUNT="stand_mount_01",t.WALK_MOUNT="walk_mount_01",t.s_attack_01="s_attack_01",t}();t.CharAction=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.init=function(i){t.Scene_data.vpMatrix=new t.Matrix3D,t.Scene_data.canvas3D=i,t.Scene_data.context3D=new t.Context3D,t.Scene_data.context3D.init(i),t.UIManager.getInstance().init(),t.Scene_data.cam3D=new t.Camera3D,t.Scene_data.focus3D=new t.Object3D,t.Scene_data.focus3D.x=0,t.Scene_data.focus3D.y=0,t.Scene_data.focus3D.z=0,t.Scene_data.focus3D.rotationY=135,t.Scene_data.focus3D.rotationX=-45,t.Scene_data.light=new t.LightVo,e.testBlob(),e.resetSize(),e.initShadow(),t.TimeUtil.init(),t.PathManager.init()},e.resReady=function(){e.initPbr()},e.testBlob=function(){},e.initPbr=function(){t.Scene_data.pubLut||t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+"base/brdf_ltu.jpg",(function(e){t.Scene_data.pubLut=e.texture}),1)},e.initShadow=function(){t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+"base/shadow.png",(function(e){t.Display3dShadow.texture=e.texture}))},e.resetSize=function(i,a){void 0===i&&(i=0),void 0===a&&(a=0),e.needInputTxt||(document.body.clientWidth>document.body.clientHeight?(t.Scene_data.stageWidth=document.body.clientWidth,t.Scene_data.stageHeight=document.body.clientHeight,t.Scene_data.verticalScene=!1):(t.Scene_data.stageWidth=document.body.clientHeight,t.Scene_data.stageHeight=document.body.clientWidth,t.Scene_data.verticalScene=!0),this.needVertical||(t.Scene_data.stageWidth=document.body.clientWidth,t.Scene_data.stageHeight=document.body.clientHeight,t.Scene_data.verticalScene=!1),t.Scene_data.canvas3D.width=t.Scene_data.stageWidth,t.Scene_data.canvas3D.height=t.Scene_data.stageHeight,t.Scene_data.context3D.resetSize(t.Scene_data.stageWidth,t.Scene_data.stageHeight),t.UIManager.getInstance().resize(),this.resetViewMatrx3D(),t.Scene_data.canvas3D.style.position="absolute",t.Scene_data.canvas3D.style.left="0px",t.Scene_data.canvas3D.style.top="0px",t.Scene_data.verticalScene?t.Scene_data.canvas3D.style.transform="matrix(0,1,-1,0,"+t.Scene_data.stageHeight+",0)":t.Scene_data.canvas3D.style.transform="matrix(1,0,0,1,0,0)",t.Scene_data.canvas3D.style.transformOrigin="0px 0px 0px",t.Scene_data.canvas3D.style.top="0px")},e.resetViewMatrx3D=function(){t.Scene_data.viewMatrx3D?t.Scene_data.viewMatrx3D.identity():t.Scene_data.viewMatrx3D=new t.Matrix3D;var e=t.Scene_data.stageWidth,i=t.Scene_data.stageHeight;t.Scene_data.sceneViewHW=Math.max(e,i),t.Scene_data.viewMatrx3D.perspectiveFieldOfViewLH(this.sceneCamScale,1,50,t.Scene_data.camFar),t.Scene_data.viewMatrx3D.appendScale(t.Scene_data.sceneViewHW/e*2*1,e/i*(t.Scene_data.sceneViewHW/e*2),1)},e.update=function(){t.TimeUtil.update(),t.FpsMc.update()},e.unload=function(){},e.needVertical=!0,e.needInputTxt=!1,e.sceneCamScale=1.76,e}();t.Engine=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this.drawNum=0,this.fpsStr=""}return t.update=function(){},t.prototype.getStr=function(){return t.fpsNowNum=Math.min(this.drawNum,600),this.fpsStr="Fps:"+String(t.fpsNowNum)+"-"+t.tipStr,this.fpsStr},t.addFps=0,t.fpsNowNum=0,t.tipStr="",t}();t.FpsMc=e;var i=function(){function i(){this.lastTime=0,this.cPos=new t.Vector2D(150,100)}return i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.init=function(i,a){var n=this;this.canvas2D=i,this.loadCav=a,this.fps=new e,this.canvasUi=this.canvas2D.getContext("2d"),this.loadCtx=this.loadCav.getContext("2d"),t.TimeUtil.addFrameTick((function(){n.upData()}))},i.prototype.showLoadInfo=function(t){},i.prototype.removeShowLoad=function(){this.loadCav.parentElement&&this.loadCav.parentElement.removeChild(this.loadCav),i.showFps=!0},i.prototype.upData=function(){if(this.fps.drawNum++,!(this.lastTime>=t.TimeUtil.getTimer()-1e3))if(this.lastTime=t.TimeUtil.getTimer(),i.showFps){this.canvasUi.font="40px Helvetica";var e=this.canvasUi.measureText(this.fps.getStr()).width;this.canvas2D.width=e,this.canvas2D.height=30,this.canvasUi.clearRect(50,0,this.canvas2D.width-50,this.canvas2D.height),this.canvasUi.fillStyle="#000000",this.canvasUi.fillRect(50,0,this.canvas2D.width-50,this.canvas2D.height),this.canvasUi.font="30px Helvetica",this.canvasUi.fillStyle="#ffffff",this.canvasUi.textBaseline="top",this.canvasUi.textAlign="left",this.canvasUi.fillText(this.fps.getStr(),50,0),this.fps.drawNum=0}else this.canvasUi.clearRect(0,0,this.canvas2D.width,this.canvas2D.height)},i.prototype.makeXyzLine=function(){var e=new t.Vector3D(80,0,0),i=new t.Vector3D(0,70,0),a=new t.Vector3D(0,0,80),n=new t.Matrix3D;n.appendRotation(t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),n.appendRotation(t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS),e=n.transformVector(e),i=n.transformVector(i),a=n.transformVector(a),this.drawLine(new t.Vector2D(0,0),new t.Vector2D(e.x,-e.y),"#ff0000"),this.drawLine(new t.Vector2D(0,0),new t.Vector2D(i.x,-i.y),"#00ff00"),this.drawLine(new t.Vector2D(0,0),new t.Vector2D(a.x,-a.y),"#0000ff"),this.canvasUi.font="12px Helvetica",this.canvasUi.fillStyle="#ff0000",this.canvasUi.fillText("x",e.x+this.cPos.x,-e.y+this.cPos.y),this.canvasUi.fillStyle="#00ff00",this.canvasUi.fillText("y",i.x+this.cPos.x,-i.y+this.cPos.y),this.canvasUi.fillStyle="#0000ff",this.canvasUi.fillText("z",a.x+this.cPos.x,-a.y+this.cPos.y)},i.prototype.drawLine=function(t,e,i){void 0===i&&(i="red"),this.canvasUi.beginPath(),this.canvasUi.lineWidth=2,this.canvasUi.strokeStyle=i,this.canvasUi.moveTo(t.x+this.cPos.x,t.y+this.cPos.y),this.canvasUi.lineTo(e.x+this.cPos.x,e.y+this.cPos.y),this.canvasUi.stroke()},i.prototype.resetSize=function(){this.cPos=new t.Vector2D(150,t.Scene_data.stageHeight-100)},i.showFps=!1,i}();t.FpsStage=i}(tl3d||(tl3d={})),function(t){var e=function(){function e(e,i){this.width=e,this.height=i;var a=t.UIManager.getInstance().getContext2D(this.width,this.height,!1);this.imgData=a.getImageData(0,0,this.width,this.height);for(var n=0;n<this.imgData.data.length;n+=4)this.imgData.data[n+0]=255,this.imgData.data[n+1]=255,this.imgData.data[n+2]=255,this.imgData.data[n+3]=255}return e.prototype.getIndexByPos=function(t,e){return 4*(e*this.width+t)},e.prototype.setRgb=function(t,e,i){t=Math.round(t),e=Math.round(e);var a=this.getIndexByPos(t,e);this.imgData.data[a+0]=255*i.x,this.imgData.data[a+1]=255*i.y,this.imgData.data[a+2]=255*i.z,this.imgData.data[a+3]=255},e.prototype.getRgb=function(e,i){e=Math.round(e),i=Math.round(i);var a=new t.Vector3D,n=this.getIndexByPos(e,i);return a.x=this.imgData.data[n+0]/255,a.y=this.imgData.data[n+1]/255,a.z=this.imgData.data[n+2]/255,a.w=1,a},e}();t.BitMapData=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this._eventsMap=null}return t.prototype.addEventListener=function(t,e,i){this._eventsMap||(this._eventsMap=new Object);var a=this._eventsMap[t];a||(a=this._eventsMap[t]=[]);for(var n={listener:e,thisObject:i},r=0;r<a.length;r++){var o=a[r];if(o.listener==e&&o.thisObject==i)return}a.push(n)},t.prototype.hasEventListener=function(t){return this._eventsMap&&null!=this._eventsMap[t]},t.prototype.removeEventListener=function(t,e,i){if(null!=this._eventsMap)for(var a=this._eventsMap[t],n=0;a&&n<a.length;n++){var r=a[n];if(r.listener==e&&r.thisObject==i)return void a.splice(n,1)}},t.prototype.removeEventListenerByName=function(t){if(null!=this._eventsMap){var e=this._eventsMap[t];e&&(e.length=0)}},t.prototype.removeEventListenerByTarget=function(t){if(null!=this._eventsMap)for(var e in this._eventsMap){var i=this._eventsMap[e];if(i)for(var a=0;i&&a<i.length;a++){if(i[a].thisObject==t)return void i.splice(a,1)}}},t.prototype.removeEventListenerByNameAndTarget=function(t,e){if(null!=this._eventsMap){var i=this._eventsMap[t];if(i)for(var a=0;i&&a<i.length;a++){if(i[a].thisObject==e)return void i.splice(a,1)}}},t.prototype.dispatchEvent=function(t){var e=this._eventsMap;if(!e)return!0;var i=e[t.type];if(!i)return!0;var a=i.length;if(0==a)return!0;t.target=this;for(var n=[].concat.apply([],i),r=0;r<a;r++){var o=n[r];o&&o.listener.call(o.thisObject,t)}},t}();t.EventDispatcher=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(i,a,n){void 0===i&&(i=0),void 0===a&&(a=0),void 0===n&&(n=0);var r=e.call(this)||this;return r._x=i,r._y=a,r._z=n,r._scaleX=1,r._scaleY=1,r._scaleZ=1,r._rotationX=0,r._rotationY=0,r._rotationZ=0,r.posMatrix=new t.Matrix3D,r}return __extends(i,e),i.prototype.toStringout=function(){return"Object3D("+String(this._x)+","+String(this._y)+","+String(this._z)+")"},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{set:function(t){this._scaleX=this._scaleY=this._scaleZ=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleZ",{get:function(){return this._scaleZ},set:function(t){this._scaleZ=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._rotationX},set:function(t){this._rotationX=t,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(t){this._rotationZ=t,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"px",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"py",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pz",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),i.prototype.updateMatrix=function(){this.posMatrix.identity(),this.posMatrix.appendScale(this._scaleX,this._scaleY,this._scaleZ),this.posMatrix.appendRotation(this._rotationX,t.Vector3D.X_AXIS),this.posMatrix.appendRotation(this._rotationY,t.Vector3D.Y_AXIS),this.posMatrix.appendRotation(this._rotationZ,t.Vector3D.Z_AXIS),this.posMatrix.appendTranslation(this._x,this._y,this._z)},i.prototype.updateRotationMatrix=function(){},i}(t.EventDispatcher);t.Object3D=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._distance=500,i.offset=new t.Vector3D,i.lastFoucs3D=new t.Vector3D,i.needChange=!0,i.cameraMatrix=new t.Matrix3D,i}return __extends(i,e),Object.defineProperty(i.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=t},enumerable:!0,configurable:!0}),i.prototype.lookAt=function(t){this.lookAtTarget=t},Object.defineProperty(i.prototype,"astarRect",{set:function(e){this._astarRect=new t.Rectangle,this._astarRect.x=e.x,this._astarRect.y=e.y,this._astarRect.width=e.width,this._astarRect.height=e.height,this._midPos=new t.Vector3D,this._midPos.x=this._astarRect.x+this._astarRect.width/2,this._midPos.z=this._astarRect.y+this._astarRect.height/2,this._scaleVec=new t.Vector3D,this._scaleVec.x=(this._astarRect.width-100)/this._astarRect.width,this._scaleVec.z=(this._astarRect.height-100)/this._astarRect.height},enumerable:!0,configurable:!0}),i.prototype.update=function(){if(this.lookAtTarget){if(this._astarRect&&this._astarRect.width<600){var e=new t.Vector3D;e.x=(this.lookAtTarget.px-this._midPos.x)*this._scaleVec.x+this._midPos.x,e.z=(this.lookAtTarget.pz-this._midPos.z)*this._scaleVec.z+this._midPos.z,e.y=this.lookAtTarget.py,t.Scene_data.focus3D.x=e.x,t.Scene_data.focus3D.y=e.y+28,t.Scene_data.focus3D.z=e.z}else t.Scene_data.focus3D.x=this.lookAtTarget.px,t.Scene_data.focus3D.y=this.lookAtTarget.py+28,t.Scene_data.focus3D.z=this.lookAtTarget.pz;this.lastFoucs3D.x!=t.Scene_data.focus3D.x||this.lastFoucs3D.y!=t.Scene_data.focus3D.y||this.lastFoucs3D.z!=t.Scene_data.focus3D.z?(this.lastFoucs3D.x=t.Scene_data.focus3D.x,this.lastFoucs3D.y=t.Scene_data.focus3D.y,this.lastFoucs3D.z=t.Scene_data.focus3D.z,this.needChange=!0):this.needChange=!1}},Object.defineProperty(i.prototype,"postion",{get:function(){return new t.Vector3D(this.x,this.y,this.z)},enumerable:!0,configurable:!0}),i}(t.Object3D);t.Camera3D=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.Orange7a2f21="[7a2f21]",t.Orange9a683f="[9a683f]",t.Orange853d07="[853d07]",t.Brown6a4936="[6a4936]",t.Brown623424="[623424]",t.Brownac8965="[ac8965]",t.Reddb4051="[db4051]",t.Redd92200="[d92200]",t.Redff0000="[ff0000]",t.Brownd8d49c="[d8d49c]",t.color843b11="[843b11]",t.colorb96d49="[b96d49]",t.colorcd2000="[cd2000]",t.colorfef3d7="[fef3d7]",t.color9a683f="[9a683f]",t.Brown7a2f21="[7a2f21]",t.Brown40120a="[40120a]",t.Brown491207="[491207]",t.Brown541616="[541616]",t.Brown5a2610="[5a2610]",t.Browndf9a68="[df9a68]",t.Browndb39264="[b39264]",t.Brownd662c0d="[662c0d]",t.colorefe4c4="[efe4c4]",t.color802626="[802626]",t.color9f7b4d="[9f7b4d]",t.color4b0808="[4b0808]",t.color5f5c59="[5f5c59]",t.color903713="[903713]",t.colorfdf6da="[fdf6da]",t.color73301c="[73301c]",t.colorffeeb5="[ffeeb5]",t.Green98ec2c="   ",t.Green56da35="[56da35]",t.Green20a200="[20a200]",t.Greenadff00="[adff00]",t.Green2ca937="[2ca937]",t.Green464b11="[464b11]",t.Green54db36="[54db36]",t.Yellowf7d253="[f7d253]",t.Yellowffecc6="[ffecc6]",t.Yellowffd500="[ffd500]",t.Yellowffe9b4="[ffe9b4]",t.Yellowedce7e="[edce7e]",t.color4c1c07="[4c1c07]",t.Whiteffffff="[ffffff]",t.Whitefffce6="[fffce6]",t.Whitefff7db="[fff7db]",t.White9A683F="[9A683F]",t.Black000000="[000000]",t.Whitefff4d6="[fff4d6]",t.Whiteffeed0="[ffeed0]",t.Whiteffeec9="[ffeec9]",t.Whiteffe9b4="[ffe9b4]",t.Whitefff0b4="[fff0b4]",t.Coffeeff9200="[ff9200]",t.Coffeefee87b="[fee87b]",t.color2daa35="[2daa35]",t.color4392ff="[4392ff]",t.colorb759ff="[b759ff]",t.colorff7200="[ff7200]",t.colorce0a00="[ce0a00]",t.coloraa874a="[aa874a]",t.colorffecc6="[ffecc6]",t.colorfde87e="[fde87e]",t.colord6e7ff="[d6e7ff]",t.colord27262e="[27262e]",t.colorffe9b4="[ffe9b4]",t.color9c9b9b="[9c9b9b]",t.colorfff2d3="[fff2d3]",t.color451800="[451800]",t}();t.ColorType=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(t){this._keys=new Array,this._values=new Array;for(var e=0;t&&e<t.length;e++)this[t[e].key]=t[e].value,this._keys.push(t[e].key),this._values.push(t[e].value)}return t.prototype.add=function(t,e){this[t]=e,this._keys.push(t),this._values.push(e)},t.prototype.has=function(t){return!!this[t]},t.prototype.remove=function(t){var e=this._keys.indexOf(t,0);this._keys.splice(e,1),this._values.splice(e,1),delete this[t]},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.containsKey=function(t){return void 0!==this[t]},t.prototype.toLookup=function(){return this},t}();t.Dictionary=e;!function(){function t(){this._item=new Array}t.prototype.add=function(t){this._item.push(t)},t.prototype.has=function(t){for(var e=0;e<this._item.length;e++)if(this._item[e]==t)return!0;return!1}}()}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.prototype.destory=function(){},t}();t.GC=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._useNum=0,e.idleTime=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"useNum",{get:function(){return this._useNum},set:function(t){this._useNum=t,0==this._useNum&&(this.idleTime=0)},enumerable:!0,configurable:!0}),e.prototype.clearUseNum=function(){this._useNum--,this._useNum<=0&&(this.idleTime=e.GCTime)},e.GCTime=4,e}(t.GC);t.ResCount=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.vertices=new Array,t.uvs=new Array,t.indexs=new Array,t.lightuvs=new Array,t.normals=new Array,t.tangents=new Array,t.bitangents=new Array,t.treNum=0,t.compressBuffer=!1,t.hasdispose=!1,t}return __extends(i,e),i.prototype.destory=function(){this.vertices.length=0,this.vertices=null,this.uvs.length=0,this.uvs=null,this.indexs.length=0,this.indexs=null,this.lightuvs.length=0,this.lightuvs=null,this.normals.length=0,this.normals=null,this.tangents.length=0,this.tangents=null,this.bitangents.length=0,this.bitangents=null,this.vertexBuffer&&(t.Scene_data.context3D.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null),this.uvBuffer&&(t.Scene_data.context3D.deleteBuffer(this.uvBuffer),this.uvBuffer=null),this.indexBuffer&&(t.Scene_data.context3D.deleteBuffer(this.indexBuffer),this.indexBuffer=null),this.lightUvBuffer&&(t.Scene_data.context3D.deleteBuffer(this.lightUvBuffer),this.lightUvBuffer=null),this.normalsBuffer&&(t.Scene_data.context3D.deleteBuffer(this.normalsBuffer),this.normalsBuffer=null),this.tangentBuffer&&(t.Scene_data.context3D.deleteBuffer(this.tangentBuffer),this.tangentBuffer=null),this.bitangentBuffer&&(t.Scene_data.context3D.deleteBuffer(this.bitangentBuffer),this.bitangentBuffer=null),this.hasdispose=!0},i}(t.ResCount);t.ObjData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.boneIDAry=new Array,t.boneWeightAry=new Array,t.boneNewIDAry=new Array,t.particleAry=new Array,t}return __extends(i,e),i.prototype.getBindPosMatrix=function(){for(var e=new Array,i=new Array,a=0;a<this.bindPosAry.length;a++){var n=this.bindPosAry[a],r=new t.Quaternion(n[0],n[1],n[2]);r.setMd5W();var o=r.toMatrix3D();o.appendTranslation(n[3],n[4],n[5]),i.push(o.clone()),o.invert(),e.push(o)}this.bindPosMatrixAry=e,this.bindPosInvertMatrixAry=i},i.prototype.destory=function(){e.prototype.destory.call(this),this.materialParam&&(this.materialParam.destory(),this.materialParam=null,this.materialParamData=null),this.boneIDAry.length=0,this.boneWeightAry.length=0,this.boneNewIDAry.length=0,this.boneIDAry=null,this.boneWeightAry=null,this.boneNewIDAry=null,this.boneWeightBuffer&&(t.Scene_data.context3D.deleteBuffer(this.boneWeightBuffer),this.boneWeightBuffer=null),this.boneIdBuffer&&(t.Scene_data.context3D.deleteBuffer(this.boneIdBuffer),this.boneIdBuffer=null),this.material&&this.material.clearUseNum(),this.particleAry.length=0,this.particleAry=null},i}(t.ObjData);t.MeshData=e;var i=function(t,e){this.url=t,this.socketName=e};t.BindParticle=i}(tl3d||(tl3d={})),function(t){var e=function(){function e(){var e=this;this._dic=new Object;var i=t.Util.getRandomNumAssgin(1,3e4,35e3)[0];Laya.timer.loop(i,this,(function(){e.gc()}))}return e.prototype.gc=function(){var e=[];for(var i in this._dic){e.push(i);var a=this._dic[i];a.useNum<=0&&(a.idleTime++,a.idleTime>=t.ResCount.GCTime&&(a.destory(),delete this._dic[i]))}},e}();t.ResGC=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.setTextureNum=0,this.setProgramNum=0}return e.prototype.init=function(t){var e=t.getContext("webgl",{stencil:!0,alpha:!0,depth:!0,antialias:!0})||t.getContext("experimental-webgl",{stencil:!0,alpha:!0,depth:!0,antialias:!0});this.renderContext=e,this._contextSetTest=new a},e.prototype.resetSize=function(t,e){this.renderContext.viewport(0,0,t,e)},e.prototype.uploadBuff3D=function(t){var e=this.renderContext.getParameter(this.renderContext.ARRAY_BUFFER_BINDING),i=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,i),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,new Float32Array(t),this.renderContext.STATIC_DRAW),e&&this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,e),this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,this.nullBuff),i},e.prototype.uploadBuff3DArrayBuffer=function(t){var e=this.renderContext.getParameter(this.renderContext.ARRAY_BUFFER_BINDING),i=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,i),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,t,this.renderContext.STATIC_DRAW),e&&this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,e),this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,this.nullBuff),i},e.prototype.uploadBuff3DByBuffer=function(t,e){var i=this.renderContext.getParameter(this.renderContext.ARRAY_BUFFER_BINDING);this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,t),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,new Float32Array(e),this.renderContext.STATIC_DRAW),i&&this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,i)},e.prototype.uploadIndexBuff3D=function(t){var e=this.renderContext.getParameter(this.renderContext.ELEMENT_ARRAY_BUFFER_BINDING),i=this.renderContext.createBuffer();for(this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,i);t.length%4!=0;)t.push(0);return this.renderContext.bufferData(this.renderContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.renderContext.STATIC_DRAW),e&&this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,e),this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,this.nullBuff),i},e.prototype.uploadIndexBuff3DByBuffer=function(t,e){var i=this.renderContext.getParameter(this.renderContext.ELEMENT_ARRAY_BUFFER_BINDING);this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,t),this.renderContext.bufferData(this.renderContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this.renderContext.STATIC_DRAW),i&&this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,i)},e.prototype.clearContext=function(){this.renderContext.depthMask(!0),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT)},e.prototype.update=function(){this._contextSetTest.clear(),this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,null),this.renderContext.clearColor(63/255,63/255,63/255,1),this.renderContext.clearDepth(1),this.renderContext.clearStencil(0),this.renderContext.enable(this.renderContext.DEPTH_TEST),this.renderContext.depthMask(!0),this.renderContext.enable(this.renderContext.BLEND),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT),this.setBlendParticleFactors(0),this.renderContext.disable(this.renderContext.CULL_FACE),this.setTextureNum=0,this.setProgramNum=0},e.prototype.updateFBO=function(t){this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,t.frameBuffer),this.renderContext.clearColor(63/255,63/255,63/255,1),this.renderContext.clearDepth(1),this.renderContext.clearStencil(0),this.renderContext.enable(this.renderContext.DEPTH_TEST),this.renderContext.depthMask(!0),this.renderContext.enable(this.renderContext.BLEND),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT),this.setBlendParticleFactors(0),this.renderContext.disable(this.renderContext.CULL_FACE)},e.prototype.setDepthTest=function(t){t?this.renderContext.enable(this.renderContext.DEPTH_TEST):this.renderContext.disable(this.renderContext.DEPTH_TEST)},e.prototype.setWriteDepth=function(t){this._contextSetTest.testZbuffer(t)||this.renderContext.depthMask(t)},e.prototype.setBlendParticleFactors=function(t){if(!this._contextSetTest.testBlend(t))switch(t){case 0:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE_MINUS_SRC_ALPHA);break;case 1:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE);break;case 2:this.renderContext.blendFunc(this.renderContext.DST_COLOR,this.renderContext.ZERO);break;case 3:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE_MINUS_SRC_COLOR);break;case 4:this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE);break;case-1:this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE_MINUS_SRC_ALPHA)}},e.prototype.setProgram=function(t){this._contextSetTest.testProgram(t)||(this.renderContext.useProgram(t),this.setProgramNum++)},e.prototype.getLocation=function(t,e){return this.renderContext.getUniformLocation(t,e)},e.prototype.setVcMatrix3fv=function(t,e,i){this.renderContext.uniformMatrix3fv(t.getWebGLUniformLocation(e),!1,i)},e.prototype.setVcMatrix4fv=function(t,e,i){this.renderContext.uniformMatrix4fv(t.getWebGLUniformLocation(e),!1,i)},e.prototype.setVpMatrix=function(t,e){this._contextSetTest.testVp()||this.renderContext.uniformMatrix4fv(t.getWebGLUniformLocation("vpMatrix3D"),!1,e)},e.prototype.setVc4fv=function(t,e,i){this.renderContext.uniform4fv(t.getWebGLUniformLocation(e),i)},e.prototype.setVc1fv=function(t,e,i){this.renderContext.uniform1fv(t.getWebGLUniformLocation(e),i)},e.prototype.setVc3fv=function(t,e,i){this.renderContext.uniform3fv(t.getWebGLUniformLocation(e),i)},e.prototype.setVc2fv=function(t,e,i){this.renderContext.uniform2fv(t.getWebGLUniformLocation(e),i)},e.prototype.setVcFloat=function(t,e,i){this.renderContext.uniform1fv(t.getWebGLUniformLocation(e),i)},e.prototype.setuniform3f=function(t,e,i,a,n){this.renderContext.uniform3f(t.getWebGLUniformLocation(e),i,a,n)},e.prototype.setVcMatrix4fvLocation=function(t,e){this.renderContext.uniformMatrix4fv(t,!1,e)},e.prototype.setVc2f=function(t,e,i,a){this.renderContext.uniform2f(t.getWebGLUniformLocation(e),i,a)},e.prototype.setVcMatrix2fvLocation=function(t,e){this.renderContext.uniformMatrix2fv(t,!1,e)},e.prototype.setVc4fvLocation=function(t,e){this.renderContext.uniform4fv(t,e)},e.prototype.setVa=function(t,e,i){this._contextSetTest.testVa(i),this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,i),this.renderContext.enableVertexAttribArray(t),this.renderContext.vertexAttribPointer(t,e,this.renderContext.FLOAT,!1,0,0)},e.prototype.pushVa=function(t){return!!this._contextSetTest.testVa(t)||(this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,t),!1)},e.prototype.setVaOffset=function(t,e,i,a){this._contextSetTest.enableVaAry[t]||(this.renderContext.enableVertexAttribArray(t),this._contextSetTest.enableVaAry[t]=!0),this.renderContext.vertexAttribPointer(t,e,this.renderContext.FLOAT,!1,i,a)},e.prototype.clearVa=function(t){this._contextSetTest.enableVaAry[t]=!1,this.renderContext.disableVertexAttribArray(t)},e.prototype.drawCall=function(t,e){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,t),this.renderContext.drawElements(this.renderContext.TRIANGLES,e,this.renderContext.UNSIGNED_SHORT,0)},e.prototype.drawLine=function(t,e){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,t),this.renderContext.drawElements(this.renderContext.LINES,e,this.renderContext.UNSIGNED_SHORT,0)},e.prototype.setRenderTexture=function(t,e,i,a,n){void 0===n&&(n=!0),n&&this._contextSetTest.testTexture(e,i)||(0==a?this.renderContext.activeTexture(this.renderContext.TEXTURE0):1==a?this.renderContext.activeTexture(this.renderContext.TEXTURE1):2==a?this.renderContext.activeTexture(this.renderContext.TEXTURE2):3==a?this.renderContext.activeTexture(this.renderContext.TEXTURE3):4==a?this.renderContext.activeTexture(this.renderContext.TEXTURE4):5==a?this.renderContext.activeTexture(this.renderContext.TEXTURE5):6==a&&this.renderContext.activeTexture(this.renderContext.TEXTURE6),this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,i),this.renderContext.uniform1i(t.getWebGLUniformLocation(e),a),this.setTextureNum++)},e.prototype.setRenderTextureCube=function(t,e,i,a){0==a?this.renderContext.activeTexture(this.renderContext.TEXTURE0):1==a?this.renderContext.activeTexture(this.renderContext.TEXTURE1):2==a?this.renderContext.activeTexture(this.renderContext.TEXTURE2):3==a?this.renderContext.activeTexture(this.renderContext.TEXTURE3):4==a?this.renderContext.activeTexture(this.renderContext.TEXTURE4):5==a?this.renderContext.activeTexture(this.renderContext.TEXTURE5):6==a&&this.renderContext.activeTexture(this.renderContext.TEXTURE6),this.renderContext.bindTexture(this.renderContext.TEXTURE_CUBE_MAP,i),this.renderContext.uniform1i(this.renderContext.getUniformLocation(t,e),a)},e.prototype.updateTexture=function(t,e,i,a){this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,t),this.renderContext.texSubImage2D(this.renderContext.TEXTURE_2D,0,e,i,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,a)},e.prototype.getTexture=function(e,i,a,n){void 0===i&&(i=0),void 0===a&&(a=0),void 0===n&&(n=0);var r=new t.Rectangle(0,0,Math.pow(2,Math.ceil(Math.log(e.width)/Math.log(2))),Math.pow(2,Math.ceil(Math.log(e.height)/Math.log(2))));if(r.width!=e.width||r.height!=e.height){var o=t.UIManager.getInstance().getContext2D(r.width,r.height,!1);return o.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),this.getTexture(o.canvas,0,0)}var s,h,c=this.renderContext.getParameter(this.renderContext.TEXTURE_BINDING_2D),u=this.renderContext.createTexture();return this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,u),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGBA,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,e),s=0==a?this.renderContext.LINEAR:this.renderContext.NEAREST,0==a?0==n?h=this.renderContext.LINEAR:1==n?h=this.renderContext.LINEAR_MIPMAP_LINEAR:2==n&&(h=this.renderContext.LINEAR_MIPMAP_NEAREST):0==n?h=this.renderContext.NEAREST:1==n?h=this.renderContext.NEAREST_MIPMAP_LINEAR:2==n&&(h=this.renderContext.NEAREST_MIPMAP_NEAREST),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,s),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,h),0==i?(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.REPEAT),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.REPEAT)):(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.CLAMP_TO_EDGE),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.CLAMP_TO_EDGE)),0!=n&&this.renderContext.generateMipmap(this.renderContext.TEXTURE_2D),c&&this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,c),u},e.prototype.creatTexture=function(t,e,i){void 0===i&&(i=0);var a=this.renderContext.getParameter(this.renderContext.TEXTURE_BINDING_2D),n=this.renderContext.createTexture();return this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,n),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,this.renderContext.LINEAR),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,this.renderContext.LINEAR),0==i?(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.REPEAT),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.REPEAT)):(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.CLAMP_TO_EDGE),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.CLAMP_TO_EDGE)),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGB,t,e,0,this.renderContext.RGB,this.renderContext.UNSIGNED_BYTE,null),a&&this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,a),n},e.prototype.createFramebuffer=function(){var t=this.renderContext.createFramebuffer();return this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,t),t},e.prototype.deleteBuffer=function(t){this.renderContext.deleteBuffer(t)},e.prototype.deleteTexture=function(t){this.renderContext.deleteTexture(t)},e.prototype.deleteShader=function(t){this.renderContext.deleteShader(t.vShader),this.renderContext.deleteShader(t.fShader),this.renderContext.deleteProgram(t.program)},e.prototype.cullFaceBack=function(t){this._contextSetTest.testCull(t)||(t?(this.renderContext.enable(this.renderContext.CULL_FACE),this.renderContext.cullFace(this.renderContext.FRONT)):this.renderContext.disable(this.renderContext.CULL_FACE))},e.prototype.getFBO=function(){var t=i.fw,e=i.fh,a=this.renderContext.createFramebuffer();this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,a);var n=this.renderContext.createRenderbuffer();this.renderContext.bindRenderbuffer(this.renderContext.RENDERBUFFER,n),this.renderContext.renderbufferStorage(this.renderContext.RENDERBUFFER,this.renderContext.DEPTH_COMPONENT16,t,e),this.renderContext.framebufferRenderbuffer(this.renderContext.FRAMEBUFFER,this.renderContext.DEPTH_ATTACHMENT,this.renderContext.RENDERBUFFER,n);var r=this.renderContext.getParameter(this.renderContext.TEXTURE_BINDING_2D),o=this.renderContext.createTexture();this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,o),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGBA,t,e,0,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,null),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,this.renderContext.LINEAR),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,this.renderContext.LINEAR),this.renderContext.framebufferTexture2D(this.renderContext.FRAMEBUFFER,this.renderContext.COLOR_ATTACHMENT0,this.renderContext.TEXTURE_2D,o,0),this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,null),this.renderContext.bindRenderbuffer(this.renderContext.RENDERBUFFER,null),this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,null);var s=new i;return s.frameBuffer=a,s.depthBuffer=n,s.texture=o,r&&this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,r),s},e.prototype.clearTest=function(){this._contextSetTest.clear()},e}();t.Context3D=e;var i=function(){function t(){}return t.fw=512,t.fh=512,t}();t.FBO=i;var a=function(){function t(){this.enableVaAry=new Array,this.vaAry=new Array,this._blendType=-1e3,this._cullType=!1,this._zbufferType=!0,this._vpMatrix=!1}return t.prototype.testTexture=function(t,e){return this._textureDic[t]==e||(this._textureDic[t]=e,!1)},t.prototype.testProgram=function(t){return this._program==t||(this._program=t,this._textureDic=new Object,this._vpMatrix=!1,!1)},t.prototype.testVa=function(t){return this._vabuffer==t||(this._vabuffer=t,!1)},t.prototype.clear=function(){this._blendType=-1e3,this._cullType=!1,this._vpMatrix=!1,this._program=null,this._vabuffer=null},t.prototype.testBlend=function(t){return this._blendType==t||(this._blendType=t,!1)},t.prototype.testCull=function(t){return this._cullType==t||(this._cullType=t,!1)},t.prototype.testZbuffer=function(t){return this._zbufferType==t||(this._zbufferType=t,!1)},t.prototype.testVp=function(){return!!this._vpMatrix||(this._vpMatrix=!0,!1)},t}();t.ContextSetTest=a}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return Object.defineProperty(t,"viewMatrx3D",{get:function(){return t._viewMatrx3D},set:function(e){t._viewMatrx3D=e},enumerable:!0,configurable:!0}),t.sceneViewHW=500,t.fileRoot="",t.fileSub="",t.soundPath="skill/sound/",t.verticalScene=!1,t.effectsLev=2,t.camFar=1e3,t.frameTime=1e3/60,t.MAX_NUMBER=1e7,t.scaleLight=[2],t.useByte=!0,t.fogColor=[0,0,0],t.fogData=[825,.003],t.gameAngle=0,t.sceneNumId=0,t.supportBlob=!1,t}();t.Scene_data=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.fragment=t.getFragmentShaderString(),t}return __extends(i,e),i.prototype.encode=function(){this.vertex=this.getVertexShaderString();var e=t.Scene_data.context3D.renderContext;try{this.program=e.createProgram()}catch(t){console.error("engin init error")}return this.vShader=e.createShader(e.VERTEX_SHADER),this.fShader=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(this.vShader,this.vertex),e.shaderSource(this.fShader,this.fragment),e.compileShader(this.vShader),e.compileShader(this.fShader),e.attachShader(this.program,this.vShader),e.attachShader(this.program,this.fShader),this.binLocation(e),e.linkProgram(this.program),this.localDic=new Object,!0},i.prototype.getWebGLUniformLocation=function(e){var i=this.localDic[e];return i||(this.localDic[e]=t.Scene_data.context3D.getLocation(this.program,e),this.localDic[e])},i.prototype.binLocation=function(t){},i.prototype.getVertexShaderString=function(){return""},i.prototype.getFragmentShaderString=function(){return""},i.prototype.destory=function(){this.vertex=null,this.fragment=null,this.name=null,this.localDic=null,t.Scene_data.context3D.deleteShader(this)},i}(t.ResCount);t.Shader3D=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.sceneVisible=!0,e._hasDestory=!1,e._onStage=!1,e}return __extends(e,t),e.prototype.update=function(){},Object.defineProperty(e.prototype,"onStage",{get:function(){return this._onStage},enumerable:!0,configurable:!0}),e.prototype.addStage=function(){this._onStage=!0},e.prototype.removeStage=function(){this._onStage=!1},e.prototype.resize=function(){},e.prototype.destory=function(){this.objData&&this.objData.useNum--},e}(t.Object3D);t.Display3D=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"u2Texture")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec2 u2Texture;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return"precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor =infoUv;\n}"},e.BaseDiplay3dShader="BaseDiplay3dShader",e}(t.Shader3D);t.BaseDiplay3dShader=e;var i=function(i){function a(){var t=i.call(this)||this;return t.initData(),t.updateMatrix,t}return __extends(a,i),a.prototype.initData=function(){t.ProgrmaManager.getInstance().registe(e.BaseDiplay3dShader,new e),this.shader=t.ProgrmaManager.getInstance().getProgram(e.BaseDiplay3dShader),this.program=this.shader.program,this.objData=new t.ObjData,this.objData.vertices=new Array,this.objData.vertices.push(0,0,0),this.objData.vertices.push(100,0,0),this.objData.vertices.push(100,0,100),this.objData.uvs=new Array,this.objData.uvs.push(0,0),this.objData.uvs.push(1,0),this.objData.uvs.push(0,1),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2),this.loadTexture(),this.upToGpu()},a.prototype.loadTexture=function(){var e=t.UIManager.getInstance().getContext2D(128,128,!1);e.fillStyle="rgb(255,255,255)",e.fillRect(0,0,128,128),this._uvTextureRes=t.TextureManager.getInstance().getCanvasTexture(e)},a.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},a.prototype.update=function(){this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},a}(t.Display3D);t.BaseDiplay3dSprite=i}(tl3d||(tl3d={})),function(t){var e=function(e){function a(){var i=e.call(this)||this;return i.batchPos=new Array,i.objData=new t.ObjData,i.watchCaramMatrix=new t.Matrix3D,i.shader=t.ProgrmaManager.getInstance().getProgram(t.Sprite2DShader.SPRITE2D_SHADER),i.program=i.shader.program,i}return __extends(a,e),a.prototype.setInfo=function(e,i,a){this._imgAtlas||(this._imgAtlas=new t.UIAtlas),this._imgAtlas.setInfo(e,i,a)},a.prototype.getSprite=function(t){var e=new i;return e.uvData=this._imgAtlas.getRec(t),e},a.prototype.addSprite=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i++)this.batchPos.push(t[i]);this.applyData()},a.prototype.applyData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var e=0;e<this.batchPos.length;e++){var i=this.batchPos[e].uvData,a=i.pixelHeight/i.pixelWitdh;this.objData.vertices.push(-.5*i.width,1*a*i.width,0,.5*i.width,1*a*i.width,0,.5*i.width,0,0,-.5*i.width,0,0),this.objData.uvs.push(i.x,i.y,e,i.x+i.width,i.y,e,i.x+i.width,i.y+i.height,e,i.x,i.y+i.height,e),this.objData.indexs.push(4*e,1+4*e,2+4*e,4*e,2+4*e,3+4*e)}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),t.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},a.prototype.update=function(){if(0!=this.batchPos.length){this.watchCaramMatrix.identity(),this.watchCaramMatrix.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),this.watchCaramMatrix.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS),t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"watchCamMatrix3D",this.watchCaramMatrix.m);for(var e=0;e<this.batchPos.length;e++)t.Scene_data.context3D.setVc4fv(this.shader,"posdata["+e+"]",this.batchPos[e].posData);t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this._imgAtlas.texture,0),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},a}(t.Display3D);t.Display2DSprite=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.posData=[0,0,0,100],e}return __extends(e,t),e.prototype.setPos=function(t,e,i){this.x=t,this.y=e,this.z=i},Object.defineProperty(e.prototype,"scale",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this.posData[3]=100*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{set:function(t){this._x=t,this.posData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{set:function(t){this._y=t,this.posData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{set:function(t){this._z=t,this.posData[2]=t},enumerable:!0,configurable:!0}),e}(t.Object3D)}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.batchPos=new Array,i._time=0,i._allFrame=12,i._uvData=[0,0],i._uWidth=0,i._vWidth=0,i._state=0,i.frameRate=3,i.objData=new t.ObjData,i.watchCaramMatrix=new t.Matrix3D,i.shader=t.ProgrmaManager.getInstance().getProgram(t.Movie2DShader.MOVIE2D_SHADER),i.program=i.shader.program,i}return __extends(i,e),i.prototype.update=function(){this.watchCaramMatrix.identity(),this.watchCaramMatrix.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),this.watchCaramMatrix.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS),t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"watchCamMatrix3D",this.watchCaramMatrix.m);for(var e=0;e<this.batchPos.length;e++)t.Scene_data.context3D.setVc4fv(this.shader,"posdata["+e+"]",this.batchPos[e].posData);t.Scene_data.context3D.setVc2fv(this.shader,"outuv",this._uvData),t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.movieTexture,0),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},i.prototype.updateFrame=function(e){this._time+=e;var i=t.Util.float2int(this._time/(2*t.Scene_data.frameTime)/this.frameRate);i>=this._allFrame&&(0==this._state?(this._time=0,i=0):1==this._state?i=this._allFrame-1:2==this._state?(this.play("stand"),i=0,this._state=0):this._state),this._uvData[0]=i*this._uWidth},i.prototype.play=function(t,e){void 0===e&&(e=0),this._state=e,this._time=0,"walk"==t?this._uvData[1]=this._vWidth:-1!=t.indexOf("attack")?this._uvData[1]=2*this._vWidth:this._uvData[1]=0},i.prototype.addSun=function(t){this.batchPos.push(t)},i.prototype.setUrl=function(t){},i.prototype.initData=function(e,i,a,n,r,o){void 0===o&&(o=!1),this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0,this._uWidth=a,this._vWidth=n,this._allFrame=r;for(var s=0;s<e;s++){this.objData.vertices.push(-.5*i,1,0,.5*i,1,0,.5*i,0,0,-.5*i,0,0);var h=0;o&&(h=t.Util.float2int(r*Math.random())*a),this.objData.uvs.push(0+h,0,s,a+h,0,s,a+h,1*n,s,0+h,1*n,s),this.objData.indexs.push(4*s,1+4*s,2+4*s,4*s,2+4*s,3+4*s)}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),t.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},i.prototype.addStage=function(){if(e.prototype.addStage.call(this),this.batchPos.length)for(var t=0;t<this.batchPos.length;t++)this.batchPos[t].add()},i.prototype.removeStage=function(){if(e.prototype.removeStage.call(this),this.batchPos.length)for(var t=0;t<this.batchPos.length;t++)this.batchPos[t].remove()},i}(t.Display3D);t.Display2dMovie=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.shader=t.ProgrmaManager.getInstance().getProgram(t.SkyShader.Sky_Shader),i.program=i.shader.program,i}return __extends(i,e),i.prototype.setObjUrl=function(e){var i=this;this.objurl=e,t.ObjDataManager.getInstance().getObjData(t.Scene_data.fileRoot+e,(function(t){i.objData=t}))},i.prototype.setCubeUrl=function(e){var i=this;t.TextureManager.getInstance().loadCubeTexture(e,(function(t){i.cubeTextList=t}))},i.prototype.update=function(){t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),this.cubeTextList&&t.Scene_data.context3D.setRenderTextureCube(this.program,"s_texture",this.cubeTextList[0],0),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.normalsBuffer),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},i}(t.Display3D);t.Display3DSky=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.time=0,i.dynamic=!1,i._rotationMatrix=new t.Matrix3D,i}return __extends(i,e),Object.defineProperty(i.prototype,"aabbVect",{get:function(){if(!this._aabbVect){var e=this.aabb,i=e.x,a=e.y,n=e.z,r=e.width,o=e.height,s=e.depth;this._aabbVect=new Array,this._aabbVect.push(new t.Vector3D(i,a,n)),this._aabbVect.push(new t.Vector3D(i+r,a,n)),this._aabbVect.push(new t.Vector3D(i,a+o,n)),this._aabbVect.push(new t.Vector3D(i,a,n+s)),this._aabbVect.push(new t.Vector3D(i+r,a+o,n)),this._aabbVect.push(new t.Vector3D(i+r,a,n+s)),this._aabbVect.push(new t.Vector3D(i,a+o,n+s)),this._aabbVect.push(new t.Vector3D(i+r,a+o,n+s))}return this._aabbVect},enumerable:!0,configurable:!0}),i.prototype.setObjUrl=function(e){var i=this;this.objurl=e,t.ObjDataManager.getInstance().getObjData(t.Scene_data.fileRoot+e,(function(e){i.objData=e,i.material&&(i.objData.tangentBuffer||t.ObjDataManager.getInstance().creatTBNBuffer(i.objData))}))},i.prototype.setPicUrl=function(e){var i=this;this.picUrl=e,t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+e,(function(t){i.baseTexture=t}))},i.prototype.setLightMapUrl=function(e){var i=this;if(e&&""!=e){var a=t.Scene_data.fileRoot+e;t.TextureManager.getInstance().getTexture(a,(function(t){i.lightMapTextureRes=t}))}},Object.defineProperty(i.prototype,"lightMapTexture",{get:function(){return this.lightMapTextureRes?this.lightMapTextureRes.texture:null},enumerable:!0,configurable:!0}),i.prototype.setMaterialUrl=function(e,i){var a=this;void 0===i&&(i=null),e=(e=e.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),this.materialUrl=t.Scene_data.fileRoot+e,t.MaterialManager.getInstance().getMaterialByte(this.materialUrl,(function(e){a.material=e,a.material.useNormal&&a.objData&&!a.objData.tangentBuffer&&t.ObjDataManager.getInstance().creatTBNBuffer(a.objData),(a.material.usePbr||a.material.directLight)&&(a._rotationData=new Float32Array(9),a.updateRotationMatrix()),i&&(a.materialParam=new t.MaterialBaseParam,a.materialParam.setData(a.material,i))}),null,!0,t.MaterialShader.MATERIAL_SHADER,t.MaterialShader)},Object.defineProperty(i.prototype,"lightProbe",{get:function(){return this._lightProbe},set:function(e){if(this._lightProbe=e,this._lightProbe&&!this.resultSHVec){this.resultSHVec=new Array;for(var i=[.4444730390920146,-.3834955622240026,-.33124467509627725,.09365654209093091,-.05673310882817577,.2120523322966496,.02945768486978205,-.04965996229802928,-.1136529129285836],a=0;a<9;a++)this.resultSHVec.push(new t.Vector3D(i[a],i[a],i[a]))}},enumerable:!0,configurable:!0}),i.prototype.update=function(){this.dynamic&&!this.sceneVisible||this.updateMaterial()},i.prototype.updateMaterial=function(){this.material&&this.objData&&(t.Scene_data.context3D.setBlendParticleFactors(this.material.blendMode),t.Scene_data.context3D.cullFaceBack(this.material.backCull),this.updateBind(),t.Scene_data.context3D.setProgram(this.material.program),t.Scene_data.context3D.setWriteDepth(this.material.writeZbuffer),t.Scene_data.context3D.setVcMatrix4fv(this.material.shader,"posMatrix3D",this.posMatrix.m),this.setCam(),this.setMaterialVc(this.material,this.materialParam),this.setMaterialTexture(this.material,this.materialParam),this.setDirectLight(this.material),this.setMaterialVa(),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},i.prototype.setMaterialVa=function(){this.objData.compressBuffer?this.setMaterialVaCompress():this.setMaterialVaIndependent()},i.prototype.setMaterialVaIndependent=function(){t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this.material.directLight||this.material.noLight||t.Scene_data.context3D.setVa(2,2,this.objData.lightUvBuffer),(this.material.usePbr||this.material.directLight)&&(t.Scene_data.context3D.setVa(3,3,this.objData.normalsBuffer),t.Scene_data.context3D.setVcMatrix3fv(this.material.shader,"rotationMatrix3D",this._rotationData)),this.material.useNormal&&(t.Scene_data.context3D.setVa(4,3,this.objData.tangentBuffer),t.Scene_data.context3D.setVa(5,3,this.objData.bitangentBuffer))},i.prototype.setMaterialVaCompress=function(){t.Scene_data.context3D.pushVa(this.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.objData.stride,this.objData.uvsOffsets),this.material.directLight||this.material.noLight||t.Scene_data.context3D.setVaOffset(2,2,this.objData.stride,this.objData.lightuvsOffsets),(this.material.usePbr||this.material.directLight)&&(t.Scene_data.context3D.setVaOffset(3,3,this.objData.stride,this.objData.normalsOffsets),t.Scene_data.context3D.setVcMatrix3fv(this.material.shader,"rotationMatrix3D",this._rotationData)),this.material.useNormal&&(t.Scene_data.context3D.setVaOffset(4,3,this.objData.stride,this.objData.tangentsOffsets),t.Scene_data.context3D.setVaOffset(5,3,this.objData.stride,this.objData.bitangentsOffsets)))},i.prototype.setDirectLight=function(e){e.directLight&&(t.Scene_data.context3D.setVc3fv(e.shader,"ambientColor",t.Scene_data.light.ambientColor),t.Scene_data.context3D.setVc3fv(e.shader,"sunDirect",t.Scene_data.light.sunDirect),t.Scene_data.context3D.setVc3fv(e.shader,"sunColor",t.Scene_data.light.sunColor))},i.prototype.setCam=function(){t.Scene_data.context3D.setVpMatrix(this.material.shader,t.Scene_data.vpMatrix.m)},i.prototype.setBind=function(e,i){this.bindTarget=e,this.bindSocket=i,this.bindMatrix=new t.Matrix3D},i.prototype.setGroup=function(e,i,a){this._isInGroup=!0,this._groupPos=e,this._groupRotation=i,this._groupScale=a,this.groupMatrix=new t.Matrix3D,this.groupRotationMatrix=new t.Matrix3D,this.groupMatrix.isIdentity=!1,this.groupMatrix.identity(),this.groupMatrix.appendScale(a.x,a.y,a.z),this.groupMatrix.appendRotation(i.x,t.Vector3D.X_AXIS),this.groupMatrix.appendRotation(i.y,t.Vector3D.Y_AXIS),this.groupMatrix.appendRotation(i.z,t.Vector3D.Z_AXIS),this.groupMatrix.appendTranslation(e.x,e.y,e.z),this.groupRotationMatrix.isIdentity=!1,this.groupRotationMatrix.identity(),this.groupRotationMatrix.prependRotation(i.z,t.Vector3D.Z_AXIS),this.groupRotationMatrix.prependRotation(i.y,t.Vector3D.Y_AXIS),this.groupRotationMatrix.prependRotation(i.x,t.Vector3D.X_AXIS)},i.prototype.updateBind=function(){this.bindTarget&&(this.posMatrix.identity(),this.posMatrix.appendScale(this._scaleX,this._scaleY,this._scaleZ),this._isInGroup&&this.posMatrix.append(this.groupMatrix),this.bindTarget.getSocket(this.bindSocket,this.bindMatrix),this.posMatrix.append(this.bindMatrix),this.bindMatrix.copyTo(this._rotationMatrix),this._rotationMatrix.identityPostion(),this._isInGroup&&this._rotationMatrix.prepend(this.groupRotationMatrix),this.sceneVisible=this.bindTarget.visible)},i.prototype.setBaseMaterialVc=function(e){var i=0;e.hasTime&&(i=(t.TimeUtil.getTimer(this._scene?this._scene.startTime:t.TimeUtil.START_TIME)-this.time)%1e5*.001),(e.hasTime||e.usePbr||e.useKill)&&t.Scene_data.context3D.setVc4fv(e.shader,"fc0",[1,0,e.killNum,i]),e.scaleLightMap&&t.Scene_data.context3D.setVcFloat(e.shader,"scalelight",t.Scene_data.scaleLight),(e.usePbr||1==e.fogMode)&&this.setCamPos(e),0!=e.fogMode&&(t.Scene_data.context3D.setVc2fv(e.shader,"fogdata",t.Scene_data.fogData),t.Scene_data.context3D.setVc3fv(e.shader,"fogcolor",t.Scene_data.fogColor))},i.prototype.setCamPos=function(e){e.updateCam(t.Scene_data.cam3D.x/100,t.Scene_data.cam3D.y/100,t.Scene_data.cam3D.z/100)},i.prototype.setMaterialVc=function(e,i){if(void 0===i&&(i=null),!(e.fcNum<=0)){var a=0;e.hasTime&&(a=(t.TimeUtil.getTimer(this._scene?this._scene.startTime:t.TimeUtil.START_TIME)-this.time)%1e5*.001),e.update(a),this.setCamPos(e),i&&i.update(),t.Scene_data.context3D.setVc4fv(e.shader,"fc",e.fcData)}},i.prototype.setMaterialTexture=function(e,i){void 0===i&&(i=null);for(var a=e.texList,n=0;n<a.length;n++)if(a[n].type==t.TexItem.LIGHTMAP)t.Scene_data.context3D.setRenderTexture(e.shader,a[n].name,this.lightMapTexture,a[n].id);else if(a[n].type==t.TexItem.LTUMAP&&t.Scene_data.pubLut)t.Scene_data.context3D.setRenderTexture(e.shader,a[n].name,t.Scene_data.pubLut,a[n].id);else if(a[n].type==t.TexItem.CUBEMAP)if(e.useDynamicIBL);else{var r=Math.floor(5*e.roughness);if(t.Scene_data.skyCubeMap){var o=t.Scene_data.skyCubeMap[r];t.Scene_data.context3D.setRenderTextureCube(e.program,a[n].name,o,a[n].id)}}else a[n].texture&&t.Scene_data.context3D.setRenderTexture(e.shader,a[n].name,a[n].texture,a[n].id);if(i)for(n=0;n<i.dynamicTexList.length;n++)i.dynamicTexList[n].target&&t.Scene_data.context3D.setRenderTexture(e.shader,i.dynamicTexList[n].target.name,i.dynamicTexList[n].texture,i.dynamicTexList[n].target.id)},i.prototype.checkMaterialTexture=function(e){for(var i=e.texList,a=0;a<i.length;a++)if(i[a].type==t.TexItem.LIGHTMAP){if(!this.lightMapTexture)return!1}else if(i[a].type==t.TexItem.LTUMAP){if(!t.Scene_data.pubLut)return!1}else if(i[a].type==t.TexItem.CUBEMAP){if(e.useDynamicIBL);else if(!t.Scene_data.skyCubeMap)return!1}else if(!i[a].texture)return!1;return!0},i.prototype.updateRotationMatrix=function(){try{this._rotationMatrix.identity(),this._rotationMatrix.appendRotation(this._rotationX,t.Vector3D.X_AXIS),this._rotationMatrix.appendRotation(this._rotationY,t.Vector3D.Y_AXIS),this._rotationMatrix.appendRotation(this._rotationZ,t.Vector3D.Z_AXIS),this._rotationData&&this._rotationMatrix.getRotaion(this._rotationData)}catch(t){}},i.prototype.setPos=function(t){this.x=t.x,this.y=t.y+10,this.z=t.z},i.prototype.destory=function(){e.prototype.destory.call(this),this.name=null,this.objurl=null,this.picUrl=null,this.materialUrl=null,this.material&&this.material.useNum--,this.materialParam&&(this.materialParam.destory(),this.materialParam=null),this.lightMapTextureRes&&this.lightMapTextureRes.clearUseNum(),this._rotationMatrix=null,this._rotationData=null,this.bindMatrix=null,this.bindTarget=null,this.bindSocket=null,this._groupPos=null,this._groupRotation=null,this._groupScale=null,this.groupMatrix=null,this.groupRotationMatrix=null},i}(t.Display3D);t.Display3DSprite=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.uiMatrix=new t.Matrix3D,i.uiMatrix.prependTranslation(0,0,600),i.uiMatrix.prependRotation(-15,t.Vector3D.X_AXIS),i.uiMatrix.prependRotation(0,t.Vector3D.Y_AXIS),i.uiViewMatrix=new t.Matrix3D,i}return __extends(i,e),i.prototype.loadRes=function(e){var i=this;this.modelRes||(this.modelRes=new t.ModelRes),this.modelRes.load(t.Scene_data.fileRoot+t.UnitFunction.getModelUrl(e),(function(){i.loadResComFinish()}))},i.prototype.loadResComFinish=function(){this.setObjUrl(this.modelRes.objUrl),this.setMaterialUrl(this.modelRes.materialUrl)},i.prototype.loadGroup=function(e){var i=this,a=new t.GroupRes;a.load(t.Scene_data.fileRoot+"model/"+e+".txt",(function(){i.loadPartRes(a)}))},i.prototype.loadPartRes=function(e){for(var i=0;i<e.dataAry.length;i++){var a=e.dataAry[i];a.types==t.BaseRes.SCENE_PARTICLE_TYPE||a.types==t.BaseRes.PREFAB_TYPE&&(this.setObjUrl(a.objUrl),this.setMaterialUrl(a.materialUrl,a.materialInfoArr))}},i.prototype.resize=function(){this.uiViewMatrix.identity(),this.uiViewMatrix.perspectiveFieldOfViewLH(1,1,500,5e3),this.uiViewMatrix.appendScale(1e3/t.Scene_data.stageWidth,1e3/t.Scene_data.stageHeight,1)},i.prototype.setCam=function(){t.Scene_data.context3D.setVcMatrix4fv(this.material.shader,"viewMatrix3D",this.uiViewMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.material.shader,"camMatrix3D",this.uiMatrix.m)},i.prototype.update=function(){t.Scene_data.context3D.setWriteDepth(!0),t.Scene_data.context3D.setDepthTest(!0),e.prototype.update.call(this),t.Scene_data.context3D.setWriteDepth(!1),t.Scene_data.context3D.setDepthTest(!1)},i}(t.Display3DSprite);t.Display3DUISprite=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._completeState=0,t._optCbTime=1,t._optCbCurTime=0,t._defaultAction="stand",t._curentFrame=0,t._actionTime=0,t.isBreak=!0,t._fileScale=1,t._hasDestory=!1,t._isSinging=!1,t.meshVisible=!0,t._nextScale=1,t.locationDic=new Object,t._animDic=new Object,t._partDic=new Object,t._partUrl=new Object,t._preLoadActionDic=new Object,t._waitLoadActionDic=new Object,t.showCapsule=!1,t._enablePhysics=!1,t}return __extends(i,e),Object.defineProperty(i.prototype,"isSinging",{get:function(){return this._isSinging},set:function(t){this._isSinging=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"curentAction",{get:function(){return this._curentAction},set:function(t){this._curentAction=t},enumerable:!0,configurable:!0}),i.prototype.fixAstartData=function(t){},i.prototype.setRoleUrl=function(e,i){var a=this;e!==this._curMeshUrl&&(this._curMeshUrl=e,this._curMeshLoadCom=!1,this.clearMesh(),t.MeshDataManager.getInstance().getMeshData(e,(function(t){a._hasDestory?t.useNum--:e===a._curMeshUrl?a._curMeshLoadCom?t.useNum--:(a._curMeshLoadCom=!0,a._skinMesh=t,a.fileScale=t.fileScale,a.onStage&&a.addSkinMeshParticle(),a._animDic=t.animDic,a.onMeshLoaded(),i&&i()):t.useNum--})))},i.prototype.onMeshLoaded=function(){this.dispatchEvent(new t.BaseEvent(t.BaseEvent.COMPLETE))},i.prototype.clearMesh=function(){this.removeSkinMeshParticle(),this._skinMesh&&this._skinMesh.useNum--,this._skinMesh=null,this._animDic=new Object},i.prototype.addSkinMeshParticle=function(){if(this._skinMesh){var e=new Array;this._partDic.mesh=e;var i=this._skinMesh.meshAry;if(i)for(var a=0;a<i.length;a++)for(var n=i[a].particleAry,r=0;r<n.length;r++){var o,s=n[r];(o=t.ParticleManager.getInstance().getParticleByte(t.Scene_data.fileRoot+s.url)).sourceData||console.log("particle.sourceData error",o,s),o.dynamic=!0,o.bindSocket=s.socketName,e.push(o),o.bindTarget=this,this._scene.addParticle(o)}}},i.prototype.removeSkinMeshParticle=function(){this._partDic||(this._partDic=new Object);var t=this._partDic.mesh;if(t){for(var e=0;e<t.length;e++)this._scene.removeParticle(t[e]),t[e].destory();this._partDic.mesh=null}},i.prototype.roleResCom=function(t,e){},i.prototype.setMeshUrl=function(e,i){var a=this;void 0===i&&(i=1),this._meshUrl=t.Scene_data.fileRoot+e,t.MeshDataManager.getInstance().getMeshData(this._meshUrl,(function(t){for(var e in a._skinMesh=t,1!=i&&(a._skinMesh.type=1),a._animDic)a.processAnimByMesh(a._animDic[e]);t.loadMaterial((function(t){a.loadMaterialCom(t)})),a.fileScale=t.fileScale}),i)},Object.defineProperty(i.prototype,"scale",{get:function(){return this._nextScale},set:function(t){this._nextScale=t,this._scaleX=t*this._fileScale,this._scaleY=t*this._fileScale,this._scaleZ=t*this._fileScale,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fileScale",{set:function(t){this._fileScale=t,this._scaleX=this._nextScale*t,this._scaleY=this._nextScale*t,this._scaleZ=this._nextScale*t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadow",{set:function(e){e?this._shadow||(this._shadow=t.ShadowManager.getInstance().addShadow()):this._shadow&&t.ShadowManager.getInstance().removeShadow(this._shadow)},enumerable:!0,configurable:!0}),i.prototype.setShadowSize=function(t){this._shadow&&(this._shadow.size=t)},i.prototype.addStage=function(){e.prototype.addStage.call(this),this.addSkinMeshParticle(),this._shadow&&(this._shadow.visible=!0)},i.prototype.removeStage=function(){for(var i in e.prototype.removeStage.call(this),this._curMeshUrl=null,this._shadow&&t.ShadowManager.getInstance().removeShadow(this._shadow),this._partDic)for(var a=this._partDic[i],n=0;n<a.length;n++)a[n]instanceof t.CombineParticle?this._scene.removeParticle(a[n]):a[n]instanceof t.Display3DSprite&&this._scene.removeSpriteDisplay(a[n])},i.prototype.loadMaterialCom=function(t){t.lightProbe&&(this.lightProbe=!0)},i.prototype.setCollision=function(t,e){},i.prototype.applyVisible=function(){},i.prototype.removePart=function(e){var i=this._partDic[e];if(i){for(var a=0;a<i.length;a++)i[a]instanceof t.CombineParticle?(this._scene.removeParticle(i[a]),i[a].destory()):i[a]instanceof t.Display3DSprite&&(this._scene.removeSpriteDisplay(i[a]),i[a].destory());this._partDic[e]=null,this._partUrl[e]=null,delete this._partDic[e],delete this._partUrl[e]}},i.prototype.addPart=function(e,i,a){var n=this;if(this._partUrl[e]!=a){this._partUrl[e]&&this.removePart(e),this._partDic[e]||(this._partDic[e]=new Array),this._partUrl[e]=a;var r=this._partDic[e];this._scene.groupDataMgr.getGroupData(t.Scene_data.fileRoot+a,(function(t){n.loadPartRes(i,t,r)}))}},i.prototype.loadPartRes=function(e,i,a){if(!this._hasDestory){for(var n=0;n<i.dataAry.length;n++){var r,o,s,h=i.dataAry[n];if(h.isGroup&&(r=new t.Vector3D(h.x,h.y,h.z),o=new t.Vector3D(h.rotationX,h.rotationY,h.rotationZ),s=new t.Vector3D(h.scaleX,h.scaleY,h.scaleZ)),h.types==t.BaseRes.SCENE_PARTICLE_TYPE){var c=t.ParticleManager.getInstance().getParticleByte(t.Scene_data.fileRoot+h.particleUrl);a.push(c),c.bindTarget=this,c.bindSocket=e,c.dynamic=!0,this._scene.addParticle(c),h.isGroup&&c.setGroup(r,o,s)}else if(h.types==t.BaseRes.PREFAB_TYPE){var u=new t.Display3DSprite;u.setObjUrl(h.objUrl),u.setMaterialUrl(h.materialUrl,h.materialInfoArr),u.dynamic=!0,a.push(u),u.setBind(this,e),this._scene.addSpriteDisplay(u),h.isGroup&&u.setGroup(r,o,s)}}this.applyVisible()}},i.prototype.getSocket=function(e,i){try{if(i.identity(),!this._skinMesh)return void i.append(this.posMatrix);if(!this._skinMesh.boneSocketDic[e])return void((e="none")?i.appendTranslation(this._x,this._y,this._z):i.append(this.posMatrix));var a,n=this._skinMesh.boneSocketDic[e],r=n.index;a=this.getFrameMatrix(r),i.appendScale(1/this._scaleX,1/this._scaleY,1/this._scaleZ),i.appendRotation(n.rotationX,t.Vector3D.X_AXIS),i.appendRotation(n.rotationY,t.Vector3D.Y_AXIS),i.appendRotation(n.rotationZ,t.Vector3D.Z_AXIS),i.appendTranslation(n.x,n.y,n.z),a&&(i.append(this._skinMesh.meshAry[this._skinMesh.meshAry.length-1].bindPosInvertMatrixAry[r]),i.append(a)),i.append(this.posMatrix)}catch(t){console.error("出错啦",t)}},i.prototype.getSunType=function(){return 0},i.prototype.getFrameMatrix=function(t){if(this._animDic[this.curentAction]){var e=this._animDic[this.curentAction];return this._curentFrame>=e.matrixAry.length?e.matrixAry[0][t]:e.matrixAry[this._curentFrame][t]}return this._animDic[this._defaultAction]?(e=this._animDic[this._defaultAction]).matrixAry[this._curentFrame][t]:null},i.prototype.addAction=function(t,e,i){void 0===i&&(i=!1),this._preLoadActionDic[t]=e,(t==this._defaultAction||t==this.curentAction||i)&&this.setAnimUrl(t,e)},i.prototype.setAnimUrl=function(e,i){var a=this;this._waitLoadActionDic[e]=!0,t.AnimManager.getInstance().getAnimData(i,(function(t){a._animDic[e]=t,a.processAnimByMesh(t),a._waitLoadActionDic[e]=!1}))},i.prototype.randomPlayAction=function(){var e=Object.keys(this._animDic),i=e[t.Util.random(e.length)];this.play(i,2)},i.prototype.play=function(t,e,i,a,n){if(void 0===e&&(e=0),void 0===i&&(i=!0),this.isBreak&&this.curentAction!=t)return this._completecb=n,this._optCbCurTime=0,this.curentAction=t,this._comboBackAction=a||this._defaultAction,this._completeState=e,this._actionTime=0,this.updateFrame(0),!!this._animDic.hasOwnProperty(t)||(!this._waitLoadActionDic[t]&&this._preLoadActionDic[t]&&this.setAnimUrl(t,this._preLoadActionDic[t]),!1)},i.prototype.processAnimByMesh=function(t){if(this._skinMesh&&!t.hasProcess){for(var e=0;e<t.matrixAry.length;e++)for(var i=t.matrixAry[e],a=0;a<i.length;a++)i[a].prepend(this._skinMesh.meshAry[0].bindPosMatrixAry[a]);t.hasProcess=!0}},i.prototype.update=function(){if(this._skinMesh){if(this.lightProbe&&(this.resultSHVec=t.LightProbeManager.getInstance().getData(new t.Vector3D(this.x,this.y+10,this.z))),this.updateBind(),this.meshVisible)for(var e=0;this._skinMesh&&this._skinMesh.meshAry&&e<this._skinMesh.meshAry.length;e++)this.updateMaterialMesh(this._skinMesh.meshAry[e]);this.showCapsule&&this.updateShowCapsule()}},i.prototype.updateFrame=function(e){var i;if(this._actionTime+=e,this.curentAction&&this._animDic[this.curentAction])i=this.curentAction;else{if(!this._animDic[this._defaultAction])return;i=this._defaultAction}var a=this._animDic[i];this._curentFrame=t.Util.float2int(this._actionTime/(2*t.Scene_data.frameTime)),this._curentFrame>=a.matrixAry.length&&(this._completecb&&this._optCbCurTime<this._optCbTime&&(this._optCbCurTime++,this._completecb()),0==this._completeState?(this._actionTime=0,this._curentFrame=0):1==this._completeState?this._curentFrame=a.matrixAry.length-1:2==this._completeState?(this._curentFrame=0,this._completeState=0,this.changeAction(this._defaultAction)):3==this._completeState&&(this._curentFrame=0,this._completeState=0,this.changeAction(this._comboBackAction),this._completeState=2))},i.prototype.changeAction=function(t){this.curentAction=t},i.prototype.destory=function(){for(var i in e.prototype.destory.call(this),this._skinMesh&&this._skinMesh.useNum--,this._partDic)for(var a=this._partDic[i],n=0;a&&n<a.length;n++)(a[n]instanceof t.CombineParticle||a[n]instanceof t.Display3DSprite)&&a[n].destory();this._partDic=null,this._hasDestory=!0},i.prototype.updateShowCapsule=function(){this.capsuleLineSprite?(this.capsuleLineSprite.x=this.x,this.capsuleLineSprite.y=this.y+this._capsule.radius,this.capsuleLineSprite.z=this.z,this.capsuleLineSprite.update()):(this.capsuleLineSprite=new t.LineDisplaySprite,this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new t.Vector3D(1,0,0,1),this.drawCylinder(this._capsule.radius,this._capsule.height),this.drawBall(this._capsule.radius),this.capsuleLineSprite.upToGpu())},i.prototype.drawBall=function(e){var i,a,n,r,o,s,h,c=e;for(o=0;o<=12;o++)for(n=null,r=6;r<12;r++)i=new t.Vector3D(c,0,0),(a=new t.Matrix3D).appendRotation(30*r,t.Vector3D.Z_AXIS),i=a.transformVector(i),(s=new t.Matrix3D).appendRotation(30*o,t.Vector3D.Y_AXIS),i=s.transformVector(i),n&&this.capsuleLineSprite.makeLineMode(n,i),n=i.clone();for(o=1;o<=4;o++)for((s=new t.Matrix3D).appendRotation(-20*o,t.Vector3D.Z_AXIS),h=s.transformVector(new t.Vector3D(c,0,0)),n=null,r=0;r<12;r++)i=h.clone(),(a=new t.Matrix3D).appendRotation(30*r,t.Vector3D.Y_AXIS),i=a.transformVector(i),n&&this.capsuleLineSprite.makeLineMode(n,i),11==r&&this.capsuleLineSprite.makeLineMode(h,i),n=i.clone()},i.prototype.drawCylinder=function(e,i){var a,n,r,o=e,s=i;for(r=0;r<12;r++){var h=new t.Vector3D(o,0,0),c=new t.Vector3D(o,+s,0),u=new t.Matrix3D;u.appendRotation(30*r,t.Vector3D.Y_AXIS);var l=u.transformVector(h),d=u.transformVector(c);this.capsuleLineSprite.makeLineMode(l,d),this.capsuleLineSprite.makeLineMode(d,new t.Vector3D(0,+s,0)),11==r&&(this.capsuleLineSprite.makeLineMode(l,h),this.capsuleLineSprite.makeLineMode(d,c)),(a||n)&&(this.capsuleLineSprite.makeLineMode(l,a),this.capsuleLineSprite.makeLineMode(d,n)),a=l.clone(),n=d.clone()}},i.prototype.setVcMatrix=function(e){t.Scene_data.context3D.setVpMatrix(e.material.shader,t.Scene_data.vpMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"posMatrix3D",this.posMatrix.m)},i.prototype.setVa=function(t){t.compressBuffer?this.setVaCompress(t):this.setVaIndependent(t)},i.prototype.setVaIndependent=function(e){t.Scene_data.context3D.setVa(0,3,e.vertexBuffer),t.Scene_data.context3D.setVa(1,2,e.uvBuffer),t.Scene_data.context3D.setVa(2,4,e.boneIdBuffer),t.Scene_data.context3D.setVa(3,4,e.boneWeightBuffer),e.material.usePbr?(t.Scene_data.context3D.setVa(4,4,e.normalsBuffer),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"rotationMatrix3D",this._rotationMatrix.m),e.material.useNormal&&(t.Scene_data.context3D.setVa(5,4,e.tangentBuffer),t.Scene_data.context3D.setVa(6,4,e.bitangentBuffer))):(e.material.lightProbe||e.material.directLight)&&(t.Scene_data.context3D.setVa(4,4,e.normalsBuffer),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"rotationMatrix3D",this._rotationMatrix.m))},i.prototype.setVaCompress=function(e){t.Scene_data.context3D.pushVa(e.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,e.stride,0),t.Scene_data.context3D.setVaOffset(1,2,e.stride,e.uvsOffsets),t.Scene_data.context3D.setVaOffset(2,4,e.stride,e.boneIDOffsets),t.Scene_data.context3D.setVaOffset(3,4,e.stride,e.boneWeightOffsets),e.material.usePbr?(t.Scene_data.context3D.setVaOffset(4,3,e.stride,e.normalsOffsets),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"rotationMatrix3D",this._rotationMatrix.m),e.material.useNormal&&(t.Scene_data.context3D.setVaOffset(5,3,e.stride,e.tangentsOffsets),t.Scene_data.context3D.setVaOffset(6,3,e.stride,e.bitangentsOffsets))):(e.material.lightProbe||e.material.directLight)&&(t.Scene_data.context3D.setVaOffset(4,3,e.stride,e.normalsOffsets),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"rotationMatrix3D",this._rotationMatrix.m)))},i.prototype.clearVa=function(){t.Scene_data.context3D.clearVa(2),t.Scene_data.context3D.clearVa(3),t.Scene_data.context3D.clearVa(4),t.Scene_data.context3D.clearVa(5),t.Scene_data.context3D.clearVa(6)},i.prototype.updateMaterialMesh=function(e){e.material&&(t.Scene_data.context3D.setProgram(e.material.program),t.Scene_data.context3D.cullFaceBack(!1),t.Scene_data.context3D.setBlendParticleFactors(e.material.blendMode),this.setVcMatrix(e),this.setMaterialVc(e.material,e.materialParam),this.setMaterialTexture(e.material,e.materialParam),this.setVa(e),this.setDirectLight(e.material),this.setMeshVc(e),t.Scene_data.context3D.drawCall(e.indexBuffer,e.treNum))},i.prototype.setLightProbeVc=function(e){if(e.lightProbe)for(var i=0;i<this.resultSHVec.length;i++)t.Scene_data.context3D.setVc3fv(e.shader,"sh["+i+"]",[this.resultSHVec[i].x,this.resultSHVec[i].y,this.resultSHVec[i].z])},i.prototype.setMeshVc=function(e){var i;if(this._animDic[this.curentAction])i=this._animDic[this.curentAction];else{if(!this._animDic[this._defaultAction])return;i=this._animDic[this._defaultAction]}var a=i.getBoneQPAryByMesh(e)[e.uid][this._curentFrame];a&&(t.Scene_data.context3D.setVc4fv(e.material.shader,"boneQ",a.quat),t.Scene_data.context3D.setVc3fv(e.material.shader,"boneD",a.pos))},i.prototype.setPos=function(t){e.prototype.setPos.call(this,t),this._shadow&&(this._shadow.x=t.x,this._shadow.y=t.y+8,this._shadow.z=t.z)},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.updateMatrix(),this._shadow&&(this._shadow.x=t),this.changePos()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.updateMatrix(),this._shadow&&(this._shadow.y=t),this.changePos()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.updateMatrix(),this._shadow&&(this._shadow.z=t),this.changePos()},enumerable:!0,configurable:!0}),i.prototype.changePos=function(){},i}(t.Display3DSprite);t.Display3dMovie=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.batchNum=0,t.batchPos=new Array,t}return __extends(i,e),Object.defineProperty(i.prototype,"fileScale",{set:function(t){this._fileScale=t;for(var e=0;e<this.batchPos.length;e++)this.batchPos[e].fileScale=t},enumerable:!0,configurable:!0}),i.prototype.addSun=function(t){this.batchPos.push(t),t.fileScale=this._fileScale},i.prototype.setVcMatrix=function(e){t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"rotationMatrix3D",this._rotationMatrix.m);for(var i=0;i<this.batchPos.length;i++)t.Scene_data.context3D.setVcMatrix4fv(e.material.shader,"posMatrixAry["+i+"]",this.batchPos[i].posMatrix.m)},i.prototype.setLightProbeVc=function(t){},i.prototype.setVa=function(e){t.Scene_data.context3D.setVa(0,3,e.vertexBuffer),t.Scene_data.context3D.setVa(1,3,e.uvBuffer),t.Scene_data.context3D.setVa(2,4,e.boneIdBuffer),t.Scene_data.context3D.setVa(3,4,e.boneWeightBuffer),e.material.usePbr?(t.Scene_data.context3D.setVa(4,4,e.normalsBuffer),e.material.useNormal&&(t.Scene_data.context3D.setVa(5,4,e.tangentBuffer),t.Scene_data.context3D.setVa(6,4,e.bitangentBuffer))):(e.material.lightProbe||e.material.directLight)&&t.Scene_data.context3D.setVa(4,4,e.normalsBuffer)},i.prototype.addStage=function(){if(e.prototype.addStage.call(this),this.batchPos.length)for(var t=0;t<this.batchPos.length;t++)this.batchPos[t].add()},i.prototype.removeStage=function(){if(e.prototype.removeStage.call(this),this.batchPos.length)for(var t=0;t<this.batchPos.length;t++)this.batchPos[t].remove()},i}(t.Display3dMovie);t.Display3dBatchMovie=e;var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.posData=[0,0,0,10],t.hasReach=!1,t._fileScale=1,t}return __extends(i,e),Object.defineProperty(i.prototype,"shadow",{set:function(e){e&&(this._shadow||(this._shadow=t.ShadowManager.getInstance().addShadow(),this._shadow.x=this._x,this._shadow.y=this._y,this._shadow.z=this._z))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fileScale",{set:function(t){this._fileScale=t,this._scaleX*=t,this._scaleY*=t,this._scaleZ*=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{set:function(t){this._scaleX=t*this._fileScale,this._scaleY=t*this._fileScale,this._scaleZ=t*this._fileScale,this.posData[3]=20*t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.posData[0]=t,this.updateMatrix(),this._shadow&&(this.retinueShadowFix?this._shadow.x=t+this.retinueShadowFix.x:this._shadow.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.posData[1]=t,this.updateMatrix(),this._shadow&&(this.retinueShadowFix?this._shadow.y=t+this.retinueShadowFix.y+2:this._shadow.y=t+2)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.posData[2]=t,this.updateMatrix(),this._shadow&&(this.retinueShadowFix?this._shadow.z=t+this.retinueShadowFix.z:this._shadow.z=t)},enumerable:!0,configurable:!0}),i.prototype.add=function(){this._shadow&&(this._shadow.visible=!0)},i.prototype.remove=function(){this._shadow&&(this._shadow.visible=!1)},i}(t.Object3D);t.Movie3D=i}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._scaleData=[1,1],i.shader=t.ProgrmaManager.getInstance().getProgram(t.UIImageShader.UI_IMG_SHADER),i.program=i.shader,i.initData(),i}return __extends(i,e),i.prototype.initData=function(){this.objData=new t.ObjData,this.objData.vertices.push(-1,1,.99,1,1,.99,1,-1,.99,-1,-1,.99),this.objData.uvs.push(0,0,1,0,1,1,0,1),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=6,this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},i.prototype.resize=function(){this.appleyPos()},i.prototype.setImgInfo=function(t,e,i){this.setImgUrl(t),this._width=e,this._height=i},i.prototype.setImgUrl=function(t){},i.prototype.appleyPos=function(){var e=this._width/t.Scene_data.stageWidth,i=this._height/t.Scene_data.stageHeight;e<i?(this._scaleData[0]=1,this._scaleData[1]=this._height/t.Scene_data.stageHeight/e):(this._scaleData[0]=this._width/t.Scene_data.stageWidth/i,this._scaleData[1]=1)},i.prototype.update=function(){this.appleyPos(),t.Scene_data.context3D.setBlendParticleFactors(0),t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),t.Scene_data.context3D.setVc2fv(this.shader,"scale",this._scaleData),t.Scene_data.context3D.setVcFloat(this.shader,"alpha",[1]),t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},i}(t.Display3D);t.Display3dBg=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.needUpdate=!1,i.locationFloat32=new Float32Array(0),i.shadowList=new Array,i.objData=new t.ObjData,i.shader=t.ProgrmaManager.getInstance().getProgram(t.Display3DShadowShader.Display3DShadowShader),i.program=i.shader.program,i.posProLocation=t.Scene_data.context3D.getLocation(i.program,"pos"),i}return __extends(i,e),i.prototype.addShadow=function(t){this.shadowList.push(t),t.display=this,this.applyObjData()},i.prototype.removeShadow=function(t){var e=this.shadowList.indexOf(t);-1!=e&&(this.shadowList.splice(e,1),this.applyObjData()),this.shadowList.length},i.prototype.stateChage=function(){for(var t=0;t<this.shadowList.length&&!this.shadowList[t].visible;t++);t==this.shadowList.length?this.needUpdate=!1:this.needUpdate=!0},i.prototype.hasIdle=function(){return this.shadowList.length<30},i.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var e=0;e<this.shadowList.length;e++)this.objData.vertices.push(-5,0,5,5,0,5,5,0,-5,-5,0,-5),this.objData.uvs.push(0,0,e,0,1,e,1,1,e,1,0,e),this.objData.indexs.push(4*e,1+4*e,2+4*e,4*e,2+4*e,3+4*e);this.objData.treNum=6*this.shadowList.length,this.objData.vertexBuffer?(t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),t.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},i.prototype.update=function(){if(this.needUpdate=!0,this.needUpdate&&0!=this.shadowList.length&&this.objData.treNum){t.Scene_data.context3D.setBlendParticleFactors(0),t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),this.locationFloat32.length!=4*this.shadowList.length&&(this.locationFloat32=new Float32Array(4*this.shadowList.length));for(var e=0;e<this.shadowList.length;e++)this.shadowList[e].visible?(this.locationFloat32[4*e+0]=this.shadowList[e].data[0],this.locationFloat32[4*e+1]=this.shadowList[e].data[1],this.locationFloat32[4*e+2]=this.shadowList[e].data[2],this.locationFloat32[4*e+3]=this.shadowList[e].data[3]):(this.locationFloat32[4*e+0]=0,this.locationFloat32[4*e+1]=1e4,this.locationFloat32[4*e+2]=0,this.locationFloat32[4*e+3]=0);t.Scene_data.context3D.setVc4fvLocation(this.posProLocation,this.locationFloat32),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",i.texture,0),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},i}(t.Display3D);t.Display3dShadow=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.prototype.mekeUseTexture=function(e){var i=new t.Rectangle(0,0,Math.pow(2,Math.ceil(Math.log(e.width)/Math.log(2))),Math.pow(2,Math.ceil(Math.log(e.height)/Math.log(2))));if(i.width!=e.width||i.height!=e.height){for(var a=new t.BitMapData(i.width,i.height),n=0;n<a.width;n++)for(var r=0;r<a.height;r++){var o=e.getRgb(n/a.width*e.width,r/a.height*e.height);a.setRgb(n,r,o)}return a}return e},e.prototype.calibration=function(){this.idBitmap=this.mekeUseTexture(this.idBitmap),this.infoBitmap=this.mekeUseTexture(this.infoBitmap)},e.meshAllgroundData=function(i){for(var a=i.readInt(),n=i.readInt(),r=new Array,o=0;o<a;o++)for(var s=0;s<n;s++){var h=i.readInt(),c=i.readInt(),u=i.readInt(),l=i.readInt(),d=new e;d.idBitmap=new t.BitMapData(u,l),d.infoBitmap=new t.BitMapData(u,l),d.tx=h,d.ty=c,r.push(d);for(var p=0;p<u;p++)for(var f=0;f<l;f++){var m;switch(i.readByte()){case 0:m=new t.Vector3D(0,1,2);break;case 1:m=new t.Vector3D(0,1,3);break;case 2:m=new t.Vector3D(0,2,3);break;case 3:m=new t.Vector3D(1,2,3);break;default:throw new Error("信息索引没有编入")}d.idBitmap.setRgb(p,f,new t.Vector3D(m.x/255,m.y/255,m.z/255,1));var y=new t.Vector3D;y.x=i.readByte()+128,y.y=i.readByte()+128,y.z=255-y.x-y.y,d.infoBitmap.setRgb(p,f,new t.Vector3D(y.x/255,y.y/255,y.z/255,1))}d.calibration()}for(var _=i.readUTF(),v=0;v<r.length;v++)r[v].sixurl=_;return r},e}();t.GroundDataMesh=e;var i=function(e){function i(){var i=e.call(this)||this;return t.ProgrmaManager.getInstance().registe(t.TerrainDisplay3DShader.TerrainDisplay3DShader,new t.TerrainDisplay3DShader),i.groundShader=t.ProgrmaManager.getInstance().getProgram(t.TerrainDisplay3DShader.TerrainDisplay3DShader),i}return __extends(i,e),i.prototype.update=function(){this.groundShader&&this.baseSixteenRes&&this.idMapPicDataTexture?this.upDataToDraw():e.prototype.update.call(this)},i.prototype.upDataToDraw=function(){this.groundShader&&this.baseSixteenRes&&(t.Scene_data.context3D.cullFaceBack(!1),t.Scene_data.context3D.setProgram(this.groundShader.program),t.Scene_data.context3D.setVcMatrix4fv(this.groundShader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.groundShader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.groundShader,"posMatrix3D",this.posMatrix.m),t.Scene_data.context3D.setVc4fv(this.groundShader,"colorData",[1,0,1,1]),t.Scene_data.context3D.pushVa(this.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.objData.stride,this.objData.uvsOffsets)),t.Scene_data.context3D.setRenderTexture(this.groundShader,"idmaptexture",this.idMapPicDataTexture,0),t.Scene_data.context3D.setRenderTexture(this.groundShader,"infotexture",this.infoMapPicDataTexture,1),t.Scene_data.context3D.setRenderTexture(this.groundShader,"sixtexture",this.baseSixteenRes.texture,2),t.Scene_data.context3D.setRenderTexture(this.groundShader,"lightexture",this.lightMapTexture,3),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},i.prototype.setGrounDataMesh=function(e){var i=this;this.idMapPicDataTexture=t.Scene_data.context3D.getTexture(e.idBitmap.imgData,0,1),this.infoMapPicDataTexture=t.Scene_data.context3D.getTexture(e.infoBitmap.imgData,0,1);var a=e.sixurl;t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+a,(function(t){i.baseSixteenRes=t}))},i}(t.Display3DSprite);t.TerrainDisplay3DSprite=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(t){this.type=t}return t.COMPLETE="complete",t}();t.BaseEvent=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.value=new t.Vector3D,this.offset=0}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this.name="fc"+t,this.offset=4*t},enumerable:!0,configurable:!0}),e.prototype.creat=function(t){this.vecNum=t,this.vecNum[0+this.offset]=this.value.x,this.vecNum[1+this.offset]=this.value.y,this.vecNum[2+this.offset]=this.value.z,this.vecNum[3+this.offset]=this.value.w},e.prototype.setData=function(e){this.id=e.id,this.value=new t.Vector3D(e.value.x,e.value.y,e.value.z,e.value.w),this.paramName0=e.paramName0,this.param0Type=e.param0Type,this.param0Index=e.param0Index,this.paramName1=e.paramName1,this.param1Type=e.param1Type,this.param1Index=e.param1Index,this.paramName2=e.paramName2,this.param2Type=e.param2Type,this.param2Index=e.param2Index,this.paramName3=e.paramName3,this.param3Type=e.param3Type,this.param3Index=e.param3Index},e.prototype.setDynamicOffset=function(t){this.paramName0==t.paramName?t.targetOffset=this.param0Index+this.offset:this.paramName1==t.paramName?t.targetOffset=this.param1Index+this.offset:this.paramName2==t.paramName?t.targetOffset=this.param2Index+this.offset:this.paramName3==t.paramName&&(t.targetOffset=this.param3Index+this.offset)},e.prototype.setDynamicDirect=function(t,e){this.vecNum.set(t,e)},e.prototype.setDynamic=function(t){try{this.vecNum.set(t.currentValue,t.targetOffset)}catch(t){}},e}();t.ConstItem=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.prototype.update=function(t){void 0===t&&(t=0),this.target&&this.target.setDynamic(this)},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),t.prototype.setTargetInfo=function(t,e,i){this.target=t,this.paramName=e,this.type=i,this.target&&this.target.setDynamicOffset(this),this.currentValue=new Array(i)},t.prototype.setCurrentVal=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i++)this.currentValue[i]=t[i]},t}();t.DynamicBaseConstItem=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.prototype.destory=function(){this.textureRes&&this.textureRes.useNum--,this.target=null},Object.defineProperty(t.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),t}();t.DynamicBaseTexItem=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.update=function(t){void 0===t&&(t=0),this.currentValue=this.curve.getValue(t),this.target.setDynamic(this)},Object.defineProperty(i.prototype,"type",{set:function(e){this._type=e,this.curve=new t.Curve,this.curve.type=e},enumerable:!0,configurable:!0}),i}(t.DynamicBaseConstItem);t.DynamicConstItem=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this._textureDynamic&&t.Scene_data.context3D.deleteTexture(this._textureDynamic),this.target=null},i.prototype.initCurve=function(e){this.curve=new t.Curve,this.curve.type=e},Object.defineProperty(i.prototype,"texture",{get:function(){return this._textureDynamic?this._textureDynamic:this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),i.prototype.creatTextureByCurve=function(){var e=0,i=this.curve.valueVec.length-1,a=new Array;for(e=0;e<this.life;e++)if(e<this.curve.begintFrame)a.push(255*this.curve.valueVec[0][0],255*this.curve.valueVec[0][1],255*this.curve.valueVec[0][2],255*this.curve.valueVec[0][3]);else if(e>this.curve.maxFrame)0==this.curve.maxFrame&&this.curve.begintFrame<0?a.push(255,255,255,255):a.push(255*this.curve.valueVec[i][0],255*this.curve.valueVec[i][1],255*this.curve.valueVec[i][2],255*this.curve.valueVec[i][3]);else if(this.curve.begintFrame<0)a.push(255,255,255,255);else{var n=e-this.curve.begintFrame;a.push(255*this.curve.valueVec[n][0],255*this.curve.valueVec[n][1],255*this.curve.valueVec[n][2],255*this.curve.valueVec[n][3])}var r,o=t.UIManager.getInstance().getContext2D(64,2,!1);for(e=0;e<64;e++)r=4*Math.floor(e/64*this.life),o.fillStyle="rgba("+Math.floor(a[r+0])+","+Math.floor(a[r+1])+","+Math.floor(a[r+2])+","+Math.floor(a[r+3])/255+")",o.fillRect(e,0,1,2);this._textureDynamic=t.TextureManager.getInstance().getCanvasTexture(o).texture},Object.defineProperty(i.prototype,"life",{get:function(){return this._life},set:function(t){this._life=t},enumerable:!0,configurable:!0}),i}(t.DynamicBaseTexItem);t.DynamicTexItem=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.texList=new Array,t.constList=new Array,t.killNum=0,t.writeZbuffer=!0,t.fogMode=0,t.fcNum=0,t}return __extends(i,e),i.prototype.update=function(t){this.updateTime(t),this.updateScene()},i.prototype.updateTime=function(t){this.hasTime&&(this.fcData[1]=t)},i.prototype.updateCam=function(t,e,i){if(this.usePbr||1==this.fogMode){var a=4*this.fcIDAry[0];this.fcData[0+a]=t,this.fcData[1+a]=e,this.fcData[2+a]=i}},i.prototype.updateScene=function(){if(this.sceneNumId!=t.Scene_data.sceneNumId){if(this.sceneNumId=t.Scene_data.sceneNumId,0!=this.fogMode)var e=4*this.fcIDAry[1];if(this.scaleLightMap){e=4*this.fcIDAry[2];this.fcData[0+e]=t.Scene_data.scaleLight[0]}}},i.prototype.initFcData=function(){if(this.fcData=new Float32Array(4*this.fcNum),!(this.fcNum<=0)){if(this.sceneNumId=t.Scene_data.sceneNumId,(this.hasTime||this.useKill||0!=this.fogMode)&&(this.useKill&&(this.fcData[0]=this.killNum),0!=this.fogMode&&(this.fcData[2]=t.Scene_data.fogData[0],this.fcData[3]=t.Scene_data.fogData[1])),this.usePbr||1==this.fogMode){var e=4*this.fcIDAry[0];this.fcData[0+e]=t.Scene_data.cam3D.x/100,this.fcData[1+e]=t.Scene_data.cam3D.y/100,this.fcData[2+e]=t.Scene_data.cam3D.z/100}if(0!=this.fogMode){e=4*this.fcIDAry[1];this.fcData[0+e]=t.Scene_data.fogColor[0],this.fcData[1+e]=t.Scene_data.fogColor[1],this.fcData[2+e]=t.Scene_data.fogColor[2]}if(this.scaleLightMap){e=4*this.fcIDAry[2];this.fcData[0+e]=t.Scene_data.scaleLight[0]}}},i.prototype.setCompileData=function(e){if(e){if(this.shaderStr=e.shaderStr,this.hasTime=e.hasTime,this.timeSpeed=e.timeSpeed,this.blendMode=e.blendMode,this.backCull=e.backCull,this.killNum=e.killNum,this.hasVertexColor=e.hasVertexColor,this.usePbr=e.usePbr,this.useNormal=e.useNormal,this.roughness=e.roughness,this.writeZbuffer=e.writeZbuffer,this.hasFresnel=e.hasFresnel,this.useDynamicIBL=e.useDynamicIBL,this.normalScale=e.normalScale,this.lightProbe=e.lightProbe,this.useKill=e.useKill,this.directLight=e.directLight,this.noLight=e.noLight,this.scaleLightMap=e.scaleLightMap,this.fogMode=e.fogMode,this.hasParticleColor=!1,this.initFcData(),e.texList){var i=e.texList;this.texList=new Array;for(var a=0;a<i.length;a++){var n=new t.TexItem;n.id=i[a].id,n.url=i[a].url,n.isDynamic=i[a].isDynamic,n.paramName=i[a].paramName,n.isMain=i[a].isMain,n.isParticleColor=i[a].isParticleColor,n.type=i[a].type,n.wrap=i[a].wrap,n.filter=i[a].filter,n.mipmap=i[a].mipmap,this.texList.push(n),n.isParticleColor&&(this.hasParticleColor=!0)}}if(e.constList)for(i=e.constList,this.constList=new Array,a=0;a<i.length;a++){var r=new t.ConstItem;r.setData(i[a]),r.creat(this.fcData),this.constList.push(r)}}},i.prototype.setByteData=function(t){var e=t,i=e.readInt();if(this.shaderStr=e.readUTF(),this.hasTime=e.readBoolean(),this.timeSpeed=e.readFloat(),this.blendMode=e.readFloat(),this.backCull=e.readBoolean(),this.killNum=e.readFloat(),this.hasVertexColor=e.readBoolean(),this.usePbr=e.readBoolean(),this.useNormal=e.readBoolean(),this.roughness=e.readFloat(),this.writeZbuffer=e.readBoolean(),this.hasFresnel=e.readBoolean(),this.useDynamicIBL=e.readBoolean(),this.normalScale=e.readFloat(),this.lightProbe=e.readBoolean(),this.useKill=e.readBoolean(),this.directLight=e.readBoolean(),this.noLight=e.readBoolean(),this.scaleLightMap=e.readBoolean(),i>2&&(this.fogMode=e.readInt()),i>=22){this.fcNum=e.readByte();var a=e.readByte();this.fcIDAry=new Array;for(var n=0;n<a;n++)this.fcIDAry.push(e.readByte())}this.hasParticleColor=!1,this.initFcData(),this.readTexList(e),this.readConstLis(e)},i.prototype.readConstLis=function(e){var i=e.readInt();this.constList=new Array;for(var a=0;a<i;a++){var n=new t.ConstItem;n.id=e.readFloat(),n.value=new t.Vector3D(e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()),n.paramName0=e.readUTF(),n.param0Type=e.readFloat(),n.param0Index=e.readFloat(),n.paramName1=e.readUTF(),n.param1Type=e.readFloat(),n.param1Index=e.readFloat(),n.paramName2=e.readUTF(),n.param2Type=e.readFloat(),n.param2Index=e.readFloat(),n.paramName3=e.readUTF(),n.param3Type=e.readFloat(),n.param3Index=e.readFloat(),n.creat(this.fcData),this.constList.push(n)}},i.prototype.readTexList=function(e){var i=e.readInt();this.texList=new Array;for(var a=0;a<i;a++){var n=new t.TexItem;n.id=e.readFloat(),n.url=e.readUTF(),n.isDynamic=e.readBoolean(),n.paramName=e.readUTF(),n.isMain=e.readBoolean(),n.isParticleColor=e.readBoolean(),n.type=e.readFloat(),n.wrap=e.readFloat(),n.filter=e.readFloat(),n.mipmap=e.readFloat(),n.isParticleColor&&(this.hasParticleColor=!0),this.texList.push(n)}},i.prototype.destory=function(){for(var t=0;t<this.texList.length;t++)this.texList[t].destory();this.texList=null,this.constList=null,this.shader&&this.shader.clearUseNum()},i}(t.ResCount);t.Material=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.destory=function(){for(var t=0;t<this.dynamicTexList.length;t++)this.dynamicTexList[t].destory();this.dynamicTexList=null,this.dynamicConstList=null},i.prototype.update=function(){if(this.material&&this.dynamicConstList)for(var t=0;t<this.dynamicConstList.length;t++)this.dynamicConstList[t].update()},i.prototype.setData=function(e,i){this.material=e,this.dynamicConstList=new Array,this.dynamicTexList=new Array;for(var a=e.constList,n=e.texList,r=0;r<i.length;r++){var o=i[r];if(0==o.type){var s=new t.DynamicBaseTexItem;s.paramName=o.name;for(var h=0;h<n.length;h++)if(s.paramName==n[h].paramName){s.target=n[h];break}var c=0;s.target&&(c=s.target.mipmap),c=0,t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+o.url,(function(t){s.textureRes=t}),0,null,0,c),this.dynamicTexList.push(s)}else{var u=o.name,l=null;for(h=0;h<a.length;h++)if(u==a[h].paramName0||u==a[h].paramName1||u==a[h].paramName2||u==a[h].paramName3){l=a[h];break}var d=new t.DynamicBaseConstItem;d.setTargetInfo(l,u,o.type),1==o.type?d.setCurrentVal(o.x):2==o.type?d.setCurrentVal(o.x,o.y):d.setCurrentVal(o.x,o.y,o.z),this.dynamicConstList.push(d)}}},i}(t.GC);t.MaterialBaseParam=e}(tl3d||(tl3d={})),function(t){var e=function(e){function a(){var t=e.call(this)||this;return t._loadDic=new Object,t._resDic=new Object,t._regDic=new Object,t}return __extends(a,e),a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.getMaterialByte=function(e,a,n,r,o,s){var h=this;if(void 0===n&&(n=null),void 0===r&&(r=!1),void 0===o&&(o=null),void 0===s&&(s=null),this._dic[e])return n?a(this._dic[e],n):a(this._dic[e]),void this._dic[e].useNum++;var c=new i(a,n,e,r,o,s);this._loadDic[e]?this._loadDic[e].push(c):(this._loadDic[e]=new Array,this._loadDic[e].push(c),this._resDic[e]?(this.meshByteMaterialByt(this._resDic[e],c),this._regDic[e]&&(this._dic[e].useNum+=this._regDic[e],delete this._regDic[e]),delete this._resDic[e]):t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t,e){h.loadMaterialByteCom(t,e)}),c))},a.prototype.meshByteMaterialByt=function(e,i){var a=new t.Material;a.setByteData(e),a.url=i.url,this.loadMaterial(a),i.autoReg&&(a.shader=t.ProgrmaManager.getInstance().getMaterialProgram(i.regName,i.shader3D,a,null,!0),a.program=a.shader.program);for(var n=this._loadDic[i.url],r=0;r<n.length;r++)n[r].info?n[r].fun(a,n[r].info):n[r].fun(a),a.useNum++;delete this._loadDic[i.url],this._dic[i.url]=a},a.prototype.loadMaterialByteCom=function(e,i){var a=new t.TLByteArray(e);this.meshByteMaterialByt(a,i)},a.prototype.addResByte=function(t,e){this._dic[t]||this._resDic[t]||(this._resDic[t]=e)},a.prototype.registerUrl=function(t){t=(t=t.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),this._dic[t]?this._dic[t].useNum++:this._regDic[t]?this._regDic[t]++:this._regDic[t]},a.prototype.releaseUrl=function(t){t=(t=t.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),this._dic[t]&&this._dic[t].clearUseNum()},a.prototype.loadMaterial=function(e){for(var i=e.texList,a=0;a<i.length;a++)i[a].isParticleColor||i[a].isDynamic||0!=i[a].type||t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+i[a].url,(function(t,e){e.textureRes=t}),i[a].wrap,i[a],i[a].filter,i[a].mipmap)},a.prototype.loadDynamicTexUtil=function(e){for(var i=e.dynamicTexList,a=0;a<i.length;a++)i[a].isParticleColor?i[a].creatTextureByCurve():t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+i[a].url,(function(t,e){e.textureRes=t}),0,i[a],0,1)},a}(t.ResGC);t.MaterialManager=e;var i=function(t,e,i,a,n,r){this.fun=t,this.info=e,this.url=i,this.autoReg=a,this.regName=n,this.shader3D=r}}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.destory=function(){this.material.useNum--,this.shader.useNum--,e.prototype.destory.call(this)},i.prototype.setMaterial=function(t){this.material=t,this.materialUrl=t.url,this.dynamicTexList=new Array,this.dynamicConstList=new Array,this.setTexList(),this.setConstList()},i.prototype.setLife=function(t){for(var e=0;e<this.dynamicTexList.length;e++)this.dynamicTexList[e].isParticleColor&&(this.dynamicTexList[e].life=t)},i.prototype.setTexList=function(){for(var e=this.material.texList,i=0;i<e.length;i++){var a;e[i].isParticleColor?((a=new t.DynamicTexItem).target=e[i],a.paramName=e[i].paramName,a.initCurve(4),this.dynamicTexList.push(a),a.isParticleColor=!0):e[i].isDynamic&&((a=new t.DynamicTexItem).target=e[i],a.paramName=e[i].paramName,this.dynamicTexList.push(a))}},i.prototype.setConstList=function(){for(var e=this.material.constList,i=0;i<e.length;i++){var a,n=e[i];0!=n.param0Type&&((a=new t.DynamicConstItem).setTargetInfo(n,n.paramName0,n.param0Type),this.dynamicConstList.push(a)),0!=n.param1Type&&((a=new t.DynamicConstItem).setTargetInfo(n,n.paramName1,n.param1Type),this.dynamicConstList.push(a)),0!=n.param2Type&&((a=new t.DynamicConstItem).setTargetInfo(n,n.paramName2,n.param2Type),this.dynamicConstList.push(a)),0!=n.param3Type&&((a=new t.DynamicConstItem).setTargetInfo(n,n.paramName3,n.param3Type),this.dynamicConstList.push(a))}},i.prototype.setTextObj=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],a=0;a<this.dynamicTexList.length;a++)if(this.dynamicTexList[a].paramName==i.paramName){this.dynamicTexList[a].isParticleColor?this.dynamicTexList[a].curve.setData(i.curve):this.dynamicTexList[a].url=i.url;break}},i.prototype.setConstObj=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],a=0;a<this.dynamicConstList.length;a++)if(this.dynamicConstList[a].paramName==i.paramName){this.dynamicConstList[a].curve.setData(i.curve);break}},i}(t.MaterialBaseParam);t.MaterialParam=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.prototype.destory=function(){this.textureRes&&this.textureRes.clearUseNum()},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this.name="fs"+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),t.LIGHTMAP=1,t.LTUMAP=2,t.CUBEMAP=3,t.HEIGHTMAP=4,t.REFRACTIONMAP=5,t}();t.TexItem=e}(tl3d||(tl3d={})),function(t){var e=function(){};t.TextureCube=e}(tl3d||(tl3d={})),function(t){var e=function(e){function n(){var t=e.call(this)||this;return t._loadDic=new Object,t._resDic=new Object,t.initDefaultLightMapTexture(),t}return __extends(n,e),n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.hasTexture=function(t){return!!this._dic[t]},n.prototype.getTexture=function(e,a,n,r,o,s){var h=this;void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=0),void 0===s&&(s=0);var c=this._dic[e];if(c)return r?a(c,r):a(c),void c.useNum++;var u=new i(a,r,e,n,o,s),l=this._loadDic[e];l?l.push(u):((l=new Array).push(u),this._loadDic[e]=l,this._resDic[e]?(this.loadTextureCom(this._resDic[e],u),delete this._resDic[e]):t.LoadManager.getInstance().load(e,t.LoadManager.IMG_TYPE,(function(t,e){h.loadTextureCom(t,e)}),u))},n.prototype.loadTextureCom=function(e,i){var a=t.Scene_data.context3D.getTexture(e,i.wrap,i.filter,i.mipmap),n=new t.TextureRes(i.url);n.texture=a,n.width=e.width,n.height=e.height;for(var r=this._loadDic[i.url],o=0;o<r.length;o++)r[o].info?r[o].fun(n,r[o].info):r[o].fun(n),n.useNum++;delete this._loadDic[i.url],this._dic[i.url]=n},n.prototype.addRes=function(t,e){this._dic[t]||this._resDic[t]||(this._resDic[t]=e)},n.prototype.removeRes=function(t){this._resDic[t]&&delete this._resDic[t]},n.prototype.getCanvasTexture=function(e){var i=new t.TextureRes(""),a=t.Scene_data.context3D.getTexture(e.canvas,0,0);return i.texture=a,i},n.prototype.updateTexture=function(e,i,a,n){t.Scene_data.context3D.updateTexture(e,i,a,n.canvas)},n.prototype.loadCubeTexture=function(t,e){(new a).loadCube(t,(function(t){e(t)}))},n.prototype.initDefaultLightMapTexture=function(){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=32,e.height=32,i.fillStyle="rgb(51,51,51)",i.fillRect(0,0,32,32),this.defaultLightMap=t.Scene_data.context3D.getTexture(e)},n}(t.ResGC);t.TextureManager=e;var i=function(t,e,i,a,n,r){this.fun=t,this.info=e,this.url=i,this.wrap=a,this.filter=n,this.mipmap=r};t.TextureLoad=i;var a=function(){function e(){this.ary=new Array(6),this.flagNum=0}return e.prototype.loadCube=function(e,i){var a=this;this.fun=i;for(var n=0;n<6;n++){var r=e+"0"+(n+1)+".jpg";t.LoadManager.getInstance().load(r,t.LoadManager.IMG_TYPE,(function(t,e){a.loadCom(t,e)}),{id:n})}},e.prototype.loadCom=function(e,i){var a=e.width/4,n=document.createElement("canvas"),r=n.getContext("2d");n.width=a,n.height=a;var o=t.Scene_data.context3D.renderContext,s=o.createTexture();o.bindTexture(o.TEXTURE_CUBE_MAP,s),r.drawImage(e,2*a,a,a,a,0,0,a,a),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),r.drawImage(e,0,a,a,a,0,0,a,a),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_X,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),r.drawImage(e,a,0,a,a,0,0,a,a),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Y,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),r.drawImage(e,a,2*a,a,a,0,0,a,a),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),r.drawImage(e,a,a,a,a,0,0,a,a),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Z,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),r.drawImage(e,3*a,a,a,a,0,0,a,a),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),this.ary[i.id]=s,this.flagNum++,6==this.flagNum&&this.fun(this.ary)},e}();t.CubemapLoad=a}(tl3d||(tl3d={})),function(t){var e=function(e){function i(t){void 0===t&&(t="");var i=e.call(this)||this;return i.url=t,i}return __extends(i,e),i.prototype.destory=function(){t.Scene_data.context3D.deleteTexture(this.texture)},i}(t.ResCount);t.TextureRes=e}(tl3d||(tl3d={})),function(t){var e=function(){this.a=0,this.b=0,this.c=0,this.d=0};t.ObjectMath=e;var i=function(){function i(){}return i._PanelEquationFromThreePt=function(t,i,a){var n=(i.y-t.y)*(a.z-t.z)-(i.z-t.z)*(a.y-t.y),r=(i.z-t.z)*(a.x-t.x)-(i.x-t.x)*(a.z-t.z),o=(i.x-t.x)*(a.y-t.y)-(i.y-t.y)*(a.x-t.x),s=0-(n*t.x+r*t.y+o*t.z),h=new e;return h.a=n,h.b=r,h.c=o,h.d=s,h},i.calPlaneLineIntersectPoint=function(e,i,a,n){var r=new t.Vector3D,o=e.x,s=e.y,h=e.z,c=i.x,u=i.y,l=i.z,d=a.x-n.x,p=a.y-n.y,f=a.z-n.z,m=n.x,y=n.y,_=n.z,v=d*o+p*s+f*h;if(0==v)return null;var x=((c-m)*o+(u-y)*s+(l-_)*h)/v;return r.x=m+d*x,r.y=y+p*x,r.z=_+f*x,r},i}();t.Calculation=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.setData(t,e,i)}return t.prototype.setData=function(t,e,i){this.x=t,this.y=e,this.radius=i},t.prototype.setPos=function(t,e){this.x=t,this.y=e},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),t.prototype.setRadius=function(t){this.radius=t},t.prototype.testPoint=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<this.radius},t}();t.Circle=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.getGroundPos=function(e,i){if(!this._plantObjectMath){var a=new t.Vector3D(0,-500,500),n=new t.Vector3D(-500,-500,0),r=new t.Vector3D(500,-500,0);this._plantObjectMath=t.Calculation._PanelEquationFromThreePt(a,n,r),this._plantnormal=new t.Vector3D(this._plantObjectMath.a,this._plantObjectMath.b,this._plantObjectMath.c),this._plantnormal.normalize(),this._plane_a=new t.Vector3D(a.x,a.y,a.z)}var o=t.MathUtil.mathDisplay2Dto3DWorldPos(new t.Vector2D(e,i),500),s=new t.Vector3D(t.Scene_data.cam3D.x,t.Scene_data.cam3D.y,t.Scene_data.cam3D.z);return t.Calculation.calPlaneLineIntersectPoint(this._plantnormal,this._plane_a,o,s)},e}();t.Groundposition=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.getCamView=function(e,i){e.update();var a=new t.Matrix3D;a.appendRotation(-i.rotationX,t.Vector3D.X_AXIS),a.appendRotation(-i.rotationY,t.Vector3D.Y_AXIS),a.appendTranslation(i.x,i.y,i.z);var n=a.transformVector(new t.Vector3D(0,0,-e.distance));return e.x=n.x,e.y=n.y,e.z=n.z,e.rotationX=i.rotationX,e.rotationY=i.rotationY,e.cameraMatrix.identity(),e.cameraMatrix.prependTranslation(0,0,e.distance),e.cameraMatrix.prependRotation(e.rotationX,t.Vector3D.X_AXIS),e.cameraMatrix.prependRotation(e.rotationY,t.Vector3D.Y_AXIS),e.cameraMatrix.prependTranslation(-i.x,-i.y,-i.z),this.camOffSetShock(e),this.updateVp(),e.cameraMatrix.m},e.camOffSetShock=function(t){this.SetShock&&t.cameraMatrix.prependTranslation(t.offset.x,t.offset.y,t.offset.z)},e.updateVp=function(){t.Scene_data.vpMatrix.identity(),t.Scene_data.vpMatrix.prepend(t.Scene_data.viewMatrx3D),t.Scene_data.vpMatrix.prepend(t.Scene_data.cam3D.cameraMatrix)},e.MathCam=function(e){var i=new t.Matrix3D;i.prependRotation(e.rotationX,t.Vector3D.X_AXIS),i.prependRotation(e.rotationY,t.Vector3D.Y_AXIS),i.prependTranslation(-e.x,-e.y,-e.z),e.cameraMatrix.identity(),e.cameraMatrix.append(i)},e.GetViewHitBoxData=function(e){t.Scene_data.cam3D.cameraMatrix.clone().invert();var i=t.Scene_data.viewMatrx3D.m[0],a=t.Scene_data.viewMatrx3D.m[5];this.viewBoxVecItem?this.lastViewScale.x==i&&this.lastViewScale.y==a||(this.viewBoxVecItem[0]=new t.Vector3D(-e/i,-e/a,e),this.viewBoxVecItem[1]=new t.Vector3D(-e/i,+e/a,e),this.viewBoxVecItem[2]=new t.Vector3D(+e/i,-e/a,e),this.viewBoxVecItem[3]=new t.Vector3D(+e/i,+e/a,e),this.viewBoxVecItem[4]=new t.Vector3D(0,0,0)):(this.lastViewScale=new t.Vector2D(i,a),this.viewBoxVecItem=new Array,this.viewBoxVecItem.push(new t.Vector3D(-e/i,-e/a,e)),this.viewBoxVecItem.push(new t.Vector3D(-e/i,+e/a,e)),this.viewBoxVecItem.push(new t.Vector3D(+e/i,-e/a,e)),this.viewBoxVecItem.push(new t.Vector3D(+e/i,+e/a,e)),this.viewBoxVecItem.push(new t.Vector3D(0,0,0)))},e.GetViewHitBoxDataCopy=function(e){this.viewBoxVecItem||(this.viewBoxVecItem=new Array,this.viewBoxVecItem.push(new t.Vector3D),this.viewBoxVecItem.push(new t.Vector3D),this.viewBoxVecItem.push(new t.Vector3D),this.viewBoxVecItem.push(new t.Vector3D));var i=e/(t.Scene_data.sceneViewHW/2),a=t.Scene_data.sceneViewHW/2*i,n=t.Scene_data.stageWidth,r=t.Scene_data.stageHeight,o=new t.Matrix3D;o.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),o.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS);var s=t.Scene_data.viewMatrx3D.transformVector(new t.Vector3D(500,0,500)),h=s.x/s.w,c=n/2/h*i*.8,u=r/2/h*i*.8;this.viewBoxVecItem[0]=this.gettempPos(new t.Vector3D(-c,-u,a),o),this.viewBoxVecItem[1]=this.gettempPos(new t.Vector3D(+c,-u,a),o),this.viewBoxVecItem[2]=this.gettempPos(new t.Vector3D(+c,+u,a),o),this.viewBoxVecItem[3]=this.gettempPos(new t.Vector3D(-c,+u,a),o)},e.gettempPos=function(e,i){var a=i.transformVector(e);return a=a.add(new t.Vector3D(t.Scene_data.cam3D.x,t.Scene_data.cam3D.y,t.Scene_data.cam3D.z))},e.mathmidpoint=function(t,e,i){var a,n,r;a=t.x+(e.x-t.x)*i,n=t.y+(e.y-t.y)*i,r=t.z+(e.z-t.z)*i,t.x=a,t.y=n,t.z=r},e.drawbezier=function(t,e){var i=new Array;if(0==t.length)return{x:0,y:0,z:0};for(var a=0;a<t.length;a++)i.push({x:t[a].x,y:t[a].y,z:t[a].z});for(;i.length>1;){for(var n=0;n<i.length-1;n++)this.mathmidpoint(i[n],i[n+1],e);i.pop()}return i[0]},e.math_distance=function(t,e,i,a){return Math.sqrt((a-e)*(a-e)+(i-t)*(i-t))},e.math_angle=function(t,e,i,a){var n=t-i,r=e-a;return 180*Math.atan(r/n)/Math.PI},e.easeIn=function(t,e,i,a){return i*(t/=a)*t+e},e.easeOut=function(t,e,i,a){return-i*(t/=a)*(t-2)+e},e.easeInOut=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},e.mathDisplay2Dto3DWorldPos=function(e,i,a){void 0===a&&(a=300);var n=t.Scene_data.cam3D.cameraMatrix.clone(),r=t.Scene_data.viewMatrx3D.clone();n.invert(),r.invert();var o=new t.Vector3D;return o.x=i.x-e.x,o.y=i.y-e.y,o.x=2*o.x/e.width-1,o.y=1-2*o.y/e.height,o.w=a,o.x=o.x*o.w,o.y=o.y*o.w,(o=r.transformVector(o)).z=a,o=n.transformVector(o)},e.SetShock=!0,e}();t.MathClass=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.mathDisplay2Dto3DWorldPos=function(e,i){void 0===i&&(i=300);var a=i/(t.Scene_data.sceneViewHW/2),n=t.Scene_data.sceneViewHW/2*a,r=t.Scene_data.stageWidth,o=t.Scene_data.stageHeight,s=new t.Matrix3D;s.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),s.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS);var h=t.Scene_data.viewMatrx3D.transformVector(new t.Vector3D(500,0,500)),c=h.x/h.w,u=r/2/c*a,l=o/2/c*a,d=e.x/r*u*2,p=e.y/o*l*2;return this.gettempPos(new t.Vector3D(-u+d,+l-p,n),s)},e.getGroundPanelPos=function(e){var i=t.MathClass.mathDisplay2Dto3DWorldPos(new t.Rectangle(0,0,t.Scene_data.stageWidth,t.Scene_data.stageHeight),new t.Vector2D(e.x,e.y),300),a=new Array;a.push(new t.Vector3D(0,0,0)),a.push(new t.Vector3D(-100,0,100)),a.push(new t.Vector3D(100,0,100));var n=new t.Vector3D(t.Scene_data.cam3D.x,t.Scene_data.cam3D.y,t.Scene_data.cam3D.z);return this.getLinePlaneInterectPointByTri(n,i,a)},e.gettempPos=function(e,i){var a=i.transformVector(e);return a=a.add(new t.Vector3D(t.Scene_data.cam3D.x,t.Scene_data.cam3D.y,t.Scene_data.cam3D.z))},e.math3DWorldtoDisplay2DPos=function(e){var i=t.Scene_data.cam3D.cameraMatrix.clone();i.append(t.Scene_data.viewMatrx3D.clone());var a=t.Scene_data.stageWidth,n=t.Scene_data.stageHeight,r=i.transformVector(e),o=new t.Vector2D;return o.x=(r.x/r.w+1)*(a/2),o.y=(-r.y/r.w+1)*(n/2),o},e.argbToHex=function(t,e,i,a){return t<<24|e<<16|i<<8|a},e.hexToArgb=function(e){var i=new t.Vector3D;return i.w=e>>24&255,i.x=e>>16&255,i.y=e>>8&255,i.z=255&e,i},e.getLinePlaneInterectPointByTri=function(e,i,a){if(a.length<3)return null;var n=new t.Vector3D(0,2e3,0);return this.getLineAndPlaneIntersectPoint(e,i,a[0],n)},e.getLineAndPlaneIntersectPoint=function(e,i,a,n){var r=new t.Vector3D(e.x-i.x,e.y-i.y,e.z-i.z);r.normalize();var o=r.x*n.x+r.y*n.y+r.z*n.z,s=((a.x-e.x)*n.x+(a.y-e.y)*n.y+(a.z-e.z)*n.z)/o,h=new t.Vector3D;return h.setTo(e.x+r.x*s,e.y+r.y*s,e.z+r.z*s),h},e.lookAt=function(e,i){var a=new t.Matrix3D;return a.buildLookAtLH(e,i,t.Vector3D.Y_AXIS),a},e.getTowPointsAngle2=function(t,e,i,a){var n=Math.atan2(a-e,i-t);return n<0&&(n+=2*Math.PI),180*n/Math.PI|0},e.getTowPointsAngle=function(t,e){var i=Math.atan2(e.y-t.y,e.x-t.x);return i<0&&(i+=2*Math.PI),180*i/Math.PI},e.getDisSquare=function(t,e,i,a){return Math.sqrt((t-i)*(t-i)+(e-a)*(e-a))},e}();t.MathUtil=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.isIdentity=!0;this.m=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return e.prototype.clone=function(t){return void 0===t&&(t=null),t||(t=new e),t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t.m[6]=this.m[6],t.m[7]=this.m[7],t.m[8]=this.m[8],t.m[9]=this.m[9],t.m[10]=this.m[10],t.m[11]=this.m[11],t.m[12]=this.m[12],t.m[13]=this.m[13],t.m[14]=this.m[14],t.m[15]=this.m[15],t},Object.defineProperty(e.prototype,"position",{get:function(){return new t.Vector3D(this.m[12],this.m[13],this.m[14],this.m[15])},enumerable:!0,configurable:!0}),e.prototype.copyTo=function(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t.m[6]=this.m[6],t.m[7]=this.m[7],t.m[8]=this.m[8],t.m[9]=this.m[9],t.m[10]=this.m[10],t.m[11]=this.m[11],t.m[12]=this.m[12],t.m[13]=this.m[13],t.m[14]=this.m[14],t.m[15]=this.m[15]},e.prototype.identity=function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},e.prototype.invert=function(){var t=this.m,e=t[0],i=t[1],a=t[2],n=t[3],r=t[4],o=t[5],s=t[6],h=t[7],c=t[8],u=t[9],l=t[10],d=t[11],p=t[12],f=t[13],m=t[14],y=t[15],_=e*o-i*r,v=e*s-a*r,x=e*h-n*r,g=i*s-a*o,D=i*h-n*o,b=a*h-n*s,S=c*f-u*p,T=c*m-l*p,w=c*y-d*p,A=u*m-l*f,M=u*y-d*f,I=l*y-d*m,P=_*I-v*M+x*A+g*w-D*T+b*S;if(!P)return null;P=1/P,this.m[0]=(o*I-s*M+h*A)*P,this.m[1]=(a*M-i*I-n*A)*P,this.m[2]=(f*b-m*D+y*g)*P,this.m[3]=(l*D-u*b-d*g)*P,this.m[4]=(s*w-r*I-h*T)*P,this.m[5]=(e*I-a*w+n*T)*P,this.m[6]=(m*x-p*b-y*v)*P,this.m[7]=(c*b-l*x+d*v)*P,this.m[8]=(r*M-o*w+h*S)*P,this.m[9]=(i*w-e*M-n*S)*P,this.m[10]=(p*D-f*x+y*_)*P,this.m[11]=(u*x-c*D-d*_)*P,this.m[12]=(o*T-r*A-s*S)*P,this.m[13]=(e*A-i*T+a*S)*P,this.m[14]=(f*v-p*g-m*_)*P,this.m[15]=(c*g-u*v+l*_)*P},e.prototype.invertToMatrix=function(t){var e=this.m,i=e[0],a=e[1],n=e[2],r=e[3],o=e[4],s=e[5],h=e[6],c=e[7],u=e[8],l=e[9],d=e[10],p=e[11],f=e[12],m=e[13],y=e[14],_=e[15],v=i*s-a*o,x=i*h-n*o,g=i*c-r*o,D=a*h-n*s,b=a*c-r*s,S=n*c-r*h,T=u*m-l*f,w=u*y-d*f,A=u*_-p*f,M=l*y-d*m,I=l*_-p*m,P=d*_-p*y,B=v*P-x*I+g*M+D*A-b*w+S*T;if(!B)return null;B=1/B,t.m[0]=(s*P-h*I+c*M)*B,t.m[1]=(n*I-a*P-r*M)*B,t.m[2]=(m*S-y*b+_*D)*B,t.m[3]=(d*b-l*S-p*D)*B,t.m[4]=(h*A-o*P-c*w)*B,t.m[5]=(i*P-n*A+r*w)*B,t.m[6]=(y*g-f*S-_*x)*B,t.m[7]=(u*S-d*g+p*x)*B,t.m[8]=(o*I-s*A+c*T)*B,t.m[9]=(a*A-i*I-r*T)*B,t.m[10]=(f*b-m*g+_*v)*B,t.m[11]=(l*g-u*b-p*v)*B,t.m[12]=(s*w-o*M-h*T)*B,t.m[13]=(i*M-a*w+n*T)*B,t.m[14]=(m*x-f*D-y*v)*B,t.m[15]=(u*D-l*x+d*v)*B},e.prototype.appendTranslation=function(t,i,a){e.tempM.identity(),e.tempM.prependTranslation(t,i,a),this.append(e.tempM)},e.prototype.prependTranslation=function(t,e,i){var a=this.m;a[12]=a[0]*t+a[4]*e+a[8]*i+a[12],a[13]=a[1]*t+a[5]*e+a[9]*i+a[13],a[14]=a[2]*t+a[6]*e+a[10]*i+a[14],a[15]=a[3]*t+a[7]*e+a[11]*i+a[15]},e.prototype.transformVector=function(e){var i=new t.Vector3D;return i.x=this.m[0]*e.x+this.m[4]*e.y+this.m[8]*e.z+this.m[12]*e.w,i.y=this.m[1]*e.x+this.m[5]*e.y+this.m[9]*e.z+this.m[13]*e.w,i.z=this.m[2]*e.x+this.m[6]*e.y+this.m[10]*e.z+this.m[14]*e.w,i.w=this.m[3]*e.x+this.m[7]*e.y+this.m[11]*e.z+this.m[15]*e.w,i},e.prototype.append=function(t){e.tempM.m[0]=t.m[0],e.tempM.m[1]=t.m[1],e.tempM.m[2]=t.m[2],e.tempM.m[3]=t.m[3],e.tempM.m[4]=t.m[4],e.tempM.m[5]=t.m[5],e.tempM.m[6]=t.m[6],e.tempM.m[7]=t.m[7],e.tempM.m[8]=t.m[8],e.tempM.m[9]=t.m[9],e.tempM.m[10]=t.m[10],e.tempM.m[11]=t.m[11],e.tempM.m[12]=t.m[12],e.tempM.m[13]=t.m[13],e.tempM.m[14]=t.m[14],e.tempM.m[15]=t.m[15],e.tempM.prepend(this),this.m[0]=e.tempM.m[0],this.m[1]=e.tempM.m[1],this.m[2]=e.tempM.m[2],this.m[3]=e.tempM.m[3],this.m[4]=e.tempM.m[4],this.m[5]=e.tempM.m[5],this.m[6]=e.tempM.m[6],this.m[7]=e.tempM.m[7],this.m[8]=e.tempM.m[8],this.m[9]=e.tempM.m[9],this.m[10]=e.tempM.m[10],this.m[11]=e.tempM.m[11],this.m[12]=e.tempM.m[12],this.m[13]=e.tempM.m[13],this.m[14]=e.tempM.m[14],this.m[15]=e.tempM.m[15]},e.prototype.prepend=function(t){var e=t.m,i=this.m,a=this.m,n=a[0],r=a[1],o=a[2],s=a[3],h=a[4],c=a[5],u=a[6],l=a[7],d=a[8],p=a[9],f=a[10],m=a[11],y=a[12],_=a[13],v=a[14],x=a[15],g=e[0],D=e[1],b=e[2],S=e[3];i[0]=g*n+D*h+b*d+S*y,i[1]=g*r+D*c+b*p+S*_,i[2]=g*o+D*u+b*f+S*v,i[3]=g*s+D*l+b*m+S*x,g=e[4],D=e[5],b=e[6],S=e[7],i[4]=g*n+D*h+b*d+S*y,i[5]=g*r+D*c+b*p+S*_,i[6]=g*o+D*u+b*f+S*v,i[7]=g*s+D*l+b*m+S*x,g=e[8],D=e[9],b=e[10],S=e[11],i[8]=g*n+D*h+b*d+S*y,i[9]=g*r+D*c+b*p+S*_,i[10]=g*o+D*u+b*f+S*v,i[11]=g*s+D*l+b*m+S*x,g=e[12],D=e[13],b=e[14],S=e[15],i[12]=g*n+D*h+b*d+S*y,i[13]=g*r+D*c+b*p+S*_,i[14]=g*o+D*u+b*f+S*v,i[15]=g*s+D*l+b*m+S*x},e.prototype.appendRotation=function(t,i){e.tempM.identity(),e.tempM.prependRotation(t,i),this.append(e.tempM)},e.prototype.tomat3=function(){var t=Array.prototype.concat.apply([],arguments);t=[1,0,0,0,1,0,0,0,1];var e=new Float32Array(t);return e[0]=this.m[0],e[1]=this.m[1],e[2]=this.m[2],e[3]=this.m[4],e[4]=this.m[5],e[5]=this.m[6],e[6]=this.m[8],e[7]=this.m[9],e[8]=this.m[10],e},e.prototype.getRotaion=function(t){t[0]=this.m[0],t[1]=this.m[1],t[2]=this.m[2],t[3]=this.m[4],t[4]=this.m[5],t[5]=this.m[6],t[6]=this.m[8],t[7]=this.m[9],t[8]=this.m[10]},e.prototype.identityPostion=function(){this.m[12]=0,this.m[13]=0,this.m[14]=0},Object.defineProperty(e.prototype,"x",{get:function(){return this.m[12]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.m[13]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.m[14]},enumerable:!0,configurable:!0}),e.prototype.prependRotation=function(t,e){var i,a,n,r,o,s,h,c,u,l,d,p,f,m,y,_,v,x,g,D,b,S,T,w,A=this.m,M=this.m,I=e.x,P=e.y,B=e.z,R=Math.sqrt(I*I+P*P+B*B);return Math.abs(R)<1e-6?null:(I*=R=1/R,P*=R,B*=R,i=Math.sin(t*Math.PI/180),n=1-(a=Math.cos(t*Math.PI/180)),r=M[0],o=M[1],s=M[2],h=M[3],c=M[4],u=M[5],l=M[6],d=M[7],p=M[8],f=M[9],m=M[10],y=M[11],_=I*I*n+a,v=P*I*n+B*i,x=B*I*n-P*i,g=I*P*n-B*i,D=P*P*n+a,b=B*P*n+I*i,S=I*B*n+P*i,T=P*B*n-I*i,w=B*B*n+a,A[0]=r*_+c*v+p*x,A[1]=o*_+u*v+f*x,A[2]=s*_+l*v+m*x,A[3]=h*_+d*v+y*x,A[4]=r*g+c*D+p*b,A[5]=o*g+u*D+f*b,A[6]=s*g+l*D+m*b,A[7]=h*g+d*D+y*b,A[8]=r*S+c*T+p*w,A[9]=o*S+u*T+f*w,A[10]=s*S+l*T+m*w,A[11]=h*S+d*T+y*w,M!==A&&(A[12]=M[12],A[13]=M[13],A[14]=M[14],A[15]=M[15]),A)},e.prototype.prependScale=function(t,e,i){var a=this.m,n=this.m;return n[0]=a[0]*t,n[1]=a[1]*t,n[2]=a[2]*t,n[3]=a[3]*t,n[4]=a[4]*e,n[5]=a[5]*e,n[6]=a[6]*e,n[7]=a[7]*e,n[8]=a[8]*i,n[9]=a[9]*i,n[10]=a[10]*i,n[11]=a[11]*i,n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n},e.prototype.appendScale=function(t,i,a){e.tempM.identity(),e.tempM.prependScale(t,i,a),this.append(e.tempM)},e.prototype.perspectiveFieldOfViewLH=function(t,e,i,a){var n=1/Math.tan(t/2),r=n/e,o=this.m;o[0]=r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=a/(a-i),o[11]=1,o[12]=0,o[13]=0,o[14]=i*a/(i-a),o[15]=0},e.prototype.fromVtoV=function(e,i){var a=e.cross(i);a.normalize();var n=Math.acos(e.dot(i)),r=new t.Quaternion;r.fromAxisAngle(a,n),r.toMatrix3D(this)},e.prototype.buildLookAtLH=function(e,i,a){var n=this.m,r=new t.Vector3D;r.x=i.x-e.x,r.y=i.y-e.y,r.z=i.z-e.z,r.normalize();var o=a.cross(r);o.normalize();var s=r.cross(o);n[0]=o.x,n[1]=s.x,n[2]=r.x,n[3]=0,n[4]=o.y,n[5]=s.y,n[6]=r.y,n[7]=0,n[8]=o.z,n[9]=s.z,n[10]=r.z,n[11]=0,n[12]=-o.dot(e),n[13]=-s.dot(e),n[14]=-r.dot(e),n[15]=1},e.mul=function(t,e,i){var a=e[0],n=e[1],r=e[2],o=e[3],s=e[4],h=e[5],c=e[6],u=e[7],l=e[8],d=e[9],p=e[10],f=e[11],m=e[12],y=e[13],_=e[14];e=e[15];var v=i[0],x=i[1],g=i[2],D=i[3];return t[0]=v*a+x*s+g*l+D*m,t[1]=v*n+x*h+g*d+D*y,t[2]=v*r+x*c+g*p+D*_,t[3]=v*o+x*u+g*f+D*e,v=i[4],x=i[5],g=i[6],D=i[7],t[4]=v*a+x*s+g*l+D*m,t[5]=v*n+x*h+g*d+D*y,t[6]=v*r+x*c+g*p+D*_,t[7]=v*o+x*u+g*f+D*e,v=i[8],x=i[9],g=i[10],D=i[11],t[8]=v*a+x*s+g*l+D*m,t[9]=v*n+x*h+g*d+D*y,t[10]=v*r+x*c+g*p+D*_,t[11]=v*o+x*u+g*f+D*e,v=i[12],x=i[13],g=i[14],D=i[15],t[12]=v*a+x*s+g*l+D*m,t[13]=v*n+x*h+g*d+D*y,t[14]=v*r+x*c+g*p+D*_,t[15]=v*o+x*u+g*f+D*e,t},e.prototype.toEulerAngles=function(e){void 0===e&&(e=null);var i=new t.Quaternion;return i.fromMatrix(this),i.toEulerAngles(e)},e.tempM=new e,e}();t.Matrix3D=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=a}return e.prototype.print=function(){alert(String(this.x)+" "+String(this.y)+" "+String(this.z)+" "+String(this.w))},e.prototype.toEulerAngles=function(e){void 0===e&&(e=null),e||(e=new t.Vector3D);var i=this.x,a=this.y,n=this.z,r=this.w;return e.x=Math.atan2(2*(r*i+a*n),1-2*(i*i+a*a)),e.y=Math.asin(2*(r*a-n*i)),e.z=Math.atan2(2*(r*n+i*a),1-2*(a*a+n*n)),e},e.prototype.toMatrix3D=function(e){void 0===e&&(e=null),e||(e=new t.Matrix3D);var i=e.m,a=this.x,n=this.y,r=this.z,o=this.w,s=a+a,h=n+n,c=r+r,u=a*s,l=n*s,d=n*h,p=r*s,f=r*h,m=r*c,y=o*s,_=o*h,v=o*c;return i[0]=1-d-m,i[1]=l+v,i[2]=p-_,i[3]=0,i[4]=l-v,i[5]=1-u-m,i[6]=f+y,i[7]=0,i[8]=p+_,i[9]=f-y,i[10]=1-u-d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,e},e.prototype.fromAxisAngle=function(t,e){var i=Math.sin(e/2),a=Math.cos(e/2);this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=a,this.normalize()},e.prototype.normalize=function(t){void 0===t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},e.prototype.fromMatrix=function(t){var e=[0,0,0,0,0,0,0,0,0];e[0]=t.m[0],e[1]=t.m[1],e[2]=t.m[2],e[3]=t.m[4],e[4]=t.m[5],e[5]=t.m[6],e[6]=t.m[8],e[7]=t.m[9],e[8]=t.m[10];var i,a=e[0]+e[4]+e[8],n=[0,0,0,0];if(a>0)i=Math.sqrt(a+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),n[r]=.5*i,i=.5/i,n[3]=(e[3*o+s]-e[3*s+o])*i,n[o]=(e[3*o+r]+e[3*r+o])*i,n[s]=(e[3*s+r]+e[3*r+s])*i}this.x=n[0],this.y=n[1],this.z=n[2],this.w=n[3]},e.prototype.setMd5W=function(){this.w=1-(this.x*this.x+this.y*this.y+this.z*this.z),this.w<0?this.w=0:this.w=-Math.sqrt(this.w)},e.prototype.slerp=function(t,e,i){var a=t.w,n=t.x,r=t.y,o=t.z,s=e.w,h=e.x,c=e.y,u=e.z,l=a*s+n*h+r*c+o*u;if(l<0&&(l=-l,s=-s,h=-h,c=-c,u=-u),l<.95){var d=Math.acos(l),p=1/Math.sin(d),f=Math.sin(d*(1-i))*p,m=Math.sin(d*i)*p;this.w=a*f+s*m,this.x=n*f+h*m,this.y=r*f+c*m,this.z=o*f+u*m}else{this.w=a+i*(s-a),this.x=n+i*(h-n),this.y=r+i*(c-r),this.z=o+i*(u-o);var y=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=y,this.x*=y,this.y*=y,this.z*=y}},e}();t.Quaternion=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===a&&(a=1),this.x=0,this.y=0,this.width=0,this.height=1,this.x=t,this.y=e,this.width=i,this.height=a}return t.prototype.sets=function(t,e,i,a){this.x=t,this.y=e,this.width=i,this.height=a},t.prototype.setRec=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.isHitByPoint=function(t,e){return t>=this.x&&e>=this.y&&t<=this.x+this.width&&e<=this.y+this.height},t}();t.Rectangle=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=e;var i=function(){function i(t){this.BUFFER_EXT_SIZE=0,this.optcode=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=e.BIG_ENDIAN}return i.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},i.prototype.setdata=function(t){this._setArrayBuffer(t.buffer)},Object.defineProperty(i.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),i.prototype.getByte=function(t){return this.data.getUint8(t)},i.prototype.setByte=function(t,e){this.data.setUint8(t,e)},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this.clear()},Object.defineProperty(i.prototype,"length",{get:function(){return this.write_position},set:function(t){this.validateBuffer(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),i.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},i.prototype.readBoolean=function(){return 0!=this.data.getUint8(this.position++)},i.prototype.readByte=function(){return this.data.getInt8(this.position++)},i.prototype.readBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var a=0;a<i;a++)t.data.setUint8(a+e,this.data.getUint8(this.position++))},i.prototype.readDouble=function(){var t=this.data.getFloat64(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_FLOAT64,t},i.prototype.readFloat=function(){var t=this.data.getFloat32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_FLOAT32,t},i.prototype.readInt=function(){var t=this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_INT32,t},i.prototype.getInt=function(){return this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN)},i.prototype.readInt32=function(){return this.readInt()},i.prototype.readShort=function(){this.position,this.data.byteLength;var t=this.data.getInt16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_INT16,t},i.prototype.readFloatTwoByte=function(t){return this.readShort()/t},i.prototype.readFloatOneByte=function(){return(this.readByte()+128)/256},i.prototype.readUnsignedByte=function(){return this.data.getUint8(this.position++)},i.prototype.readUint8=function(){return this.readUnsignedByte()},i.prototype.readInt8=function(){return this.readByte()},i.prototype.readUnsignedInt=function(){var t=this.data.getUint32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT32,t},i.prototype.readUint32=function(){return this.readUnsignedInt()},i.prototype.readUint64=function(){return this.readDouble()},i.prototype.readUnsignedShort=function(){var t=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT16,t},i.prototype.readUint16=function(){return this.readUnsignedShort()},i.prototype.readUTF=function(){var t=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT16,t>0?this.readUTFBytes(t):""},i.prototype.readString=function(){return this.readUTF()},i.prototype.readUTFBytes=function(t){var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},i.prototype.readStringByLen=function(t){return this.readUTFBytes(t)},i.prototype.writeBoolean=function(t){this.validateBuffer(i.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,t?1:0)},i.prototype.writeByte=function(t){this.validateBuffer(i.SIZE_OF_INT8),this.data.setInt8(this.position++,t)},i.prototype.writeUint8=function(t){this.writeByte(t)},i.prototype.writeInt8=function(t){this.writeByte(t)},i.prototype.writeBytes=function(t,e,i){var a;if(void 0===e&&(e=0),void 0===i&&(i=0),!(e<0)&&!(i<0)&&(a=0==i?t.length-e:Math.min(t.length-e,i))>0){this.validateBuffer(a);for(var n=new DataView(t.buffer),r=e;r<a+e;r++)this.data.setUint8(this.position++,n.getUint8(r))}},i.prototype.writeDouble=function(t){this.validateBuffer(i.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT64},i.prototype.writeFloat=function(t){this.validateBuffer(i.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT32},i.prototype.writeInt=function(t){this.validateBuffer(i.SIZE_OF_INT32),this.data.setInt32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT32},i.prototype.writeInt32=function(t){this.writeInt(t)},i.prototype.writeUnsignedShort=function(t){this.validateBuffer(i.SIZE_OF_INT16),this.data.setInt16(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT16},i.prototype.writeUint16=function(t){this.writeUnsignedShort(t)},i.prototype.writeUint64=function(t){this.validateBuffer(i.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT64},i.prototype.writeShort=function(t){this.validateBuffer(i.SIZE_OF_INT16),this.data.setUint16(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT16},i.prototype.writeUnsignedInt=function(t){this.validateBuffer(i.SIZE_OF_UINT32),this.data.setUint32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT32},i.prototype.writeUint32=function(t){this.writeUnsignedInt(t)},i.prototype.writeUTF=function(t){var a=this.encodeUTF8(t),n=a.length;this.validateBuffer(i.SIZE_OF_UINT16+n),this.data.setUint16(this.position,n,this.endian===e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT16,this._writeUint8Array(a,!1)},i.prototype.writeString=function(t){var e=new i;e.writeUTFBytes(t),this.writeUint16(e.length+1),this.writeBytes(e,0,e.length),this.writeByte(0)},i.prototype.writeStringByLen=function(t,e){var i=this.position;this.writeUTFBytes(t),this.position=i+e,this.length=this.position+1},i.prototype.readVector3D=function(e){void 0===e&&(e=!1);var i=new t.Vector3D;return i.x=this.readFloat(),i.y=this.readFloat(),i.z=this.readFloat(),e&&(i.w=this.readFloat()),i},i.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},i.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},i.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},i.prototype.validate=function(t){return this.data.byteLength>0&&this._position+t<=this.data.byteLength||(console.error("unvalidate byte len code:1025"),!1)},i.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),a=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,a)),this.buffer=i.buffer}},i.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),a=[];i.length>e;){var n=i[e++];if(this.inRange(n,55296,57343))this.encoderError(n);else if(this.inRange(n,0,127))a.push(n);else{var r,o;for(this.inRange(n,128,2047)?(r=1,o=192):this.inRange(n,2048,65535)?(r=2,o=224):this.inRange(n,65536,1114111)&&(r=3,o=240),a.push(this.div(n,Math.pow(64,r))+o);r>0;){var s=this.div(n,Math.pow(64,r-1));a.push(128+s%64),r-=1}}}return new Uint8Array(a)},i.prototype.decodeUTF8=function(t){for(var e,i=0,a="",n=0,r=0,o=0,s=0;t.length>i;){var h=t[i++];if(h===this.EOF_byte)e=0!==r?this.decoderError(!1):this.EOF_code_point;else if(0===r)this.inRange(h,0,127)?e=h:(this.inRange(h,194,223)?(r=1,s=128,n=h-192):this.inRange(h,224,239)?(r=2,s=2048,n=h-224):this.inRange(h,240,244)?(r=3,s=65536,n=h-240):this.decoderError(!1),n*=Math.pow(64,r),e=null);else if(this.inRange(h,128,191))if(o+=1,n+=(h-128)*Math.pow(64,r-o),o!==r)e=null;else{var c=n,u=s;n=0,r=0,o=0,s=0,e=this.inRange(c,u,1114111)&&!this.inRange(c,55296,57343)?c:this.decoderError(!1,h)}else n=0,r=0,o=0,s=0,i--,e=this.decoderError(!1,h);null!==e&&e!==this.EOF_code_point&&(e<=65535?e>0&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(e>>10&1023)),a+=String.fromCharCode(56320+(1023&e))))}return a},i.prototype.encoderError=function(t){console.error("encoderError 1026",t)},i.prototype.decoderError=function(t,e){return t&&console.error("decoderError 1027"),e||65533},i.prototype.inRange=function(t,e,i){return e<=t&&t<=i},i.prototype.div=function(t,e){return Math.floor(t/e)},i.prototype.stringToCodePoints=function(t){for(var e=[],i=0,a=t.length;i<t.length;){var n=t.charCodeAt(i);if(this.inRange(n,55296,57343))if(this.inRange(n,56320,57343))e.push(65533);else if(i===a-1)e.push(65533);else{var r=t.charCodeAt(i+1);if(this.inRange(r,56320,57343)){var o=1023&n,s=1023&r;i+=1,e.push(65536+(o<<10)+s)}else e.push(65533)}else e.push(n);i+=1}return e},i.SIZE_OF_BOOLEAN=1,i.SIZE_OF_INT8=1,i.SIZE_OF_INT16=2,i.SIZE_OF_INT32=4,i.SIZE_OF_UINT8=1,i.SIZE_OF_UINT16=2,i.SIZE_OF_UINT32=4,i.SIZE_OF_FLOAT32=4,i.SIZE_OF_FLOAT64=8,i}();t.TLByteArray=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(t,e,i,a){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===a&&(a=.1),this.p1=t,this.p2=e,this.p3=i,this.precision=a}return t.prototype.setAllPoint=function(t,e,i){this.p1=t,this.p2=e,this.p3=i},t.prototype.checkPointIn=function(e){var i=this.getArea(),a=0;return a+=t.getAreaByPoints(e,this.p1,this.p2),a+=t.getAreaByPoints(e,this.p2,this.p3),(a+=t.getAreaByPoints(e,this.p3,this.p1))==i||Math.abs(a-i)<this.precision},t.prototype.getArea=function(){return t.getAreaByPoints(this.p1,this.p2,this.p3)},t.getAreaByPoints=function(t,e,i){var a=t.x-e.x,n=t.y-e.y,r=Math.sqrt(a*a+n*n);a=e.x-i.x,n=e.y-i.y;var o=Math.sqrt(a*a+n*n);a=i.x-t.x,n=i.y-t.y;var s=Math.sqrt(a*a+n*n),h=(r+o+s)/2,c=h*(h-r)*(h-o)*(h-s);return c>0?Math.sqrt(c):0},t.baseTri=new t,t}();t.TestTriangle=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.normalize=function(){var t=this.length;0!=t&&this.scaleBy(1/t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.scaleBy=function(t){this.x*=t,this.y*=t},t.prototype.sub=function(e){return new t(e.x-this.x,e.y-this.y)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y)},t.prototype.toString=function(){return"Vector2D("+String(this.x)+","+String(this.y)+")"},t.distance=function(t,e){var i=t.x-e.x,a=t.y-e.y;return Math.sqrt(i*i+a*a)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t}();t.Vector2D=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=a}return t.prototype.normalize=function(){var t=this.length;0!=t&&this.scaleBy(1/t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),t.prototype.scaleBy=function(t){this.x*=t,this.y*=t,this.z*=t,this.w*=t},t.prototype.divideScalar=function(t){0!=t?(this.x=this.x/t,this.y=this.y/t,this.z=this.z/t):(this.x=0,this.y=0,this.z=0)},t.prototype.distanceToSquared=function(e){return t.distance(this,e)},t.prototype.scaleByW=function(){this.x*=this.w,this.y*=this.w,this.z*=this.w},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.addByNum=function(t,e,i,a){void 0===a&&(a=0),this.x+=t,this.y+=e,this.z+=i,this.w+=a},t.prototype.setTo=function(t,e,i){this.x=t,this.y=e,this.z=i},t.prototype.setByte=function(t){this.x=t.readFloat(),this.y=t.readFloat(),this.z=t.readFloat()},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.distance=function(t,e){var i=t.x-e.x,a=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+a*a+n*n)},t.prototype.toString=function(){return"Vector3D("+String(this.x)+","+String(this.y)+","+String(this.z)+","+String(this.w)+")"},t.X_AXIS=new t(1,0,0),t.Y_AXIS=new t(0,1,0),t.Z_AXIS=new t(0,0,1),t}();t.Vector3D=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._maxTime=1e6,i._rotationX=0,i._rotationY=0,i._rotationZ=0,i.hasMulItem=!1,i.sceneVisible=!0,i.dynamic=!1,i.hasDestory=!1,i.timeScale=1,i._displayAry=new Array,i._time=0,i.bindMatrix=new t.Matrix3D,i.invertBindMatrix=new t.Matrix3D,i.bindVecter3d=new t.Vector3D,i.bindScale=new t.Vector3D(1,1,1),i.groupMatrix=new t.Matrix3D,i.groupRotationMatrix=new t.Matrix3D,i}return __extends(i,e),Object.defineProperty(i.prototype,"displayAry",{get:function(){return this._displayAry},set:function(t){this._displayAry=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxTime",{set:function(t){this._maxTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bindTarget",{set:function(t){this._bindTarget=t,this.invertBindMatrix.isIdentity=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bindSocket",{set:function(t){this._bindSocket=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this.bindVecter3d.x},set:function(t){this.bindVecter3d.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.bindVecter3d.y},set:function(t){this.bindVecter3d.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this.bindVecter3d.z},set:function(t){this.bindVecter3d.z=t},enumerable:!0,configurable:!0}),i.prototype.setPos=function(t,e,i){this.bindVecter3d.setTo(t,e,i);for(var a=0;a<this._displayAry.length;a++)this._displayAry[a].resetPos()},i.prototype.setMulPos=function(t){for(var e=0;e<this._displayAry.length;e++)this._displayAry[e].resetMulPos(t)},Object.defineProperty(i.prototype,"scaleX",{get:function(){return this.bindScale.x},set:function(t){this.bindScale.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this.bindScale.y},set:function(t){this.bindScale.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleZ",{get:function(){return this.bindScale.z},set:function(t){this.bindScale.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{set:function(t){this._rotationX=t,this.applyRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{set:function(t){this._rotationY=t,this.applyRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{set:function(t){this._rotationZ=t,this.applyRotation()},enumerable:!0,configurable:!0}),i.prototype.applyRotation=function(){this.bindMatrix.identity(),this.bindMatrix.appendRotation(this._rotationX,t.Vector3D.X_AXIS),this.bindMatrix.appendRotation(this._rotationY,t.Vector3D.Y_AXIS),this.bindMatrix.appendRotation(this._rotationZ,t.Vector3D.Z_AXIS),this.bindMatrix.copyTo(this.invertBindMatrix),this.invertBindMatrix.invert(),this.invertBindMatrix.isIdentity=!1},i.prototype.setGroup=function(e,i,a){this._isInGroup=!0,this._groupPos=e,this._groupRotation=i,this._groupScale=a,this.groupMatrix.isIdentity=!1,this.groupMatrix.identity(),this.groupMatrix.appendScale(a.x,a.y,a.z),this.groupMatrix.appendRotation(i.x,t.Vector3D.X_AXIS),this.groupMatrix.appendRotation(i.y,t.Vector3D.Y_AXIS),this.groupMatrix.appendRotation(i.z,t.Vector3D.Z_AXIS),this.groupMatrix.appendTranslation(e.x,e.y,e.z),this.groupRotationMatrix.isIdentity=!1,this.groupRotationMatrix.identity(),this.groupRotationMatrix.prependRotation(i.z,t.Vector3D.Z_AXIS),this.groupRotationMatrix.prependRotation(i.y,t.Vector3D.Y_AXIS),this.groupRotationMatrix.prependRotation(i.x,t.Vector3D.X_AXIS)},i.prototype.setDataByte=function(e){e.position=0;var i=e.readInt(),a=e.readInt();this._maxTime=0,this._displayAry=new Array;for(var n=0;n<a;n++){var r=e.readInt(),o=this.getDisplay3DById(r);o.setAllByteInfo(e,i),o.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(o),o.timeline.maxFrameNum>this._maxTime&&(this._maxTime=o.timeline.maxFrameNum)}this._maxTime*=t.Scene_data.frameTime},i.prototype.addPrticleItem=function(t){t.visible=!1,t.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(t)},i.prototype.getDisplay3DById=function(t){var e=new Object;return e.particleType=t,this.getDisplay3D(e)},i.prototype.setData=function(e){this._displayAry=new Array,this._maxTime=0;for(var i=0;i<e.length;i++){var a=e[i].display,n=this.getDisplay3D(a);n.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(n),n.timeline.maxFrameNum>this._maxTime&&(this._maxTime=n.timeline.maxFrameNum)}this._maxTime*=t.Scene_data.frameTime},i.prototype.updateTime=function(e){if(this._time+=e*this.timeScale,this._displayAry){for(var i=0;i<this._displayAry.length;i++)this._displayAry[i].updateTime(this._time);this.updateBind(),this._time>=this._maxTime&&(this.hasEventListener(t.BaseEvent.COMPLETE)&&this.dispatchEvent(new t.BaseEvent(t.BaseEvent.COMPLETE)),null!=this.onComplete&&(this.onComplete(this),this.onComplete=null))}},i.prototype.updateBind=function(){this._bindTarget&&(this._bindTarget.getSocket(this._bindSocket,this.bindMatrix),this.bindVecter3d.setTo(this.bindMatrix.x,this.bindMatrix.y,this.bindMatrix.z),this.bindMatrix.identityPostion(),this.groupRotationMatrix.isIdentity?this.bindMatrix.invertToMatrix(this.invertBindMatrix):(this.bindMatrix.copyTo(this.invertBindMatrix),this.invertBindMatrix.prepend(this.groupRotationMatrix),this.invertBindMatrix.invert()))},i.prototype.reset=function(){if(!this.hasDestory){this._time=0;for(var t=0;this._displayAry&&t<this._displayAry.length;t++)this._displayAry[t].reset()}},i.prototype.update=function(){if(this.sceneVisible&&this._displayAry)for(var t=0;t<this._displayAry.length;t++)this._displayAry[t].update()},i.prototype.updateItem=function(t){this.sceneVisible&&(this.hasDestory||this._displayAry[t].update())},Object.defineProperty(i.prototype,"size",{get:function(){return this._displayAry?this._displayAry.length:0},enumerable:!0,configurable:!0}),i.prototype.getDisplay3D=function(e){var i;switch(e.particleType){case 1:i=new t.Display3DFacetParticle;break;case 18:i=new t.Display3DBallPartilce;break;case 3:i=new t.Display3DLocusPartilce;break;case 14:i=new t.Display3DLocusBallPartilce;break;case 9:i=new t.Display3DModelObjParticle;break;case 4:i=new t.Display3DModelPartilce;break;case 7:i=new t.Display3dModelAnimParticle;break;case 8:i=new t.Display3DFollowPartilce}return i.visible=!1,i},i.prototype.destory=function(){if(!this.hasDestory){this.sourceData&&this.sourceData.useNum--;for(var t=0;t<this._displayAry.length;t++)this._displayAry[t].destory();this._displayAry.length=0,this._displayAry=null,this.bindMatrix=null,this.bindVecter3d=null,this.bindScale=null,this.invertBindMatrix=null,this._bindTarget=null,this._bindSocket=null,this._groupPos=null,this._groupRotation=null,this._groupScale=null,this.groupMatrix=null,this.groupRotationMatrix=null,this.hasDestory=!0}},i}(t.EventDispatcher);t.CombineParticle=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.destory=function(){for(var t=0;t<this.dataAry.length;t++)this.dataAry[t].destory()},i.prototype.getCombineParticle=function(){var e=new t.CombineParticle;e.maxTime=this.maxTime;for(var i=0;i<this.dataAry.length;i++){var a=this.dataAry[i].creatPartilce();e.addPrticleItem(a)}return e.sourceData=this,this.useNum++,e},i.prototype.setDataByte=function(e){e.position=0;var i=e.readInt(),a=e.readInt();this.maxTime=0,this.dataAry=new Array;for(var n=0;n<a;n++){var r=e.readInt(),o=this.getParticleDataType(r);o.version=i,o.setAllByteInfo(e),this.dataAry.push(o),o.timelineData.maxFrameNum>this.maxTime&&(this.maxTime=o.timelineData.maxFrameNum)}this.maxTime*=t.Scene_data.frameTime},i.prototype.getParticleDataType=function(e){var i;switch(e){case 1:i=new t.ParticleFacetData;break;case 18:i=new t.ParticleBallData;break;case 3:i=new t.ParticleLocusData;break;case 14:i=new t.ParticleLocusballData;break;case 9:case 4:case 7:i=new t.ParticleModelData;break;case 8:i=new t.ParticleFollowData;break;case 12:i=new t.ParticleFollowLocusData;break;case 13:i=new t.ParticleBoneData}return i},i}(t.ResCount);t.CombineParticleData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.isInGroup=!1,i.visible=!0,i._rotationMatrix=new t.Matrix3D,i.modelMatrix=new t.Matrix3D,i}return __extends(i,e),i.prototype.onCreated=function(){},i.prototype.setBind=function(t,e,i,a,n){this.bindVecter3d=t,this.bindMatrix=e,this.bindScale=i,this.invertBindMatrix=a,this.groupMatrix=n},i.prototype.getMulBindList=function(){return null},i.prototype.updateMatrix=function(){this.bindMatrix&&(this.modelMatrix.identity(),this.groupMatrix.isIdentity||this.posMatrix.append(this.groupMatrix),this.modelMatrix.append(this.posMatrix),this.modelMatrix.append(this.bindMatrix),this.modelMatrix.appendTranslation(this.bindVecter3d.x,this.bindVecter3d.y,this.bindVecter3d.z))},Object.defineProperty(i.prototype,"cantUseEffectsLev",{get:function(){return!(this.data._renderPriority<=t.Scene_data.effectsLev)},enumerable:!0,configurable:!0}),i.prototype.updateTime=function(t){this.cantUseEffectsLev||(this._time=t-this._beginTime,this._time+=this.data._delayedTime,this.timeline.updateTime(t),this.visible=this.timeline.visible,this.posMatrix.identity(),this.posMatrix.prependScale(.1*this._scaleX*this.bindScale.x*this.data.overAllScale,.1*this._scaleY*this.bindScale.y*this.data.overAllScale,.1*this._scaleZ*this.bindScale.z*this.data.overAllScale),this.timeline.updateMatrix(this.posMatrix,this))},i.prototype.reset=function(){this.timeline.reset(),this.updateTime(0)},i.prototype.clearAllAnim=function(){},i.prototype.update=function(){this.cantUseEffectsLev||this.visible&&this.data.materialParam&&(0==this.data._alphaMode&&(this.data._alphaMode=-1),t.Scene_data.context3D.setBlendParticleFactors(this.data._alphaMode),t.Scene_data.context3D.cullFaceBack(this.data.materialParam.material.backCull),this.data.materialParam&&t.Scene_data.context3D.setProgram(this.data.materialParam.program),this.updateMatrix(),this.setVc(),this.setVa(),this.resetVa())},i.prototype.setVc=function(){},i.prototype.pushVc=function(){t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData)},i.prototype.setVa=function(){},i.prototype.resetVa=function(){},i.prototype.setMaterialVc=function(){if(this.data.materialParam){for(var e=this.data.materialParam.dynamicConstList,i=this._time%(t.Scene_data.frameTime*this.data._life),a=0;a<e.length;a++)e[a].update(i);this.data.materialParam.material.fcNum<=0||(i*=this.data.materialParam.material.timeSpeed,this.data.materialParam.material.update(i),t.Scene_data.context3D.setVc4fv(this.data.materialParam.shader,"fc",this.data.materialParam.material.fcData))}},i.prototype.setMaterialTexture=function(){if(this.data.materialParam){for(var e=this.data.materialParam.material.texList,i=0;i<e.length;i++)e[i].isDynamic||t.Scene_data.context3D.setRenderTexture(this.data.materialParam.shader,e[i].name,e[i].texture,e[i].id,!0);var a=this.data.materialParam.dynamicTexList;for(i=0;i<a.length;i++)t.Scene_data.context3D.setRenderTexture(this.data.materialParam.shader,a[i].target.name,a[i].texture,a[i].target.id,!0)}},i.prototype.inverBind=function(){this.invertBindMatrix.isIdentity||this._rotationMatrix.prepend(this.invertBindMatrix)},i.prototype.resetPos=function(){},i.prototype.resetMulPos=function(t){},i.prototype.getVector3DByObject=function(e){return e?new t.Vector3D(e.x,e.y,e.z,e.w):null},i.prototype.clone=function(){return null},i.prototype.setAllByteInfo=function(e,i){void 0===i&&(i=0),this.creatData(),this.data.version=i,this.data.setAllByteInfo(e),this.timeline=new t.TimeLine,this.timeline.setAllDataInfo(this.data.timelineData),this._beginTime=this.timeline.beginTime},i.prototype.creatData=function(){this.data=new t.ParticleData},i.prototype.setTimeLine=function(t){this.timeline=t,this._beginTime=t.beginTime},i.prototype.destory=function(){this.timeline=null,this.bindMatrix=null,this.bindVecter3d=null,this.bindScale=null,this.invertBindMatrix=null,this.groupMatrix=null,this._rotationMatrix=null,this.modelMatrix=null,this.groupPos=null,this.groupScale=null,this.groupRotation=null},i}(t.Object3D);t.Display3DParticle=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._delayedTime=0,this._width=100,this._height=100,this._originWidthScale=.5,this._originHeightScale=.5,this._eyeDistance=0,this._watchEye=!1,this._isZiZhuan=!1,this.overAllScale=1}return e.prototype.destory=function(){this.objData&&this.objData.destory(),this.materialParam.destory(),this.timelineData.destory(),this.timelineData=null},e.prototype.uploadGpu=function(){},e.prototype.regShader=function(){},e.prototype.initVcData=function(){},e.prototype.creatPartilce=function(){var e=this.getParticle();e.data=this;var i=new t.TimeLine;return i.setAllDataInfo(this.timelineData),e.setTimeLine(i),e.onCreated(),e},e.prototype.getParticle=function(){return null},e.prototype.setAllByteInfo=function(e){this.timelineData=new t.TimeLineData,this.timelineData.setByteData(e),this._beginTime=this.timelineData.beginTime,this.version>=15&&(this._delayedTime=e.readFloat()),this._width=e.readFloat(),this._height=e.readFloat(),this._widthFixed=e.readBoolean(),this._heightFixed=e.readBoolean(),this._originWidthScale=e.readFloat(),this._originHeightScale=e.readFloat(),this._eyeDistance=e.readFloat(),this._alphaMode=e.readFloat(),this._uSpeed=e.readFloat(),this._vSpeed=e.readFloat(),this._animLine=e.readFloat(),this._animRow=e.readFloat(),this._animInterval=e.readFloat(),this._renderPriority=e.readFloat(),this._distortion=e.readBoolean(),this._isUV=e.readBoolean(),this._isU=e.readBoolean(),this._isV=e.readBoolean(),this._life=e.readFloat(),this._life=this._life>1e4?t.Scene_data.MAX_NUMBER:this._life,this._watchEye=e.readBoolean(),this._ziZhuanAngly=new t.Vector3D,this._ziZhuanAngly.x=e.readFloat(),this._ziZhuanAngly.y=e.readFloat(),this._ziZhuanAngly.z=e.readFloat(),this._ziZhuanAngly.w=e.readFloat(),this.rotationV3d=new t.Vector3D,this.rotationV3d.x=e.readFloat(),this.rotationV3d.y=e.readFloat(),this.rotationV3d.z=e.readFloat(),this.center=new t.Vector3D,this.center.x=e.readFloat(),this.center.y=e.readFloat(),this.center.z=e.readFloat(),this.center.w=e.readFloat(),this.overAllScale=e.readFloat(),!this._ziZhuanAngly||0==this._ziZhuanAngly.x&&0==this._ziZhuanAngly.y&&0==this._ziZhuanAngly.z||(this._isZiZhuan=!0),this.readMaterialPara(e);var i=e.readUTF();i=(i=i.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),this.materialByteUrl=i},Object.defineProperty(e.prototype,"materialByteUrl",{set:function(e){var i=this;this._materialUrl!=e&&(this._materialUrl=e,t.MaterialManager.getInstance().getMaterialByte(t.Scene_data.fileRoot+e,(function(t){i.onMaterialLoad(t)})))},enumerable:!0,configurable:!0}),e.prototype.onMaterialLoad=function(e){this.materialParam=new t.MaterialParam,this.materialParam.setMaterial(e),this.materialParam.setLife(this._life),this.materialParamData&&(this.materialParam.setTextObj(this.materialParamData.texAry),this.materialParam.setConstObj(this.materialParamData.conAry)),t.MaterialManager.getInstance().loadDynamicTexUtil(this.materialParam),this.regShader()},e.prototype.readMaterialPara=function(t){this.materialParamData=new Object;t.readUTF();var e=t.readInt();this.materialParamData.texAry=new Array;for(var i=0;i<e;i++){var a=new Object;a.isParticleColor=t.readBoolean(),a.paramName=t.readUTF(),a.url=t.readUTF(),a.isParticleColor&&(a.curve=new Object,this.readTempCurve(t,a.curve)),this.materialParamData.texAry.push(a)}this.readMaterialParaConAry(t)},e.prototype.readTempCurve=function(t,e){e.values=new Array;var i=!1;if(this.version>=12){var a=t.readInt();if(a>0)var n=t.readFloat();for(var r=0;r<a;r++){for(var o=t.readInt(),s=new Array,h=0;h<o;h++)s.push(t.readByte()/127*n);e.values.push(s)}i=!0}e.type=t.readFloat(),e.maxFrame=t.readFloat(),e.sideType=t.readBoolean(),e.speedType=t.readBoolean(),e.useColorType=t.readBoolean(),e.items=this.readItems(t),i||this.makeCurveData(e)},e.prototype.readItems=function(t){for(var e=new Array,i=t.readInt(),a=0;a<i;a++){var n=new Object;n.frame=t.readInt(),n.vec3=t.readVector3D(!0),n.rotation=t.readVector3D(!0),n.rotationLeft=t.readVector3D(!0),e.push(n)}return e},e.prototype.makeCurveData=function(t){for(var e=t.items,i=new Array,a=new Array,n=new Array,r=new Array,o=0;o<e.length;o++)if(o==e.length-1)i.push(e[o].vec3.x),a.push(e[o].vec3.y),n.push(e[o].vec3.z),r.push(e[o].vec3.w);else{var s=e[o+1].frame-e[o].frame,h=e[o].vec3,c=e[o+1].vec3,u=t.items[o].rotation,l=t.items[o+1].rotationLeft;i=i.concat(this.getBzData(h.x,c.x,u.x,l.x,s)),a=a.concat(this.getBzData(h.y,c.y,u.y,l.y,s)),n=n.concat(this.getBzData(h.z,c.z,u.z,l.z,s)),r=r.concat(this.getBzData(h.w,c.w,u.w,l.w,s))}t.values=new Array,t.values[0]=i,t.values[1]=a,t.values[2]=n,t.values[3]=r},e.prototype.getBzData=function(e,i,a,n,r){var o=new t.Vector2D(0,10*e),s=new t.Vector2D(r,10*i),h=new t.Matrix3D,c=new t.Vector3D;h.identity(),h.appendRotation(-a,t.Vector3D.Z_AXIS),c=h.transformVector(new t.Vector3D(r/2,0,0));var u=new t.Vector2D(r/2,o.y+c.y);h.identity(),h.appendRotation(-n,t.Vector3D.Z_AXIS),c=h.transformVector(new t.Vector3D(-r/2,0,0));for(var l=[o,u,new t.Vector2D(r/2,s.y+c.y),s],d=new Array,p=1;p<3*r;p++)d.push(this.drawbezier(l,p/(3*r)));var f=new Array;for(p=0;p<r;p++)for(var m=0;m<d.length;m++)if(d[m].x>=p){f.push(d[m].y/10);break}return f},e.prototype.drawbezier=function(e,i){var a=new Array;if(0==e.length)return new t.Vector2D;for(var n in e)a.push(new t.Vector2D(e[n].x,e[n].y));for(;a.length>1;){for(var r=0;r<a.length-1;r++)this.mathmidpoint(a[r],a[r+1],i);a.pop()}return a[0]},e.prototype.mathmidpoint=function(t,e,i){var a,n;a=t.x+(e.x-t.x)*i,n=t.y+(e.y-t.y)*i,t.x=a,t.y=n},e.prototype.readMaterialParaConAry=function(t){for(var e=new Array,i=t.readInt(),a=0;a<i;a++){var n=new Object;n.type=t.readFloat(),n.indexID=t.readFloat(),n.paramName=t.readUTF(),n.curve=new Object,this.readTempCurve(t,n.curve),e.push(n)}this.materialParamData.conAry=e},e.prototype.setFloat32Vec=function(t,e){},e.prototype.setFloat32Mat=function(t,e){},e}();t.ParticleData=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.ObjData);t.ParticleGpuData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.getParticleByte=function(e){var i,a=e=(e=e.replace("_byte.txt",".txt")).replace(".txt","_byte.txt");this._dic[a]?i=this._dic[a].getCombineParticle():i=new t.CombineParticle;return i.url=a,i},i.prototype.registerUrl=function(t){(t=(t=t.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),this._dic[t])&&this._dic[t].useNum++},i.prototype.releaseUrl=function(t){(t=(t=t.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),this._dic[t])&&this._dic[t].clearUseNum()},i.prototype.addResByte=function(e,i){if(!this._dic[e]){var a=new t.CombineParticleData;a.setDataByte(i),this._dic[e]=a}},i}(t.ResGC);t.ParticleManager=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"balldata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleBallData},i.prototype.setVa=function(){this.setVaCompress(),this.setMaterialTexture(),t.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},i.prototype.setVaCompress=function(){t.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,3,this.data.objData.stride,12),t.Scene_data.context3D.setVaOffset(2,4,this.data.objData.stride,24),t.Scene_data.context3D.setVaOffset(3,3,this.data.objData.stride,40),this.balldata._needSelfRotation&&t.Scene_data.context3D.setVaOffset(4,2,this.data.objData.stride,52),this.balldata._needRandomColor&&t.Scene_data.context3D.setVaOffset(5,4,this.particleBallData.stride,this.particleBallData.randomOffset))},i.prototype.resetVa=function(){},i.prototype.setVc=function(){this.updateWatchCaramMatrix(),this.balldata.vcmatData.set(t.Scene_data.viewMatrx3D.m,0),this.balldata.vcmatData.set(t.Scene_data.cam3D.cameraMatrix.m,16),this.balldata.vcmatData.set(this.modelMatrix.m,32),this.balldata.vcmatData.set(this._rotationMatrix.m,48),this.balldata._timeVec[0]=this._time/t.Scene_data.frameTime*this.balldata._playSpeed,this.balldata.vcmatData.set(this.balldata._timeVec,80),this.balldata._is3Dlizi&&(this.updateAllRotationMatrix(),this.balldata._wordPosVec[0]=this.bindVecter3d.x,this.balldata._wordPosVec[1]=this.bindVecter3d.y,this.balldata._wordPosVec[2]=this.bindVecter3d.z,this.balldata._caramPosVec[0]=t.Scene_data.cam3D.x,this.balldata._caramPosVec[1]=t.Scene_data.cam3D.y,this.balldata._caramPosVec[2]=t.Scene_data.cam3D.z,this.balldata.vcmatData.set(this.balldata._allRotationMatrix.m,64),this.balldata.vcmatData.set(this.balldata._wordPosVec,96),this.balldata.vcmatData.set(this.balldata._caramPosVec,100)),t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.balldata.vcmatData),this.setMaterialVc()},i.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.balldata.facez?this._rotationMatrix.prependRotation(90,t.Vector3D.X_AXIS):this.balldata._is3Dlizi?(this.timeline.inverAxisRotation(this._rotationMatrix),this.inverBind()):this.balldata._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this.inverBind(),this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS))},i.prototype.updateAllRotationMatrix=function(){this.balldata._allRotationMatrix.identity(),this.balldata._allRotationMatrix.prependScale(this.data.overAllScale*this._scaleX*.1*this.bindScale.x,this.data.overAllScale*this._scaleY*.1*this.bindScale.y,this.data.overAllScale*this._scaleZ*.1*this.bindScale.z),this.timeline.inverAxisRotation(this._rotationMatrix),this.isInGroup&&(this.balldata._allRotationMatrix.appendRotation(this.groupRotation.x,t.Vector3D.X_AXIS),this.balldata._allRotationMatrix.appendRotation(this.groupRotation.y,t.Vector3D.Y_AXIS),this.balldata._allRotationMatrix.appendRotation(this.groupRotation.z,t.Vector3D.Z_AXIS)),this.bindMatrix&&this.balldata._allRotationMatrix.append(this.bindMatrix)},Object.defineProperty(i.prototype,"particleBallData",{get:function(){return this.data.objData},enumerable:!0,configurable:!0}),i}(t.Display3DParticle);t.Display3DBallPartilce=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"vPosition"),t.bindAttribLocation(this.program,1,"texcoord"),t.bindAttribLocation(this.program,2,"basePos"),t.bindAttribLocation(this.program,3,"speed"),this.paramAry[3]&&t.bindAttribLocation(this.program,4,"rotation"),this.paramAry[1]&&t.bindAttribLocation(this.program,5,"color")},e.prototype.getMat4Str=function(t){return"vcmat["+e.shader_mat4[t]+"]"},e.prototype.getVec4Str=function(t){return"vcmat["+e.shader_vec4[t][0]+"]["+e.shader_vec4[t][1]+"]"},e.getVcSize=function(){return 7},e.prototype.getVertexShaderString=function(){var t,i,a,n,r,o,s,h,c,u;u="attribute vec4 vPosition;\nattribute vec3 texcoord;\nattribute vec4 basePos;\nattribute vec3 speed;\nuniform mat4 vcmat["+e.getVcSize()+"];\nvarying vec2 v0;\n",t="float ctime = "+this.getVec4Str("time")+".x - basePos.w;\nif ("+this.getVec4Str("time")+".w > 0.0 && ctime >= 0.0) {\n    ctime = fract(ctime / "+this.getVec4Str("time")+".z) * "+this.getVec4Str("time")+".z;\n}\nvec4 pos = vPosition;\n",i="float stime = ctime - "+this.getVec4Str("scale")+".w;\nstime = max(stime,0.0);\nfloat sf = "+this.getVec4Str("scale")+".x * stime;\nif ("+this.getVec4Str("scale")+".y != 0.0 && "+this.getVec4Str("scale")+".z != 0.0) {\n    sf += sin("+this.getVec4Str("scale")+".y * stime) * "+this.getVec4Str("scale")+".z;\n}\nif (sf > "+this.getVec4Str("scaleCtrl")+".z) {\n    sf = "+this.getVec4Str("scaleCtrl")+".z;\n} else if (sf < "+this.getVec4Str("scaleCtrl")+".w) {\n    sf = "+this.getVec4Str("scaleCtrl")+".w;\n}\nvec2 sv2 = vec2("+this.getVec4Str("scaleCtrl")+".x * sf, "+this.getVec4Str("scaleCtrl")+".y * sf);\nsv2 = sv2 + 1.0;\npos.x *= sv2.x;\npos.y *= sv2.y;\n",a="vec3 addPos = speed * ctime;\nvec3 uspeed = vec3(0,0,0);\nif (ctime < 0.0 || ctime >= "+this.getVec4Str("time")+".z) {\n    addPos.y = addPos.y + 100000.0;\n}\n",n="if("+this.getVec4Str("time")+".y != 0.0 && length(speed) != 0.0) {\n    uspeed = vec3(speed.x, speed.y, speed.z);\n    uspeed = normalize(uspeed);\n    uspeed = uspeed * "+this.getVec4Str("time")+".y;\n    uspeed.xyz = uspeed.xyz + "+this.getVec4Str("force")+".xyz;\n} else {\n    uspeed = vec3("+this.getVec4Str("force")+".x, "+this.getVec4Str("force")+".y, "+this.getVec4Str("force")+".z);\n}\naddPos.xyz = addPos.xyz + uspeed.xyz * ctime * ctime;\n",r="uspeed = speed + uspeed * ctime * 2.0;\nuspeed = normalize(uspeed);\nvec4 tempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(uspeed,1.0);\nuspeed.xyz = tempMul.xyz;\nuspeed = normalize(uspeed);\nvec3 cPos = addPos;\ntempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(cPos,1.0);\ncPos.xyz = tempMul.xyz; \ncPos.xyz = "+this.getVec4Str("worldPos")+".xyz + cPos.xyz;\ncPos.xyz = "+this.getVec4Str("camPos")+".xyz - cPos.xyz;\ncPos = normalize(cPos);\ncPos = cross(uspeed, cPos);\ncPos = normalize(cPos);\nuspeed = uspeed * pos.x;\ncPos = cPos * pos.y;\npos.xyz = uspeed.xyz + cPos.xyz;\n",o="pos = "+this.getMat4Str("watheye")+" * pos;\npos.xyz = pos.xyz + basePos.xyz + addPos.xyz;\ngl_Position = "+this.getMat4Str("viewMatrix3D")+" * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("modelMatrix")+" * pos;\n",s="vec2 uv = vec2(texcoord.x,texcoord.y);\nfloat animframe = floor(ctime / "+this.getVec4Str("animCtrl")+".z);\nanimframe = animframe / "+this.getVec4Str("animCtrl")+".x;\nuv.x += animframe;\nanimframe = floor(animframe);\nuv.y += animframe / "+this.getVec4Str("animCtrl")+".y;\nv0.xy = uv.xy;\n",h="vec2 uv = vec2("+this.getVec4Str("uvCtrl")+".x,"+this.getVec4Str("uvCtrl")+".y);\nuv.xy = uv.xy * ctime + texcoord.xy;\nv0.xy = uv.xy;\n",c="v1 = vec2(ctime/"+this.getVec4Str("time")+".z,1.0);\n";var l=this.paramAry[0],d=this.paramAry[1],p=this.paramAry[2],f=this.paramAry[3],m=this.paramAry[4],y=this.paramAry[5],_=this.paramAry[6],v="",x="";return v+=t,x+=u,m&&(v+=i,x+=""),f&&(v+="float angle = rotation.x + rotation.y * ctime;\nvec4 np = vec4(sin(angle), cos(angle), 0, 0);\nnp.z = np.x * pos.y + np.y * pos.x;\nnp.w = np.y * pos.y - np.x * pos.x;\npos.xy = np.zw;\n",x+="attribute vec2 rotation;\n"),v+=a,y&&(v+=n,x+=""),p&&(v+=r,x+=""),v+=o,1==_?(v+=s,x+=""):2==_?(v+=h,x+=""):v+="v0 = vec2(texcoord.x,texcoord.y);\n",d&&(v+="v2 = color;\n",x+="attribute vec4 color;\nvarying vec4 v2;\n"),l&&(v+=c,x+="varying vec2 v1;\n"),x+"void main(){\n"+v+"}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}"},e.Display3D_Ball_Shader="Display3DBallShader",e.shader_mat4={viewMatrix3D:0,camMatrix3D:1,modelMatrix:2,watheye:3,rotationMatrix:4},e.shader_vec4={time:[5,0],scale:[5,1],scaleCtrl:[5,2],force:[5,3],worldPos:[6,0],camPos:[6,1],animCtrl:[6,2],uvCtrl:[6,3]},e}(t.Shader3D);t.Display3DBallShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._totalNum=1,i._acceleration=.2,i._toscale=0,i._shootAngly=new t.Vector3D(1,0,0),i._shootSpeed=0,i._isRandom=!1,i._isSendRandom=!1,i._isSendAngleRandom=!1,i._paticleMaxScale=1,i._paticleMinScale=1,i._addforce=new t.Vector3D(0,0,0),i._lixinForce=new t.Vector3D(0,0,0),i._waveform=new t.Vector3D(0,0,0,0),i._round=new t.Vector3D,i._is3Dlizi=!1,i._speed=1,i._isLoop=!1,i._basePositon=new t.Vector3D(0,0,0),i._baseRandomAngle=0,i._shapeType=0,i._playSpeed=1,i._beginScale=0,i}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DBallPartilce},i.prototype.setAllByteInfo=function(i){this._totalNum=i.readFloat(),this._acceleration=i.readFloat(),this._toscale=i.readFloat(),this._shootSpeed=i.readFloat(),this._isRandom=i.readBoolean(),this._isSendRandom=i.readBoolean(),this._round.x=i.readFloat(),this._round.y=i.readFloat(),this._round.z=i.readFloat(),this._round.w=i.readFloat(),this._is3Dlizi=i.readBoolean(),this._halfCircle=i.readBoolean(),this._shootAngly.x=i.readFloat(),this._shootAngly.y=i.readFloat(),this._shootAngly.z=i.readFloat(),this._shootAngly.w=i.readFloat(),this._shootAngly.normalize(),this._speed=i.readFloat(),this._isLoop=i.readBoolean(),this._isSendAngleRandom=i.readBoolean(),this._waveform.x=i.readFloat(),this._waveform.y=i.readFloat(),this._waveform.z=i.readFloat(),this._waveform.w=i.readFloat(),this._closeSurface=i.readBoolean(),this._isEven=i.readBoolean(),this._paticleMaxScale=i.readFloat(),this._paticleMinScale=i.readFloat(),this._basePositon.x=i.readFloat(),this._basePositon.y=i.readFloat(),this._basePositon.z=i.readFloat(),this._basePositon.w=i.readFloat(),this._baseRandomAngle=i.readFloat(),this._shapeType=i.readFloat(),this._lockX=i.readBoolean(),this._lockY=i.readBoolean(),this._addforce.x=i.readFloat(),this._addforce.y=i.readFloat(),this._addforce.z=i.readFloat(),this._addforce.w=i.readFloat(),this._addforce.scaleByW(),this._lixinForce.x=i.readFloat(),this._lixinForce.y=i.readFloat(),this._lixinForce.z=i.readFloat(),this._lixinForce.w=i.readFloat(),this._islixinAngly=i.readBoolean(),this._particleRandomScale=new t.Vector3D,this._particleRandomScale.x=i.readFloat(),this._particleRandomScale.y=i.readFloat(),this._particleRandomScale.z=i.readFloat(),this._particleRandomScale.w=i.readFloat(),this._playSpeed=i.readFloat(),this.facez=i.readBoolean(),this._beginScale=i.readFloat(),this._widthFixed=i.readBoolean(),this._heightFixed=i.readBoolean(),this.readRandomColor(i),0!=this._acceleration||0!=this._addforce.x||0!=this._addforce.y||0!=this._addforce.z?(this._needAddSpeed=!0,this._addSpeedVec=[this._addforce.x,this._addforce.y,this._addforce.z]):this._needAddSpeed=!1,0!=this._toscale||0!=this._waveform.x||0!=this._waveform.y?(this._needScale=!0,this._scaleVec=[this._toscale,this._waveform.x,this._waveform.y,this._beginScale],this._scaleCtrlVec=[this._widthFixed?0:1,this._heightFixed?0:1,this._paticleMaxScale-1,this._paticleMinScale-1]):this._needScale=!1,e.prototype.setAllByteInfo.call(this,i),this._timeVec=[0,this._acceleration,this._life,this._isLoop?1:-1],this._is3Dlizi&&(this._wordPosVec=[0,0,0],this._caramPosVec=[0,0,0],this._allRotationMatrix=new t.Matrix3D),this.initVcData()},i.prototype.readRandomColor=function(t){var e=t.readInt(),i=new Object;i.alpha=new Array,i.color=new Array,i.pos=new Array;for(var a=0;a<e;a++)i.alpha.push(t.readFloat()),i.color.push(t.readFloat()),i.pos.push(t.readFloat());this._textureRandomColorInfo=i},Object.defineProperty(i.prototype,"objBallData",{get:function(){return this.objData},enumerable:!0,configurable:!0}),i.prototype.uploadGpu=function(){this.objData=new t.ParticleBallGpuData,this.initBaseData(),this.initBasePos(),this.initSpeed(),this.initSelfRotaion(),this._needRandomColor&&this.initBaseColor(),this.pushToGpu()},i.prototype.initBaseData=function(){for(var t=new Array,e=new Array,i=new Array,a=0;a<this._totalNum;a++)this.makeRectangleData(t,e,this._width,this._height,this._originWidthScale,this._originHeightScale,this._isUV,this._isU,this._isV,this._animLine,this._animRow,a),i.push(0+4*a,1+4*a,2+4*a,0+4*a,2+4*a,3+4*a);this.objBallData.vertices=t,this.objBallData.uvs=e,this.objBallData.indexs=i},i.prototype.makeRectangleData=function(e,i,a,n,r,o,s,h,c,u,l,d){void 0===r&&(r=.5),void 0===o&&(o=.5),void 0===s&&(s=!1),void 0===h&&(h=!1),void 0===c&&(c=!1),void 0===u&&(u=1),void 0===l&&(l=1),void 0===d&&(d=0);var p=Math.random()*(this._particleRandomScale.x-this._particleRandomScale.y)+this._particleRandomScale.y;e.push(-r*a*p,(n-o*n)*p,0),e.push((a-r*a)*p,(n-o*n)*p,0),e.push((a-r*a)*p,-o*n*p,0),e.push(-r*a*p,-o*n*p,0);var f=new Array;if(f.push(new t.Vector2D(0,0)),f.push(new t.Vector2D(0,1/l)),f.push(new t.Vector2D(1/u,1/l)),f.push(new t.Vector2D(1/u,0)),h)for(var m=0;m<f.length;m++)f[m].x=-f[m].x;if(c)for(m=0;m<f.length;m++)f[m].y=-f[m].y;s&&f.push(f.shift());for(m=0;m<f.length;m++)i.push(f[m].x,f[m].y,d)},i.prototype.initBasePos=function(){for(var e=new Array,i=0;i<this._totalNum;i++){var a,n;if(this._isRandom){var r=new t.Vector3D(this._round.x*this._round.w,this._round.y*this._round.w,this._round.z*this._round.w);this._isEven?this._closeSurface?(a=new t.Vector3D(0,0,r.z),(n=new t.Matrix3D).appendRotation(360*Math.random(),t.Vector3D.Y_AXIS),(a=n.transformVector(a)).y=r.y*Math.random()*2-r.y):(a=new t.Vector3D(0,0,r.z*Math.random()*2-r.z),(n=new t.Matrix3D).appendRotation(360*Math.random(),t.Vector3D.Y_AXIS),(a=n.transformVector(a)).y=r.y*Math.random()*2-r.y):this._closeSurface?(a=new t.Vector3D(0,0,r.z),n=new t.Matrix3D,this._halfCircle?n.appendRotation(180*-Math.random(),t.Vector3D.X_AXIS):n.appendRotation(360*Math.random(),t.Vector3D.X_AXIS),n.appendRotation(360*Math.random(),t.Vector3D.Y_AXIS),a=n.transformVector(a)):a=this._halfCircle?new t.Vector3D(r.x*Math.random()*2-r.x,r.y*Math.random(),r.z*Math.random()*2-r.z):new t.Vector3D(r.x*Math.random()*2-r.x,r.y*Math.random()*2-r.y,r.z*Math.random()*2-r.z)}else a=new t.Vector3D;a=a.add(this._basePositon);for(var o=0;o<4;o++)e.push(a.x,a.y,a.z,i*this._shootSpeed)}this.objBallData.basePos=e},i.prototype.initSpeed=function(){for(var e=new Array,i=0;i<this._totalNum;i++){var a=new t.Vector3D,n=new t.Vector3D;if(0!=this._shootAngly.x||0!=this._shootAngly.y||0!=this._shootAngly.z){var r=Math.tan(this._shootAngly.w*Math.PI/180*Math.random()),o=360*Math.PI/180*Math.random();n=new t.Vector3D(Math.sin(o)*r,Math.cos(o)*r,1);var s=new t.Matrix3D;if(s.fromVtoV(new t.Vector3D(0,.0101,.99994),new t.Vector3D(this._shootAngly.x,this._shootAngly.y,this._shootAngly.z)),n=s.transformVector(n),isNaN(n.x))throw new Error("发射锥角，可能有问题，确定是否有取膜");n.normalize(),a=a.add(n)}0==this._lixinForce.x&&0==this._lixinForce.y&&0==this._lixinForce.z||((n=new t.Vector3D(Math.random()>.5?-this._lixinForce.x:this._lixinForce.x,Math.random()>.5?-this._lixinForce.y:this._lixinForce.y,Math.random()>.5?-this._lixinForce.z:this._lixinForce.z)).normalize(),a=a.add(n)),this._islixinAngly&&((n=this._isEven?new t.Vector3D(this.objBallData.basePos[16*i],0,this.objBallData.basePos[16*i+2]):new t.Vector3D(this.objBallData.basePos[16*i],this.objBallData.basePos[16*i+1],this.objBallData.basePos[16*i+2])).normalize(),a=a.add(n)),a.normalize(),this._isSendRandom?a.scaleBy(this._speed*Math.random()):a.scaleBy(this._speed);this._baseRandomAngle,Math.random(),Math.PI;for(var h=0;h<4;h++)e.push(a.x,a.y,a.z)}this.objBallData.beMove=e},i.prototype.initSelfRotaion=function(){var t=0,e=0;if(0!=this._ziZhuanAngly.x||0!=this._ziZhuanAngly.y||0!=this._ziZhuanAngly.z||0!=this._ziZhuanAngly.w)if(this._is3Dlizi)this._needSelfRotation=!1;else{this._needSelfRotation=!0;for(var i=new Array,a=0;a<this._totalNum;)t=this._ziZhuanAngly.x,1==this._ziZhuanAngly.y&&(t*=Math.random()),e=this._ziZhuanAngly.z,1==this._ziZhuanAngly.w?e*=Math.random():-1==this._ziZhuanAngly.w&&(e*=2*Math.random()-1),i.push(t,e),i.push(t,e),i.push(t,e),i.push(t,e),a++;this.objBallData.baseRotation=i}else this._needSelfRotation=!1},i.prototype.initBaseColor=function(){for(var e=t.ColorTransition.getInstance().getImageData(this._textureRandomColorInfo).data,i=new Array,a=0;a<this._totalNum;a++){var n=4*t.Util.float2int(128*Math.random()),r=new t.Vector3D(e[n],e[n+1],e[n+2],e[n+3]);r.scaleBy(1/255),i.push(r.x,r.y,r.z,r.w),i.push(r.x,r.y,r.z,r.w),i.push(r.x,r.y,r.z,r.w),i.push(r.x,r.y,r.z,r.w)}this.objBallData.randomColor=i},i.prototype.pushToGpu=function(){this.compressVertex()},i.prototype.compressVertex=function(){var e=this.objBallData.vertices.length/3,i=13;this._needSelfRotation&&(i+=2),this._needRandomColor&&(this.objBallData.randomOffset=4*i,i+=4),this.objBallData.stride=4*i;for(var a=new Array,n=0;n<e;n++){for(var r=0;r<3;r++)a.push(this.objBallData.vertices[3*n+r]);for(r=0;r<3;r++)a.push(this.objBallData.uvs[3*n+r]);for(r=0;r<4;r++)a.push(this.objBallData.basePos[4*n+r]);for(r=0;r<3;r++)a.push(this.objBallData.beMove[3*n+r]);if(this._needSelfRotation)for(r=0;r<2;r++)a.push(this.objBallData.baseRotation[2*n+r]);if(this._needRandomColor)for(r=0;r<4;r++)a.push(this.objBallData.randomColor[4*n+r])}this.objBallData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(a),this.objBallData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objBallData.indexs),this.objBallData.treNum=this.objBallData.indexs.length},i.prototype.setFloat32Vec=function(e,i){var a=t.Display3DBallShader.shader_vec4[e],n=16*a[0]+4*a[1];this.vcmatData.set(i,n)},i.prototype.setFloat32Mat=function(e,i){var a=16*t.Display3DBallShader.shader_mat4[e];this.vcmatData.set(i,a)},i.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*t.Display3DBallShader.getVcSize()),this.setFloat32Vec("time",this._timeVec),this._needAddSpeed&&this.setFloat32Vec("force",this._addSpeedVec),this._needScale&&(this.setFloat32Vec("scale",this._scaleVec),this.setFloat32Vec("scaleCtrl",this._scaleCtrlVec)),1==this._uvType?this.setFloat32Vec("animCtrl",this._animCtrlVec):2==this._uvType&&this.setFloat32Vec("uvCtrl",this._uvCtrlVec)},i.prototype.regShader=function(){if(this.materialParam){var e=this.getShaderParam();this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DBallShader.Display3D_Ball_Shader,t.Display3DBallShader,this.materialParam.material,e),this.materialParam.program=this.materialParam.shader.program}},i.prototype.getShaderParam=function(){1!=this._animRow||1!=this._animLine?(this._uvType=1,this._animCtrlVec=[this._animLine,this._animRow,this._animInterval]):0!=this._uSpeed||0!=this._vSpeed?(this._uvType=2,this._uvCtrlVec=[this._uSpeed,this._vSpeed]):this._uvType=0;var t=this.materialParam.material.hasParticleColor;return this._needRandomColor=this.materialParam.material.hasVertexColor,this.uploadGpu(),[t?1:0,this._needRandomColor?1:0,this._is3Dlizi?1:0,this._needSelfRotation?1:0,this._needScale?1:0,this._needAddSpeed?1:0,this._uvType]},i}(t.ParticleData);t.ParticleBallData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.destory=function(){e.prototype.destory.call(this),this.basePos&&(this.basePos.length=0,this.basePos=null,this.basePosBuffer&&(t.Scene_data.context3D.deleteBuffer(this.basePosBuffer),this.basePosBuffer=null)),this.beMove&&(this.beMove.length=0,this.beMove=null,this.beMoveBuffer&&(t.Scene_data.context3D.deleteBuffer(this.beMoveBuffer),this.beMoveBuffer=null)),this.randomColor&&(this.randomColor.length=0,this.randomColor=null,this.randomColorBuffer&&(t.Scene_data.context3D.deleteBuffer(this.randomColorBuffer),this.randomColorBuffer=null)),this.baseRotation&&(this.baseRotation.length=0,this.baseRotation=null,this.baseRotationBuffer&&(t.Scene_data.context3D.deleteBuffer(this.baseRotationBuffer),this.baseRotationBuffer=null))},i}(t.ParticleGpuData);t.ParticleBallGpuData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"pos"),t.bindAttribLocation(this.program,1,"v2uv"),t.bindAttribLocation(this.program,2,"boneWeight"),t.bindAttribLocation(this.program,3,"boneID")},i.prototype.getMat4Str=function(t){return"vcmat["+i.shader_mat4[t]+"]"},i.getVcSize=function(){return 3},i.prototype.getVertexShaderString=function(){return"attribute vec3 pos;attribute vec2 v2uv;attribute vec4 boneWeight;attribute vec4 boneID;uniform vec4 boneQ[54];\nuniform vec3 boneD[54];\nuniform mat4 vcmat["+i.getVcSize()+"];\nvarying vec2 v0;\n"+t.MaterialAnimShader.getMd5M44Str()+"void main(void){v0 = v2uv;\nvec4 vt0 = getQDdata(vec3(pos.x,pos.y,pos.z));\n gl_Position = "+this.getMat4Str("viewMatrix3D")+" * "+this.getMat4Str("camMatrix3D")+" *"+this.getMat4Str("posMatrix3D")+"* vt0;}"},i.prototype.getFragmentShaderString=function(){return"precision mediump float;\nvarying vec2 v0;\nvoid main(void)\n{\ngl_FragColor = vec4(1.0,0.0,1.0,1.0);\n}"},i.Display3DBoneShader="Display3DBoneShader",i.shader_mat4={viewMatrix3D:0,camMatrix3D:1,posMatrix3D:2},i}(t.Shader3D);t.Display3DBoneShader=e;var i=function(e){function i(){var t=e.call(this)||this;return t.skipNum=0,t}return __extends(i,e),Object.defineProperty(i.prototype,"modeldata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleBoneData},i.prototype.update=function(){t.Scene_data.context3D.setWriteDepth(!1),e.prototype.update.call(this)},i.prototype.setVc=function(){var e=t.Util.float2int(this._time/t.Scene_data.frameTime/2);this.data.vcmatData.set(t.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(t.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,32),t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData);var i=this.modeldata.animData.boneQPAry[0],a=i[e%i.length];t.Scene_data.context3D.setVc4fv(this.data.materialParam.shader,"boneQ",a.quat),t.Scene_data.context3D.setVc3fv(this.data.materialParam.shader,"boneD",a.pos),this.setMaterialVc()},i.prototype.setVa=function(){t.Scene_data.context3D.pushVa(this.modeldata.meshData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.modeldata.meshData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.modeldata.meshData.stride,12),t.Scene_data.context3D.setVaOffset(3,4,this.modeldata.meshData.stride,20),t.Scene_data.context3D.setVaOffset(2,4,this.modeldata.meshData.stride,36)),this.setMaterialTexture(),t.Scene_data.context3D.drawCall(this.modeldata.meshData.indexBuffer,this.modeldata.meshData.treNum)},i.prototype.resetVa=function(){e.prototype.resetVa.call(this)},i}(t.Display3DParticle);t.Display3DBonePartilce=i}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.objScale=1,t}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DBonePartilce},i.prototype.destory=function(){e.prototype.destory.call(this),this.meshData.destory(),this.animData=null},i.prototype.setAllByteInfo=function(i){this.meshData=new t.MeshData,this.animData=new t.AnimData,this.objScale=i.readFloat();var a=i.getInt(),n=new ArrayBuffer(a*=52),r=new DataView(n);t.BaseRes.readBytes2ArrayBuffer(i,r,3,0,13),t.BaseRes.readBytes2ArrayBuffer(i,r,2,3,13),t.BaseRes.readIntForTwoByte(i,this.meshData.indexs),t.BaseRes.readBytes2ArrayBuffer(i,r,4,5,13,2),t.BaseRes.readBytes2ArrayBuffer(i,r,4,9,13,3),this.meshData.stride=52,this.readFrameQua(i),e.prototype.setAllByteInfo.call(this,i),this.initVcData(),this.meshData.vertexBuffer=t.Scene_data.context3D.uploadBuff3DArrayBuffer(n),this.meshData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.meshData.indexs),this.meshData.treNum=this.meshData.indexs.length},i.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*t.Display3DBoneShader.getVcSize())},i.prototype.setFloat32Mat=function(e,i){var a=16*t.Display3DBoneShader.shader_mat4[e];this.vcmatData.set(i,a)},i.prototype.readFrameQua=function(e){for(var i=e.readFloat(),a=e.readInt(),n=new Array,r=0;r<a;r++){var o=e.readInt(),s=new t.DualQuatFloat32Array;s.quat=new Float32Array(4*o),s.pos=new Float32Array(3*o);for(var h=0;h<o;h++)s.quat[4*h+0]=e.readShort()/32767,s.quat[4*h+1]=e.readShort()/32767,s.quat[4*h+2]=e.readShort()/32767,s.quat[4*h+3]=e.readShort()/32767,s.pos[3*h+0]=e.readShort()/32767*i,s.pos[3*h+1]=e.readShort()/32767*i,s.pos[3*h+2]=e.readShort()/32767*i;n.push(s)}this.animData.boneQPAry=new Array,this.animData.boneQPAry.push(n)},i.prototype.uploadGpu=function(){this.uploadMesh(this.meshData)},i.prototype.uploadMesh=function(e){e.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(e.vertices),e.uvBuffer=t.Scene_data.context3D.uploadBuff3D(e.uvs),e.boneIdBuffer=t.Scene_data.context3D.uploadBuff3D(e.boneIDAry),e.boneWeightBuffer=t.Scene_data.context3D.uploadBuff3D(e.boneWeightAry),e.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(e.indexs),e.treNum=e.indexs.length},i.prototype.regShader=function(){this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DBoneShader.Display3DBoneShader,t.Display3DBoneShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program},i}(t.ParticleData);t.ParticleBoneData=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this.baseNum=0,this.num=0,this.time=0,this.speed=0,this.aSpeed=0,this.beginTime=0,this.lastTime=0,this.baseTime=0}return t.prototype.BaseAnim=function(){},t.prototype.update=function(t){this._isDeath||(this.time=t-this.baseTime,this._isActiva?(this.time=this.time-this.beginTime,this.time>this.lastTime&&(this.time=this.lastTime-this.beginTime,this._isDeath=!0),this.coreCalculate()):this.time>=this.beginTime&&(this.time>=this.lastTime?(this.time=this.lastTime-this.beginTime,this.coreCalculate(),this._isDeath=!0):(this.time=this.time-this.beginTime,this.coreCalculate()),this._isActiva=!0))},t.prototype.coreCalculate=function(){this.num=this.speed*this.time+this.aSpeed*this.time*this.time+this.baseNum},t.prototype.reset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.num=0},t.prototype.depthReset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.baseNum=0,this.num=0},Object.defineProperty(t.prototype,"data",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeath",{get:function(){return this._isDeath},set:function(t){this._isDeath=t},enumerable:!0,configurable:!0}),t.prototype.getAllNum=function(t){t=Math.min(t,this.lastTime),t-=this.beginTime;var e=this.speed*t+this.aSpeed*t*t;this.baseNum+=e},t}();t.BaseAnim=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"data",{set:function(e){this.beginTime=Number(e[0].value),-1==Number(e[1].value)?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(e[1].value);var i=e[2].value.split("|");this.axis=new t.Vector3D(Number(i[0]),Number(i[1]),Number(i[2])),this.axis.normalize(),this.speed=.1*Number(e[3].value),this.aSpeed=.001*Number(e[4].value)},enumerable:!0,configurable:!0}),i.prototype.dataByte=function(e,i){this.beginTime=i[0],-1==i[1]?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=i[1],this.axis=i[2],this.axis.normalize(),this.speed=.1*i[3],this.aSpeed=.001*i[4]},i}(t.BaseAnim);t.AxisMove=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"data",{set:function(e){this.beginTime=Number(e[0].value),-1==Number(e[1].value)?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(e[1].value);var i=String(e[2].value).split("|");this.axis=new t.Vector3D(Number(i[0]),Number(i[1]),Number(i[2])),i=String(e[3].value).split("|"),this.axisPos=new t.Vector3D(100*Number(i[0]),100*Number(i[1]),100*Number(i[2])),this.speed=.1*Number(e[4].value),this.aSpeed=.1*Number(e[5].value)},enumerable:!0,configurable:!0}),i.prototype.dataByte=function(e,i){this.beginTime=Number(i[0]),-1==Number(i[1])?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(i[1]),this.axis=i[2],this.axisPos=i[3],this.speed=.1*i[4],this.aSpeed=.1*i[5]},i}(t.BaseAnim);t.AxisRotaion=e}(tl3d||(tl3d={})),function(t){var e=function(){};t.KeyFrame=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.num=1,t}return __extends(i,e),i.prototype.update=function(t){this._isDeath||(this.time=t-this.baseTime,this._isActiva?(this.coreCalculate(),this.time>this.lastTime&&(this._isDeath=!0)):this.time>=this.beginTime&&(this._isActiva=!0))},i.prototype.coreCalculate=function(){var e=t.Util.float2int(this.time/t.Scene_data.frameTime);e>=this.numAry.length?this.num=this.numAry[this.numAry.length-1]:this.num=this.numAry[e]},i.prototype.reset=function(){e.prototype.reset.call(this),this.num=1},i.prototype.depthReset=function(){e.prototype.depthReset.call(this),this.num=1},Object.defineProperty(i.prototype,"data",{set:function(e){this.numAry=new Array,this.beginTime=Number(e[0].value),-1==Number(e[1].value)?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(e[1].value),this.beginScale=Number(e[2].value),this.scaleNum=Number(e[3].value),this.scaleAry=new Array;for(var i,a=0,n=4;n<4+2*this.scaleNum;n+=2){var r=new Object;r.value=Number(e[n].value),r.time=Number(e[n+1].value),a+=r.time,r.beginTime=this.beginTime+a,this.scaleAry.push(r)}var o=0,s=1;this.scaleAry.length?(i=(this.scaleAry[this.scaleAry.length-1].beginTime+this.scaleAry[this.scaleAry.length-1].time)/t.Scene_data.frameTime,s=this.scaleAry[0].beginTime,this._currentTarget=this.scaleAry[0]):i=0;var h=0;for(n=0;n<i;n++){var c=t.Scene_data.frameTime*n;c>=this._currentTarget.beginTime&&(this.beginScale=this._currentTarget.value,o=this._currentTarget.beginTime,h==this.scaleAry.length-1?this._currentTarget=this.scaleAry[this.scaleAry.length-1]:(h++,this._currentTarget=this.scaleAry[h]),s=this._currentTarget.time);var u=(c-o)/s*(this._currentTarget.value-this.beginScale)+this.beginScale;this.numAry.push(u)}this._currentTarget=this.scaleAry[0]},enumerable:!0,configurable:!0}),i.prototype.dataByte=function(e,i){this.numAry=new Array,this.beginTime=i[0],-1==i[1]?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=i[1],this.beginScale=i[2],this.scaleNum=i[3],this.scaleAry=new Array;for(var a,n=0,r=4;r<4+2*this.scaleNum;r+=2){var o=new Object;o.value=i[r],o.time=i[r+1],n+=o.time,o.beginTime=this.beginTime+n,this.scaleAry.push(o)}var s=0,h=1;this.scaleAry.length?(a=(this.scaleAry[this.scaleAry.length-1].beginTime+this.scaleAry[this.scaleAry.length-1].time)/t.Scene_data.frameTime,h=this.scaleAry[0].beginTime,this._currentTarget=this.scaleAry[0]):a=0;var c=0;for(r=0;r<a;r++){var u=t.Scene_data.frameTime*r;u>=this._currentTarget.beginTime&&(this.beginScale=this._currentTarget.value,s=this._currentTarget.beginTime,c==this.scaleAry.length-1?this._currentTarget=this.scaleAry[this.scaleAry.length-1]:(c++,this._currentTarget=this.scaleAry[c]),h=this._currentTarget.time);var l=(u-s)/h*(this._currentTarget.value-this.beginScale)+this.beginScale;this.numAry.push(l)}this._currentTarget=this.scaleAry[0]},i.prototype.getAllNum=function(t){t=Math.min(t,this.lastTime+this.beginTime);var e=this.scaleAry[this.scaleAry.length-1];if(t>=e.beginTime+e.time)this.baseNum=e.value;else{for(var i,a=0;a<this.scaleAry.length;a++)t>this.scaleAry[a].this.beginTime&&(this._currentTarget=this.scaleAry[a],this.beginTime=this._currentTarget.this.beginTime,this.beginScale=this._currentTarget.value,i=a);i++,this._currentTarget=this.scaleAry[i],this.baseNum=(this._currentTarget.value-this.beginScale)/this._currentTarget.this.time*(t-this.beginTime)+this.beginScale}},i}(t.BaseAnim);t.ScaleAnim=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.num=1,t}return __extends(i,e),i.prototype.coreCalculate=function(){this.num=1+this.speed*this.time+this.baseNum,this.num<this.minNum?this.num=this.minNum:this.num>this.maxNum&&(this.num=this.maxNum)},Object.defineProperty(i.prototype,"data",{set:function(e){this.beginTime=Number(e[0].value),-1==Number(e[1].value)?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(e[1].value),this.speed=.001*Number(e[2].value),this.minNum=.01*Number(e[3].value),this.maxNum=.01*Number(e[4].value)},enumerable:!0,configurable:!0}),i.prototype.dataByte=function(e,i){this.beginTime=i[0],-1==i[1]?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=i[1],this.speed=.001*i[2],this.minNum=.01*i[3],this.maxNum=.01*i[4]},i.prototype.getAllNum=function(t){t=Math.min(t,this.lastTime),t-=this.beginTime;var e=this.speed*t;this.baseNum+=e,this.baseNum<this.minNum?this.baseNum=this.minNum:e>this.maxNum&&(this.baseNum=this.maxNum)},i.prototype.reset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.num=1},i.prototype.depthReset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.baseNum=0,this.num=1},i}(t.BaseAnim);t.ScaleChange=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.coreCalculate=function(){this.num=this.amplitude+this.amplitude*Math.sin(this.speed*this.time)},Object.defineProperty(i.prototype,"data",{set:function(e){this.beginTime=Number(e[0].value),-1==Number(e[1].value)?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(e[1].value),this.amplitude=Number(e[2].value),this.speed=.01*Number(e[3].value)},enumerable:!0,configurable:!0}),i.prototype.dataByte=function(e,i){this.beginTime=i[0],-1==i[1]?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=i[1],this.amplitude=i[2],this.speed=.01*i[3]},i.prototype.getAllNum=function(t){this.baseNum=this.amplitude+this.amplitude*Math.sin(this.speed*t)},i}(t.BaseAnim);t.ScaleNoise=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"data",{set:function(e){this.beginTime=Number(e[0].value),-1==Number(e[1].value)?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=Number(e[1].value),this.speed=.1*Number(e[2].value),this.aSpeed=.1*Number(e[3].value)},enumerable:!0,configurable:!0}),i.prototype.dataByte=function(e,i){this.beginTime=i[0],-1==i[1]?this.lastTime=t.Scene_data.MAX_NUMBER:this.lastTime=i[1],this.speed=.1*i[2],this.aSpeed=.1*i[3]},i}(t.BaseAnim);t.SelfRotation=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._time=0,t.targetFlag=-1,t.beginTime=0,t.isByteData=!1,t.targetFlag=-1,t.visible=!1,t.maxFrameNum=0,t._time=0,t._keyFrameAry=new Array,t}return __extends(i,e),i.prototype.updateMatrix=function(e,i){this._axisMove&&e.prependTranslation(this._axisMove.axis.x*this._axisMove.num,this._axisMove.axis.y*this._axisMove.num,this._axisMove.axis.z*this._axisMove.num),this._axisRotaion&&e.prependRotation(this._axisRotaion.num,this._axisRotaion.axis),e.prependTranslation(i.data.center.x,i.data.center.y,i.data.center.z),this._scaleChange?e.prependScale(i.data._widthFixed?1:this._scaleChange.num,i.data._heightFixed?1:this._scaleChange.num,i.data._widthFixed?1:this._scaleChange.num):this._scaleNosie?e.prependScale(i.data._widthFixed?1:1+this._scaleNosie.num,i.data._heightFixed?1:1+this._scaleNosie.num,i.data._widthFixed?1:1+this._scaleNosie.num):this._scaleAnim&&e.prependScale(i.data._widthFixed?1:this._scaleAnim.num,i.data._heightFixed?1:this._scaleAnim.num,i.data._widthFixed?1:this._scaleAnim.num),e.prependRotation(i.data.rotationV3d.z,t.Vector3D.Z_AXIS),e.prependRotation(i.data.rotationV3d.y,t.Vector3D.Y_AXIS),e.prependRotation(i.data.rotationV3d.x,t.Vector3D.X_AXIS)},i.prototype.inverAxisRotation=function(t){this._axisRotaion&&t.prependRotation(-this._axisRotaion.num,this._axisRotaion.axis)},i.prototype.applySelfRotation=function(t,e){this._selfRotaion&&t.prependRotation(this._selfRotaion.num,e)},i.prototype.addKeyFrame=function(e){var i=new t.KeyFrame;return i.frameNum=e,this._keyFrameAry.push(i),i},i.prototype.updateTime=function(t){this._currentKeyFrame&&(this._time=t,this.getTarget(),this._axisRotaion&&this._axisRotaion.update(this._time),this._selfRotaion&&this._selfRotaion.update(this._time),this._axisMove&&this._axisMove.update(this._time),this._scaleChange?this._scaleChange.update(this._time):this._scaleNosie?this._scaleNosie.update(this._time):this._scaleAnim&&this._scaleAnim.update(this._time))},i.prototype.getTarget=function(){for(var e=-1,i=0;i<this._keyFrameAry.length&&this._keyFrameAry[i].frameNum*t.Scene_data.frameTime<this._time;i++)e=i;e!=this.targetFlag&&(this._currentKeyFrame=this._keyFrameAry[e],this.targetFlag=e,e>=this._keyFrameAry.length-1||!this._currentKeyFrame?(this.visible=!1,this._currentKeyFrame=null):(this.visible=!0,this.enterKeyFrame(this._currentKeyFrame.animData,this._currentKeyFrame.frameNum*t.Scene_data.frameTime,this._currentKeyFrame.baseValue)))},i.prototype.enterKeyFrame=function(e,i,a){if(void 0===i&&(i=0),void 0===a&&(a=null),null!=a){for(var n=0;n<10;n++)if(a[n])switch(n){case 1:this._selfRotaion||(this._selfRotaion=new t.SelfRotation),this._selfRotaion.num=this._selfRotaion.baseNum=a[n];break;case 2:this._axisRotaion||(this._axisRotaion=new t.AxisRotaion),this._axisRotaion.num=this._axisRotaion.baseNum=a[n];break;case 6:this._scaleChange||(this._scaleChange=new t.ScaleChange),this._scaleChange.num=this._scaleChange.baseNum=a[n];break;case 7:this._scaleAnim||(this._scaleAnim=new t.ScaleAnim),this._scaleAnim.num=this._scaleAnim.baseNum=a[n];break;case 8:this._scaleNosie||(this._scaleNosie=new t.ScaleNoise),this._scaleNosie.num=this._scaleNosie.baseNum=a[n];break;case 9:this._axisMove||(this._axisMove=new t.AxisMove),this._axisMove.num=this._axisMove.baseNum=a[n]}this._selfRotaion&&(this._selfRotaion.isDeath=!0),this._axisRotaion&&(this._axisRotaion.isDeath=!0),this._scaleChange&&(this._scaleChange.isDeath=!0),this._scaleAnim&&(this._scaleAnim.isDeath=!0),this._scaleNosie&&(this._scaleNosie.isDeath=!0),this._axisMove&&(this._axisMove.isDeath=!0),e&&this.setBaseTimeByte(e,i,a)}},i.prototype.reset=function(){this._time=0,this._currentKeyFrame=this._keyFrameAry[0],this.visible=!1,this.targetFlag=-1},i.prototype.setAllByteInfo=function(e,i){this.isByteData=!0;for(var a=e.readFloat(),n=0;n<a;n++){var r=e.readFloat(),o=this.addKeyFrame(r);o.frameNum=r,o.baseValue=new Array;for(var s=0;s<10;s++)o.baseValue.push(e.readFloat());var h=e.readFloat();if(o.animData=new Array,h>0)for(var c=0;c<h;c++)o.animData.push(this.getByteDataTemp(e))}this.maxFrameNum=this._keyFrameAry[this._keyFrameAry.length-1].frameNum,this.beginTime=this._keyFrameAry[0].frameNum*t.Scene_data.frameTime,this._currentKeyFrame=this._keyFrameAry[0]},i.prototype.setAllDataInfo=function(t){this.isByteData=!0;for(var e=t.dataAry.length,i=0;i<e;i++){var a=this.addKeyFrame(t.dataAry[i].frameNum);a.baseValue=t.dataAry[i].baseValue,a.animData=t.dataAry[i].animData}this.maxFrameNum=t.maxFrameNum,this.beginTime=t.beginTime,this._currentKeyFrame=this._keyFrameAry[0]},i.prototype.setBaseTimeByte=function(e,i,a){void 0===i&&(i=0),void 0===a&&(a=null);for(var n=0;n<e.length;n++)1==e[n].type?(this._selfRotaion?this._selfRotaion.reset():this._selfRotaion=new t.SelfRotation,this._selfRotaion.dataByte(e[n].data,e[n].dataByte),this._selfRotaion.baseTime=i):2==e[n].type?(this._axisRotaion?this._axisRotaion.reset():this._axisRotaion=new t.AxisRotaion,this._axisRotaion.dataByte(e[n].data,e[n].dataByte),this._axisRotaion.baseTime=i):6==e[n].type?(this._scaleChange?this._scaleChange.reset():this._scaleChange=new t.ScaleChange,this._scaleChange.dataByte(e[n].data,e[n].dataByte),this._scaleChange.baseTime=i):7==e[n].type?(this._scaleAnim?this._scaleAnim.reset():this._scaleAnim=new t.ScaleAnim,this._scaleAnim.dataByte(e[n].data,e[n].dataByte),this._scaleAnim.baseTime=i):8==e[n].type?(this._scaleNosie?this._scaleNosie.reset():this._scaleNosie=new t.ScaleNoise,this._scaleNosie.dataByte(e[n].data,e[n].dataByte),this._scaleNosie.baseTime=i):9==e[n].type&&(this._axisMove?this._axisMove.reset():this._axisMove=new t.AxisMove,this._axisMove.dataByte(e[n].data,e[n].dataByte),this._axisMove.baseTime=i)},i.prototype.getByteDataTemp=function(e){var i=new Object,a=e.readInt(),n=e.readInt();i.data=new Array,i.dataByte=new Array;for(var r=0;r<n;r++){var o=new Object;if(o.type=e.readInt(),1==o.type){var s=e.readFloat();i.dataByte.push(s)}if(2==o.type){var h=new t.Vector3D;h.x=e.readFloat(),h.y=e.readFloat(),h.z=e.readFloat(),i.dataByte.push(h)}}return i.type=a,i},i.prototype.getMaxFrame=function(){return this._keyFrameAry[this._keyFrameAry.length-1].frameNum},i.prototype.dispose=function(){},i}(t.EventDispatcher);t.TimeLine=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.dataAry=new Array}return e.prototype.destory=function(){this.dataAry=null},e.prototype.setByteData=function(e){for(var i=e.readFloat(),a=0;a<i;a++){var n=e.readFloat(),r=this.addKeyFrame(n);r.frameNum=n,r.baseValue=new Array;for(var o=0;o<10;o++)r.baseValue.push(e.readFloat());var s=e.readFloat();if(r.animData=new Array,s>0)for(var h=0;h<s;h++)r.animData.push(this.getByteDataTemp(e))}this.maxFrameNum=this.dataAry[this.dataAry.length-1].frameNum,this.beginTime=this.dataAry[0].frameNum*t.Scene_data.frameTime},e.prototype.addKeyFrame=function(t){var e=new Object;return e.frameNum=t,this.dataAry.push(e),e},e.prototype.getByteDataTemp=function(e){var i=new Object,a=e.readInt(),n=e.readInt();i.data=new Array,i.dataByte=new Array;for(var r=0;r<n;r++){var o=new Object;if(o.type=e.readInt(),1==o.type){var s=e.readFloat();i.dataByte.push(s)}if(2==o.type){var h=new t.Vector3D;h.x=e.readFloat(),h.y=e.readFloat(),h.z=e.readFloat(),i.dataByte.push(h)}}return i.type=a,i},e}();t.TimeLineData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._lifeVisible=!0,t._resultUvVec=new Array(2),t}return __extends(i,e),Object.defineProperty(i.prototype,"facetdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleFacetData},i.prototype.update=function(){this._lifeVisible&&e.prototype.update.call(this)},i.prototype.reset=function(){e.prototype.reset.call(this),this._lifeVisible=!0},i.prototype.setVc=function(){this.updateRotaionMatrix(),this.updateUV(),this.data.vcmatData.set(t.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(t.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,48),this.data.vcmatData.set(this._rotationMatrix.m,32),this.data.vcmatData.set(this._resultUvVec,64),this.setMaterialVc(),!this.facetdata._isCycle&&this._time/t.Scene_data.frameTime>this.data._life-2&&(this._lifeVisible=!1),t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData)},i.prototype.setVa=function(){t.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,12)),this.setMaterialTexture(),t.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},i.prototype.updateRotaionMatrix=function(){this._rotationMatrix.identity(),this.data._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this.facetdata._locky||this.facetdata._lockx||this.inverBind(),this.facetdata._locky||this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),this.facetdata._lockx||this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS)),this.data._isZiZhuan&&this.timeline.applySelfRotation(this._rotationMatrix,this.data._ziZhuanAngly)},i.prototype.updateUV=function(){var e=t.Util.float2int(this._time/t.Scene_data.frameTime);e=(e=e>this.facetdata._maxAnimTime?this.facetdata._maxAnimTime:e)/this.data._animInterval%(this.data._animLine*this.data._animRow),this._resultUvVec[0]=t.Util.float2int(e%this.data._animLine)/this.data._animLine+this._time/t.Scene_data.frameTime*this.data._uSpeed,this._resultUvVec[1]=t.Util.float2int(e/this.data._animLine)/this.data._animRow+this._time/t.Scene_data.frameTime*this.data._vSpeed},i}(t.Display3DParticle);t.Display3DFacetParticle=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord")},e.prototype.getMat4Str=function(t){return"vcmat["+e.shader_mat4[t]+"]"},e.prototype.getVec4Str=function(t){return"vcmat["+e.shader_vec4[t][0]+"]["+e.shader_vec4[t][1]+"]"},e.getVcSize=function(){return 5},e.prototype.getVertexShaderString=function(){return"attribute vec4 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 vcmat["+e.getVcSize()+"];\nvarying vec2 v0;\nvoid main(void){\n   v0 = v2TexCoord + vec2("+this.getVec4Str("uvMove")+".xy);\n   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("posMatrix3D")+" * "+this.getMat4Str("rotationMatrix3D")+" * v3Position;\n}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}"},e.Display3D_Facet_Shader="Display3DFacetShader",e.shader_mat4={viewMatrix3D:0,camMatrix3D:1,rotationMatrix3D:2,posMatrix3D:3},e.shader_vec4={uvMove:[4,0]},e}(t.Shader3D);t.Display3DFacetShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._isCycle=!1,t}return __extends(i,e),i.prototype.setAllByteInfo=function(t){this._maxAnimTime=t.readFloat(),this._isCycle=t.readBoolean(),this._lockx=t.readBoolean(),this._locky=t.readBoolean(),e.prototype.setAllByteInfo.call(this,t),this.initVcData(),this.uploadGpu()},i.prototype.getParticle=function(){return new t.Display3DFacetParticle},i.prototype.uploadGpu=function(){this.objData=new t.ObjData,this.makeRectangleData(this._width,this._height,this._originWidthScale,this._originHeightScale,this._isUV,this._isU,this._isV,this._animLine,this._animRow)},i.prototype.makeRectangleData=function(e,i,a,n,r,o,s,h,c){void 0===a&&(a=.5),void 0===n&&(n=.5),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===h&&(h=1),void 0===c&&(c=1);var u=new Array,l=new Array,d=new Array;if(d.push(new t.Vector2D(0,0)),d.push(new t.Vector2D(0,1/c)),d.push(new t.Vector2D(1/h,1/c)),d.push(new t.Vector2D(1/h,0)),o)for(var p=0;p<d.length;p++)d[p].x=-d[p].x;if(s)for(p=0;p<d.length;p++)d[p].y=-d[p].y;r&&d.push(d.shift());for(p=0;p<d.length;p++)u.push(d[p].x,d[p].y);l.push(-a*e,i-n*i,0),l.push(d[0].x,d[0].y),l.push(e-a*e,i-n*i,0),l.push(d[1].x,d[1].y),l.push(e-a*e,-n*i,0),l.push(d[2].x,d[2].y),l.push(-a*e,-n*i,0),l.push(d[3].x,d[3].y);var f=new Array;f.push(0,1,2,0,2,3),this.objData.stride=20,this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(l),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(f),this.objData.treNum=f.length},i.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*t.Display3DFacetShader.getVcSize())},i.prototype.setFloat32Vec=function(e,i){var a=t.Display3DFacetShader.shader_vec4[e],n=16*a[0]+4*a[1];this.vcmatData.set(i,n)},i.prototype.setFloat32Mat=function(e,i){var a=16*t.Display3DFacetShader.shader_mat4[e];this.vcmatData.set(i,a)},i.prototype.regShader=function(){this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DFacetShader.Display3D_Facet_Shader,t.Display3DFacetShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program},i}(t.ParticleData);t.ParticleFacetData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.flag=0,t}return __extends(i,e),Object.defineProperty(i.prototype,"followdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleFollowData},i.prototype.onCreated=function(){this.initBingMatrixAry()},i.prototype.setVc=function(){e.prototype.setVc.call(this),this.updateBind(),t.Scene_data.context3D.setVc3fv(this.data.materialParam.shader,"bindpos",this._bindMatrixAry)},i.prototype.initBingMatrixAry=function(){this._bindMatrixAry=new Float32Array(120),this._bindFlagAry=new Array;for(var t=0;t<this.followdata._totalNum;t++)this._bindFlagAry.push(0)},i.prototype.updateBind=function(){for(var e=this._time/t.Scene_data.frameTime,i=this.flag;i<this.followdata._totalNum;i++){if((e-i*this.followdata._shootSpeed)/this.followdata._life>=this._bindFlagAry[i]){var a=3*i;this._bindMatrixAry[a]=this.bindVecter3d.x,this._bindMatrixAry[a+1]=this.bindVecter3d.y,this._bindMatrixAry[a+2]=this.bindVecter3d.z,this._bindFlagAry[i]++}}},i.prototype.updateMatrix=function(){this.bindMatrix&&(this.modelMatrix.identity(),this.groupMatrix.isIdentity||this.posMatrix.append(this.groupMatrix),this.modelMatrix.append(this.posMatrix))},i.prototype.updateAllRotationMatrix=function(){this.followdata._allRotationMatrix.identity(),this.followdata._allRotationMatrix.prependScale(this.followdata.overAllScale*this._scaleX*.1*this.bindScale.x,this.followdata.overAllScale*this._scaleY*.1*this.bindScale.y,this.followdata.overAllScale*this._scaleZ*.1*this.bindScale.z),this.isInGroup&&(this.followdata._allRotationMatrix.appendRotation(this.groupRotation.x,t.Vector3D.X_AXIS),this.followdata._allRotationMatrix.appendRotation(this.groupRotation.y,t.Vector3D.Y_AXIS),this.followdata._allRotationMatrix.appendRotation(this.groupRotation.z,t.Vector3D.Z_AXIS))},i.prototype.reset=function(){e.prototype.reset.call(this);for(var t=0;t<this.followdata._totalNum;t++)this._bindMatrixAry[3*t]=0,this._bindMatrixAry[3*t+1]=0,this._bindMatrixAry[3*t+2]=0,this._bindFlagAry[t]=0},i.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.followdata.facez?this._rotationMatrix.prependRotation(90,t.Vector3D.X_AXIS):this.followdata._watchEye&&(this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS))},i}(t.Display3DBallPartilce);t.Display3DFollowPartilce=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"vPosition"),t.bindAttribLocation(this.program,1,"texcoord"),t.bindAttribLocation(this.program,2,"basePos"),t.bindAttribLocation(this.program,3,"speed"),this.paramAry[3]&&t.bindAttribLocation(this.program,4,"rotation"),this.paramAry[1]&&t.bindAttribLocation(this.program,5,"color")},i.prototype.getMat4Str=function(e){return"vcmat["+t.Display3DBallShader.shader_mat4[e]+"]"},i.prototype.getVec4Str=function(e){return"vcmat["+t.Display3DBallShader.shader_vec4[e][0]+"]["+t.Display3DBallShader.shader_vec4[e][1]+"]"},i.getVcSize=function(){return 7},i.prototype.getVertexShaderString=function(){var e,i,a,n,r,o,s,h,c,u;u="attribute vec4 vPosition;\nattribute vec3 texcoord;\nattribute vec4 basePos;\nattribute vec3 speed;\nuniform mat4 vcmat["+t.Display3DBallShader.getVcSize()+"];\nuniform vec3 bindpos[30];\nvarying vec2 v0;\n",e="float ctime = "+this.getVec4Str("time")+".x - basePos.w;\nif ("+this.getVec4Str("time")+".w > 0.0 && ctime >= 0.0) {\n    ctime = fract(ctime / "+this.getVec4Str("time")+".z) * "+this.getVec4Str("time")+".z;\n}\nvec4 pos = vPosition;\n",i="float stime = ctime - "+this.getVec4Str("scale")+".w;\nstime = max(stime,0.0);\nfloat sf = "+this.getVec4Str("scale")+".x * stime;\nif ("+this.getVec4Str("scale")+".y != 0.0 && "+this.getVec4Str("scale")+".z != 0.0) {\n    sf += sin("+this.getVec4Str("scale")+".y * stime) * "+this.getVec4Str("scale")+".z;\n}\nif (sf > "+this.getVec4Str("scaleCtrl")+".z) {\n    sf = "+this.getVec4Str("scaleCtrl")+".z;\n} else if (sf < "+this.getVec4Str("scaleCtrl")+".w) {\n    sf = "+this.getVec4Str("scaleCtrl")+".w;\n}\nvec2 sv2 = vec2("+this.getVec4Str("scaleCtrl")+".x * sf, "+this.getVec4Str("scaleCtrl")+".y * sf);\nsv2 = sv2 + 1.0;\npos.x *= sv2.x;\npos.y *= sv2.y;\n",a="vec3 addPos = speed * ctime;\nvec3 uspeed = vec3(0,0,0);\nif (ctime < 0.0 || ctime >= "+this.getVec4Str("time")+".z) {\n    addPos.y = addPos.y + 100000.0;\n}\n",n="if("+this.getVec4Str("time")+".y != 0.0 && length(speed) != 0.0) {\n    uspeed = vec3(speed.x, speed.y, speed.z);\n    uspeed = normalize(uspeed);\n    uspeed = uspeed * "+this.getVec4Str("time")+".y;\n    uspeed.xyz = uspeed.xyz + "+this.getVec4Str("force")+".xyz;\n} else {\n    uspeed = vec3("+this.getVec4Str("force")+".x, "+this.getVec4Str("force")+".y, "+this.getVec4Str("force")+".z);\n}\naddPos.xyz = addPos.xyz + uspeed.xyz * ctime * ctime;\n",r="uspeed = speed + uspeed * ctime * 2.0;\nuspeed = normalize(uspeed);\nvec4 tempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(uspeed,1.0);\nuspeed.xyz = tempMul.xyz;\nuspeed = normalize(uspeed);\nvec3 cPos = addPos;\ntempMul = "+this.getMat4Str("rotationMatrix")+" * vec4(cPos,1.0);\ncPos.xyz = tempMul.xyz; \ncPos.xyz = "+this.getVec4Str("worldPos")+".xyz + cPos.xyz;\ncPos.xyz = "+this.getVec4Str("camPos")+".xyz - cPos.xyz;\ncPos = normalize(cPos);\ncPos = cross(uspeed, cPos);\ncPos = normalize(cPos);\nuspeed = uspeed * pos.x;\ncPos = cPos * pos.y;\npos.xyz = uspeed.xyz + cPos.xyz;\n",o="pos = "+this.getMat4Str("watheye")+" * pos;\npos.xyz = pos.xyz + basePos.xyz + addPos.xyz;\npos = "+this.getMat4Str("modelMatrix")+" * pos;\npos.xyz = pos.xyz + bindpos[int(texcoord.z)].xyz;\ngl_Position = "+this.getMat4Str("viewMatrix3D")+" * "+this.getMat4Str("camMatrix3D")+" * pos;\n",s="vec2 uv = vec2(texcoord.x,texcoord.y);\nfloat animframe = floor(ctime / "+this.getVec4Str("animCtrl")+".z);\nanimframe = animframe / "+this.getVec4Str("animCtrl")+".x;\nuv.x += animframe;\nanimframe = floor(animframe);\nuv.y += animframe / "+this.getVec4Str("animCtrl")+".y;\nv0.xy = uv.xy;\n",h="vec2 uv = vec2("+this.getVec4Str("uvCtrl")+".x,"+this.getVec4Str("uvCtrl")+".y);\nuv.xy = uv.xy * ctime + texcoord.xy;\nv0.xy = uv.xy;\n",c="v1 = vec2(ctime/"+this.getVec4Str("time")+".z,1.0);\n";var l=this.paramAry[0],d=this.paramAry[1],p=this.paramAry[2],f=this.paramAry[3],m=this.paramAry[4],y=this.paramAry[5],_=this.paramAry[6],v="",x="";return v+=e,x+=u,m&&(v+=i,x+=""),f&&(v+="float angle = rotation.x + rotation.y * ctime;\nvec4 np = vec4(sin(angle), cos(angle), 0, 0);\nnp.z = np.x * pos.y + np.y * pos.x;\nnp.w = np.y * pos.y - np.x * pos.x;\npos.xy = np.zw;\n",x+="attribute vec2 rotation;\n"),v+=a,y&&(v+=n,x+=""),p&&(v+=r,x+=""),v+=o,1==_?(v+=s,x+=""):2==_?(v+=h,x+=""):v+="v0 = vec2(texcoord.x,texcoord.y);\n",d&&(v+="v2 = color;\n",x+="attribute vec4 color;\nvarying vec4 v2;\n"),l&&(v+=c,x+="varying vec2 v1;\n"),x+"void main(){\n"+v+"}"},i.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}"},i.Display3D_Follow_Shader="Display3DFollowShader",i.shader_mat4={viewMatrix3D:0,camMatrix3D:1,modelMatrix:2,watheye:3,rotationMatrix:4},i.shader_vec4={time:[5,0],scale:[5,1],scaleCtrl:[5,2],force:[5,3],worldPos:[6,0],camPos:[6,1],animCtrl:[6,2],uvCtrl:[6,3]},i}(t.Shader3D);t.Display3DFollowShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DFollowPartilce},i.prototype.setAllByteInfo=function(t){e.prototype.setAllByteInfo.call(this,t),this.uploadGpu()},i.prototype.regShader=function(){if(this.materialParam){var e=this.getShaderParam();this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DFollowShader.Display3D_Follow_Shader,t.Display3DFollowShader,this.materialParam.material,e),this.materialParam.program=this.materialParam.shader.program}},i}(t.ParticleBallData);t.ParticleFollowData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.flag=0,t._caramPosVec=[0,0,0],t}return __extends(i,e),Object.defineProperty(i.prototype,"followlocusdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleFollowLocusData},i.prototype.onCreated=function(){this.initBindMatrixAry()},i.prototype.initBindMatrixAry=function(){this._bindPosAry=new Array,this._gpuVc=new Float32Array(6*this.followlocusdata._fenduanshu);for(var t=0;t<=this.followlocusdata._fenduanshu;t++)this._bindPosAry.push([0,0,5*t]),this._bindPosAry.push([0,0,1])},i.prototype.setVa=function(){t.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,12)),this.setMaterialTexture(),t.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},i.prototype.setVc=function(){this.updateMatrix(),this.updateBind(),this.data.vcmatData.set(t.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(t.Scene_data.cam3D.cameraMatrix.m,16),this._caramPosVec[0]=t.Scene_data.cam3D.x,this._caramPosVec[1]=t.Scene_data.cam3D.y,this._caramPosVec[2]=t.Scene_data.cam3D.z,this.data.vcmatData.set(this._caramPosVec,32),t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData),this.setBindPosVc(),this.setMaterialVc()},i.prototype.setBindPosVc=function(){for(var e=0;e<this._bindPosAry.length;e++)t.Scene_data.context3D.setVc3fv(this.data.materialParam.shader,"bindpos["+e+"]",this._bindPosAry[e])},i.prototype.reset=function(){this.resetPos(),e.prototype.reset.call(this)},i.prototype.updateMatrix=function(){this.modelMatrix.identity(),this.modelMatrix.prepend(this.posMatrix)},i.prototype.resetPos=function(){for(var e=0;e<this._bindPosAry.length;e+=2)this._bindPosAry[e][0]=this.bindVecter3d.x,this._bindPosAry[e][1]=this.bindVecter3d.y,this._bindPosAry[e][2]=this.bindVecter3d.z;this.flag=t.TimeUtil.getTimer()},i.prototype.updateBind=function(){var e=t.TimeUtil.getTimer();if(e-this.flag>=i.waitCdTime){var a=this._bindPosAry.pop(),n=this._bindPosAry.pop();n[0]=this.bindVecter3d.x,n[1]=this.bindVecter3d.y,n[2]=this.bindVecter3d.z;var r=this._bindPosAry[0],o=this._bindPosAry[1],s=new t.Vector3D(n[0]-r[0],n[1]-r[1],n[2]-r[2]);s.normalize(),o[0]=s.x,a[0]=s.x,o[1]=s.y,a[1]=s.y,o[2]=s.z,a[2]=s.z,this._bindPosAry.unshift(a),this._bindPosAry.unshift(n),this.flag=e}},i.waitCdTime=35,i}(t.Display3DParticle);t.Display3DFollowLocusPartilce=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord")},i.prototype.getMat4Str=function(t){return"vcmat["+i.shader_mat4[t]+"]"},i.prototype.getVec4Str=function(t){return"vcmat["+i.shader_vec4[t][0]+"]["+i.shader_vec4[t][1]+"]"},i.getVcSize=function(){return 3},i.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 vcmat["+t.Display3DFacetShader.getVcSize()+"];\nuniform vec3 bindpos[30];\nvarying vec2 v0;\n"+"void main(){\n"+("   vec3 cpos = bindpos[int(v3Position.x)];\n   vec3 mulPos = normalize(vec3("+this.getVec4Str("camPos")+".xyz) - cpos);\n   vec3 normals = bindpos[int(v3Position.y)];\n   mulPos = cross(mulPos, normals);\n   mulPos = normalize(mulPos);\n   mulPos *= v3Position.z;\n   cpos += mulPos;\n   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * vec4(cpos,1.0);\n")+"v0 = v2TexCoord;\n}"},i.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}"},i.Display3D_FollowLocus_Shader="Display3DFollowLocusShader",i.shader_mat4={viewMatrix3D:0,camMatrix3D:1},i.shader_vec4={camPos:[2,0]},i}(t.Shader3D);t.Display3DFollowLocusShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DFollowLocusPartilce},i.prototype.setAllByteInfo=function(t){this._fenduanshu=t.readFloat(),e.prototype.setAllByteInfo.call(this,t),this.uploadGpu(),this.initVcData()},i.prototype.uploadGpu=function(){this.objData=new t.ObjData,this.objData.vertices=new Array,this.objData.uvs=new Array,this.objData.indexs=new Array;for(var e=0;e<=this._fenduanshu;e++){var i=new t.Vector2D(e/this._fenduanshu,0),a=new t.Vector2D(e/this._fenduanshu,1);i.scaleBy(.9),a.scaleBy(.9),this._isU&&(i.x=-i.x,a.x=-a.x),this._isV&&(i.y=-i.y,a.y=-a.y);var n=2*e;this.objData.vertices.push(n,n+1,-this._originWidthScale*this._width/100),this._isUV?this.objData.vertices.push(i.y,i.x):this.objData.vertices.push(i.x,i.y),this.objData.vertices.push(n,n+1,(1-this._originWidthScale)*this._width/100),this._isUV?this.objData.vertices.push(a.y,a.x):this.objData.vertices.push(a.x,a.y)}for(e=0;e<this._fenduanshu;e++)this.objData.indexs.push(0+2*e,1+2*e,2+2*e,1+2*e,3+2*e,2+2*e);this.pushToGpu()},i.prototype.pushToGpu=function(){this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.stride=20,this.objData.treNum=this.objData.indexs.length},i.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*t.Display3DFollowLocusShader.getVcSize())},i.prototype.regShader=function(){if(this.materialParam){new t.Display3DFollowLocusShader;this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DFollowLocusShader.Display3D_FollowLocus_Shader,t.Display3DFollowLocusShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program}},i}(t.ParticleData);t.ParticleFollowLocusData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"locusdata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleLocusData},i.prototype.setVa=function(){t.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,28),this.data._watchEye&&t.Scene_data.context3D.setVaOffset(2,4,this.data.objData.stride,12)),this.setMaterialTexture(),t.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum)},i.prototype.setVc=function(){this.updateUV(),this.data.vcmatData.set(t.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(t.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,32),this.data.vcmatData.set(this.locusdata._resultUvVec,48),this.data._watchEye&&(this.locusdata._caramPosVec[0]=t.Scene_data.cam3D.x,this.locusdata._caramPosVec[1]=t.Scene_data.cam3D.y,this.locusdata._caramPosVec[2]=t.Scene_data.cam3D.z,this.data.vcmatData.set(this.locusdata._caramPosVec,52)),this.locusdata._changUv&&this.data.setFloat32Vec("isUv",this.locusdata._uvVec),t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData),this.setMaterialVc()},i.prototype.updateUV=function(){var e=this._time/t.Scene_data.frameTime,i=this.data._life/100,a=this.locusdata._speed*e/this.locusdata._density/10;this.locusdata._isEnd&&(a=Math.min(1,a)),this.locusdata._isLoop&&(this.locusdata._life?a%=i+1:a%=1),this.locusdata._resultUvVec[0]=a},i}(t.Display3DParticle);t.Display3DLocusPartilce=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord"),this.paramAry[0]&&t.bindAttribLocation(this.program,2,"v3Normal")},i.prototype.getMat4Str=function(t){return"vcmat["+i.shader_mat4[t]+"]"},i.prototype.getVec4Str=function(t){return"vcmat["+i.shader_vec4[t][0]+"]["+i.shader_vec4[t][1]+"]"},i.getVcSize=function(){return 4},i.prototype.getVertexShaderString=function(){var e="attribute vec4 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 vcmat["+t.Display3DFacetShader.getVcSize()+"];\nvarying vec2 v0;\nvarying vec4 v2;\n",i="   vec2 tempv0 = v2TexCoord;\n   tempv0.x -= "+this.getVec4Str("uvMove")+".x;\n",a="   tempv0.xy *= "+this.getVec4Str("isUv")+".xy;\n   if("+this.getVec4Str("isUv")+".z >= 0.0){\n   vec2 tempv1 = tempv0;\n   tempv0.y = tempv1.x;\n   tempv0.x = tempv1.y;}\n   v0 = tempv0;\n",n="   float alpha = tempv0.x/"+this.getVec4Str("uvMove")+".y;\n   alpha = 1.0 - clamp(abs(alpha),0.0,1.0);\n   float kill = -tempv0.x;\n   kill *= tempv0.x - "+this.getVec4Str("uvMove")+".z;\n   v2 = vec4(kill,0.0,0.0,alpha);\n",r="   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("posMatrix3D")+" * v3Position;\n",o="   vec4 tempPos = "+this.getMat4Str("posMatrix3D")+" * v3Position;\n   vec3 mulPos = vec3(tempPos.x,tempPos.y,tempPos.z);\n   vec3 normals = vec3(v3Normal.x,v3Normal.y,v3Normal.z);\n   mulPos = normalize(vec3("+this.getVec4Str("camPos")+".xyz) - mulPos);\n   mulPos = cross(mulPos, normals);\n   mulPos = normalize(mulPos);\n   mulPos *= v3Normal.w;\n   tempPos.xyz = mulPos.xyz + v3Position.xyz;\n   gl_Position = "+this.getMat4Str("viewMatrix3D")+"  * "+this.getMat4Str("camMatrix3D")+" * "+this.getMat4Str("posMatrix3D")+" * tempPos;\n",s=this.paramAry[0],h=this.paramAry[1],c=this.paramAry[2],u=e;s&&(u+="attribute vec4 v3Normal;\n"),h&&(u+=""),c&&(u+="varying vec2 v1;\n");var l=i+n;return c&&(l+="   v1 = v2TexCoord;\n"),l+=h?a:"   v0 = tempv0;\n",u+"void main(void){\n"+(l+=s?o:r)+"}"},i.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}"},i.Display3D_Locus_Shader="Display3DLocusShader",i.shader_mat4={viewMatrix3D:0,camMatrix3D:1,posMatrix3D:2},i.shader_vec4={uvMove:[3,0],camPos:[3,1],isUv:[3,2]},i}(t.Shader3D);t.Display3DLocusShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._speed=1,t._isLoop=!1,t}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DLocusPartilce},i.prototype.setAllByteInfo=function(i){this._isLoop=i.readBoolean(),this._speed=i.readFloat(),this._density=i.readFloat(),this._isEnd=i.readBoolean(),this.objData=new t.ObjData;var a=i.getInt(),n=new ArrayBuffer(9*a*4),r=new DataView(n);t.BaseRes.readBytes2ArrayBuffer(i,r,3,0,9,4),t.BaseRes.readBytes2ArrayBuffer(i,r,4,3,9,4),t.BaseRes.readBytes2ArrayBuffer(i,r,2,7,9,4);for(var o=i.readInt(),s=0;s<o;s++)this.objData.indexs.push(i.readInt());this.objData.stride=36,e.prototype.setAllByteInfo.call(this,i),this.initUV(),this._watchEye&&(this._caramPosVec=[0,0,0]),this._uvVec=[this._isU?-1:1,this._isV?-1:1,this._isUV?1:-1],this.initVcData(),this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3DArrayBuffer(n),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},i.prototype.initUV=function(){this._resultUvVec=new Array(3);var e,i=this._life/100,a=0*this._speed/this._density/10;this._isEnd&&(a=Math.min(1,a)),this._isLoop?this._life?(a%=i+1,e=new t.Vector3D(a,i,-i)):(a%=1,e=new t.Vector3D(a+1,99,-2)):e=this._life?new t.Vector3D(a,i,-1):new t.Vector3D(a,99,-1),this._resultUvVec[0]=e.x,this._resultUvVec[1]=e.y,this._resultUvVec[2]=e.z},i.prototype.uploadGpu=function(){this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this._watchEye&&(this.objData.normalsBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.normals)),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},i.prototype.regShader=function(){if(this.materialParam){var e,i=this._watchEye?1:0,a=0,n=this.materialParam.material.hasParticleColor;this._isU||this._isV||this._isUV?(a=1,this._changUv=!0):this._changUv=!1,e=[i,a,n?1:0],this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DLocusShader.Display3D_Locus_Shader,t.Display3DLocusShader,this.materialParam.material,e),this.materialParam.program=this.materialParam.shader.program}},i.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*t.Display3DLocusShader.getVcSize())},i.prototype.setFloat32Vec=function(e,i){var a=t.Display3DLocusShader.shader_vec4[e],n=16*a[0]+4*a[1];this.vcmatData.set(i,n)},i.prototype.setFloat32Mat=function(e,i){var a=16*t.Display3DLocusShader.shader_mat4[e];this.vcmatData.set(i,a)},i}(t.ParticleData);t.ParticleLocusData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.creatData=function(){this.data=new t.ParticleLocusballData},i}(t.Display3DBallPartilce);t.Display3DLocusBallPartilce=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DLocusBallPartilce},i.prototype.initBasePos=function(){for(var e=new Array,i=0;i<this._totalNum;i++){var a,n=3*i;if(this._isRandom){var r=new t.Vector3D(this._round.x*this._round.w,this._round.y*this._round.w,this._round.z*this._round.w);a=new t.Vector3D(this._posAry[n]+Math.random()*r.x,this._posAry[n+1]+Math.random()*r.y,this._posAry[n+2]+Math.random()*r.z)}else a=new t.Vector3D(this._posAry[n],this._posAry[n+1],this._posAry[n+2]);a=a.add(this._basePositon);for(var o=0;o<4;o++)e.push(a.x,a.y,a.z,i*this._shootSpeed)}this.objBallData.basePos=e},i.prototype.initSpeed=function(){for(var e=new Array,i=0;i<this._totalNum;i++){var a=new t.Vector3D;if(0==this._tangentSpeed)a.addByNum(this._angleAry[3*i],this._angleAry[3*i+1],this._angleAry[3*i+2]);else if(2==this._tangentSpeed)a.setTo(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);else{var n=new t.Vector3D(this._tangentAry[3*i],this._tangentAry[3*i+1],this._tangentAry[3*i+2]);n.scaleBy(this._tangentSpeed),a=a.add(n)}a.normalize(),this._isSendRandom?a.scaleBy(this._speed*Math.random()):a.scaleBy(this._speed);for(var r=0;r<4;r++)e.push(a.x,a.y,a.z)}this.objBallData.beMove=e},i.prototype.setAllByteInfo=function(t){this._tangentSpeed=t.readFloat(),this._posAry=JSON.parse(t.readUTF()),this._angleAry=JSON.parse(t.readUTF()),this._tangentAry=JSON.parse(t.readUTF()),e.prototype.setAllByteInfo.call(this,t),this.uploadGpu()},i}(t.ParticleBallData);t.ParticleLocusballData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._resultUvVec=new Array(2),t}return __extends(i,e),Object.defineProperty(i.prototype,"modeldata",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.creatData=function(){this.data=new t.ParticleModelData},i.prototype.setVc=function(){this.updateWatchCaramMatrix(),this.updateUV(),this.data.vcmatData.set(t.Scene_data.viewMatrx3D.m,0),this.data.vcmatData.set(t.Scene_data.cam3D.cameraMatrix.m,16),this.data.vcmatData.set(this.modelMatrix.m,48),this.data.vcmatData.set(this._rotationMatrix.m,32),this.data.vcmatData.set(this._resultUvVec,64),t.Scene_data.context3D.setVcMatrix4fv(this.data.materialParam.shader,"vcmat",this.data.vcmatData),this.setMaterialVc()},i.prototype.setVa=function(){t.Scene_data.context3D.setWriteDepth(1==this.data._depthMode),t.Scene_data.context3D.pushVa(this.data.objData.vertexBuffer)||(t.Scene_data.context3D.setVaOffset(0,3,this.data.objData.stride,0),t.Scene_data.context3D.setVaOffset(1,2,this.data.objData.stride,12)),this.setMaterialTexture(),t.Scene_data.context3D.drawCall(this.data.objData.indexBuffer,this.data.objData.treNum),t.Scene_data.context3D.setWriteDepth(!1)},i.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.data._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS)),this.data._isZiZhuan&&this.timeline.applySelfRotation(this._rotationMatrix,this.data._ziZhuanAngly)},i.prototype.updateUV=function(){var e=Math.floor(this._time/t.Scene_data.frameTime/this.data._animInterval);this.data._animLine,this.data._animRow;this._resultUvVec[0]=Math.floor(e%this.data._animLine)/this.data._animLine,this._resultUvVec[1]=Math.floor(e/this.data._animLine)/this.data._animRow,this._resultUvVec[0]+=this._time/t.Scene_data.frameTime*this.data._uSpeed,this._resultUvVec[1]+=this._time/t.Scene_data.frameTime*this.data._vSpeed,this._resultUvVec[0]=this._resultUvVec[0]%1,this._resultUvVec[1]=this._resultUvVec[1]%1},i}(t.Display3DParticle);t.Display3DModelPartilce=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.update=function(){this._depthMode&&t.Scene_data.context3D.setDepthTest(!0),e.prototype.update.call(this),this._depthMode&&t.Scene_data.context3D.setDepthTest(!1)},i}(t.Display3DModelPartilce);t.Display3DModelObjParticle=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.updateUV=function(){var e=this._time/t.Scene_data.frameTime;e=(e=e>this.modeldata._maxAnimTime?this.modeldata._maxAnimTime:e)/this.data._animInterval%(this.data._animLine*this.data._animRow),this._resultUvVec[0]=t.Util.float2int(e%this.data._animLine)/this.data._animLine+this._time/t.Scene_data.frameTime*this.data._uSpeed,this._resultUvVec[1]=t.Util.float2int(e/this.data._animLine)/this.data._animRow+this._time/t.Scene_data.frameTime*this.data._vSpeed},i}(t.Display3DModelPartilce);t.Display3dModelAnimParticle=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getParticle=function(){return new t.Display3DModelPartilce},i.prototype.setAllByteInfo=function(i){this.objData=new t.ObjData,this._maxAnimTime=i.readFloat();var a=i.getInt(),n=new ArrayBuffer(5*a*4),r=new DataView(n);t.BaseRes.readBytes2ArrayBuffer(i,r,3,0,5,4),t.BaseRes.readBytes2ArrayBuffer(i,r,2,3,5,4);for(var o=i.readInt(),s=0;s<o;s++)this.objData.indexs.push(i.readInt());this.objData.stride=20,this.version>=36&&(this._depthMode=i.readInt()),e.prototype.setAllByteInfo.call(this,i),this.initVcData(),this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3DArrayBuffer(n),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},i.prototype.initVcData=function(){this.vcmatData=new Float32Array(16*t.Display3DFacetShader.getVcSize())},i.prototype.uploadGpu=function(){this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},i.prototype.regShader=function(){this.materialParam.shader=t.ProgrmaManager.getInstance().getMaterialProgram(t.Display3DFacetShader.Display3D_Facet_Shader,t.Display3DFacetShader,this.materialParam.material),this.materialParam.program=this.materialParam.shader.program},i.prototype.setFloat32Vec=function(e,i){var a=t.Display3DFacetShader.shader_vec4[e],n=16*a[0]+4*a[1];this.vcmatData.set(i,n)},i.prototype.setFloat32Mat=function(e,i){var a=16*t.Display3DFacetShader.shader_mat4[e];this.vcmatData.set(i,a)},i}(t.ParticleData);t.ParticleModelData=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2CubeTexST")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec2 v2CubeTexST;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2CubeTexST.x, v2CubeTexST.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nuniform vec4 testconst;uniform vec4 testconst2;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\nvec4 test = vec4(0,0,0,1);\ntest.xyz = mix(vec3(1,1,1)*0.5,testconst.xyz,0.5);\ninfoUv.xyz = test.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}"},e.buildShader="BuildShader",e}(t.Shader3D);t.BuildShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform vec4 pos[30];varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2uv.x, v2uv.y);   vec3 vt1= vec3(v3Pos.xyz * pos[int(v2uv.z)].w + pos[int(v2uv.z)].xyz);   vec4 vt0= vec4(vt1, 1.0);   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}"},e.Display3DShadowShader="Display3DShadowShader",e}(t.Shader3D);t.Display3DShadowShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.name="Material_Anim_shader",e}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"pos"),t.bindAttribLocation(this.program,1,"v2Uv"),t.bindAttribLocation(this.program,2,"boneID"),t.bindAttribLocation(this.program,3,"boneWeight");var e=this.paramAry[0],i=this.paramAry[1],a=this.paramAry[4],n=this.paramAry[5];e?(t.bindAttribLocation(this.program,4,"normal"),i&&(t.bindAttribLocation(this.program,5,"tangent"),t.bindAttribLocation(this.program,6,"bitangent"))):(a||n)&&t.bindAttribLocation(this.program,4,"normal")},e.getMd5M44Str=function(){return"vec4 qdv(vec4 q,vec3 d, vec3 v ){\nvec3 t = 2.0 * cross(q.xyz, v);\nvec3 f = v + q.w * t + cross(q.xyz, t);\nreturn  vec4(f.x+d.x,f.y+d.y,f.z+d.z,1.0);\n }\nvec4 getQDdata(vec3 vdata){\nvec4 tempnum = qdv(boneQ[int(boneID.x)],boneD[int(boneID.x)],vdata) * boneWeight.x;\ntempnum += qdv(boneQ[int(boneID.y)],boneD[int(boneID.y)],vdata) * boneWeight.y;\ntempnum += qdv(boneQ[int(boneID.z)],boneD[int(boneID.z)],vdata)* boneWeight.z;\ntempnum += qdv(boneQ[int(boneID.w)],boneD[int(boneID.w)],vdata) * boneWeight.w;\ntempnum.x = tempnum.x*-1.0;\nreturn  tempnum;\n }\n"},e.getMd5M44NrmStr=function(){return"vec4 qdvNrm(vec4 q, vec3 v ){\nvec3 t = 2.0 * cross(q.xyz, v);\nvec3 f = v + q.w * t + cross(q.xyz, t);\nreturn  vec4(f.x,f.y,f.z,1.0);\n }\nvec4 getQDdataNrm(vec3 vdata){\nvec4 tempnum = qdvNrm(boneQ[int(boneID.x)],vdata) * boneWeight.x;\ntempnum += qdvNrm(boneQ[int(boneID.y)],vdata) * boneWeight.y;\ntempnum += qdvNrm(boneQ[int(boneID.z)],vdata)* boneWeight.z;\ntempnum += qdvNrm(boneQ[int(boneID.w)],vdata) * boneWeight.w;\ntempnum.x = tempnum.x*-1.0;\ntempnum.xyz = normalize(tempnum.xyz);\nreturn  tempnum;\n }\n"},e.prototype.getVertexShaderString=function(){var t=this.paramAry[0],i=this.paramAry[1],a=(this.paramAry[2],this.paramAry[3],this.paramAry[4]),n=this.paramAry[5],r=this.paramAry[6],o="attribute vec4 pos;\nattribute vec2 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform vec4 boneQ[54];\nuniform vec3 boneD[54];\nuniform mat4 vpMatrix3D;\nuniform mat4 posMatrix3D;\n";return a?o+="uniform vec3 sh[9];\nvarying vec3 v2;\n":n?o+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\nvarying vec3 v2;\n":r||(o+="varying vec2 v2;\n"),t?(o+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\nvarying vec3 v1;\n",o+=i?"varying mat3 v4;\n":"varying vec3 v4;\n",i&&(o+="attribute vec4 tangent;\nattribute vec4 bitangent;\n")):(a||n)&&(o+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\n"),o+=e.getMd5M44Str()+e.getMd5M44NrmStr()+"void main(void){\nv0 = v2Uv;\nvec4 vt0 = getQDdata(vec3(pos.x,pos.y,pos.z));\nvt0.xyz = vt0.xyz*1.0;\nvt0 = posMatrix3D * vt0;\n",t&&(o+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),o+="vt0 = vpMatrix3D * vt0;\ngl_Position = vt0;\n",t?o+=i?"vec4 vt2 = getQDdataNrm(vec3(tangent.x,tangent.y,tangent.z));\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = getQDdataNrm(vec3(bitangent.x,bitangent.y,bitangent.z));\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(a||n)&&(o+="vt0 = getQDdataNrm(vec3(normal.x,normal.y,normal.z));\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),a?o+="vec3 lpb = sh[0] * 0.28209479177387814;\nlpb += sh[1] * (vt0.y * -0.4886025119029199);\nlpb += sh[2] * (vt0.z * 0.4886025119029199);\nlpb += sh[3] * (vt0.x * -0.4886025119029199);\nlpb += sh[4] * (vt0.x * vt0.y * 1.0925484305920792);\nlpb += sh[5] * (vt0.z * vt0.y * -1.0925484305920792);\nlpb += sh[6] * ((3.0 * vt0.z * vt0.z - 1.0) * 0.31539156525252005);\nlpb += sh[7] * (vt0.z * vt0.x * -1.0925484305920792);\nlpb += sh[8] * ((vt0.x * vt0.x - vt0.y * vt0.y) * 0.5462742152960396);\nv2 = lpb;\n":n?o+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":r||(o+="v2 = v2Uv;\n"),o+="}"},e.prototype.getFragmentShaderString=function(){return"uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}"},e.MATERIAL_ANIM_SHADER="Material_Anim_shader",e}(t.Shader3D);t.MaterialAnimShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.name="Material_Batch_Anim_Shader",e}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"pos"),t.bindAttribLocation(this.program,1,"v2Uv"),t.bindAttribLocation(this.program,2,"boneID"),t.bindAttribLocation(this.program,3,"boneWeight");var e=this.paramAry[0],i=this.paramAry[1],a=this.paramAry[4],n=this.paramAry[5];e?(t.bindAttribLocation(this.program,4,"normal"),i&&(t.bindAttribLocation(this.program,5,"tangent"),t.bindAttribLocation(this.program,6,"bitangent"))):(a||n)&&t.bindAttribLocation(this.program,4,"normal")},e.prototype.getVertexShaderString=function(){var t=this.paramAry[0],e=this.paramAry[1],i=(this.paramAry[2],this.paramAry[3],this.paramAry[4]),a=this.paramAry[5],n=this.paramAry[6],r="precision mediump float;\nattribute vec4 pos;\nattribute vec3 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform mat4 bone[19];\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 posMatrixAry[6];\n";return i?r+="varying vec3 v2;\n":a?r+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\nvarying vec3 v2;\n":n||(r+="varying vec2 v2;\n"),t?(r+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\nvarying vec3 v1;\n",r+=e?"varying mat3 v4;\n":"varying vec3 v4;\n",e&&(r+="attribute vec4 tangent;\nattribute vec4 bitangent;\n")):(i||a)&&(r+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\n"),r+="void main(void){\nv0 = vec2(v2Uv.xy);\nvec4 vt0 = bone[int(boneID.x)] * pos * boneWeight.x;\nvt0 += bone[int(boneID.y)] * pos * boneWeight.y;\nvt0 += bone[int(boneID.z)] * pos * boneWeight.z;\nvt0 += bone[int(boneID.w)] * pos * boneWeight.w;\nvt0 = posMatrixAry[int(v2Uv.z)] * vt0;\n",t&&(r+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),r+="vt0 = camMatrix3D * vt0;\nvt0 = viewMatrix3D * vt0;\ngl_Position = vt0;\n",t?r+=e?"vec4 vt2 = bone[int(boneID.x)] * tangent * boneWeight.x;\nvt2 += bone[int(boneID.y)] * tangent * boneWeight.y;\nvt2 += bone[int(boneID.z)] * tangent * boneWeight.z;\nvt2 += bone[int(boneID.w)] * tangent * boneWeight.w;\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = bone[int(boneID.x)] * bitangent * boneWeight.x;\nvt1 += bone[int(boneID.y)] * bitangent * boneWeight.y;\nvt1 += bone[int(boneID.z)] * bitangent * boneWeight.z;\nvt1 += bone[int(boneID.w)] * bitangent * boneWeight.w;\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(i||a)&&(r+="vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),i?r+="vec3 lpb = normalize(vec3(1.0,1.0,-1.0));\nfloat lp = min(0.0,dot(lpb,vec3(vt0.xyz)));\nlp = lp * 2.0 + 0.7;\nv2 = vec3(lp,lp,lp);\n":a?r+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":n||(r+="v2 = v2Uv;\n"),r+="}"},e.prototype.getFragmentShaderString=function(){return"uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}"},e}(t.Shader3D);t.MaterialBatchAnimShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.name="Material_shader",t}return __extends(i,e),i.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2CubeTexST");var e=this.paramAry[0],i=this.paramAry[1],a=(this.paramAry[4],this.paramAry[5]),n=this.paramAry[6];a||n||t.bindAttribLocation(this.program,2,"v2lightuv"),e?(t.bindAttribLocation(this.program,3,"v3Normal"),i&&(t.bindAttribLocation(this.program,4,"v3Tangent"),t.bindAttribLocation(this.program,5,"v3Bitangent"))):a&&t.bindAttribLocation(this.program,3,"v3Normal")},i.prototype.getVertexShaderString=function(){var t=this.paramAry[0],e=this.paramAry[1],i=(this.paramAry[2],this.paramAry[3],this.paramAry[4],this.paramAry[5]),a=this.paramAry[6],n=this.paramAry[7],r="attribute vec3 v3Position;\nattribute vec2 v2CubeTexST;\nvarying vec2 v0;\n";return i?r+="varying vec3 v2;\n":a||(r+="attribute vec2 v2lightuv;\nvarying vec2 v2;\n"),t?(r+="attribute vec3 v3Normal;\nvarying vec3 v1;\n",r+=e?"varying mat3 v4;\n":"varying vec3 v4;\n"):0!=n&&(r+="varying vec3 v1;\n"),e&&(r+="attribute vec3 v3Tangent;\nattribute vec3 v3Bitangent;\n"),i&&(t||(r+="attribute vec3 v3Normal;\n"),r+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\n"),r+="uniform mat4 vpMatrix3D;\nuniform mat4 posMatrix3D;\nuniform mat3 rotationMatrix3D;\n",r+="void main(void){\nv0 = vec2(v2CubeTexST.x, v2CubeTexST.y);\nvec4 vt0= vec4(v3Position, 1.0);\nvt0 = posMatrix3D * vt0;\n",i||a||(r+="v2 = vec2(v2lightuv.x, v2lightuv.y);\n"),(t||0!=n)&&(r+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),r+="vt0 = vpMatrix3D * vt0;\n",t&&(r+=e?"v4 = mat3(rotationMatrix3D * v3Tangent,rotationMatrix3D * v3Bitangent, rotationMatrix3D * v3Normal);\n":"v4 = rotationMatrix3D * v3Normal;\n"),i&&(r+=t?"float suncos = dot(v4.xyz,sunDirect.xyz);\n":"vec3 n = rotationMatrix3D * v3Normal;\nfloat suncos = dot(n.xyz,sunDirect.xyz);\n",r+="suncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;"),r+="gl_Position = vt0;}"},i.prototype.outstr=function(e){for(var i=e.split(";"),a=0;a<i.length;a++)String(t.Util.trim(i[a]))},i.prototype.getFragmentShaderString=function(){return"uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}"},i.MATERIAL_SHADER="Material_shader",i}(t.Shader3D);t.MaterialShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 watchCamMatrix3D;\nuniform vec4 posdata[24];uniform vec2 outuv;varying vec2 v_texCoord;void main(void){   vec4 data = posdata[int(v2uv.z)];   vec4 vt0= vec4(v3Pos * data.w,1.0);   vt0= watchCamMatrix3D * vt0;   vt0.xyz += data.xyz;   v_texCoord = vec2(v2uv.x,v2uv.y) + outuv;   gl_Position = viewMatrix3D * camMatrix3D * vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\nif(infoUv.w < 0.1){discard;}\ngl_FragColor = infoUv;\n}"},e.MOVIE2D_SHADER="Movie2DShader",e}(t.Shader3D);t.Movie2DShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getProgram=function(t){return this._dic[t]?this._dic[t]:(alert("please registe Program=>"+t),null)},e.prototype.registe=function(t,e){this._dic[t]||(e.encode(),e.useNum=1,e.name=t,this._dic[t]=e)},e.prototype.getMaterialProgram=function(t,e,i,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=t+"_"+i.url;if(a){for(var o=0;o<a.length;o++)r+="_"+a[o];r+=n?"true_":"false_"}if(this._dic[r])return this._dic[r].useNum++,this._dic[r];n&&(a=[i.usePbr,i.useNormal,i.hasFresnel,i.useDynamicIBL,i.lightProbe,i.directLight,i.noLight,i.fogMode]);var s=new e;s.paramAry=a,s.fragment=i.shaderStr;s.encode();return s.useNum++,this._dic[r]=s,s},e.prototype.outShader=function(t){for(var e=t.split("\n"),i=0;i<e.length;i++){e[i],i<e.length-1?("\\n",'"',"+"):'"'}},e}(t.ResGC);t.ProgrmaManager=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v3Normal")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec3 v3Normal;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec3 vNormal;void main(void){   vNormal = vec3(v3Normal.x, v3Normal.y,v3Normal.z);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return"precision mediump float;\nuniform samplerCube s_texture;\nvarying vec3 vNormal;\nvoid main(void)\n{\nvec4 infoUv = textureCube(s_texture, vNormal);\ngl_FragColor = infoUv;\n}"},e.Sky_Shader="SkyShader",e}(t.Shader3D);t.SkyShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 watchCamMatrix3D;\nuniform vec4 posdata[12];varying vec2 v_texCoord;void main(void){   vec4 data = posdata[int(v2uv.z)];   vec4 vt0= vec4(v3Pos * data.w,1.0);   vt0= watchCamMatrix3D * vt0;   vt0.xyz += data.xyz;   v_texCoord = vec2(v2uv.x,v2uv.y);   gl_Position = viewMatrix3D * camMatrix3D * vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\nif(infoUv.w < 0.1){discard;}\ngl_FragColor = infoUv;\n}"},e.SPRITE2D_SHADER="Sprite2DShader",e}(t.Shader3D);t.Sprite2DShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec2 v2TexCoord;\nuniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v0;\nvoid main(void){ v0 = v2TexCoord;   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return"precision mediump float;uniform sampler2D idmaptexture;uniform sampler2D infotexture;uniform sampler2D sixtexture;uniform sampler2D lightexture;vec4 qdvNrm(float indx ,vec2 uvpos){vec2 sixuvTx=uvpos; float ccavid= floor(indx*255.0);if (ccavid==0.0) {\n} else  if (ccavid==1.0){\nsixuvTx.x=sixuvTx.x+0.5;} else  if (ccavid==2.0){sixuvTx.y=sixuvTx.y+0.5;}else{sixuvTx.x=sixuvTx.x+0.5;sixuvTx.y=sixuvTx.y+0.5;}; sixuvTx.x=sixuvTx.x+0.001;sixuvTx.y=sixuvTx.y+0.001;vec4 sixUvColor = texture2D(sixtexture, sixuvTx.xy);\nreturn  sixUvColor;\n }\nvarying vec2 v0;void main(void){vec4 idUv = texture2D(idmaptexture, v0.xy);\nvec4 infoUv = texture2D(infotexture, v0.xy);\nvec4 sixUv = texture2D(sixtexture, v0.xy);\nvec4 lightUv = texture2D(lightexture, v0*0.995+0.0025);\nvec2 sixuv=fract(v0*10.0);  sixuv=sixuv*0.498; vec4 tempnumA = qdvNrm(idUv.x,sixuv) * infoUv.x;\nvec4 tempnumB = qdvNrm(idUv.y,sixuv) * infoUv.y;\nvec4 tempnumC = qdvNrm(idUv.z,sixuv) * infoUv.z;\nvec4 tempnumD = tempnumA+tempnumB+tempnumC;\n tempnumD.xyz=tempnumD.xyz*lightUv.xyz*2.0; gl_FragColor = tempnumD;}"},e.TerrainDisplay3DShader="TerrainDisplay3DShader",e}(t.Shader3D);t.TerrainDisplay3DShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;attribute vec2 v2uv;uniform vec2 scale;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2uv.x, v2uv.y);   vec4 vt0= vec4(v3Pos.x*scale.x,v3Pos.y*scale.y,v3Pos.z,1.0);   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nuniform float alpha;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.w = alpha;\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}"},e.UI_IMG_SHADER="UI_img_Shader",e}(t.Shader3D);t.UIImageShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;uniform vec4 ui;void main(void){   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * ui.zw * 2.0;   pos.x += ui.x * 2.0 - 1.0;   pos.y += -ui.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nvoid main(void)\n{\ngl_FragColor = vec4(0.5,0.5,0.5,1.0);\n}"},e.UI_MASK_SHADER="UImaskShader",e}(t.Shader3D);t.UIMaskShader=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[50];uniform vec4 ui2[50];varying vec2 v_texCoord;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_texCoord = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}"},e.UI_SHADER="UIShader",e}(t.Shader3D);t.UIShader=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._ready=!1,this.render=!0,this._particletime=0,this.renderDic=new Object,this._displayList=new Array,this._displaySpriteList=new Array,this._displayRoleList=new Array,this._display2DList=new Array,this.startTime=t.TimeUtil.START_TIME,this._time=t.TimeUtil.getTimer(this.startTime),this._sceneDic=new Object,this.initScene(),this._particleList=new Array,this.shadowMgr=new t.ShadowManager,this.skillMgr=new t.SkillManager(this),this.groupDataMgr=new t.GroupDataManager(this)}return Object.defineProperty(e.prototype,"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayRoleList",{get:function(){return this._displayRoleList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displaySpriteList",{get:function(){return this._displaySpriteList},enumerable:!0,configurable:!0}),e.prototype.testUrl=function(t){return this._currentUrl==t},e.prototype.loadScene=function(e,i,a,n){var r=this;if(this._currentUrl==e){this._ready=!0,i();var o=t.SceneResManager.getInstance().getRes(e);return o&&this.setFogData(o.sceneData),void n()}this.clearStaticScene(),this._ready=!1,t.SceneResManager.getInstance().loadSceneRes(e,i,a,(function(t){r.loadSceneConfigCom(t),n()})),this._currentUrl=e},e.prototype.addSceneImgBg=function(e){var i=new t.Display3dBg;i.setImgInfo(e.url,e.width,e.height),this.addDisplay(i)},e.prototype.getDisplayByID=function(t,e){return 0==t?this._sceneDic["build"+e]:1==t?this._sceneDic["particle"+e]:void 0},e.prototype.fixAstart=function(t){for(var e=0;e<this._displayRoleList.length;e++)this._displayRoleList[e].fixAstartData(t)},e.prototype.setFogData=function(e){t.Scene_data.fogColor=[e.fogColor.x/255,e.fogColor.y/255,e.fogColor.z/255];var i=e.fogDistance+1e3,a=e.fogAttenuation;t.Scene_data.gameAngle=isNaN(e.gameAngle)?0:e.gameAngle,t.Scene_data.focus3D.rotationY=t.Scene_data.gameAngle,t.Scene_data.fogData=[i*a,1/((1-a)*i)]},e.prototype.loadSceneConfigCom=function(e){this.mapData=e,this._sceneDic=new Object;var i=e.groundItem,a=e.buildItem;this.setFogData(e),t.Scene_data.sceneNumId++;for(var n=0;i&&n<i.length;n++){var r=this.getGroundSprite(i[n],e.terrain);this.addDisplay(r)}for(var o=0;o<a.length;o++){var s=a[o];if(s.type==t.BaseRes.PREFAB_TYPE){var h=this.getBuildSprite(s);this.addDisplay(h)}else if(s.type==t.BaseRes.SCENE_PARTICLE_TYPE){var c=this.getParticleSprite(s);this.addParticle(c)}}t.Scene_data.light.setData(e.SunNrm,e.SunLigth,e.AmbientLight),t.LightProbeManager.getInstance().setLightProbeData(e.lightProbeItem),this._ready=!0,e.quadTreeData?(this._sceneQuadTree=new t.SceneQuadTree,this._sceneQuadTree.init(e.quadTreeData,this._sceneDic)):this._sceneQuadTree=null},e.prototype.getGroundSprite=function(e,i){var a=new t.TerrainDisplay3DSprite;return a.setObjUrl(e.objsurl),a.setMaterialUrl(e.materialurl,e.materialInfoArr),a.materialInfoArr=e.materialInfoArr,a.setLightMapUrl(e.lighturl),a.scaleX=e.scaleX,a.scaleY=e.scaleY,a.scaleZ=e.scaleZ,a.x=e.x,a.y=e.y,a.z=e.z,a.rotationX=e.rotationX,a.rotationY=e.rotationY,a.rotationZ=e.rotationZ,a.objData.lightuvsOffsets=a.objData.uvsOffsets,i&&a.setGrounDataMesh(i[e.id]),this._sceneDic["ground"+e.id]=a,a},e.prototype.makeCollisioin=function(t){},Object.defineProperty(e.prototype,"ready",{get:function(){return this._ready},set:function(t){this._ready=t},enumerable:!0,configurable:!0}),e.prototype.getBuildSprite=function(e){var i=new t.Display3DSprite;return i.setObjUrl(e.objsurl),i.setMaterialUrl(e.materialurl,e.materialInfoArr),i.materialInfoArr=e.materialInfoArr,i.setLightMapUrl(e.lighturl),i.scaleX=e.scaleX,i.scaleY=e.scaleY,i.scaleZ=e.scaleZ,i.x=e.x,i.y=e.y,i.z=e.z,i.rotationX=e.rotationX,i.rotationY=e.rotationY,i.rotationZ=e.rotationZ,i.isPerspective=e.isPerspective,i.type=0,i.id=e.id,this._sceneDic["build"+e.id]=i,i},e.prototype.getParticleSprite=function(e){var i;return(i=t.ParticleManager.getInstance().getParticleByte(t.Scene_data.fileRoot+e.url)).scaleX=e.scaleX,i.scaleY=e.scaleY,i.scaleZ=e.scaleZ,i.x=e.x,i.y=e.y,i.z=e.z,i.rotationX=e.rotationX,i.rotationY=e.rotationY,i.rotationZ=e.rotationZ,i.type=0,this._sceneDic["particle"+e.id]=i,i},e.prototype.initScene=function(){},e.prototype.addDisplay=function(t){-1==this._displayList.indexOf(t)&&(this._displayList.push(t),t.addStage())},e.prototype.removeDisplay=function(t){var e=this._displayList.indexOf(t);-1!=e&&this._displayList.splice(e,1),t.removeStage()},e.prototype.addSpriteDisplay=function(t){if(-1==this._displaySpriteList.indexOf(t)){t.addStage();for(var e=0;e<this._displaySpriteList.length;e++)if(this._displaySpriteList[e].materialUrl==t.materialUrl)return void this._displaySpriteList.splice(e,0,t);this._displaySpriteList.push(t)}},e.prototype.removeSpriteDisplay=function(t){var e=this._displaySpriteList.indexOf(t);-1!=e&&this._displaySpriteList.splice(e,1),t.removeStage()},e.prototype.addMovieDisplayTop=function(t){this._displayRoleList.unshift(t),t.addStage()},e.prototype.setParticleVisible=function(){for(var e=this._particleList,i=0;e&&i<e.length;i++)if(!e[i].dynamic&&e[i].bindVecter3d){var a=t.Vector3D.distance(new t.Vector3D(t.Scene_data.focus3D.x,t.Scene_data.focus3D.y,t.Scene_data.focus3D.z),new t.Vector3D(e[i].x,e[i].y,e[i].z));e[i].sceneVisible=a<1e3}},e.prototype.upFrame=function(){if(this._sceneQuadTree&&(this._sceneQuadTree.setCircle(t.Scene_data.focus3D.x,t.Scene_data.focus3D.z,e.mapQudaTreeDistance),this._sceneQuadTree.needUpdata)){for(var i=0;i<this._displayList.length;i++)this._displayList[i].sceneVisible=!1,this._displayList[i].sceneVisible=!0;this.setParticleVisible(),this._sceneQuadTree.update(),this.mathCamFar()}t.Scene_data.context3D._contextSetTest.clear(),isNaN(this._time)&&(this._time=t.TimeUtil.getTimer(this.startTime)),this.updateMovieFrame(),this._ready&&(this.updateParticleTime(),this.skillMgr.update(),this.render&&(t.Scene_data.context3D.setWriteDepth(!0),t.Scene_data.context3D.setDepthTest(!0),this.updateStaticDiplay(),this.updateSpriteDisplay(),this.updateMovieDisplay(),this.shadowMgr.update(),t.Scene_data.context3D.setWriteDepth(!1),this.updateParticles(),this.bloodMgr&&this.bloodMgr.update(),t.Scene_data.context3D.setBlendParticleFactors(0),t.Scene_data.context3D.setWriteDepth(!0),t.Scene_data.context3D.setWriteDepth(!1)),t.Scene_data.context3D.setDepthTest(!1),t.UIManager.getInstance().update(),this.cameraMatrix=t.Scene_data.cam3D.cameraMatrix.clone(),this.viewMatrx3D=t.Scene_data.viewMatrx3D.clone())},e.prototype.updateFBO=function(){t.Scene_data.fbo||(t.Scene_data.fbo=t.Scene_data.context3D.getFBO()),0!=this._displayList.length&&(t.Scene_data.context3D.updateFBO(t.Scene_data.fbo),t.Scene_data.viewMatrx3D.identity(),t.Scene_data.context3D.renderContext.viewport(0,0,t.FBO.fw,t.FBO.fh),t.Scene_data.viewMatrx3D.perspectiveFieldOfViewLH(2,1,50,t.Scene_data.camFar),t.Scene_data.viewMatrx3D.appendScale(2,t.Scene_data.stageWidth/t.Scene_data.stageHeight*2,1),t.MathClass.updateVp(),this.updateStaticDiplay(),t.Engine.resetSize(),t.Scene_data.context3D.renderContext.bindFramebuffer(t.Scene_data.context3D.renderContext.FRAMEBUFFER,null))},e.prototype.addDisplay2DList=function(t){this._display2DList.push(t)},e.prototype.mathCamFar=function(){for(var e=new t.Vector3D,i=0,a=0;a<this._displayList.length;a++){var n=this._displayList[a];if(n.sceneVisible&&n.aabb){n.posMatrix.clone().append(t.Scene_data.cam3D.cameraMatrix);for(var r=n.aabbVect,o=0;o<r.length;o++)(e=t.Scene_data.cam3D.cameraMatrix.transformVector(r[o])).z>i&&(i=e.z)}}t.Scene_data.camFar=Math.max(500,i+100),t.Engine.resetViewMatrx3D()},e.prototype.updateStaticDiplay=function(){for(var t=0;t<this._displayList.length;t++)this._displayList[t].update()},e.prototype.updateStaticBind=function(){},e.prototype.updateSpriteDisplay=function(){for(var t=0;t<this._displaySpriteList.length;t++)this._displaySpriteList[t].update()},e.prototype.updateMovieDisplay=function(){for(var t=0;t<this._displayRoleList.length;t++)this._displayRoleList[t].update()},e.prototype.updateMovieFrame=function(){var e=t.TimeUtil.getTimer(this.startTime),i=e-this._time;this._time=e;for(var a=0;a<this._displayRoleList.length;a++)this._displayRoleList[a].updateFrame(i)},e.prototype.changeBloodManager=function(t){this.bloodMgr=t},e.prototype.addMovieDisplay=function(t){t._scene=this,this._displayRoleList.push(t),t.addStage()},e.prototype.clearStaticScene=function(){for(var e in this._sceneDic){var i=this._sceneDic[e];i instanceof t.CombineParticle&&this.removeParticle(i),i instanceof t.Display3DSprite&&(i.removeStage(),i.destory())}this._ready=!1,this._sceneDic=null,this._sceneQuadTree=null,this._displayList.length=0,this.removeAllMovieDisplay(),this._displayRoleList.length=0,this.clearAllParticle(),this._currentUrl="",this.mapData=null},e.prototype.playLyf=function(e,i,a,n){var r=this;void 0===a&&(a=20),void 0===n&&(n=1),this.groupDataMgr.getGroupData(t.Scene_data.fileRoot+e,(function(e){for(var o=0;o<e.dataAry.length;o++){var s=e.dataAry[o];if(s.types==t.BaseRes.SCENE_PARTICLE_TYPE){var h=t.ParticleManager.getInstance().getParticleByte(t.Scene_data.fileRoot+s.particleUrl);h.x=i.x,h.y=i.y,h.z=i.z,h.rotationX=a,h.scaleX=n,h.scaleY=n,h.scaleZ=n,r.addParticle(h),h.addEventListener(t.BaseEvent.COMPLETE,r.onPlayCom,r)}else console.log("播放的不是单纯特效")}}))},e.prototype.charPlaySkill=function(e,i,a,n){if(void 0===a&&(a="skill_01"),void 0===n&&(n=null),e._scene.ready){var r=this.skillMgr.getSkill(t.UnitFunction.getSkillUrl(i),a);if(r.keyAry)return r&&(r.reset(),r.isDeath=!1),r.configFixEffect(e,n),this.skillMgr.playSkill(r),r}},e.prototype.removeCharSkill=function(t){t.removeSkillForce()},e.prototype.removeAllMovieDisplay=function(){for(;this._displayRoleList.length>0;){var t=this._displayRoleList.splice(0,1);t[0].removeStage(),t[0].destory()}},e.prototype.removeMovieDisplay=function(t){if(t){var e=this._displayRoleList.indexOf(t);-1!=e&&this._displayRoleList.splice(e,1),t.removeStage()}},e.prototype.onPlayCom=function(t){this.removeParticle(t.target)},e.prototype.updateParticles=function(){this.updateRenderDic(),this.clearPaticleVa()},e.prototype.clearPaticleVa=function(){t.Scene_data.context3D.clearVa(2),t.Scene_data.context3D.clearVa(3),t.Scene_data.context3D.clearVa(4),t.Scene_data.context3D.clearVa(5)},e.prototype.setParticleHide=function(){for(var t=0;t<this._particleList.length;t++)this._particleList[t].dynamic},Object.defineProperty(e.prototype,"particleList",{get:function(){return this._particleList},enumerable:!0,configurable:!0}),e.prototype.updateParticleTime=function(){var e=t.TimeUtil.getTimer(this.startTime);0==this._particletime&&(this._particletime=e);var i=e-this._particletime;this._particletime=e;for(var a=0;a<this._particleList.length;a++)this._particleList[a].sceneVisible&&this._particleList[a].updateTime(i)},e.prototype.addRenderDic=function(t){var e=t.url;this.renderDic[e]||(this.renderDic[e]=new Array),this.renderDic[e].push(t)},e.prototype.removeRenderDic=function(t){var e=t.url,i=this.renderDic[e].indexOf(t);-1!=i&&(this.renderDic[e].splice(i,1),0==this.renderDic[e].length&&delete this.renderDic[e])},e.prototype.updateRenderDic=function(){for(var t in this.renderDic){var e=this.renderDic[t];if(1==e.length)e[0].update();else for(var i=e[0].size,a=0;a<i;a++)for(var n=0;n<e.length;n++)e[n].updateItem(a)}},e.prototype.addParticle=function(t){-1==this._particleList.lastIndexOf(t)&&(this._particleList.push(t),this.addRenderDic(t))},e.prototype.removeParticle=function(t){var e=this._particleList.indexOf(t);-1!=e&&(this._particleList.splice(e,1),this.removeRenderDic(t),t.reset())},e.prototype.clearAllParticle=function(){for(this._particletime=0;this._particleList&&this._particleList.length>0;){var t=this._particleList.pop();this.removeRenderDic(t),t.reset()}},e.mapQudaTreeDistance=200,e}();t.SceneManager=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.allImgBytes=1e7,t.urlCache={},t}return __extends(i,e),i.prototype.read=function(e){void 0===e&&(e=null),this._imgFun=e;var a=this._byte.readInt();a==i.IMG_TYPE?t.Scene_data.supportBlob?this.readImg():this.readImgLow():a==i.OBJS_TYPE?this.readObj(this._byte):a==i.MATERIAL_TYPE?this.readMaterial():a==i.PARTICLE_TYPE?this.readParticle():a==i.ZIP_OBJS_TYPE&&this.readZipObj()},i.prototype.readZipObj=function(){var e=this._byte.readInt(),i=this._byte.buffer.slice(this._byte.position,this._byte.position+e);this._byte.position+=e;var a=t.Util.unZip(i),n=new t.TLByteArray(a);this.readObj(n)},i.prototype.readImg=function(){var e=this;this.imgNum=this._byte.readInt(),this.imgLoadNum=0;for(var i=new Array,a=new Array,n=0;n<this.imgNum;n++){var r=t.Scene_data.fileRoot+this._byte.readUTF(),o=this._byte.readInt();if(-1==r.search(".jpng")){var s=this._byte.buffer.slice(this._byte.position,this._byte.position+o);this._byte.position+=o;var h=new Blob([s],{type:"application/octet-binary"});i.push(h),a.push(r)}else this.readJpngImg(r)}for(n=0;n<i.length;n++){var c=new Image;c.url=a[n],c.onload=function(t){e.addImg(t.target.url,t.target);var i=t.target;URL.revokeObjectURL(i.src)},c.src=URL.createObjectURL(i[n])}},i.prototype.readJpngImg=function(e){var i=this,a=this._byte.readInt(),n=this._byte.buffer.slice(this._byte.position,this._byte.position+a);this._byte.position+=a;var r=this._byte.readInt(),o=this._byte.buffer.slice(this._byte.position,this._byte.position+r);this._byte.position+=r;var s=new Image,h=new Image,c=0,u=function(a){if(!(++c<2)){var n=t.UIManager.getInstance().getContext2D(s.width,s.height);n.drawImage(s,0,0);var r=n.getImageData(0,0,s.width,s.height);n.clearRect(0,0,s.width,s.height),n.drawImage(h,0,0);for(var o=n.getImageData(0,0,s.width,s.height),u=0;u<r.data.length;u+=4){o.data[u];r.data[u+3]=o.data[u]}i.addImg(e.replace(".jpng",".png"),r)}};s.onload=u,h.onload=u,s.src="data:image/png;base64,"+t.Base64.encode(n),h.src="data:image/png;base64,"+t.Base64.encode(o)},i.prototype.readImgLow=function(){var e=this;this.imgNum=this._byte.readInt(),this.imgLoadNum=0;for(var i=0,a=0;a<this.imgNum;a++){var n=this._byte.readUTF(),r=t.Scene_data.fileRoot+t.LoadManager.getInstance().getVersion(n);i+=this._byte.readInt();var o=new Image;o.url=r,this.urlCache[r]=t.Scene_data.fileRoot+n,o.onload=function(t){e.loadImg(t.target)},o.src=r}this.allImgBytes=i},i.prototype.loadImg=function(e){var i=this.urlCache[e.url]||e.url;t.TextureManager.getInstance().addRes(i,e),this.countImg()},i.prototype.addImg=function(e,i){t.TextureManager.getInstance().addRes(e,i),this.countImg()},i.prototype.countImg=function(){this.imgLoadNum++,this.imgLoadNum==this.imgNum&&(this._imgComplete=!0,this.allResCom())},i.prototype.readObj=function(e){for(var i=e.readInt(),a=0;a<i;a++){var n=t.Scene_data.fileRoot+e.readUTF(),r=e.readInt(),o=new t.TLByteArray;o.length=r,e.readBytes(o,0,r);t.ObjDataManager.getInstance().loadObjCom(o.buffer,n)}this._imgFun&&this._imgFun()},i.prototype.readMaterial=function(){for(var e=this._byte.readInt(),i=0;i<e;i++){var a=t.Scene_data.fileRoot+this._byte.readUTF(),n=this._byte.readInt(),r=new t.TLByteArray;r.length=n,this._byte.readBytes(r,0,n),t.MaterialManager.getInstance().addResByte(a,r)}},i.prototype.readParticle=function(){for(var e=this._byte.readInt(),i=0;i<e;i++){var a=t.Scene_data.fileRoot+this._byte.readUTF(),n=this._byte.readInt(),r=new t.TLByteArray;r.length=n,this._byte.readBytes(r,0,n),t.ParticleManager.getInstance().addResByte(a,r)}},i.prototype.readMaterialInfo=function(){var t=this._byte.readInt();if(t>0){for(var e=new Array,i=0;i<t;i++){var a=new Object;a.type=this._byte.readInt(),a.name=this._byte.readUTF(),0==a.type&&(a.url=this._byte.readUTF()),1==a.type&&(a.x=this._byte.readFloat()),2==a.type&&(a.x=this._byte.readFloat(),a.y=this._byte.readFloat()),3==a.type&&(a.x=this._byte.readFloat(),a.y=this._byte.readFloat(),a.z=this._byte.readFloat()),e.push(a)}return e}return null},i.readFloatTwoByte=function(t,e){var i=t.readInt();if(i>0){var a=t.readFloat();e.length=0;for(var n=0;n<i;n++)e.push(t.readFloatTwoByte(a))}},i.readFloatOneByte=function(t,e){var i=t.readInt();if(i>0)for(var a=0;a<i;a++)e.push((t.readByte()+128)/256)},i.readIntForTwoByte=function(t,e){for(var i=t.readInt(),a=0;a<i;a++)e.push(t.readShort())},i.readIntForOneByte=function(t,e){for(var i=t.readInt(),a=0;a<i;a++)e.push(t.readByte())},i.readBytes2ArrayBuffer=function(t,e,i,a,n,r){void 0===r&&(r=0);var o=t.readInt();if(!(o<=0)){var s;0==r&&(s=t.readFloat());for(var h=o/i,c=0;c<h;c++)for(var u=n*c+a,l=0;l<i;l++)0==r?e.setFloat32(4*(u+l),t.readFloatTwoByte(s),!0):1==r?e.setFloat32(4*(u+l),t.readFloatOneByte(),!0):2==r?e.setFloat32(4*(u+l),t.readByte(),!0):3==r?e.setFloat32(4*(u+l),(t.readByte()+128)/255,!0):4==r&&e.setFloat32(4*(u+l),t.readFloat(),!0)}},i.readMaterialParamData=function(t){var e=t.readInt();if(e>0){for(var i=new Array,a=0;a<e;a++){var n=new Object;n.name=t.readUTF(),n.type=t.readByte(),0==n.type?n.url=t.readUTF():1==n.type?n.x=t.readFloat():2==n.type?(n.x=t.readFloat(),n.y=t.readFloat()):3==n.type&&(n.x=t.readFloat(),n.y=t.readFloat(),n.z=t.readFloat()),i.push(n)}return i}return null},i.prototype.allResCom=function(){this._imgFun&&this._imgFun()},i.IMG_TYPE=1,i.OBJS_TYPE=2,i.MATERIAL_TYPE=3,i.PARTICLE_TYPE=4,i.SCENE_TYPE=5,i.ZIP_OBJS_TYPE=6,i.PREFAB_TYPE=1,i.SCENE_PARTICLE_TYPE=11,i}(t.ResCount);t.BaseRes=e}(tl3d||(tl3d={})),function(t){var e=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype.load=function(e,i,n,r){var o=this;if(this._completeFun=i,this._readDataFun=r,this._progressFun=n,this.sceneData)this.isNeedReload()?(i(),n(1),this.applyByteArray()):(i(),n(1),r(this.sceneData));else{var s=a.sceneConfigData;s&&s[e]?this.loadZipMap(e,s[e].len):(e=t.Scene_data.fileRoot+t.UnitFunction.getMapUrl(e),t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t){o.loadComplete(t)}),null))}},a.prototype.loadZipMap=function(e,i){for(var a=this,n=new Array,r=new Array,o=0,s=new Array,h=0;h<i;h++)s[h]=0;var c=function(t){var e=t.response,i=n.indexOf(t);if(r[i]=e,++o==n.length){for(var s=0,h=0;h<r.length;h++)s+=r[h].byteLength;var c=new Uint8Array(s),u=0;for(h=0;h<r.length;h++)c.set(new Uint8Array(r[h]),u),u+=r[h].byteLength;a.loadComplete(c.buffer)}},u=function(t,e){var r=n.indexOf(t);s[r]=e;for(var o=0,h=0;h<i;h++)o+=s[h];o/=i,a._progressFun(o)};for(h=0;h<i;h++){var l=new XMLHttpRequest;l.onreadystatechange=function(t){var e=t.target;200==e.status&&4==e.readyState&&c(e)},l.onprogress=function(t){var e=t.target;u(e,t.loaded/t.total)};var d=t.Scene_data.fileRoot+t.UnitFunction.getZipMapUrl(e)+h+".txt";n.push(l),l.open("GET",d,!0),l.responseType="arraybuffer",l.send()}},a.prototype.isNeedReload=function(){for(var e=this.sceneData.buildItem,i=0;i<e.length;i++)if(e[i].type==t.BaseRes.PREFAB_TYPE&&e[i].lighturl){var a=t.Scene_data.fileRoot+e[i].lighturl;return!t.TextureManager.getInstance().hasTexture(a)}return t.ResCount.GCTime-this.idleTime<10},a.prototype.loadComplete=function(e){this._byte=new t.TLByteArray(e),this.applyByteArray()},a.prototype.applyByteArray=function(){var t=this;this._byte.position=0,this.version=this._byte.readInt(),this.read((function(){t.readNext()}))},a.prototype.readNext=function(){this.read(),this.read(),this.read(),this.readScene(),this._readDataFun(this.sceneData)},a.prototype.readScene=function(){this._byte.readInt();this.readAstat(),this.version>=28&&this.readTerrainIdInfoBitmapData(this._byte);var t=this._byte.readInt();this.sceneData=JSON.parse(this._byte.readUTFBytes(t)),this.sceneData.astar=this._astarDataMesh,this.sceneData.terrain=this._terrainDataItem},a.prototype.readTerrainIdInfoBitmapData=function(e){var i=e.readInt();if(i){var a=i,n=e.buffer.slice(e.position,e.position+a);e.position+=a;var r=t.Util.unZip(n),o=new t.TLByteArray(r);this._terrainDataItem=t.GroundDataMesh.meshAllgroundData(o)}},a.prototype.readAstat=function(){if(this._byte.readBoolean()){var e,a;this._astarDataMesh=new i,this._astarDataMesh.aPos=new t.Vector3D,this._astarDataMesh.astarItem=new Array,this._astarDataMesh.heightItem=new Array,this._astarDataMesh.jumpItem=new Array,this._astarDataMesh.midu=this._byte.readFloat(),this._astarDataMesh.aPos.x=this._byte.readFloat(),this._astarDataMesh.aPos.y=this._byte.readFloat(),this._astarDataMesh.aPos.z=this._byte.readFloat();var n=this._byte.readInt(),r=this._byte.readInt();if(this._astarDataMesh.width=n,this._astarDataMesh.height=r,this.version<25){for(e=0;e<r;e++){var o=new Array;for(a=0;a<n;a++)o.push(this._byte.readFloat());this._astarDataMesh.astarItem.push(o)}for(e=0;e<r;e++){var s=new Array;for(a=0;a<n;a++)s.push(this._byte.readFloat());this._astarDataMesh.heightItem.push(s)}}else{var h=this._byte.readFloat(),c=this.readAstarFromByte(this._byte),u=this.readAstarFromByte(this._byte),l=0,d=0;for(e=0;e<r;e++){o=new Array;var p=new Array;for(a=0;a<n;a++){var f=c[l++];if(o.push(f),1==f){var m=u[d++];p.push(m)}else p.push(0)}this._astarDataMesh.astarItem.push(o),this._astarDataMesh.jumpItem.push(p)}for(this._astarDataMesh.jumpItem,e=0;e<r;e++){s=new Array;for(a=0;a<n;a++)s.push(this._byte.readShort()/h);this._astarDataMesh.heightItem.push(s)}}}},a.prototype.readAstarFromByte=function(t){for(var e=t.readUnsignedInt(),i=Math.ceil(e/32),a=new Array,n=0;n<i;n++)for(var r=t.readUnsignedInt(),o=0;o<32;o++){var s=1&r;a.length<e&&a.push(s),r>>=1}return a},a.prototype.countImg=function(){this._progressFun&&this._progressFun(this.imgLoadNum/this.imgNum),e.prototype.countImg.call(this)},a.prototype.allResCom=function(){e.prototype.allResCom.call(this),this._completeFun&&this._completeFun()},a.prototype.destory=function(){e.prototype.destory.call(this)},a}(t.BaseRes);t.SceneRes=e;var i=function(){}}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v3Color")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec3 v3Color;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec4 colorData;void main(void){   vec4 vt0= vec4(v3Position, 1.0);   colorData =vec4(v3Color,1) ;   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nvarying vec4 colorData;\nvoid main(void)\n{\ngl_FragColor =colorData;\n}"},e.LineShader="LineShader",e}(t.Shader3D);t.LineDisplayShader=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.baseColor=new t.Vector3D(1,0,0),i.objData=new t.ObjData,i.shader=t.ProgrmaManager.getInstance().getProgram(t.LineDisplayShader.LineShader),i.program=i.shader.program,i.makeLineMode(new t.Vector3D(0,0,0),new t.Vector3D(100,0,0),new t.Vector3D),i.makeLineMode(new t.Vector3D(0,0,0),new t.Vector3D(100,0,100),new t.Vector3D),i.makeLineMode(new t.Vector3D(100,0,0),new t.Vector3D(100,0,100),new t.Vector3D),i.upToGpu(),i}return __extends(i,e),i.prototype.makeLineMode=function(t,e,i){void 0===i&&(i=null),this.lineVecPos&&this.lineIndex||this.clear(),i&&(this.baseColor=i),this.lineVecPos.push(t.x,t.y,t.z),this.lineVecPos.push(e.x,e.y,e.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineIndex.push(this.lineIndex.length+0,this.lineIndex.length+1)},i.prototype.clear=function(){this.lineVecPos=new Array,this.lineIndex=new Array,this.lineColor=new Array,this.objData.indexBuffer&&(this.objData.indexBuffer=null)},i.prototype.upToGpu=function(){this.lineIndex.length&&(this.objData.treNum=this.lineIndex.length,this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.lineVecPos),this.objData.normalsBuffer=t.Scene_data.context3D.uploadBuff3D(this.lineColor),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.lineIndex))},i.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"viewMatrix3D",t.Scene_data.viewMatrx3D.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"camMatrix3D",t.Scene_data.cam3D.cameraMatrix.m),t.Scene_data.context3D.setVcMatrix4fv(this.shader,"posMatrix3D",this.posMatrix.m),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.normalsBuffer),t.Scene_data.context3D.drawLine(this.objData.indexBuffer,this.objData.treNum))},i}(t.Display3D);t.LineDisplaySprite=e;var i=function(t){function i(){var e=t.call(this)||this;return e.itemSprite||(e.itemSprite=new Array),e}return __extends(i,t),i.prototype.makeLineMode=function(e,i,a){void 0===a&&(a=null),t.prototype.makeLineMode.call(this,e,i,a),this.getSprite().makeLineMode(e,i,a)},i.prototype.getSprite=function(){var t=Math.floor(this.lineIndex.length/1e4);if(!this.itemSprite[t]){var i=new e;i.clear(),i.baseColor=this.baseColor,this.itemSprite.push(i)}return this.itemSprite[t]},i.prototype.update=function(){for(var t=0;t<this.itemSprite.length;t++)this.itemSprite[t].posMatrix=this.posMatrix,this.itemSprite[t].update()},i.prototype.upToGpu=function(){for(var t=0;t<this.itemSprite.length;t++)this.itemSprite[t].upToGpu()},i.prototype.clear=function(){t.prototype.clear.call(this),this.itemSprite||(this.itemSprite=new Array);for(var e=0;this.itemSprite&&e<this.itemSprite.length;e++)this.itemSprite[e].clear()},i}(e);t.MulLineSprite=i;var a=function(e){function i(){var t=e.call(this)||this;return t.makeGridData(),t}return __extends(i,e),i.prototype.makeGridData=function(){var e,i,a=100;this.clear(),e=new t.Vector3D(0,0,100),i=new t.Vector3D(0,0,-a),this.makeLineMode(e,i,new t.Vector3D(0,0,1,1)),e=new t.Vector3D(100,0,0),i=new t.Vector3D(-a,0,0),this.makeLineMode(e,i,new t.Vector3D(1,0,0,1)),this.baseColor=new t.Vector3D(128/255,128/255,128/255,1);for(var n=1;n<=10;n++)e=new t.Vector3D(10*+n,0,100),i=new t.Vector3D(10*+n,0,-a),this.makeLineMode(e,i),e=new t.Vector3D(10*-n,0,100),i=new t.Vector3D(10*-n,0,-a),this.makeLineMode(e,i),e=new t.Vector3D(100,0,10*+n),i=new t.Vector3D(-a,0,10*+n),this.makeLineMode(e,i),e=new t.Vector3D(100,0,10*-n),i=new t.Vector3D(-a,0,10*-n),this.makeLineMode(e,i);this.upToGpu()},i}(e);t.GridLineSprite=a}(tl3d||(tl3d={})),function(t){var e=function(){function e(t,e,i,a,n,r){this.x=t,this.y=e,this.z=i,this.width=a,this.height=n,this.depth=r}return e.prototype.testViewFrustum=function(t,e){if(this.sun&&1==this.sun.length)this.sun[0].testViewFrustum(t,e);else if(this.testViewFrustumResult(t)&&(this.target&&(this.target.isPerspective&&this.testRay(e)||(this.target.sceneVisible=!0)),this.sun))for(var i=0;i<this.sun.length;i++)this.sun[i].testViewFrustum(t,e)},e.prototype.testViewFrustumResult=function(e){for(var i=new t.Vector3D(this.x,this.y,this.z),a=new t.Vector3D(this.width,this.height,this.depth),n=!0,r=0;r<e.length;r++){var o=i,s=i.add(a),h=new t.Vector3D;if(e[r].x>0?h.x=s.x:h.x=o.x,e[r].y>0?h.y=s.y:h.y=o.y,e[r].z>0?h.z=s.z:h.z=o.z,e[r].dot(h)+e[r].w<0){n=!1;break}}return n},e.prototype.testRay=function(t){var e,i,a,n,r,o,s=t.o.x,h=t.o.y,c=t.o.z,u=t.d.x,l=t.d.y,d=t.d.z,p=this.x,f=this.y,m=this.z,y=this.x+this.width,_=this.y+this.height,v=this.z+this.depth,x=1/u;x>=0?(e=(p-s)*x,n=(y-s)*x):(e=(y-s)*x,n=(p-s)*x);var g=1/l;g>=0?(i=(f-h)*g,r=(_-h)*g):(i=(_-h)*g,r=(f-h)*g);var D,b,S=1/d;S>=0?(a=(m-c)*S,o=(v-c)*S):(a=(v-c)*S,o=(m-c)*S),a>(D=e>i?e:i)&&(D=a),o<(b=n<r?n:r)&&(b=o);return D<b&&b>1e-4&&((D>1e-4?D:b)<t.baseT||void 0)},e}();t.QuadTreeNode=e;var i=function(){function e(){this.o=new t.Vector3D,this.d=new t.Vector3D,this.baseT=500}return e.prototype.setPos=function(t,e,i){this.o.x=t,this.o.y=e,this.o.z=i},e.prototype.setTarget=function(t,e,i){this.d.x=t-this.o.x,this.d.y=e-this.o.y,this.d.z=i-this.o.z,this.d.normalize()},e}();t.Ray=i}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.needUpdata=!1,this.panleAry=new Array}return e.prototype.init=function(e,i){this._circle=new t.Circle(1e4,1e4),this._sceneDic=i,this._rootNode=this.getNode(e),this._ray=new t.Ray},e.prototype.getNode=function(e){var i=new t.QuadTreeNode(e.x,e.y,e.z,e.width,e.height,e.depth);if(e.data){i.sun||(i.sun=new Array);for(var a=0;a<e.data.length;a++){var n,r=new t.QuadTreeNode(e.data[a].x,e.data[a].y,e.data[a].z,e.data[a].width,e.data[a].height,e.data[a].depth);1==e.data[a].type?n="build"+e.data[a].id:11==e.data[a].type?n="particle"+e.data[a].id:14==e.data[a].type&&(n="ground"+e.data[a].id),r.target=this._sceneDic[n],r.target.aabb=r,i.sun.push(r)}}if(e.sun){i.sun||(i.sun=new Array);for(a=0;a<e.sun.length;a++)i.sun.push(this.getNode(e.sun[a]))}return i},e.prototype.setCircle=function(t,e,i){var a=t-this._circle.x,n=e-this._circle.y;Math.sqrt(a*a+n*n)<10?this.needUpdata=!1:(this._circle.setData(t,e,i),this.needUpdata=!0)},e.prototype.update=function(){t.MathClass.GetViewHitBoxDataCopy(t.Scene_data.cam3D.distance);var e=new t.Vector3D(t.Scene_data.cam3D.x,t.Scene_data.cam3D.y,t.Scene_data.cam3D.z),i=t.MathClass.viewBoxVecItem;this.panleAry.length=0,this.panleAry.push(this.getPanelByVec(e,i[0],i[1])),this.panleAry.push(this.getPanelByVec(e,i[1],i[2])),this.panleAry.push(this.getPanelByVec(e,i[2],i[3])),this.panleAry.push(this.getPanelByVec(e,i[3],i[0])),this._ray.setPos(t.Scene_data.cam3D.x,t.Scene_data.cam3D.y,t.Scene_data.cam3D.z),this._ray.setTarget(t.Scene_data.focus3D.x,t.Scene_data.focus3D.y,t.Scene_data.focus3D.z),this._ray.baseT=t.Scene_data.cam3D.distance,this._rootNode.testViewFrustum(this.panleAry,this._ray)},e.prototype.getPanelByVec=function(t,e,i){var a=e.subtract(t),n=i.subtract(t);return(a=a.cross(n)).normalize(),a.w=-a.dot(t),a},e.prototype.updateDraw=function(){this.capsuleLineSprite?(this.capsuleLineSprite.x=t.Scene_data.focus3D.x,this.capsuleLineSprite.y=t.Scene_data.focus3D.y+50,this.capsuleLineSprite.z=t.Scene_data.focus3D.z,this.capsuleLineSprite.update()):(this.capsuleLineSprite=new t.LineDisplaySprite,this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new t.Vector3D(1,0,0,1),this.drawCylinder(this._circle.radius,10),this.capsuleLineSprite.upToGpu())},e.prototype.drawCylinder=function(e,i){var a,n,r,o=e,s=i;for(r=0;r<12;r++){var h=new t.Vector3D(o,0,0),c=new t.Vector3D(o,+s,0),u=new t.Matrix3D;u.appendRotation(30*r,t.Vector3D.Y_AXIS);var l=u.transformVector(h),d=u.transformVector(c);this.capsuleLineSprite.makeLineMode(l,d),this.capsuleLineSprite.makeLineMode(d,new t.Vector3D(0,+s,0)),11==r&&(this.capsuleLineSprite.makeLineMode(l,h),this.capsuleLineSprite.makeLineMode(d,c)),(a||n)&&(this.capsuleLineSprite.makeLineMode(l,a),this.capsuleLineSprite.makeLineMode(d,n)),a=l.clone(),n=d.clone()}},e}();t.SceneQuadTree=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.isDeath=!0,i.src=!1,i.time=0,i.targetFlag=0,i.targetShockFlag=0,i.needSound=!1,i.needShock=!1,i.hasDestory=!1,i.actionEnd=!1,i.skillMgr=t,i}return __extends(i,e),i.prototype.setData=function(e,i){this.hasDestory||(this.skillVo=new t.SkillVo,this.skillVo.setData(e),this.setKeyAry(),this.trajectoryAry=new Array,this._skillData=i)},i.prototype.getBloodTime=function(){return this.skillVo?this.skillVo.bloodTime:t.SkillVo.defaultBloodTime},i.prototype.play=function(){var e=this;this.skillVo?this.active&&this.active instanceof t.Display3dMovie&&this.active.play(this.skillVo.action,this.actionEnd?1:2,!1,null,(function(){e.actionCompleteFun&&e.actionCompleteFun()})):this.skillComplete()},i.prototype.setKeyAry=function(){var e=this;if(this.keyAry=new Array,this.skillVo.types==t.SkillType.FixEffect)for(var i=0;i<this.skillVo.keyAry.length;i++){var a=new t.SkillFixEffect(this);a.setInfo(this.skillVo.keyAry[i]),a.removeCallFun=function(t){e.removeKey(t)},a.active=this.active,this.keyAry.push(a)}else if(this.skillVo.types==t.SkillType.TrajectoryDynamicTarget||this.skillVo.types==t.SkillType.TrajectoryDynamicPoint)for(i=0;i<this.skillVo.keyAry.length;i++){var n;(n=1==this.skillVo.keyAry[i].multype?new t.SkillMulTrajectory(this.skillMgr):new t.SkillTrajectory(this.skillMgr)).setInfo(this.skillVo.keyAry[i]),this.keyAry.push(n)}},i.prototype.removeKey=function(t){this.completeNum++,this.completeNum==this.keyAry.length&&this.skillComplete()},i.prototype.removeSkillForce=function(){if(this.keyAry)for(var t=0;t<this.keyAry.length;t++)this.keyAry[t].reset();this.skillComplete(),this.reset()},i.prototype.skillComplete=function(){this.skillMgr.removeSkill(this),this.isDeath=!0,this.completeFun&&this.completeFun(),this.idleTime=0},i.prototype.reset=function(){this.time=0,this.completeNum=0,this.active=null,this.completeFun=null,this.targetFlag=0,this.targetShockFlag=0,this.soundPlay=!1,this.needSound=!0,this.needShock=!0},i.prototype.update=function(t){this.time+=t,this.time>i.MaxTime?this.skillComplete():(this.getKeyTarget(),this.getShockTarget(),this.updateTrajector(t))},i.prototype.updateTrajector=function(t){for(var e=0;e<this.trajectoryAry.length;e++)this.trajectoryAry[e].update(t)},i.prototype.getKeyTarget=function(){if(this.keyAry){for(var e=this.targetFlag;e<this.keyAry.length&&this.keyAry[e].time<this.time;){if(this.keyAry[e].addToRender(),this.skillVo.types==t.SkillType.TrajectoryDynamicTarget||this.skillVo.types==t.SkillType.TrajectoryDynamicPoint){var i=this.keyAry[e];this.trajectoryAry.push(i)}e++,this.targetFlag=e}this.getSound()}},i.prototype.getShockTarget=function(){if(this.skillVo.shockAry&&this.needShock)for(var t=this.targetShockFlag;t<this.skillVo.shockAry.length&&this.skillVo.shockAry[t].time<this.time;t++)this.skillMgr.shock.shock(this.skillVo.shockAry[t].lasttime,this.skillVo.shockAry[t].amp),this.targetShockFlag=t+1},i.prototype.getSound=function(){this.skillVo.sound&&!this.soundPlay&&this.needSound&&this.skillVo.sound.frame<this.time&&(t.AudioMgr.playSound(t.Scene_data.soundPath+this.skillVo.sound.url),this.soundPlay=!0)},i.prototype.configFixEffect=function(e,i,a,n){if(void 0===i&&(i=null),void 0===a&&(a=null),void 0===n&&(n=null),this.active=e,this.completeFun=a,this.actionCompleteFun=i,this.keyAry)for(var r=0;r<this.keyAry.length;r++)if(this.skillVo.types==t.SkillType.FixEffect){var o=this.keyAry[r];o.active=e,n&&n.length?r>n.length-1?o.outPos=n[n.length-1]:o.outPos=n[r]:o.outPos=null}},i.prototype.configTrajectory=function(e,i,a,n,r){var o=this;if(void 0===a&&(a=null),void 0===n&&(n=0),void 0===r&&(r=null),this.active=e,this.completeFun=a,this.completeNum=0,this.keyAry)for(var s=0;s<this.keyAry.length;s++){if(this.skillVo.types==t.SkillType.TrajectoryDynamicTarget||this.skillVo.types==t.SkillType.TrajectoryDynamicPoint)this.keyAry[s].setPlayData(e,i,(function(t){o.removeTrajectory(t)}),n,0==s?r:null)}},i.prototype.configMulTrajectory=function(e,i,a,n){var r=this;if(void 0===n&&(n=null),this.active=i,this.completeFun=n,this.completeNum=0,this.keyAry)for(var o=0;o<this.keyAry.length;o++){if(this.skillVo.types==t.SkillType.TrajectoryDynamicTarget)this.keyAry[o].setMulPlayData(e,a,(function(t){r.removeTrajectory(t)}),2)}},i.prototype.removeTrajectory=function(t){var e=this.trajectoryAry.indexOf(t);-1!=e&&this.trajectoryAry.splice(e,1),this.completeNum++,this.completeNum==this.keyAry.length&&this.skillComplete()},i.prototype.destory=function(){if(this.skillVo=null,this.name=null,this.keyAry){for(var t=0;t<this.keyAry.length;t++)this.keyAry[t].destory();this.keyAry.length=0,this.keyAry=null}if(this.active=null,this.completeFun=null,this.trajectoryAry){for(t=0;t<this.trajectoryAry.length;t++)this.trajectoryAry[t].destory();this.trajectoryAry.length=0,this.trajectoryAry=null}this._skillData&&this._skillData.useNum--,this._skillData=null,this.hasDestory=!0},i.MaxTime=5e3,i}(t.ResCount);t.Skill=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.srcList=new Array,i.skillMgr=t,i}return __extends(i,e),i.prototype.addSrcSkill=function(t){this.srcList.push(t)},i.prototype.destory=function(){for(var t=0;t<this.srcList.length;t++){var e=this.srcList[t];e.destory(),this.skillMgr.gcSkill(e)}},i.prototype.testDestory=function(){for(var e=0;e<this.srcList.length;e++){var i=this.srcList[e];if(!(i.isDeath&&i.idleTime>=t.ResCount.GCTime))return!1}return!0},i}(t.ResCount);t.SkillData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function a(t){var i=e.call(this)||this;return i._time=0,i.scene=t,i._skillDic=new Object,i._loadDic=new Object,i._skillAry=new Array,i._preLoadDic=new Object,i}return __extends(a,e),a.prototype.update=function(){for(var e=t.TimeUtil.getTimer(this.scene?this.scene.startTime:t.TimeUtil.START_TIME),i=e-this._time,a=0;a<this._skillAry.length;a++)this._skillAry[a].update(i);this._time=e},a.prototype.preLoadSkill=function(e,i){var a=this;void 0===i&&(i=null),this._callBack=i,this._dic[e]||this._preLoadDic[e]?this._callBack&&(this._callBack.call(null),this._callBack=null):(this.loadSkillRes(t.Scene_data.fileRoot+e,(function(i){var n=new t.SkillData(a);n.data=i.data,n.useNum++,a._dic[e]=n,a.addSrc(e,n),a._callBack&&(a._callBack.call(null),a._callBack=null)})),this._preLoadDic[e]=!0)},a.prototype.loadSkillRes=function(e,i){var a=new t.SkillRes;a.load(e,(function(){i(a)}))},a.prototype.getSkill=function(e,i,a){var n,r=this;void 0===a&&(a=null);var o,s=e+i,h=this._skillDic[s];if(h)for(var c=0;c<h.length;c++)if((n=h[c]).isDeath&&0==n.useNum)return n.reset(),n.isDeath=!1,n;return(n=new t.Skill(this)).name=i,n.isDeath=!1,this._skillDic[s]||(this._skillDic[s]=new Array),this._skillDic[s].push(n),this._dic[e]?(n.setData(this._dic[e].data[n.name],this._dic[e]),n.key=s,this._dic[e].useNum++,n):this._loadDic[e]?((o=new Object).name=i,o.skill=n,o.callback=a,this._loadDic[e].push(o),n):(this._loadDic[e]=new Array,(o=new Object).name=i,o.skill=n,o.callback=a,this._loadDic[e].push(o),this.loadSkillRes(t.Scene_data.fileRoot+e,(function(t){r.loadSkillCom(e,t)})),n)},a.prototype.loadSkillCom=function(e,i){var a=new t.SkillData(this);a.data=i.data;for(var n=0;n<this._loadDic[e].length;n++){(r=this._loadDic[e][n]).skill.hasDestory||(r.skill.setData(a.data[r.name],a),r.skill.key=e+r.name,a.useNum++)}this._dic[e]=a,this.addSrc(e,a);for(n=0;n<this._loadDic[e].length;n++){var r;(r=this._loadDic[e][n]).callback&&r.callback()}this._loadDic[e].length=0,this._loadDic[e]=null},a.prototype.addSrc=function(e,i){for(var a in i.data){var n=new t.Skill(this);n.name=a,n.isDeath=!0,n.src=!0,n.setData(i.data[a],i),i.addSrcSkill(n);var r=e+a;this._skillDic[r]||(this._skillDic[r]=new Array),this._skillDic[r].push(n)}},a.prototype.playSkill=function(t){this._skillAry.push(t),t.play()},a.prototype.removeSkill=function(t){var e=this._skillAry.indexOf(t);-1!=e&&this._skillAry.splice(e,1)},a.prototype.removeAllSkill=function(){this._skillAry=[]},a.prototype.gcSkill=function(t){for(var e in this._skillDic){var i=this._skillDic[e],a=i.indexOf(t);-1!=a&&i.splice(a,1)}},a.prototype.gc=function(){var e=[];for(var i in this._dic){var a=this._dic[i];e.push(i),a.useNum<=0&&(a.idleTime++,a.idleTime>=t.ResCount.GCTime&&a.testDestory()&&(a.destory(),delete this._dic[i]))}for(var i in this._skillDic){for(var n=this._skillDic[i],r=n.length-1;r>=0;r--)n[r].isDeath&&n[r].useNum<=0&&(n[r].idleTime++,n[r].idleTime>=t.ResCount.GCTime&&(n[r].src||(n[r].destory(),n.splice(r,1))));0==n.length&&delete this._skillDic[i]}},Object.defineProperty(a.prototype,"shock",{get:function(){return this._shock||(this._shock=new i),this._shock},enumerable:!0,configurable:!0}),a}(t.ResGC);t.SkillManager=e;var i=function(){function e(){var t=this;this.upFun=function(e){t.update(e)}}return e.prototype.update=function(e){if(this.ctime+=e,this.ctime>this.time)return t.TimeUtil.removeFrameTick(this.upFun),void t.Scene_data.cam3D.offset.setTo(0,0,0);var i=(Math.random()-.5)*this.amp,a=(Math.random()-.5)*this.amp,n=(Math.random()-.5)*this.amp;t.Scene_data.cam3D.offset.setTo(i,a,n)},e.prototype.shock=function(e,i){this.time=e,this.ctime=0,this.amp=i,t.TimeUtil.addFrameTick(this.upFun)},e.prototype.clearShock=function(){t.TimeUtil.removeFrameTick(this.upFun)},e}();t.ShockUtil=i}(tl3d||(tl3d={})),function(t){var e=function(){function e(t){this.time=0,this.skillMgr=t}return e.prototype.addToRender=function(){this.particle&&(this.particle.reset(),this.particle.sceneVisible=!0,this.skillMgr.scene.addParticle(this.particle))},e.prototype.setInfo=function(e){this.time=e.frame*t.Scene_data.frameTime,this.particle=t.ParticleManager.getInstance().getParticleByte(t.Scene_data.fileRoot+e.url)},e.prototype.onPlayCom=function(){},e.prototype.reset=function(){this.skillMgr.scene.removeParticle(this.particle)},e.prototype.destory=function(){this.particle&&(this.particle.destory(),this.particle=null),this.removeCallFun=null},e}();t.SkillKey=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!0,configurable:!0}),e.prototype.addToRender=function(){var e=this;t.prototype.addToRender.call(this),this.particle&&(this.particle.onComplete=function(t){e.onPlayCom()})},e.prototype.onPlayCom=function(t){void 0===t&&(t=null),this.skillMgr.scene.removeParticle(this.particle),this.removeCallFun(this)},e}(t.SkillKey);t.SkillEffect=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.prototype.getSocket=function(t,e){this.bindMatrix.clone(e)},t.prototype.getSunType=function(){return 1},t}();t.SkillBugBind=e;var i=function(e){function i(t){var i=e.call(this,t.skillMgr)||this;return i.skill=t,i}return __extends(i,e),i.prototype.setInfo=function(t){e.prototype.setInfo.call(this,t);var i=t;this.pos=i.pos,this.rotation=i.rotation,this.hasSocket=i.hasSocket,this.socket=i.socket},i.prototype.onPlayCom=function(t){void 0===t&&(t=null),this.skill.skillMgr.scene.removeParticle(this.particle),this.removeCallFun(this)},i.prototype.addToRender=function(){var e=this;if(this.particle)if(this.particle.reset(),this.particle.sceneVisible=!0,this.particle.onComplete=function(t){e.onPlayCom()},this.skill.skillMgr.scene.addParticle(this.particle),this.hasSocket){var i=this.active;this.particle.bindTarget=i,this.particle.bindSocket=this.socket}else{var a=new t.Matrix3D;a.appendRotation(this.active.rotationY,t.Vector3D.Y_AXIS);var n=a.transformVector(this.pos);n.x+=null==this.outPos?this.active.x:this.outPos.x,n.y+=null==this.outPos?this.active.y:this.outPos.y,n.z+=null==this.outPos?this.active.z:this.outPos.z;var r=new t.SkillBugBind;r.bindMatrix=new t.Matrix3D,r.bindMatrix.appendRotation(this.rotation.x,t.Vector3D.X_AXIS),r.bindMatrix.appendRotation(this.rotation.y,t.Vector3D.Y_AXIS),r.bindMatrix.appendRotation(this.rotation.z,t.Vector3D.Z_AXIS),r.bindMatrix.appendRotation(this.active.rotationY,t.Vector3D.Y_AXIS),r.bindMatrix.appendTranslation(n.x,n.y,n.z),this.particle.bindTarget=r}},i}(t.SkillEffect);t.SkillFixEffect=i}(tl3d||(tl3d={})),function(t){var e=function(e){function i(i){var a=e.call(this,i)||this;return a._currentPos=new t.Vector3D,a.rotationMatrix=new t.Matrix3D,a._socketMaxrix=new t.Matrix3D,a._currentTargetPos=new t.Vector3D,a}return __extends(i,e),i.prototype.update=function(t){this.path.update(t)},i.prototype.reset=function(){e.prototype.reset.call(this),this.endParticle&&(this.skillMgr.scene.addParticle(this.endParticle),this.endParticle.reset(),this.endParticle.setPos(this._currentTargetPos.x,this._currentTargetPos.y,this._currentTargetPos.z)),this.removeCallFun&&this.removeCallFun(this)},i.prototype.endPlayFun=function(e){void 0===e&&(e=null),this.skillMgr.scene.removeParticle(this.endParticle),this.endParticle.removeEventListener(t.BaseEvent.COMPLETE,this.endPlayFun,this)},i.prototype.setCurrentPos=function(){if(this.data.hitSocket){var t=this.target;return t&&(t.getSocket(this.data.hitSocket,this._socketMaxrix),this._currentTargetPos.setTo(this._socketMaxrix.position.x,this._socketMaxrix.position.y,this._socketMaxrix.position.z)),!0}return(this._currentTargetPos.x!=this.target.x||this._currentTargetPos.y!=this.target.y||this._currentTargetPos.z!=this.target.z)&&(this._currentTargetPos.setTo(this.target.x,this.target.y,this.target.z),!0)},i.prototype.addToRender=function(){var i;if(e.prototype.addToRender.call(this),0==this.data.beginType){var a=new t.Matrix3D;a.appendRotation(this.active.rotationY,t.Vector3D.Y_AXIS),i=a.transformVector(this.data.beginPos),this._currentPos.setTo(this.active.x+i.x,this.active.y+i.y,this.active.z+i.z)}else if(1==this.data.beginType){var n=new t.Matrix3D;this.active.getSocket(this.data.beginSocket,n),i=n.position,this._currentPos.setTo(i.x,i.y,i.z)}this.particle.setPos(this._currentPos.x,this._currentPos.y,this._currentPos.z),this.path.add()},i.prototype.getSocket=function(t,e){e.identity(),e.append(this.rotationMatrix),e.appendTranslation(this._currentPos.x,this._currentPos.y,this._currentPos.z)},i.prototype.getSunType=function(){return 0},i.prototype.setInfo=function(i){e.prototype.setInfo.call(this,i),this.particle.bindTarget=this,this.data=i,this.data.endParticleUrl&&(this.endParticle=t.ParticleManager.getInstance().getParticleByte(t.Scene_data.fileRoot+this.data.endParticleUrl),this.endParticle.addEventListener(t.BaseEvent.COMPLETE,this.endPlayFun,this))},i.prototype.setPlayData=function(e,i,a,n,r){var o=this;void 0===n&&(n=0),void 0===r&&(r=null),this.active=e,this.target=i,this.removeCallFun=a,this._currentPos.setTo(0,0,0),this.rotationMatrix.identity(),this._socketMaxrix.identity(),this._currentTargetPos.setTo(0,0,0),this.path||(this.path=t.PathManager.getNewPath(2),this.path.setData(this,(function(){o.reset()}),this._currentPos,this.rotationMatrix,this._currentTargetPos,r),this.path.speed=this.data.speed),this.path.reset()},i.prototype.destory=function(){e.prototype.destory.call(this),this.active=null,this.target=null,this.data=null,this._currentPos=null,this.rotationMatrix=null,this._socketMaxrix=null,this._currentTargetPos=null,this.path=null},i}(t.SkillKey);t.SkillTrajectory=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.update=function(t){this.pathMul.update(t)},i.prototype.getSunType=function(){return 1},i.prototype.addToRender=function(){if(this.particle){if(this.particle.reset(),this.skillMgr.scene.addParticle(this.particle),this.currentPosList)for(e=0;e<this.activeList.length;e++)this.currentPosList[e].setTo(this.activeList[e].x,this.activeList[e].y+10,this.activeList[e].z+5),this.currentPosList[e].w=0;else{this.currentPosList=new Array;for(var e=0;e<this.activeList.length;e++)this.currentPosList.push(new t.Vector3D(this.activeList[e].x,this.activeList[e].y+10,this.activeList[e].z+5));this.pathMul.setInitCurrentPos(this.currentPosList)}this.pathMul.add(),this.particle.setMulPos(this.pathMul.resultAry)}},i.prototype.setMulPlayData=function(e,i,a,n){var r=this;void 0===n&&(n=0),this.activeList=e,this.active=this.activeList[0],this.target=i,this.removeCallFun=a,this._currentPos.setTo(0,0,0),this.rotationMatrix.identity(),this._socketMaxrix.identity(),this._currentTargetPos.setTo(0,0,0),this.pathMul||(this.pathMul=t.PathManager.getNewPath(n),this.pathMul.setData(this,(function(){r.reset()}),this._currentPos,this.rotationMatrix,this._currentTargetPos),this.pathMul.speed=this.data.speed),this.pathMul.reset()},i.prototype.getMulSocket=function(t){t&&this.pathMul.applyData(t)},i}(t.SkillTrajectory);t.SkillMulTrajectory=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.reg=function(t,e){this.dic[t]=e},e.getNewPath=function(t){return new(0,this.dic[t])},e.init=function(){this.dic[0]=t.SkillPath,this.dic[1]=t.SkillSinPath,this.dic[2]=t.SkillCosPath},e.dic=new Object,e}();t.PathManager=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._currentDirect=new t.Vector3D}return e.prototype.update=function(e){if(this.time=e,this.hasReached)return this.endTime+=e,void(this.endTime>200&&this.applyArrive());if(this.skillTrajectory.setCurrentPos()&&(this._currentDirect.x=this.currentTargetPos.x-this.currentPos.x,this._currentDirect.y=this.currentTargetPos.y-this.currentPos.y,this._currentDirect.z=this.currentTargetPos.z-this.currentPos.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.setRotationMatrix(this.currentTargetPos.subtract(this.currentPos)),0==this._currentDirect.length))this.arrive();else{var i=this._currentDirect.length*this.time;if(!this.hasReached){var a=t.Vector3D.distance(this.currentPos,this.currentTargetPos);this.currentPos.x+=this._currentDirect.x*this.time,this.currentPos.y+=this._currentDirect.y*this.time,this.currentPos.z+=this._currentDirect.z*this.time}i>a&&this.arrive()}},e.prototype.setRotationMatrix=function(e){e.normalize();var i=new t.Vector3D(0,0,1),a=i.cross(e);a.normalize();var n=Math.acos(e.dot(i)),r=new t.Quaternion;r.fromAxisAngle(a,n),r.toMatrix3D(this.rotationMatrix)},e.prototype.arrive=function(){this.hasReached=!0},e.prototype.applyArrive=function(){this.endFun(),this.bloodFun&&this.bloodFun()},e.prototype.reset=function(){this.hasReached=!1,this._currentDirect.setTo(0,0,0),this.endTime=0},e.prototype.add=function(){},e.prototype.setData=function(t,e,i,a,n,r){this.skillTrajectory=t,this.currentPos=i,this.rotationMatrix=a,this.currentTargetPos=n,this.endFun=e,this.bloodFun=r},e}();t.SkillPath=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastTime=0,t}return __extends(i,e),i.prototype.setInitCurrentPos=function(t){this.currentPosAry=t,this.allTimeList=new Array;for(var e=0;e<t.length;e++)this.allTimeList.push(0)},i.prototype.add=function(){this.skillTrajectory.setCurrentPos(),this.directAry=new Array;for(var e=0,i=0;i<this.currentPosAry.length;i++){var a=new t.Vector3D;a.x=this.currentTargetPos.x-this.currentPosAry[i].x,a.y=this.currentTargetPos.y-this.currentPosAry[i].y,a.z=this.currentTargetPos.z-this.currentPosAry[i].z;var n=a.length;n>e&&(e=n,this.maxV3d=this.currentPosAry[i]),this.allTimeList[i]=n/this.speed,a.normalize(),a.scaleBy(this.speed),this.directAry.push(a)}this.alltime=e/this.speed,this.setAllData()},i.prototype.setAllData=function(){var e=t.Util.float2int(this.alltime/33)+8;this.resultAry=new Array;for(var i=0;i<this.currentPosAry.length;i++){var a=new Array;this.resultAry.push(a);for(var n=this.directAry[i],r=0;r<6;r++)a.push([this.currentPosAry[i].x,this.currentPosAry[i].y,this.currentPosAry[i].z]);for(var o=0;o<e;o++){this.lastTime=33*o;var s,h,c=this.lastTime/this.allTimeList[i],u=c;if(c>=1?(u=0,s=[this.currentTargetPos.x,this.currentTargetPos.y,this.currentTargetPos.z]):(u-=u*u,u*=250,s=[n.x*this.lastTime+this.currentPosAry[i].x,n.y*this.lastTime+u+this.currentPosAry[i].y,n.z*this.lastTime+this.currentPosAry[i].z]),0==o)h=[0,1,0];else{var l=a[2*o-2];h=[s[0]-l[0],s[1]-l[1],s[2]-l[2]];var d=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);h[0]/=d,h[1]/=d,h[2]/=d}a.push(s,h)}}},i.prototype.update=function(e){if(this.time=e,this.lastTime+=e,this.hasReached)return this.endTime+=e,void(this.endTime>200&&this.applyArrive());this.skillTrajectory.setCurrentPos();for(var i=0;i<this.currentPosAry.length;i++){var a=this.lastTime/this.allTimeList[i];a-=a*a,a*=250;var n=this.currentPosAry[i];if(this._currentDirect.x=this.currentTargetPos.x-n.x,this._currentDirect.y=this.currentTargetPos.y-n.y,this._currentDirect.z=this.currentTargetPos.z-n.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.maxV3d==n&&(this.setRotationMatrix(this.currentTargetPos.subtract(n)),0==this._currentDirect.length))return void this.arrive();var r=this._currentDirect.length*this.time;if(!this.hasReached){var o=t.Vector3D.distance(n,this.currentTargetPos);n.x+=this._currentDirect.x*this.time,n.y+=this._currentDirect.y*this.time,n.z+=this._currentDirect.z*this.time,n.w=a}this.maxV3d==n&&r>o&&this.arrive()}this.currentPos.setTo(this.currentPosAry[0].x,this.currentPosAry[0].y+this.currentPosAry[0].w,this.currentPosAry[0].z)},i.prototype.setData=function(t,i,a,n,r){e.prototype.setData.call(this,t,i,a,n,r,null),this.skillMul=t},i.prototype.applyData=function(t){for(var e=0;e<t.length;e++)t[e].setTo(this.currentPosAry[e].x,this.currentPosAry[e].y+this.currentPosAry[e].w,this.currentPosAry[e].z)},i.prototype.reset=function(){e.prototype.reset.call(this),this.lastTime=0},i}(t.SkillPath);t.SkillMulPath=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.basePos=new t.Vector3D,i}return __extends(i,e),i.prototype.add=function(){this.skillTrajectory.setCurrentPos();var e=new t.Vector3D;e.x=this.currentTargetPos.x-this.currentPos.x,e.y=this.currentTargetPos.y-this.currentPos.y,e.z=this.currentTargetPos.z-this.currentPos.z,this.basePos.setTo(this.currentPos.x,this.currentPos.y,this.currentPos.z),this.alltime=e.length/this.speed},i.prototype.update=function(e){if(this.time=e,this.lastTime+=e,this.hasReached)return this.endTime+=e,void(this.endTime>200&&this.applyArrive());this.skillTrajectory.setCurrentPos();var i=this.lastTime/this.alltime;i>1&&(i=1);var a=this.getOffset(i);if(this._currentDirect.x=this.currentTargetPos.x-this.basePos.x,this._currentDirect.y=this.currentTargetPos.y-this.basePos.y,this._currentDirect.z=this.currentTargetPos.z-this.basePos.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.setRotationMatrix(this.currentTargetPos.subtract(this.basePos)),0!=this._currentDirect.length){var n=this._currentDirect.length*this.time;if(!this.hasReached){var r=t.Vector3D.distance(this.basePos,this.currentTargetPos);this.basePos.x+=this._currentDirect.x*this.time,this.basePos.y+=this._currentDirect.y*this.time,this.basePos.z+=this._currentDirect.z*this.time,this.setApplyPos(a)}n>r&&this.arrive()}else this.arrive()},i.prototype.setApplyPos=function(t){this.currentPos.x=this.basePos.x+t.x,this.currentPos.y=this.basePos.y+t.y,this.currentPos.z=this.basePos.z+t.z},i.prototype.getOffset=function(e){return e=100*Math.sin(e*Math.PI),this._currentDirect.cross(new t.Vector3D(0,1,0)).scaleBy(e),new t.Vector3D},i.prototype.reset=function(){e.prototype.reset.call(this),this.lastTime=0},i}(t.SkillPath);t.SkillSinPath=e;var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.getOffset=function(e){return e=300*(e-e*e),this._currentDirect.cross(new t.Vector3D(0,-1,0)).scaleBy(e),new t.Vector3D},i}(e);t.SkillCosPath=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this.frame=0}return t.prototype.setData=function(t){this.frame=t.frame,this.url=t.url},t}();t.SkillKeyVo=e;var i=function(){function e(){}return e.prototype.setData=function(e){this.time=e.time*t.Scene_data.frameTime,this.lasttime=e.lasttime*t.Scene_data.frameTime,this.amp=e.amp},e}();t.SkillShockVo=i;var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.setData=function(i){e.prototype.setData.call(this,i),this.hasSocket=i.hasSocket,this.hasSocket?this.socket=i.socket:(this.pos=new t.Vector3D(i.pos.x,i.pos.y,i.pos.z),this.rotation=new t.Vector3D(i.rotation.x,i.rotation.y,i.rotation.z))},i}(e);t.SkillFixEffectKeyVo=a;var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.setData=function(i){e.prototype.setData.call(this,i),this.beginType=i.beginType,0==this.beginType?this.beginPos=new t.Vector3D(i.beginPos.x,i.beginPos.y,i.beginPos.z):1==this.beginType&&(this.beginSocket=i.beginSocket),this.speed=i.speed,i.hitSocket&&(this.hitSocket=i.hitSocket),i.endParticle&&(this.endParticleUrl=i.endParticle),this.multype=i.multype},i}(e);t.SkillTrajectoryTargetKeyVo=n}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.prototype.setData=function(e){this.keyAry=new Array,this.action=e.action,this.skillname=e.skillname,this.bloodTime=e.blood,this.types=e.type,this.types==i.FixEffect?this.keyAry=this.getFixEffect(e.data):this.types!=i.TrajectoryDynamicTarget&&this.types!=i.TrajectoryDynamicPoint||(this.keyAry=this.getTrajectoryDynamicTarget(e.data)),e.sound&&(this.sound=new t.SkillKeyVo,this.sound.frame=e.sound.time*t.Scene_data.frameTime,this.sound.url=e.sound.name),e.shock&&(this.shockAry=this.getShockAry(e.shock))},e.prototype.getShockAry=function(e){for(var i=new Array,a=0;a<e.length;a++){var n=new t.SkillShockVo;n.setData(e[a]),i.push(n)}return i},e.prototype.getFixEffect=function(e){for(var i=new Array,a=0;a<e.length;a++){var n=new t.SkillFixEffectKeyVo;n.setData(e[a]),i.push(n)}return i},e.prototype.getTrajectoryDynamicTarget=function(e){for(var i=new Array,a=0;a<e.length;a++){var n=new t.SkillTrajectoryTargetKeyVo;n.setData(e[a]),i.push(n)}return i},e.defaultBloodTime=250,e}();t.SkillVo=e;var i=function(){function t(){}return t.TrajectoryDynamicTarget=1,t.FixEffect=4,t.TrajectoryDynamicPoint=3,t}();t.SkillType=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.A_HIGHT_F="A_hight_f",t.TAB_HIGHT="Tab_hight",t.A_HIGHT_C="A_hight_c",t.A_DELETEBTN="A_deletebtn",t.A_ZHENQI="A_zhenqi",t.A_SHOULING="A_SHOULING",t.A_JINGHUA="A_JINGHUA",t.A_JIANTOU="A_jiantou",t.A_WUPINKUANG="A_wupinkuang",t.A_BLACK_C="A_black_c",t.A_BLACK_F="A_black_f",t.A_BLACK_START="A_black_start",t.A_HIGHT_START="A_hight_start",t.A_BLACK_BASE="A_black_base ",t.A_RED_POINT="A_red_point",t.A_YINBI="A_yinbi",t.A_YUANBAO="A_yuanbao",t.A_BANGGONG="A_banggong",t.A_DOUHUN="A_DOUHUN",t.A_EXP="A_EXP",t.A_HONOR="A_HONOR",t.A_BANGYUAN="A_bangyuan",t.A_RIGHT_XING="A_RIGHT_XING",t.A_SSTART="A_SSTART",t.A_LEFT_XING="A_LEFT_XING",t.A_GOODS_PURPLE="A_GOODS_PURPLE",t.A_GOODS_BLUE="A_GOODS_BLUE",t.A_GOODS_RED="A_GOODS_RED",t.A_GOODS_GREEN="A_GOODS_GREEN",t.A_GOODS_WHITE="A_GOODS_WHITE",t.A_GOODS_ORANGE="A_GOODS_ORANGE",t.A_START_BG="A_START_BG",t.A_START="A_START",t.A_CHAIN="A_CHAIN",t.A_OK="A_OK",t.A_QIANWANG="A_QIANWANG",t.T_LEFT="T_LEFT",t.T_MID="T_MID",t.T_RIGHT="T_RIGHT",t.E_LEFT="E_LEFT",t.E_MID="E_MID",t.E_RIGHT="E_RIGHT",t.F_LEFT="F_LEFT",t.F_MID="F_MID",t.F_RIGHT="F_RIGHT",t.A_F_22="A_F_22",t.A_BLACK_BASE_66="A_BLACK_BASE_66 ",t.A_HIGHR_C_66="A_HIGHR_C_66",t.A_V="A_V",t.A_GIVING_BG="A_GIVING_BG",t.B_SUB="B_SUB",t.A_FACTION_ICON="A_FACTION_ICON",t.SELECT_1="SELECT_1",t.SELECT_0="SELECT_0",t.A_JIE="A_JIE",t.A_XING="A_XING",t.T_tips_txt_bg="T_tips_txt_bg",t.ITEMBG="ITEMBG",t.A_quest_top="A_quest_top",t.A_quest_mid="A_quest_mid",t.A_quest_bottom="A_quest_bottom",t.A_quest_ion0="A_quest_ion0",t.A_quest_ion1="A_quest_ion1",t.A_quest_ion2="A_quest_ion2",t.A_quest_ion3="A_quest_ion3",t.A_quest_finish="A_quest_finish",t.S_sys_tip0="S_sys_tip0",t.S_sys_tip1="S_sys_tip1",t.A_zhanli_label="A_zhanli_label",t.A_gou="A_gou",t.A_cha="A_cha",t.TYPE3="TYPE3",t.TYPE5="TYPE5",t.TYPE9="TYPE9",t.TYPE7="TYPE7",t.B_ZHUFUZHI="B_ZHUFUZHI",t.B_DABAOJI="B_DABAOJI",t.B_XIAOBAOJI="B_XIAOBAOJI",t.B_JINGYAN="B_JINGYAN",t.NewPicBg="NewPicBg",t.Select="Select",t.CostBg="CostBg",t.BG2="BG2",t.PropBg40="PropBg40",t.PropBg60="PropBg60",t.PropBg100="PropBg100",t.REWARD_BG1="REWARD_BG1",t.SKILL_BG68="SKILL_BG68",t.SKILL_BG58="SKILL_BG58",t.BG6="BG6",t.Slist_nselect="Slist_nselect",t.Slist_select="Slist_select",t.TXTBG="TXTBG",t.ARROW_TOP="ARROW_TOP",t.ARROW_RIGHT="ARROW_RIGHT",t.MASK="MASK",t.BTNADD="BTNADD",t.BOSSBG76="BOSSBG76",t.BOSSBG64="BOSSBG64",t.CIRCL74="CIRCL74",t.LISTITEMBG="LISTITEMBG",t.ADDITEM="ADDITEM",t.HASSEL="HASSEL",t.SKILL_LEV_BG="SKILL_LEV_BG",t.TITLEBG="TITLEBG",t.TITLEHIGHT="TITLEHIGHT",t.NEWLISTITEMBG="NEWLISTITEMBG",t.CHATBG="CHATBG",t.ITEMBIGBG="ITEMBIGBG",t.I1bg_2="I1bg_2",t.I1bg_1="I1bg_1",t.ARROWUP="ARROWUP",t.ARROWDOWN="ARROWDOWN",t.A_EQULEVBG="A_EQULEVBG",t.DISABLE="DISABLE",t.EQUBG="EQUBG",t.RESLISTBG="RESLISTBG",t.A_CARD_C="A_CARD_C",t.A_CARD_G="A_CARD_G",t.A_CARD_B="A_CARD_B",t.RESBG="RESBG",t.STATEUP_LISTBG="STATEUP_LISTBG",t.A_LEAGUELISTBG="A_LEAGUELISTBG",t.TEAMLISTBG="TEAMLISTBG",t.A_JJ0="A_JJ0",t.A_JJ1="A_JJ1",t.A_JJ2="A_JJ2",t.A_JJ3="A_JJ3",t.A_JJ4="A_JJ4",t.A_JJ5="A_JJ5",t.A_JJ6="A_JJ6",t.A_JJ7="A_JJ7",t.A_JJ8="A_JJ8",t.A_JJ9="A_JJ9",t.A_JJ10="A_JJ10",t}();t.PuiData=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._scale=1}return Object.defineProperty(e.prototype,"ui",{get:function(){return this._ui},set:function(e){this._ui=e,this._baseRect=new t.Rectangle(this._ui.x,this._ui.y,this._ui.width,this._ui.height)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this._ui.width=this._baseRect.width*this._scale,this._ui.height=this._baseRect.height*this._scale,this._ui.x=this._baseRect.x+(this._baseRect.width-this._ui.width)/2,this._ui.y=this._baseRect.y+(this._baseRect.height-this._ui.height)/2},enumerable:!0,configurable:!0}),e.prototype.destory=function(){this._ui=null,this._scale=null,this._baseRect=null},e.getPosByPanel=function(e,i,a){if(void 0===i&&(i=null),void 0===a&&(a=null),this.baseUIConatiner||(this.baseUIConatiner=new t.UIConatiner),this.baseUIConatiner.width=t.UIData.designWidth,this.baseUIConatiner.height=t.UIData.designHeight,this.baseUIConatiner.middle=0,this.baseUIConatiner.center=0,i)for(var n in i)this.baseUIConatiner[n]=i[n];this.baseUIConatiner.resize();var r=new t.Vector2D;return r.x=e.x+this.baseUIConatiner.x/t.UIData.Scale,r.y=e.y+this.baseUIConatiner.y/t.UIData.Scale,a&&(r.x=r.x-a.x/t.UIData.Scale,r.y=r.y-a.y/t.UIData.Scale),r},e}();t.UiTweenVo=e;var i=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.changeButSize=function(t){},t}();t.UiTweenScale=i;var a=function(){function e(){this._eventItem=new Array,this.lastTime=0,t.Scene_data.uiStage=new t.UIStage,t.Scene_data.uiBlankStage=new t.UIStage,this._canvas=document.createElement("canvas"),this._canvas.style.zIndex="3",this._canvas.width=200,this._canvas.height=200,this._canvas.style.left=200,this._canvas.style.top=300,this._ctx=this._canvas.getContext("2d"),this._ctx.textBaseline="top"}return e.getInstance=function(){var t=this;return this._instance||(this._instance=new e,e.popClikNameFun=function(e,i){void 0===i&&(i=0),t.uiClikName(e,i)}),this._instance},e.uiClikName=function(t,e){},e.prototype.getContext2D=function(t,e,i){return void 0===i&&(i=!0),this._canvas.width=t,this._canvas.height=e,this._ctx.clearRect(0,0,t,e),(i=!0)&&(this._ctx.textBaseline="top",this._ctx.textAlign="left"),this._ctx},e.prototype.getGrayImageDatabyImg=function(t){var i=e.getInstance().getContext2D(t.width,t.height,!1);i.drawImage(t,0,0);for(var a,n=i.getImageData(0,0,t.width,t.height),r=0;r<n.data.length;r+=4)a=Math.floor(.3*n.data[r+0])+Math.floor(.59*n.data[r+1])+Math.floor(.11*n.data[r+2]),n.data[r+0]=a,n.data[r+1]=a,n.data[r+2]=a;return n},e.prototype.makeCtxToGray=function(t,e){for(var i,a=t.getImageData(e.x,e.y,e.width,e.height),n=0;n<a.data.length;n+=4)i=.5*(i=Math.floor(.3*a.data[n+0])+Math.floor(.59*a.data[n+1])+Math.floor(.11*a.data[n+2]))+.5,a.data[n+0]=i,a.data[n+1]=i,a.data[n+2]=i;t.putImageData(a,e.x,e.y)},e.prototype.showCanvas=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._canvas.style.left=t,this._canvas.style.top=e,document.getElementById("root").appendChild(this._canvas)},e.prototype.init=function(){t.ProgrmaManager.getInstance().registe(t.UIShader.UI_SHADER,new t.UIShader),t.ProgrmaManager.getInstance().registe(t.UIImageShader.UI_IMG_SHADER,new t.UIImageShader),t.ProgrmaManager.getInstance().registe(t.UIMaskShader.UI_MASK_SHADER,new t.UIMaskShader),t.ProgrmaManager.getInstance().registe(t.Movie2DShader.MOVIE2D_SHADER,new t.Movie2DShader),t.ProgrmaManager.getInstance().registe(t.Sprite2DShader.SPRITE2D_SHADER,new t.Sprite2DShader),this._uiList=new Array,this._containerList=new Array,t.UIData.setDesignWH(960,540)},e.prototype.addUI=function(t){for(var e=0,i=this._uiList.length-1;i>=0;i--)if(this._uiList[i].sortnum<=t.sortnum){e=i+1;break}this._uiList.splice(e,0,t),t.rendering=!0},e.prototype.removeUI=function(t){var e=this._uiList.indexOf(t);t.rendering=!1,-1!=e&&this._uiList.splice(e,1)},e.prototype.addUIContainer=function(t){if(!t.hasStage){this._containerList.push(t),t.resize();for(var e=0;e<t.renderList.length;e++)this.addUI(t.renderList[e]);t.hasStage=!0}},e.prototype.removeAll=function(){for(;this._containerList.length;)this.removeUIContainer(this._containerList[this._containerList.length-1])},e.prototype.removeUIContainer=function(t){if(t.hasStage){var e=this._containerList.indexOf(t);t.hasStage=!1,-1!=e&&this._containerList.splice(e,1);for(var i=0;i<t.renderList.length;i++)this.removeUI(t.renderList[i])}},e.prototype.hasWindowUI=function(){return!1},e.prototype.removeNoInterfaceUI=function(){for(var t=this._containerList.length-1;t>=0;t--)this._containerList[t].interfaceUI||this.removeUIContainer(this._containerList[t])},e.prototype.resize=function(){if(this._uiList){t.UIData.resize();for(var e=0;e<this._uiList.length;e++)this._uiList[e].resize();for(e=0;e<this._containerList.length;e++)this._containerList[e].resize()}},e.prototype.upBgGroundZero=function(){for(var t=0;t<this._uiList.length;t++)-1!=this._uiList[t].container.layer&&-1!=this._uiList[t].sortnum||this._uiList[t].update()},e.prototype.update=function(){for(var t=0;t<this._uiList.length;t++)this._uiList[t].container.layer>=0&&-1!=this._uiList[t].sortnum&&this._uiList[t].update()},e.prototype.regEvent=function(t){},e.prototype.onTouch=function(t){this.interactiveEvent(t)},e.prototype.onMouse=function(t){this.interactiveEvent(t)},e.prototype.interactiveEvent=function(e){var i,a=new t.Vector2D;if(e instanceof MouseEvent)e.type==t.MouseType.MouseDown?i=new t.InteractiveEvent(t.InteractiveEvent.Down):e.type==t.MouseType.MouseUp?i=new t.InteractiveEvent(t.InteractiveEvent.Up):e.type==t.MouseType.MouseMove?i=new t.InteractiveEvent(t.InteractiveEvent.Move):(e.type,t.MouseType.MouseClick),a.x=e.pageX,a.y=e.pageY;else if(e.type==t.MouseType.TouchStart?(i=new t.InteractiveEvent(t.InteractiveEvent.Down),e.touches.length>1?(a.x=e.touches[e.touches.length-1].pageX,a.y=e.touches[e.touches.length-1].pageY):(a.x=e.pageX,a.y=e.pageY)):e.type==t.MouseType.TouchEnd?(i=new t.InteractiveEvent(t.InteractiveEvent.Up),a.x=e.changedTouches[0].pageX,a.y=e.changedTouches[0].pageY):e.type==t.MouseType.TouchMove&&(e.touches.length>1?((i=new t.InteractiveEvent(t.InteractiveEvent.Pinch)).data=t.MathClass.math_distance(e.touches[0].clientX,e.touches[0].clientY,e.touches[1].clientX,e.touches[1].clientY)/this.lastSwipeDis,i.roation=180*(Math.atan2(e.touches[1].clientY-e.touches[0].clientY,e.touches[1].clientX-e.touches[0].clientX)-this.lastSwipeRot)/Math.PI):i=new t.InteractiveEvent(t.InteractiveEvent.Move),a.x=e.pageX,a.y=e.pageY),e.touches.length)for(var n=0;n<e.touches.length;n++)a.x=e.touches[n].clientX,a.y=e.touches[n].clientY;this.mouseEvetData(i,a)},e.prototype.disMoveNnum=function(e,i){return t.Vector2D.distance(e,this.lastMousePos)<i},e.prototype.mouseEvetData=function(i,a){e.cando=!0,t.Scene_data.verticalScene?(i.x=a.y,i.y=t.Scene_data.stageHeight-a.x):(i.x=a.x,i.y=a.y);var n=!1;if(!n)for(var r=this._uiList.length-1;r>=0;r--)if(this._uiList[r]&&0==this._uiList[r].container.interfaceUI&&this._uiList[r]&&this._uiList[r].interactiveEvent(i)){n=!0;break}if(!n)for(r=this._uiList.length-1;r>=0;r--)if(this._uiList[r]&&1==this._uiList[r].container.interfaceUI&&this._uiList[r]&&this._uiList[r].interactiveEvent(i)){n=!0;break}if(i.type==t.InteractiveEvent.Down){if(this.lastMousePos=new t.Vector2D(i.x,i.y),t.TimeUtil.getTimer()-this.lastTime<200)return!0;this.lastTime=t.TimeUtil.getTimer()}var o=t.Scene_data.uiStage.interactiveEvent(i);return!!n||(t.Scene_data.uiBlankStage.interactiveEvent(i),o)},e.prototype.setUseMouseEventCon=function(t){this._eventItem.length=0,t&&this._eventItem.push(t)},e.prototype.getObjectsUnderPoint=function(t){for(var e=this._uiList.length-1;e>=0;e--)if(this._uiList[e]&&this._uiList[e]&&this._uiList[e].insetUi(t))return this._uiList[e].insetUi(t);return null},e.prototype.getcurrentList=function(){for(var t=new Array,e=this._uiList.length-1;e>0;e--)if(this._eventItem.length)for(var i=0;i<this._eventItem.length;i++)this._eventItem[i]!=this._uiList[e].container||(t.push(this._uiList[e]),i=this._eventItem.length);else t.push(this._uiList[e]);return t},e.cando=!0,e}();t.UIManager=a}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.interactiveEvent=function(t){var e=t.type,i=this._eventsMap;if(!i)return!1;var a=i[e];if(!a)return!1;var n=a.length;if(0==n)return!1;for(var r=n-1;r>=0;r--){var o=a[r];o.listener.call(o.thisObject,t)}return!0},e}(t.EventDispatcher);t.UIStage=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.Down="down",e.Up="Up",e.Move="Move",e.PinchStart="PinchStart",e.Pinch="Pinch",e}(t.BaseEvent);t.InteractiveEvent=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom",t}();t.TextAlign=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._hasDispose=!1}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),e.prototype.setInfo=function(e,i,a,n){var r=this;void 0===n&&(n=null),this._useImgUrl=n,t.LoadManager.getInstance().load(t.Scene_data.fileRoot+e,t.LoadManager.XML_TYPE,(function(t){var e=JSON.parse(t);r.configData=e.uiArr,r.layoutData=e.panelArr,r.loadImgUrl(i,a)}))},e.prototype.loadConfig=function(e,i){var a=this;t.LoadManager.getInstance().load(t.Scene_data.fileRoot+e,t.LoadManager.XML_TYPE,(function(t){var e=JSON.parse(t);a.configData=e.uiArr,i()}))},e.prototype.loadImgUrl=function(e,i){var a=this;t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+e,(function(t){a.textureRes=t,a._useImgUrl?a.loadUseImg(i):i()}),1,null,0)},e.prototype.loadUseImg=function(e){this.useImg=t.Util.makeImage(),this.useImg.onload=function(){e()},this.useImg.src=t.Scene_data.fileRoot+this._useImgUrl},e.prototype.getRec=function(e){for(var i=new t.UIRectangle,a=0;a<this.configData.length;a++)if(this.configData[a].name==e){i.x=this.configData[a].x,i.y=this.configData[a].y,i.width=this.configData[a].width,i.height=this.configData[a].height,i.pixelWitdh=this.configData[a].ow,i.pixelHeight=this.configData[a].oh,i.pixelX=this.configData[a].ox,i.pixelY=this.configData[a].oy,i.type=this.configData[a].type,i.cellX=this.configData[a].cellX,i.cellY=this.configData[a].cellY;break}return i},e.prototype.getLayoutData=function(t){if(!this.layoutData)return null;for(var e in this.layoutData)for(var i=this.layoutData[e].item,a=0;a<i.length;a++)if(i[a].name==t)return i[a]},e.prototype.getGridRec=function(e){for(var i=new t.UIGridRentangle,a=0;a<this.configData.length;a++)if(this.configData[a].name==e){i.x=this.configData[a].x,i.y=this.configData[a].y,i.width=this.configData[a].width,i.height=this.configData[a].height,i.pixelWitdh=this.configData[a].ow,i.pixelHeight=this.configData[a].oh,i.pixelX=this.configData[a].ox,i.pixelY=this.configData[a].oy,i.ogw=this.configData[a].uow,i.ogh=this.configData[a].uoh;break}return i},Object.defineProperty(e.prototype,"hasData",{get:function(){return this.configData},enumerable:!0,configurable:!0}),e.prototype.getObject=function(t,e,i,a,n,r,o,s,h){void 0===s&&(s=0),void 0===h&&(h=0);var c=new Object;return c.x=e/r,c.y=i/o,c.width=a/r,c.height=n/o,c.ow=a,c.oh=n,c.ox=e,c.oy=i,c.name=t,c.cellX=s,c.cellY=h,c},e.prototype.updateCtx=function(e,i,a){t.TextureManager.getInstance().updateTexture(this.texture,i,a,e)},e.prototype.upDataPicToTexture=function(e,i){var a=this;t.LoadManager.getInstance().load(t.Scene_data.fileRoot+e,t.LoadManager.IMG_TYPE,(function(e){var n=a.getRec(i);a.ctx=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),a.ctx.drawImage(e,0,0,n.pixelWitdh,n.pixelHeight),t.TextureManager.getInstance().updateTexture(a.texture,n.pixelX,n.pixelY,a.ctx)}))},e.prototype.clearCtxTextureBySkilname=function(e){var i=this.getRec(e);this.ctx=t.UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),this.ctx.clearRect(0,0,i.pixelWitdh,i.pixelHeight),t.TextureManager.getInstance().updateTexture(this.texture,i.pixelX,i.pixelY,this.ctx)},e.prototype.copyPicToTexture=function(e,i){var a=this.getRec(e),n=this.getRec(i);this.ctx=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),this.ctx.drawImage(this.useImg,a.pixelX,a.pixelY,a.pixelWitdh,a.pixelWitdh,0,0,n.pixelWitdh,n.pixelWitdh),t.TextureManager.getInstance().updateTexture(this.texture,n.pixelX,n.pixelY,this.ctx)},e.prototype.updateLable=function(e,i,a,n,r,o,s,h){void 0===r&&(r="middle"),void 0===o&&(o="center"),void 0===s&&(s=!1),void 0===h&&(h=0);var c=this.getRec(e);this.ctx=this.getTextCtx(c,a,n,s,r,o);var u=this.getTextxpos(o,this.ctx),l=this.getTextypos(r,this.ctx);h>0?this.wrapText(this.ctx,i,u,l,h,a+3):this.ctx.fillText(i,u,l),t.TextureManager.getInstance().updateTexture(this.texture,c.pixelX,c.pixelY,this.ctx)},e.prototype.updateArtNum=function(e,i,a){var n=String(a),r=this.getRec(e),o=this.getRec(i);this.ctx=t.UIManager.getInstance().getContext2D(r.pixelWitdh,r.pixelHeight,!1);for(var s=o.pixelWitdh/10,h=0;h<n.length;h++){var c=Number(n.charAt(h));this.ctx.drawImage(this.useImg,o.pixelX+c*s,o.pixelY,s,o.pixelHeight,h*s,0,s,o.pixelHeight)}t.TextureManager.getInstance().updateTexture(this.texture,r.pixelX,r.pixelY,this.ctx)},e.prototype.writeSingleLabel=function(e,i,a,n,r){void 0===a&&(a=12),void 0===n&&(n=t.TextAlign.CENTER),void 0===r&&(r="#ffffff"),t.LabelTextFont.writeSingleLabel(this,e,i,a,n,r)},e.prototype.writeSingleLabelToCxt=function(e,i,a,n,r){void 0===a&&(a=12),void 0===n&&(n=0),void 0===r&&(r=0),e.textBaseline="top",e.textAlign="left",e.font="bolder  "+a+"px "+t.UIData.font,t.TextRegExp.wrapText(e,i,"#ffffff",n,r,9999,20)},e.prototype.updateLableCtx=function(e,i,a,n,r,o,s,h,c,u){void 0===o&&(o="center"),void 0===s&&(s="middle"),void 0===h&&(h="#000000"),void 0===c&&(c="bolder"),void 0===u&&(u=0),e.textAlign=o,e.textBaseline=s,e.fillStyle=h,e.font=c+" "+r+"px "+t.UIData.font;var l=this.getTextxpos(o,e);u>0?this.wrapText(e,i,a,n,u,r+3):e.fillText(i,a+l,n)},e.prototype.getTextCtx=function(e,i,a,n,r,o){var s=t.UIManager.getInstance().getContext2D(e.pixelWitdh,e.pixelHeight,!1);return s.textBaseline=r,s.textAlign=o,s.fillStyle=a,s.font=(n?"bolder ":"")+" "+i+"px "+t.UIData.font,s},e.prototype.getTextxpos=function(e,i){var a=0;return e==t.TextAlign.LEFT?a=0:e==t.TextAlign.RIGHT?a=i.canvas.width:e==t.TextAlign.CENTER&&(a=i.canvas.width/2),a},e.prototype.getTextypos=function(e,i){var a=0;return e==t.TextAlign.BOTTOM?a=i.canvas.height:e==t.TextAlign.TOP?a=0:e==t.TextAlign.MIDDLE&&(a=i.canvas.height/2),a},e.prototype.wrapText=function(t,e,i,a,n,r){for(var o=e,s="",h=0;h<o.length;h++)if("\n"==o[h])t.fillText(s,i,a),s="",a+=r;else{var c=s+o[h]+" ";t.measureText(c).width>n?(t.fillText(s,i,a),s=o[h]+"",a+=r):s=c}t.fillText(s,i,a)},e.prototype.dispose=function(){this._hasDispose||(this.textureRes.clearUseNum(),this.configData=null,this.layoutData=null,this.useImg=null,this._hasDispose=!0)},e}();t.UIAtlas=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._rendering=!1,this.scale=1,this.sortnum=0,this.blenderMode=0,this.renderData=new Float32Array(0),this.renderData2=new Float32Array(0),this.num=0,this.visible=!0,this.initData()}return Object.defineProperty(e.prototype,"rendering",{get:function(){return this._rendering},set:function(t){if(this._rendering=t,this._uiList)for(var e=0;e<this._uiList.length;e++)this._uiList[e].rendering=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.textureRes?this.textureRes.texture:null},enumerable:!0,configurable:!0}),e.prototype.initData=function(){this._uiList=new Array,this.objData=new t.ObjData,this.shader=t.ProgrmaManager.getInstance().getProgram(t.UIShader.UI_SHADER),this.program=this.shader.program,this.uiProLocation=t.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=t.Scene_data.context3D.getLocation(this.program,"ui2")},e.prototype.resize=function(){},e.prototype.setImgUrl=function(e){var i=this;t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+e,(function(t){i.textureRes=t}))},e.prototype.setInfo=function(e,i,a){this.uiAtlas=new t.UIAtlas,this.uiAtlas.setInfo(e,i,(function(){a()}))},e.prototype.setAtlas=function(t){this.uiAtlas=t},e.prototype.creatComponent=function(e,i,a,n){var r=new t.UICompenent;return r.tr.sets(e,i,a,n),r.uiRender=this,r},e.prototype.getComponent=function(t){var e=this.uiAtlas.getLayoutData(t);if(e){var i=e.type;if(0==i){var a=this.creatBaseComponent(e.dataItem[0]);return a.width=e.rect.width,a.height=e.rect.height,a.x=e.rect.x,a.y=e.rect.y,a.baseRec=e.rect,a.name=t,a}if(1==i){var n=this.creatGrid9Component(e.dataItem[0],e.rect.width,e.rect.height);return n.x=e.rect.x,n.y=e.rect.y,n.baseRec=e.rect,n.name=t,n}if(2==i);else if(4==i){var r=this.createFrame(e.dataItem[0]);return r.width=e.rect.width,r.height=e.rect.height,r.x=e.rect.x,r.y=e.rect.y,r.baseRec=e.rect,r.name=t,r}}return null},e.prototype.createFrame=function(e){var i=new t.FrameCompenent;i.skinName=e;var a=this.uiAtlas.getRec(e);return i.setFrameData(a),i.stopStatic,i.uiRender=this,i},e.prototype.creatBaseComponent=function(e){var i=new t.UICompenent;i.skinName=e;var a=this.uiAtlas.getRec(e);return i.tr.setRec(a),i.width=a.pixelWitdh,i.height=a.pixelHeight,i.uiRender=this,i},e.prototype.creatGrid9Component=function(e,i,a){var n=new t.Grid9Compenent;n.skinName=e;var r=this.uiAtlas.getGridRec(e);return n.tr.setRec(r),n.ogw=r.ogw,n.ogh=r.ogh,n.gw=n.ogw/r.pixelWitdh,n.gh=n.ogh/r.pixelHeight,n.width=i,n.height=a,n.uiRender=this,n},e.prototype.addRenderUI=function(t){this._uiList.length>=50?alert("UIRenderComponent超限制51"):(this._uiList.push(t),t.rendering=this.rendering,this.applyObjData())},e.prototype.removeRenderUI=function(t){var e=this._uiList.indexOf(t);-1!=e&&this._uiList.splice(e,1),t.rendering=!1,this.applyObjData()},e.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var e=0,i=0;i<this._uiList.length;i++){var a=this._uiList[i];a.isVirtual||(e=a.pushVaData(this.objData,i,e))}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),t.Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),t.Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)),this.mask&&(this.mask.scale=this.scale,this.mask.applyAbsolutePoint()),this.makeRenderDataVc(-1)},e.prototype.makeRenderDataVc=function(t){if((!this.renderData||this.renderData&&this.renderData.length!=4*this._uiList.length)&&(this.renderData=new Float32Array(4*this._uiList.length),this.renderData2=new Float32Array(4*this._uiList.length)),-1==t)for(var e=0;this._uiList&&e<this._uiList.length;e++)this._uiList[e].vcId=e,this.renderData[4*e+0]=this._uiList[e].renderData[0],this.renderData[4*e+1]=this._uiList[e].renderData[1],this.renderData[4*e+2]=this._uiList[e].renderData[2],this.renderData[4*e+3]=this._uiList[e].renderData[3],this.renderData2[4*e+0]=this._uiList[e].renderData2[0],this.renderData2[4*e+1]=this._uiList[e].renderData2[1],this.renderData2[4*e+2]=this._uiList[e].renderData2[2],this.renderData2[4*e+3]=this._uiList[e].renderData2[3];else t<this._uiList.length&&(this.renderData[4*t+0]=this._uiList[t].renderData[0],this.renderData[4*t+1]=this._uiList[t].renderData[1],this.renderData[4*t+2]=this._uiList[t].renderData[2],this.renderData[4*t+3]=this._uiList[t].renderData[3],this.renderData2[4*t+0]=this._uiList[t].renderData2[0],this.renderData2[4*t+1]=this._uiList[t].renderData2[1],this.renderData2[4*t+2]=this._uiList[t].renderData2[2],this.renderData2[4*t+3]=this._uiList[t].renderData2[3])},e.prototype.update=function(){if(this.visible&&0!=this._uiList.length||this.modelRenderList&&this.modelRenderList.length){if(this.mask){var e=t.Scene_data.context3D.renderContext;e.enable(e.STENCIL_TEST),e.stencilMask(255),e.stencilFunc(e.NEVER,this.mask.level,255),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),this.mask.update(),e.stencilFunc(e.LESS,this.mask.level-1,255),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}if(t.Scene_data.context3D.setBlendParticleFactors(this.blenderMode),t.Scene_data.context3D.setProgram(this.program),this.setVc(),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.setTextureToGpu(),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum),this.mask&&t.Scene_data.context3D.renderContext.disable(t.Scene_data.context3D.renderContext.STENCIL_TEST),this.modelRenderList)for(var i=0;i<this.modelRenderList.length;i++)this.modelRenderList[i].update()}},e.prototype.setTextureToGpu=function(){this.uiAtlas?t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.uiAtlas.texture,0):t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0)},e.prototype.setVc=function(){for(var e=0;e<this._uiList.length;e++)this._uiList[e].update(),this._uiList[e].vcId;t.Scene_data.context3D.setVc4fvLocation(this.uiProLocation,this.renderData),t.Scene_data.context3D.setVc4fvLocation(this.ui2ProLocation,this.renderData2)},e.prototype.addModel=function(t){this.modelRenderList||(this.modelRenderList=new Array),-1==this.modelRenderList.indexOf(t)&&this.modelRenderList.push(t)},e.prototype.removeModel=function(t){var e=this.modelRenderList.indexOf(t);-1!=e&&this.modelRenderList.splice(e,1)},e.prototype.insetUi=function(t){for(var e=0;e<this._uiList.length;e++)if(this._uiList[e].testPoint(t.x,t.y))return this._uiList[e];return null},e.prototype.interactiveEvent=function(e){if(this.mask&&!this.mask.testPoint(e.x,e.y))return!1;for(var i=!1,a=0;a<this._uiList.length;a++)if(this._uiList[a].interactiveEvent(e)&&t.UIManager.cando)return i=!0,t.UIManager.cando=!1,!0;return i},e.prototype.dispose=function(){this.objData.destory(),this.objData=null,this.uiAtlas&&(this.uiAtlas.dispose(),this.uiAtlas=null),this.mask&&(this.mask.dispose(),this.mask=null),this.renderData=null,this.renderData2=null},e}();t.UIRenderComponent=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._scaleData=[1,1],t._isFBO=!1,t.alpha=1,t}return __extends(i,e),i.prototype.initData=function(){this.objData=new t.ObjData,this.shader=t.ProgrmaManager.getInstance().getProgram(t.UIImageShader.UI_IMG_SHADER),this.program=this.shader.program,this.objData.vertices.push(-1,1,0,1,1,0,1,-1,0,-1,-1,0),this.objData.uvs.push(0,0,1,0,1,1,0,1),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=6,this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},i.prototype.resize=function(){this.appleyPos()},i.prototype.setImgInfo=function(t,e,i){this.setImgUrl(t),this._width=e,this._height=i},i.prototype.appleyPos=function(){var e=this._width/t.Scene_data.stageWidth,i=this._height/t.Scene_data.stageHeight;e<i?(this._scaleData[0]=1,this._scaleData[1]=this._height/t.Scene_data.stageHeight/e):(this._scaleData[0]=this._width/t.Scene_data.stageWidth/i,this._scaleData[1]=1)},i.prototype.setFbo=function(){this._isFBO=!0},i.prototype.update=function(){var e=!1;this._isFBO?(t.Scene_data.fbo&&(e=!0),t.Scene_data.context3D.clearContext(),t.Scene_data.context3D.setDepthTest(!1)):this.texture&&(e=!0),this.objData&&e&&(t.Scene_data.context3D.setBlendParticleFactors(0),t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),t.Scene_data.context3D.setVc2fv(this.shader,"scale",this._scaleData),this._isFBO?(t.Scene_data.context3D.setVc2fv(this.shader,"scale",[1,-1]),t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",t.Scene_data.fbo.texture,0)):t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),t.Scene_data.context3D.setVcFloat(this.shader,"alpha",[this.alpha]),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},i.prototype.interactiveEvent=function(t){return!0},i}(t.UIRenderComponent);t.UIBackImg=e;var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.makeRenderDataVc=function(t){e.prototype.makeRenderDataVc.call(this,t);for(var i=0;i<this.renderData2.length/4;i++)this.renderData2[4*i+0]=1,this.renderData2[4*i+1]=1,this.renderData2[4*i+2]=0,this.renderData2[4*i+3]=0},i.prototype.update=function(){this.texture&&e.prototype.update.call(this)},i.prototype.setTextureToGpu=function(){t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this.textureRes&&this.textureRes.clearUseNum()},i}(t.UIRenderComponent);t.UIRenderOnlyPicComponent=i}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._x=0,i._y=0,i._width=0,i._height=0,i.z=0,i.absoluteX=0,i.absoluteY=0,i.absoluteWidth=0,i.absoluteHeight=0,i.enable=!0,i._left=0,i._right=0,i._center=0,i._xType=-1,i._top=0,i._bottom=0,i._middle=0,i._yType=-1,i.renderX=0,i.renderY=0,i.renderWidth=0,i.renderHeight=0,i.scale=1,i.isVirtual=!1,i.vcId=0,i._uvScale=1,i._rendering=!1,i.isU=!1,i.isV=!1,i.tr=new t.Rectangle,i.mouseEnable=!0,i}return __extends(i,e),Object.defineProperty(i.prototype,"rendering",{get:function(){return this._rendering},set:function(t){this._rendering=t},enumerable:!0,configurable:!0}),i.prototype.addStage=function(){this.renderData=[0,0,0,0],this.renderData2=[1,1,0,0],this.applyAbsolutePoint(),this.uiRender.addRenderUI(this)},i.prototype.removeStage=function(){this.uiRender.removeRenderUI(this)},i.prototype.pushVaData=function(t,e,i){return t.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),t.uvs.push(this.isU?1:0,this.isV?1:0,e,this.isU?0:1,this.isV?1:0,e,this.isU?0:1,this.isV?0:1,e,this.isU?1:0,this.isV?0:1,e),t.indexs.push(i,1+i,2+i,i,2+i,3+i),i+4},i.prototype.setVc=function(e,i){t.Scene_data.context3D.setVc4fv(e,"ui["+i+"]",this.renderData),t.Scene_data.context3D.setVc4fv(e,"ui2["+i+"]",this.renderData2)},i.prototype.update=function(){},i.prototype.applyRenderSize=function(){if(this.parent){if(this.renderX=this.absoluteX/t.Scene_data.stageWidth,this.renderY=this.absoluteY/t.Scene_data.stageHeight,this.renderWidth=this.absoluteWidth/t.Scene_data.stageWidth,this.renderHeight=this.absoluteHeight/t.Scene_data.stageHeight,this._uvScale>=0)this.renderData[0]=this.renderX,this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth*this.scale*this._uvScale,this.renderData[3]=this.renderHeight*this.scale,this.renderData2[0]=this.tr.width*this._uvScale,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x,this.renderData2[3]=this.tr.y;else{var e=Math.abs(this._uvScale);this.renderData[0]=this.renderX+this.renderWidth*(1-e),this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth*this.scale*e,this.renderData[3]=this.renderHeight*this.scale,this.renderData2[0]=this.tr.width*e,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x+this.tr.width*(1-e),this.renderData2[3]=this.tr.y}this.uiRender.makeRenderDataVc(this.vcId)}},Object.defineProperty(i.prototype,"uvScale",{get:function(){return this._uvScale},set:function(t){this._uvScale=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),i.prototype.setScale=function(t){this.scale=t,this.applyAbsolutePoint()},i.prototype.applyAbsolutePoint=function(){this.parent&&(-1==this._xType?this.absoluteX=this._x*t.UIData.Scale*this.scale+this.parent.x:0==this._xType?this.absoluteX=this._left*t.UIData.Scale:1==this._xType?this.absoluteX=t.Scene_data.stageWidth-this._right*t.UIData.Scale-this.width*t.UIData.Scale:2==this._xType&&(this.absoluteX=this._center*t.UIData.Scale+t.Scene_data.stageWidth/2-this.width*t.UIData.Scale/2),-1==this._yType?this.absoluteY=this._y*t.UIData.Scale*this.scale+this.parent.y:0==this._yType?this.absoluteY=this._top*t.UIData.Scale:1==this._yType?this.absoluteY=t.Scene_data.stageHeight-this._bottom*t.UIData.Scale-this.height*t.UIData.Scale:2==this._yType&&(this.absoluteY=this._middle*t.UIData.Scale+t.Scene_data.stageHeight/2-this.height*t.UIData.Scale/2),this.absoluteWidth=this.width*t.UIData.Scale,this.absoluteHeight=this.height*t.UIData.Scale,this.applyRenderSize())},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){t!=this._x&&(this._x=t,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){t!=this._y&&(this._y=t,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){t!=this._width&&(this._width=t,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){t!=this._height&&(this._height=t,this.applyAbsolutePoint())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{set:function(t){this._left=t,this._xType=0,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{set:function(t){this._right=t,this._xType=1,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{set:function(t){this._center=t,this._xType=2,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{set:function(t){this._top=t,this._yType=0,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{set:function(t){this._bottom=t,this._yType=1,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"middle",{set:function(t){this._middle=t,this._yType=2,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),i.prototype.testPoint=function(t,e){return t>this.absoluteX&&t<this.absoluteX+this.absoluteWidth&&e>this.absoluteY&&e<this.absoluteY+this.absoluteHeight},i.prototype.setPos=function(t,e){this.x=t,this.y=e},i.prototype.interactiveEvent=function(t){if(!this.enable)return!1;t.type;var e=this._eventsMap;if(!e)return!1;var i=e[t.type];if(!i)return!1;if(!this.testPoint(t.x,t.y))return!1;var a=i.length;if(0==a)return!1;t.target=this;for(var n=a-1;n>=0;n--){var r=i[n];r.listener.call(r.thisObject,t)}return!0},i.prototype.preShow=function(){this.preParent&&this.preParent.addChild(this)},i.prototype.preHide=function(){this.preParent&&this.preParent.removeChild(this)},i}(t.EventDispatcher);t.UICompenent=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._x=0,this._y=0,this._width=0,this._height=0,this._left=0,this._right=0,this._center=0,this._xType=0,this._top=0,this._bottom=0,this._middle=0,this._yType=0,this._list=new Array,this.renderList=new Array,this._hasStage=!1,this._hasLoad=!1,this._isLoading=!1,this._needShowLoading=!0,this._interfaceUI=!1,this._layer=100}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(t){this._layer=t;for(var e=0;e<this.renderList.length;e++)this.renderList[e].sortnum=this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interfaceUI",{get:function(){return this._interfaceUI},set:function(t){this._interfaceUI=t,this.layer=t?0:100},enumerable:!0,configurable:!0}),e.prototype.load=function(t,e){void 0===e&&(e=!0),this._isLoading||(this._completeFun=t,this._needShowLoading=e,this._hasLoad?t():(this._isLoading=!0,this.makeBaseWinUi()))},Object.defineProperty(e.prototype,"hasLoad",{get:function(){return this._hasLoad},enumerable:!0,configurable:!0}),e.prototype.makeBaseWinUi=function(){this.applyLoad()},e.prototype.applyLoad=function(){},e.prototype.applyLoadComplete=function(){this._isLoading=!1,this._completeFun(),this._hasLoad=!0},Object.defineProperty(e.prototype,"hasStage",{get:function(){return this._hasStage},set:function(t){this._hasStage=t,t?this.onAdd():this.onRemove()},enumerable:!0,configurable:!0}),e.prototype.setUiListVisibleByItem=function(t,e){try{for(var i=0;i<t.length;i++)e?t[i].parent||this.addChild(t[i]):t[i].parent&&this.removeChild(t[i])}catch(t){}},e.prototype.onAdd=function(){},e.prototype.onRemove=function(){},e.prototype.addChild=function(t){if(!t)throw new Error("ui cuo");if(!t.parent)return this._list.push(t),t.parent=this,t.addStage(),t},e.prototype.addVirtualContainer=function(t){this.virtualContainerList||(this.virtualContainerList=new Array),t.parent=this,this.virtualContainerList.push(t)},e.prototype.removeVirtualContainer=function(t){},e.prototype.addUIList=function(t,e){for(var i=new Array,a=0;a<t.length;a++){var n=e.getComponent(t[a]);this.addChild(n),i.push(n)}return i},e.prototype.getUIList=function(t,e){for(var i=new Array,a=0;a<t.length;a++){var n=e.getComponent(t[a]);i.push(n)}return i},e.prototype.addEvntBut=function(e,i){var a=this.addChild(i.getComponent(e));return a.addEventListener(t.InteractiveEvent.Down,this.butClik,this),a},e.prototype.addEvntButUp=function(e,i){var a=this.addChild(i.getComponent(e));return a.addEventListener(t.InteractiveEvent.Up,this.butClik,this),a},e.prototype.removeEvntBut=function(e){e.removeEventListener(t.InteractiveEvent.Down,this.butClik,this),this.removeChild(e)},e.prototype.butClik=function(t){},e.prototype.renderSetVisibel=function(t,e){for(var i=0;i<t.length;i++)e?t[i].rendering||this.addRender(t[i]):t[i].rendering&&this.removeRender(t[i])},e.prototype.removeChild=function(t){var e=this._list.indexOf(t);-1!=e&&(this._list.splice(e,1),t.parent=null,t.removeStage())},e.prototype.removeAll=function(){for(;this._list.length;)this.removeChild(this._list[0]);for(;this._maskList.length;)this.removeMaks(this._maskList[0])},e.prototype.addMask=function(t){this._maskList||(this._maskList=new Array),t.parent=this,t.applyAbsolutePoint(),this._maskList.push(t)},e.prototype.removeMaks=function(t){if(this._maskList){var e=this._maskList.indexOf(t);-1!=e&&this._maskList.splice(e,1)}},e.prototype.addRender=function(e){-1==this.renderList.indexOf(e)&&(e.container=this,e.sortnum=this._layer,this.renderList.push(e),this.hasStage&&t.UIManager.getInstance().addUI(e))},e.prototype.addRenderAt=function(e,i){-1==this.renderList.indexOf(e)&&(e.container=this,e.sortnum=this._layer,this.renderList.splice(i,0,e),this.hasStage&&t.UIManager.getInstance().addUI(e))},e.prototype.removeRender=function(e){var i=this.renderList.indexOf(e);-1!=i&&(this.renderList.splice(i,1),this.hasStage&&t.UIManager.getInstance().removeUI(e))},e.prototype.resize=function(){0==this._xType?this._x=this._left*t.UIData.Scale:1==this._xType?this._x=t.Scene_data.stageWidth-this._right*t.UIData.Scale-this.width*t.UIData.Scale:2==this._xType&&(this._x=this._center*t.UIData.Scale+t.Scene_data.stageWidth/2-this.width*t.UIData.Scale/2),0==this._yType?this._y=this._top*t.UIData.Scale:1==this._yType?this._y=t.Scene_data.stageHeight-this._bottom*t.UIData.Scale-this.height*t.UIData.Scale:2==this._yType&&(this._y=this._middle*t.UIData.Scale+t.Scene_data.stageHeight/2-this.height*t.UIData.Scale/2),this.applyChild(),this.resizeVirtualList()},e.prototype.resizeVirtualList=function(){if(this.virtualContainerList)for(var t=0;t<this.virtualContainerList.length;t++)this.virtualContainerList[t].resize()},Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(e){this._left=e,this._xType=0,this._x=this._left*t.UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(e){this._right=e,this._xType=1,this._x=t.Scene_data.stageWidth-this._right*t.UIData.Scale-this.width*t.UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{set:function(e){this._center=e,this._xType=2,this._x=this._center*t.UIData.Scale+t.Scene_data.stageWidth/2-this.width*t.UIData.Scale/2,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top},set:function(e){this._top=e,this._yType=0,this._y=this._top*t.UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._bottom},set:function(e){this._bottom=e,this._yType=1,this._y=t.Scene_data.stageHeight-this._bottom*t.UIData.Scale-this.height*t.UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"middle",{set:function(e){this._middle=e,this._yType=2,this._y=this._middle*t.UIData.Scale+t.Scene_data.stageHeight/2-this.height*t.UIData.Scale/2,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){if(0!=this._width)return this._width;for(var t=0,e=0;e<this._list.length;e++)t=Math.max(this._list[e].width);return t},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){if(0!=this._height)return this._height;for(var t=0,e=0;e<this._list.length;e++)t=Math.max(this._list[e].height);return t},set:function(t){this._height=t},enumerable:!0,configurable:!0}),e.prototype.applyChild=function(){for(var t=0;t<this._list.length;t++)this._list[t].applyAbsolutePoint();if(this._maskList)for(t=0;t<this._maskList.length;t++)this._maskList[t].applyAbsolutePoint()},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},e.prototype.setSizeForPanelUiCopy=function(t,e,i){var a=i.getComponent(e);t.x=a.x,t.y=a.y,t.width=a.width,t.height=a.height},e}();t.UIConatiner=e;var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){},e.prototype.clearOneTemp=function(){},e}(e);t.Dis2DUIContianerBase=i}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.init=function(t,e,i){return void 0===i&&(i=null),this._itemLoad=t,this._bFun=e,this.loadFun=i,this.loadBaseConfigCom(),t.length},e.loadBaseConfigCom=function(){for(var t=0;t<this._itemLoad.length;t++)this.loadUIdata(this._itemLoad[t].xmlurl,this._itemLoad[t].picurl,this._itemLoad[t].name,Boolean(this._itemLoad[t].isTexture))},e.loadOkNum=function(t){this.loadFun&&this.loadFun(t)},e.loadUIdata=function(e,i,a,n){var r=this;if(void 0===a&&(a="default"),void 0===n&&(n=!1),!n){var o=new Image;this._imgDic[a]=o,o.onload=function(t){r.loadOkd()}}t.LoadManager.getInstance().load(t.Scene_data.fileRoot+e,t.LoadManager.XML_TYPE,(function(e){var s=Array(JSON.parse(e))[0];r._dic[a]=s,n?t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+i,(function(t){r._imgDic[a]=t,r.loadOkd()}),1,null,0):o.src=t.Scene_data.fileRoot+i}))},e.loadOkd=function(){this._skipnum++,this.loadOkNum(this._skipnum),this._skipnum>=this._itemLoad.length&&this._bFun()},e._skipnum=0,e._dic=new t.Dictionary([]),e._imgDic=new t.Dictionary([]),e}();t.MainUiLoad=e;var i=function(){function e(){}return e.setDesignWH=function(t,e){this.designWidth=t,this.designHeight=e,this.resize()},e.resize=function(){this.Scale=Math.min(t.Scene_data.stageWidth/this.designWidth,t.Scene_data.stageHeight/this.designHeight)},e.init=function(t,e,i){return void 0===i&&(i=null),this._itemLoad=t,this._bFun=e,this.loadFun=i,this.loadBaseConfigCom(),t.length},Object.defineProperty(e,"mainUIAtlas",{get:function(){return null},enumerable:!0,configurable:!0}),e.loadBaseConfigCom=function(){for(var t=0;t<this._itemLoad.length;t++)this.loadUIdata(this._itemLoad[t].xmlurl,this._itemLoad[t].picurl,this._itemLoad[t].name,Boolean(this._itemLoad[t].isTexture))},e.loadOkNum=function(t){this.loadFun&&this.loadFun(t)},e.loadUIdata=function(e,i,a,n){var r=this;if(void 0===a&&(a="default"),void 0===n&&(n=!1),!n){var o=new Image;this._imgDic[a]=o,o.onload=function(t){r.loadOkd()}}t.LoadManager.getInstance().load(t.Scene_data.fileRoot+e,t.LoadManager.XML_TYPE,(function(e){var s=Array(JSON.parse(e))[0];r._dic[a]=s,n?t.TextureManager.getInstance().getTexture(t.Scene_data.fileRoot+i,(function(t){r._imgDic[a]=t,r.loadOkd()}),1,null,0):o.src=t.Scene_data.fileRoot+i}))},e.loadOkd=function(){this._skipnum++,this.loadOkNum(this._skipnum),this._skipnum>=this._itemLoad.length&&(e.textImg=this._imgDic[e.flytext],this._bFun())},e.getImgByKey=function(t){return this._imgDic.containsKey(t)?this._imgDic[t]:null},e.getUiByName=function(t,e){if(this._dic.containsKey(t))for(var i=this._dic[t].uiArr,a=0;a<i.length;a++)if(i[a].name==e)return i[a];return null},e.getUiArrByKey=function(t){return this._dic.containsKey(t)?this._dic[t].uiArr:null},e.designWidth=960,e.designHeight=540,e.font="Helvetica",e._skipnum=0,e.publicUi="publicUi",e.flytext="flytext",e.publicsUi="publicsUi",e.faceItem=["/大笑","/脸2","/脸3","/脸4","/脸5","/脸6","/脸7","/脸8","/脸9","/脸a","/脸b","/脸c","/脸d","/脸e","/脸f","/脸g","/脸h","/脸i"],e._dic=new t.Dictionary([]),e._imgDic=new t.Dictionary([]),e}();t.UIData=i;var a=function(){function e(){}return e.drawUseImg=function(e,i,a){var n=e.uiRender.uiAtlas.getRec(e.skinName),r=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),o=i.getRec(a);r.drawImage(i.useImg,o.pixelX,o.pixelY,o.pixelWitdh,o.pixelHeight,0,0,n.pixelWitdh,n.pixelHeight),e.uiRender.uiAtlas.updateCtx(r,n.pixelX,n.pixelY)},e.clearUI=function(e){var i=e.uiRender.uiAtlas.getRec(e.skinName),a=t.UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1);e.uiRender.uiAtlas.updateCtx(a,i.pixelX,i.pixelY)},e.drawAttVal=function(i,a,n,r,o){void 0===r&&(r=t.TextAlign.LEFT),void 0===o&&(o=!1);var s="";void 0!==a?(s=t.ColorType.Orange7a2f21+t.UnitFunction.getKeyProById(a)+":  "+t.ColorType.Orange9a683f+t.UnitFunction.Snum(Math.floor(n/100)),o&&(s=t.ColorType.Orange7a2f21+t.UnitFunction.getKeyProById(a)+":  "+t.ColorType.Orange9a683f+"+"+t.UnitFunction.Snum(Math.floor(n/100))),t.LabelTextFont.writeSingleLabel(i.uiRender.uiAtlas,i.skinName,s,14,r)):e.clearUI(i)},e.drawAttValAdd=function(i,a,n){var r;void 0!==a?(r=t.ColorType.Orange7a2f21+t.UnitFunction.getKeyProById(a)+":    "+t.ColorType.Green2ca937+"+"+t.UnitFunction.Snum(Math.floor(n/100)),t.LabelTextFont.writeSingleLabel(i.uiRender.uiAtlas,i.skinName,r,14,t.TextAlign.LEFT)):e.clearUI(i)},e.drawResHasNumAndAllNum=function(t,e,i){return void 0===i&&(i=""),!1},e.cxtDrawImg=function(t,e,a,n){var r=i.getUiByName(n,e);r&&(0!=a.width&&0!=a.height||(a.width=r.ow,a.height=r.oh),0==r.type?t.drawImage(i.getImgByKey(n),r.ox,r.oy,r.ow,r.oh,a.x,a.y,a.width,a.height):1==r.type?(t.drawImage(i.getImgByKey(n),r.ox,r.oy,r.uow,r.uoh,a.x,a.y,r.uow,r.uoh),t.drawImage(i.getImgByKey(n),r.ox+r.uow,r.oy,r.ow-2*r.uow,r.uoh,a.x+r.uow,a.y,a.width-2*r.uow,r.uoh),t.drawImage(i.getImgByKey(n),r.ox+r.ow-r.uow,r.oy,r.uow,r.uoh,a.x+a.width-r.uow,a.y,r.uow,r.uoh),t.drawImage(i.getImgByKey(n),r.ox,r.oy+r.uoh,r.uow,r.oh-2*r.uoh,a.x,a.y+r.uoh,r.uow,a.height-2*r.uoh),t.drawImage(i.getImgByKey(n),r.ox+r.uow,r.oy+r.uoh,r.ow-2*r.uow,r.oh-2*r.uoh,a.x+r.uow,a.y+r.uoh,a.width-2*r.uow,a.height-2*r.uoh),t.drawImage(i.getImgByKey(n),r.ox+r.ow-r.uow,r.oy+r.uoh,r.uow,r.uoh,a.x+a.width-r.uow,a.y+r.uoh,r.uow,a.height-2*r.uoh),t.drawImage(i.getImgByKey(n),r.ox,r.oy+r.oh-r.uoh,r.uow,r.uoh,a.x,a.y+a.height-r.uoh,r.uow,r.uoh),t.drawImage(i.getImgByKey(n),r.ox+r.uow,r.oy+r.oh-r.uoh,r.ow-2*r.uow,r.uoh,a.x+r.uow,a.y+a.height-r.uoh,a.width-2*r.uow,r.uoh),t.drawImage(i.getImgByKey(n),r.ox+r.ow-r.uow,r.oy+r.oh-r.uoh,r.uow,r.uoh,a.x+a.width-r.uow,a.y+a.height-r.uoh,r.uow,r.uoh)):alert("UiDraw没有绘制成功  "+r.type))},e.uiAtlasDrawImg=function(e,a,n,r){var o=e.getRec(a);e.ctx=t.UIManager.getInstance().getContext2D(o.pixelWitdh,o.pixelHeight,!1);var s=i.getUiByName(n,r);s?(0==s.type?e.ctx.drawImage(i.getImgByKey(n),s.ox,s.oy,s.ow,s.oh,0,0,o.pixelWitdh,o.pixelHeight):1==s.type&&(e.ctx.drawImage(i.getImgByKey(n),s.ox,s.oy,s.uow,s.uoh,0,0,s.uow,s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox+s.uow,s.oy,s.ow-2*s.uow,s.uoh,s.uow,0,o.pixelWitdh-2*s.uow,s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox+s.ow-s.uow,s.oy,s.uow,s.uoh,o.pixelWitdh-s.uow,0,s.uow,s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox,s.oy+s.uoh,s.uow,s.oh-2*s.uoh,0,s.uoh,s.uow,o.pixelHeight-2*s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox+s.uow,s.oy+s.uoh,s.ow-2*s.uow,s.oh-2*s.uoh,s.uow,s.uoh,o.pixelWitdh-2*s.uow,o.pixelHeight-2*s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox+s.ow-s.uow,s.oy+s.uoh,s.uow,s.uoh,o.pixelWitdh-s.uow,s.uoh,s.uow,o.pixelHeight-2*s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox,s.oy+s.oh-s.uoh,s.uow,s.uoh,0,o.pixelHeight-s.uoh,s.uow,s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox+s.uow,s.oy+s.oh-s.uoh,s.ow-2*s.uow,s.uoh,s.uow,o.pixelHeight-s.uoh,o.pixelWitdh-2*s.uow,s.uoh),e.ctx.drawImage(i.getImgByKey(n),s.ox+s.ow-s.uow,s.oy+s.oh-s.uoh,s.uow,s.uoh,o.pixelWitdh-s.uow,o.pixelHeight-s.uoh,s.uow,s.uoh)),t.TextureManager.getInstance().updateTexture(e.texture,o.pixelX,o.pixelY,e.ctx)):alert("uiAtlasDrawImg错误")},e.SharedDrawImg=function(e,i,a,n,r,o,s){void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=!0);var h=e.getRec(a);e.ctx=t.UIManager.getInstance().getContext2D(h.pixelWitdh,h.pixelHeight,!1);var c=i.getRec(n),u=s?0:r,l=s?0:o,d=s?h.pixelWitdh:c.pixelWitdh,p=s?h.pixelHeight:c.pixelHeight;e.ctx.drawImage(i.useImg,c.pixelX,c.pixelY,c.pixelWitdh,c.pixelHeight,u,l,d,p),t.TextureManager.getInstance().updateTexture(e.texture,h.pixelX,h.pixelY,e.ctx)},e.drawToUiAtlasToCtx=function(e,i,a,n){var r=i.getRec(a);n||(n=new t.Rectangle(0,0,0,0)),n.width>1&&n.height>1?e.drawImage(i.useImg,r.pixelX,r.pixelY,r.pixelWitdh,r.pixelHeight,n.x,n.y,n.width,n.height):e.drawImage(i.useImg,r.pixelX,r.pixelY,r.pixelWitdh,r.pixelHeight,n.x,n.y,r.pixelWitdh,r.pixelHeight)},e.RepeatLoadImg=function(e,i,a){void 0===a&&(a=null);var n=new Image;n.onload=function(){t.LoadManager.getInstance().load(i,t.LoadManager.IMG_TYPE,(function(t){a&&a(n,t)}))},n.src=e},e}();t.UiDraw=a;var n=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.costtype=function(e){switch(e){case 1:return t.PuiData.A_YUANBAO;case 2:return t.PuiData.A_BANGYUAN;case 3:return t.PuiData.A_YINBI;case 101:return t.PuiData.A_ZHENQI;case 102:return t.PuiData.A_SHOULING;case 103:return t.PuiData.A_JINGHUA;case 6:return t.PuiData.A_BANGGONG;case 7:return t.PuiData.A_HONOR;case 8:case 9:return t.PuiData.A_DOUHUN;case 10:return t.PuiData.A_CARD_G;case 11:return t.PuiData.A_CARD_C;case 12:return t.PuiData.A_CARD_B;case 104:return t.PuiData.A_EXP}},e}();t.UIuitl=n}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pixelWitdh=1,e.pixelHeight=1,e.pixelX=0,e.pixelY=0,e.cellX=0,e.cellY=0,e.type=0,e}return __extends(e,t),e}(t.Rectangle);t.UIRectangle=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ogw=0,e.ogh=0,e}return __extends(e,t),e}(t.UIRectangle);t.UIGridRentangle=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._x=0,this._y=0,this._width=0,this._height=0,this.absoluteX=0,this.absoluteY=0,this.absoluteWidth=0,this.absoluteHeight=0,this.scale=1,this.level=2,this._hasDisposed=!1,this.initData(),this.renderData=[0,0,0,0]}return e.prototype.initData=function(){this.objData=new t.ObjData,this.shader=t.ProgrmaManager.getInstance().getProgram(t.UIMaskShader.UI_MASK_SHADER),this.program=this.shader.program,this.applyObjData()},e.prototype.applyAbsolutePoint=function(){this.parent&&(this.absoluteX=this._x*this.scale*t.UIData.Scale+this.parent.x,this.absoluteY=this._y*this.scale*t.UIData.Scale+this.parent.y,this.absoluteWidth=this._width*t.UIData.Scale*this.scale,this.absoluteHeight=this._height*t.UIData.Scale*this.scale,this.applyRenderSize())},e.prototype.testPoint=function(t,e){return t>this.absoluteX&&t<this.absoluteX+this.absoluteWidth&&e>this.absoluteY&&e<this.absoluteY+this.absoluteHeight},e.prototype.applyRenderSize=function(){this.parent&&(this.renderData[0]=this.absoluteX/t.Scene_data.stageWidth,this.renderData[1]=this.absoluteY/t.Scene_data.stageHeight,this.renderData[2]=this.absoluteWidth/t.Scene_data.stageWidth,this.renderData[3]=this.absoluteHeight/t.Scene_data.stageHeight)},e.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0,this.objData.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},e.prototype.update=function(){t.Scene_data.context3D.setBlendParticleFactors(0),t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVc4fv(this.shader,"ui",this.renderData),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._hasDisposed||(this.objData.destory(),this.objData=null,this.program=null,this.shader=null,this.renderData=null,this.parent=null,this._hasDisposed=!0)},e}();t.UIMask=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=!0,e}return __extends(e,t),e}(t.UIConatiner);t.UIVirtualContainer=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.isTrue=!1,t.current=0,t.totalcurrent=0,t.speed=6,t.endFlag=!1,t.stopStatic=0,t.speedNum=0,t}return __extends(i,e),i.prototype.setFrameData=function(t){this._frameData=t,this.totalcurrent=this._frameData.cellX*this._frameData.cellY},i.prototype.applyRenderSize=function(){if(this.parent){this.renderX=this.absoluteX/t.Scene_data.stageWidth,this.renderY=this.absoluteY/t.Scene_data.stageHeight,this.renderWidth=this.absoluteWidth/t.Scene_data.stageWidth,this.renderHeight=this.absoluteHeight/t.Scene_data.stageHeight,this.renderData[0]=this.renderX,this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth*this._uvScale,this.renderData[3]=this.renderHeight;var e=this._frameData.cellX,i=this._frameData.cellY,a=this._frameData.width/e,n=this._frameData.height/i,r=new t.Rectangle(0,0,a,n),o=this.current%(e*i);r.x=o%e*a,r.y=t.Util.float2int(o/e)*n,this.renderData2[0]=r.width*this._uvScale,this.renderData2[1]=r.height,this.renderData2[2]=r.x+this._frameData.x,this.renderData2[3]=r.y+this._frameData.y,this.uiRender.makeRenderDataVc(this.vcId)}},i.prototype.getSkinCtxRect=function(){var e=this._frameData,i=new t.Rectangle;return i.width=e.pixelWitdh/e.cellX,i.height=e.pixelHeight/e.cellY,i.x=this.current%e.cellX*i.width,i.y=Math.floor(this.current/e.cellX)*i.height,i},i.prototype.drawToCtx=function(t,e){var i=this._frameData,a=this.getSkinCtxRect();t.updateCtx(e,i.pixelX+a.x,i.pixelY+a.y)},i.prototype.update=function(){if(this._frameData&&2!=this.stopStatic){this.applyRenderSize(),this.speedNum++,this.speedNum>this.speed&&(this.current++,this.speedNum=0);var t=this._frameData.cellX,e=this._frameData.cellY;this.current>t*e-1&&(1==this.stopStatic?(this.stopStatic=2,this.endFlag=!0):this.current=0)}},i.prototype.goToAndPlay=function(t){this.stopStatic=1,this.current=t},i.prototype.goToAndStop=function(t){this.stopEnd(),this.current=t,this.applyRenderSize()},i.prototype.Invisible=function(){0!=this.renderData[2]&&0!=this.renderData[3]&&(this.stopEnd(),this.renderData[0]=0,this.renderData[1]=0,this.renderData[2]=0,this.renderData[3]=0,this.uiRender.makeRenderDataVc(this.vcId))},i.prototype.play=function(){this.stopStatic=0},i.prototype.stopEnd=function(){this.stopStatic=2;var t=this._frameData.cellX,e=this._frameData.cellY;this.current=t*e-1,this.applyRenderSize()},i}(t.UICompenent);t.FrameCompenent=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.pushVaData=function(t,e,i){for(var a=[0,0,0,this.ogw,0,0,this.width-this.ogw,0,0,this.width,0,0,0,-this.ogh,0,this.ogw,-this.ogh,0,this.width-this.ogw,-this.ogh,0,this.width,-this.ogh,0,0,this.ogh-this.height,0,this.ogw,this.ogh-this.height,0,this.width-this.ogw,this.ogh-this.height,0,this.width,this.ogh-this.height,0,0,-this.height,0,this.ogw,-this.height,0,this.width-this.ogw,-this.height,0,this.width,-this.height,0],n=0;n<a.length;n+=3)t.vertices.push(a[n]/this.width,a[n+1]/this.height,a[n+2]);t.uvs.push(0,0,e,this.gw,0,e,1-this.gw,0,e,1,0,e,0,this.gh,e,this.gw,this.gh,e,1-this.gw,this.gh,e,1,this.gh,e,0,1-this.gh,e,this.gw,1-this.gh,e,1-this.gw,1-this.gh,e,1,1-this.gh,e,0,1,e,this.gw,1,e,1-this.gw,1,e,1,1,e);var r=[0,1,5,0,5,4,1,2,6,1,6,5,2,3,7,2,7,6,4,5,9,4,9,8,5,6,10,5,10,9,6,7,11,6,11,10,8,9,13,8,13,12,9,10,14,9,14,13,10,11,15,10,15,14];for(n=0;n<r.length;n++)t.indexs.push(i+r[n]);return i+16},e}(t.UICompenent);t.Grid9Compenent=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.dtime=-1,this.time=0,this.oldPos=new t.Vector2D}return e.prototype.needUpData=function(e){return!(this.oldPos.x==e.x&&this.oldPos.y==e.y&&!t.Scene_data.cam3D.needChange)&&(this.oldPos.x=e.x,this.oldPos.y=e.y,!0)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.makeData(),this.time=0,this.update()},enumerable:!0,configurable:!0}),e.prototype.makeData=function(){},e.prototype.update=function(){},e.prototype.Vector3DToVector2D=function(e){var i=t.Scene_data.cam3D.cameraMatrix.clone();i.append(t.Scene_data.viewMatrx3D.clone());var a=i.transformVector(e),n=new t.Vector2D;return n.x=(a.x/a.w+1)*(t.Scene_data.stageWidth/2)/t.UIData.Scale-this.ui.width/2,n.y=(-a.y/a.w+1)*(t.Scene_data.stageHeight/2)/t.UIData.Scale-this.ui.height/2,n},e.prototype.isEqualLastKey=function(t){return!1},e}();t.Disp2DBaseText=e;var i=function(e){function i(i,a,n){var r=e.call(this)||this;return r.width=t.UIData.designWidth,r.height=t.UIData.designHeight,r.creatBaseRender(),r.addRender(r._baseRender),r.initData(i,a,n),r}return __extends(i,e),i.prototype.creatBaseRender=function(){this._baseRender=new t.UIRenderComponent},i.prototype.initData=function(e,i,a){this.voNum=Math.floor(a),this.voRect=i,this.textureRect=new t.Rectangle(0,0,Math.pow(2,Math.ceil(Math.log(i.width)/Math.log(2))),Math.pow(2,Math.ceil(Math.log(i.height*this.voNum)/Math.log(2)))),this._baseRender.uiAtlas=new t.UIAtlas;var n=this._baseRender.uiAtlas;n.configData=new Array,n.ctx=t.UIManager.getInstance().getContext2D(this.textureRect.width,this.textureRect.height,!1),n.textureRes=t.TextureManager.getInstance().getCanvasTexture(n.ctx),this.makeBaseUi(e)},i.prototype.makeBaseUi=function(t){var e=this._baseRender.uiAtlas;this._uiItem=new Array,this._lostItem=new Array;for(var i=0;i<this.voNum;i++){var a=new t;this._uiItem.push(a),a.parent=this._baseRender,a.voRect=this.voRect,a.textureStr="id"+i,e.configData.push(e.getObject(a.textureStr,0,i*this.voRect.height,this.voRect.width,this.voRect.height,this.textureRect.width,this.textureRect.height)),a.ui=this._baseRender.creatBaseComponent(a.textureStr),a.ui.width*=1,a.ui.height*=1}},i.prototype.showTemp=function(t){var e;this.clearLostItem();for(var i=0;i<this._uiItem.length;i++)if(null==this._uiItem[i].data&&this._uiItem[i].isEqualLastKey(t)){e=this._uiItem[i];break}if(!e)for(var a=0;a<this._uiItem.length;a++)if(null==this._uiItem[a].data){e=this._uiItem[a];break}return e?(e.data=t,this.addChild(e.ui)):this._lostItem.push(t),e},i.prototype.clearLostItem=function(){for(var t=this._lostItem.length-1;t>0;t--)this._lostItem[t].clear&&this._lostItem.splice(t,1)},i.prototype.playLost=function(){this._lostItem.length&&this.showTemp(this._lostItem.pop())},i.prototype.clearOneTemp=function(){for(var t=0;t<this._uiItem.length;t++)if(!this._uiItem[t].data)return;this._lostItem.length=0,this.clearTemp(this._uiItem[0].data)},i.prototype.clearTemp=function(t){for(var e=0;e<this._uiItem.length;e++)if(this._uiItem[e].data==t){this._uiItem[e].data=null,this.removeChild(this._uiItem[e].ui);break}this.playLost()},i.prototype.clearAll=function(){for(var t=0;t<this._uiItem.length;t++)this._uiItem[t].data&&this.clearTemp(this._uiItem[t].data)},i.prototype.update=function(t){for(var e=0;e<this._uiItem.length;e++)this._uiItem[e].data&&this._uiItem[e].update()},i.prototype.getUiItemLen=function(){for(var t=0,e=0;e<this._uiItem.length;e++)this._uiItem[e].data&&t++;return t},i}(t.Dis2DUIContianerBase);t.Dis2DUIContianerPanel=i;var a=function(t){function e(e,i,a){return t.call(this,e,i,a)||this}return __extends(e,t),e.prototype.makeBaseUi=function(t){var e=this._baseRender.uiAtlas;this._uiItem=new Array,this._lostItem=new Array;for(var i=0;i<this.voNum;i++){var a=new t;this._uiItem.push(a),a.parent=this._baseRender,a.voRect=this.voRect,a.textureStr="id"+i,e.configData.push(e.getObject(a.textureStr,0,i*this.voRect.height,this.voRect.width,this.voRect.height,this.textureRect.width,this.textureRect.height)),a.ui=this._baseRender.createFrame(a.textureStr),a.ui.width*=1,a.ui.height*=1}},e}(i);t.Dis2DUIFram=a}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[40];uniform vec4 ui2[40];uniform float alpha[40];varying vec2 v_texCoord;varying float v_alpha;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_texCoord = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   v_alpha = alpha[int(v2uv.z)];   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvarying float v_alpha;void main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ninfoUv *=v_alpha;\ngl_FragColor = infoUv;\n}"},e.AlphaUiShader="AlphaUiShader",e}(t.Shader3D);t.AlphaUIShader=e;var i=function(i){function o(){return i.call(this)||this}return __extends(o,i),o.prototype.update=function(){if(this.visible&&0!=this._uiList.length){t.Scene_data.context3D.setBlendParticleFactors(0),t.Scene_data.context3D.setProgram(this.program);for(var e=0;e<this._uiList.length;e++)this._uiList[e].update(),this._uiList[e].setVc(this.shader,e);t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.uiAtlas?t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.uiAtlas.texture,0):t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this.texture,0),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},o.prototype.initData=function(){this._uiList=new Array,this.objData=new t.ObjData,t.ProgrmaManager.getInstance().registe(e.AlphaUiShader,new e),this.shader=t.ProgrmaManager.getInstance().getProgram(e.AlphaUiShader),this.program=this.shader.program,this.uiProLocation=t.Scene_data.context3D.getLocation(this.program,"ui"),this.ui2ProLocation=t.Scene_data.context3D.getLocation(this.program,"ui2"),this.alphaLocation=t.Scene_data.context3D.getLocation(this.program,"alpha")},o.prototype.creatBaseComponent=function(t){var e=new r;e.skinName=t;var i=this.uiAtlas.getRec(t);return e.tr.setRec(i),e.width=i.pixelWitdh,e.height=i.pixelHeight,e.uiRender=this,e},o.prototype.creatGrid9Component=function(t,e,i){var a=new n;a.skinName=t;var r=this.uiAtlas.getGridRec(t);return a.tr.setRec(r),a.ogw=r.ogw,a.ogh=r.ogh,a.gw=a.ogw/r.pixelWitdh,a.gh=a.ogh/r.pixelHeight,a.width=e,a.height=i,a.uiRender=this,a},o.prototype.createFrame=function(t){var e=new a;e.skinName=t;var i=this.uiAtlas.getRec(t);return e.setFrameData(i),e.uiRender=this,e},o}(t.UIRenderComponent);t.AlphaUIRenderComponent=i;var a=function(e){function i(){var t=e.call(this)||this;return t.alpha=1,t}return __extends(i,e),i.prototype.setVc=function(e,i){t.Scene_data.context3D.setVc4fv(e,"ui["+i+"]",this.renderData),t.Scene_data.context3D.setVc4fv(e,"ui2["+i+"]",this.renderData2),t.Scene_data.context3D.setVc1fv(e,"alpha["+i+"]",[this.alpha])},i}(t.FrameCompenent);t.AlphaFrameCompenent=a;var n=function(e){function i(){var t=e.call(this)||this;return t.alpha=1,t}return __extends(i,e),i.prototype.setVc=function(e,i){t.Scene_data.context3D.setVc4fv(e,"ui["+i+"]",this.renderData),t.Scene_data.context3D.setVc4fv(e,"ui2["+i+"]",this.renderData2),t.Scene_data.context3D.setVc1fv(e,"alpha["+i+"]",[this.alpha])},i}(t.Grid9Compenent);t.AlphaGrid9UICompenent=n;var r=function(e){function i(){var t=e.call(this)||this;return t.alpha=1,t}return __extends(i,e),i.prototype.setVc=function(e,i){t.Scene_data.context3D.setVc4fv(e,"ui["+i+"]",this.renderData),t.Scene_data.context3D.setVc4fv(e,"ui2["+i+"]",this.renderData2),t.Scene_data.context3D.setVc1fv(e,"alpha["+i+"]",[this.alpha])},i}(t.UICompenent);t.AlphaUICompenent=r;var o=function(t){function e(e,i,a){return t.call(this,e,i,a)||this}return __extends(e,t),e.prototype.creatBaseRender=function(){this._baseRender=new i},e}(t.Dis2DUIContianerPanel);t.AlphaUiContianer=o}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._dic=new Object}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getAnimData=function(e,i){var a=this;this._dic[e]?i(this._dic[e]):t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(i,n){n(a.readData(new t.TLByteArray(i),e))}),i)},e.prototype.getAnimDataImmediate=function(t){return this._dic[t]},e.prototype.clearAnim=function(t){delete this._dic[t]},e.prototype.readData=function(e,i){var n=new Array,r=new Array,o=new t.AnimData;o.inLoop=e.readInt();for(var s=e.readInt(),h=0;h<s;h++)o.inter.push(e.readInt());s=e.readInt();for(h=0;h<s;h++)o.bounds.push(e.readVector3D());o.nameHeight=e.readInt(),s=e.readInt();for(h=0;h<s;h++){var c=new a;c.father=e.readInt(),c.changtype=e.readInt(),c.startIndex=e.readInt(),c.tx=e.readFloat(),c.ty=e.readFloat(),c.tz=e.readFloat(),c.qx=e.readFloat(),c.qy=e.readFloat(),c.qz=e.readFloat(),n.push(c)}this.readFrameData(e,r),s=e.readInt();for(h=0;h<s;h++)o.posAry.push(e.readVector3D());return o.matrixAry=this.processFrame(r,n),this._dic[i]=o,o},e.prototype.readFrameData=function(t,e){for(var i=this.readFrameTypeData(t),a=t.readBoolean(),n=t.readFloat(),r=t.readInt(),o=0;o<r;o++){var s=t.readInt(),h=new Array;e.push(h);for(var c=0;c<s;c++)i[c]?h.push(t.readFloatTwoByte(n)):a?h.push(t.readFloat()):h.push(t.readShort()/32767)}},e.prototype.readFrameTypeData=function(t){for(var e=new Array,i=t.readInt(),a=0;a<i;a++)e.push(t.readBoolean());return e},e.prototype.processFrame=function(t,e){for(var i=new Array,a=0;a<t.length;a++)i.push(this.frameToBone(t[a],e));return this.setFrameToMatrix(i)},e.prototype.frameToBone=function(t,e){for(var a=new Array,n=0;n<e.length;n++){var r=new i;r.father=e[n].father;var o=0;1&e[n].changtype?(r.tx=t[e[n].startIndex+o],++o):r.tx=e[n].tx,2&e[n].changtype?(r.ty=t[e[n].startIndex+o],++o):r.ty=e[n].ty,4&e[n].changtype?(r.tz=t[e[n].startIndex+o],++o):r.tz=e[n].tz,8&e[n].changtype?(r.qx=t[e[n].startIndex+o],++o):r.qx=e[n].qx,16&e[n].changtype?(r.qy=t[e[n].startIndex+o],++o):r.qy=e[n].qy,32&e[n].changtype?(r.qz=t[e[n].startIndex+o],++o):r.qz=e[n].qz,a.push(r)}return a},e.prototype.setFrameToMatrix=function(e){for(var i=new Array,a=0;a<e.length;a++){var n=e[a],r=new t.Quaternion,o=new t.Matrix3D,s=new Array;i.push(s);for(var h=0;h<n.length;h++){var c=n[h];if((r=new t.Quaternion(c.qx,c.qy,c.qz)).w=this.getW(r.x,r.y,r.z),-1==c.father)(o=r.toMatrix3D()).appendTranslation(c.tx,c.ty,c.tz),o.appendRotation(-90,t.Vector3D.X_AXIS),s.push(o);else{n[c.father];(o=r.toMatrix3D()).appendTranslation(c.tx,c.ty,c.tz),o.append(s[c.father]),s.push(o)}}for(h=0;h<s.length;h++)s[h].appendScale(-1,1,1)}return i},e.prototype.getW=function(t,e,i){var a=1-(t*t+e*e+i*i);return a=a<0?0:-Math.sqrt(a)},e}();t.AnimManager=e;var i=function(){},a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e;return t.tx=this.tx,t.ty=this.ty,t.tz=this.tz,t.tw=this.tw,t.qx=this.qx,t.qy=this.qy,t.qz=this.qz,t.qw=this.qw,t.changtype=this.changtype,t.name=this.name,t.father=this.father,t.startIndex=this.startIndex,t.matrix=this.matrix,t},e}(i)}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.fontData=new t.Dictionary([]),this.fontData_Unit=new t.Dictionary([]),this.makeFontRect()}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.makeFontRect=function(){this.getXmlData(t.UIData.flytext)},e.prototype.getXmlData=function(e){for(var i=t.UIData.getUiArrByKey(e),a=0;a<i.length;a++){var n=String(i[a].name);if(-1!=n.search("A_")){var r=Number(n.substring(5,n.length));(c=new t.UIRectangle).pixelX=Number(i[a].ox),c.pixelY=Number(i[a].oy),c.pixelWitdh=Number(i[a].ow),c.pixelHeight=Number(i[a].oh),c.cellX=Number(i[a].cellX),c.cellY=Number(i[a].cellY);for(var o=new t.Rectangle(0,0,c.pixelWitdh/c.cellX,c.pixelHeight),s=new Array,h=0;h<c.cellX;h++)s.push(new t.Rectangle(c.pixelX+h*o.width,c.pixelY,o.width,o.height));this.fontData["NUM"+r]=s}if(-1!=n.search("B_")){var c;r=Number(n.substring(5,n.length));(c=new t.UIRectangle).pixelX=Number(i[a].ox),c.pixelY=Number(i[a].oy),c.pixelWitdh=Number(i[a].ow),c.pixelHeight=Number(i[a].oh),c.cellX=Number(i[a].cellX),c.cellY=Number(i[a].cellY);for(o=new t.Rectangle(0,0,c.pixelWitdh/c.cellX,c.pixelHeight),s=new Array,h=0;h<c.cellX;h++)s.push(new t.Rectangle(c.pixelX+h*o.width,c.pixelY,o.width,o.height));this.fontData_Unit["BNUM"+r]=s}}},e.prototype.writeFontToCtxLeft=function(i,a,n,r,o,s){void 0===n&&(n=e.num1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=0);for(var h,c=this.fontData[n],u=0,l=0;l<a.length;l++){h=this.getCharId(a[l]);var d=this.getRect(h,n,c);if(!d)return;i.drawImage(t.UIData.textImg,d.x,d.y,d.width,d.height,u+r,o,d.width,d.height),u+=d.width-s}return u},e.prototype.writeFontToCtxRight=function(i,a,n,r,o,s){void 0===n&&(n=e.White),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=0);for(var h,c=this.fontData[n],u=0,l=this.getAirFontWidth(i,a,n,s),d=0;d<a.length;d++){h=this.getCharId(a[d]);var p=this.getRect(h,n,c);i.drawImage(t.UIData.textImg,p.x,p.y,p.width,p.height,u+r-l,o,p.width,p.height),u+=p.width-s}return l},e.prototype.writeFontToCtxCenten=function(i,a,n,r,o,s,h){void 0===r&&(r=e.White),void 0===o&&(o=0),void 0===s&&(s=0),void 0===h&&(h=0);var c,u=this.fontData[r],l=0,d=this.getAirFontWidth(i,a,r,h),p=n-d>>1;p+=o;for(var f=0;f<a.length;f++){c=this.getCharId(a[f]);var m=this.getRect(c,r,u);i.drawImage(t.UIData.textImg,m.x,m.y,m.width,m.height,l+p,s,m.width,m.height),l+=m.width-h}return d},e.prototype.writeFontToSkinName=function(i,a,n,r,o,s,h){void 0===r&&(r=e.ORANGE_TXT),void 0===o&&(o=t.TextAlign.LEFT),void 0===s&&(s=0),void 0===h&&(h=0);var c,u=i.getRec(a);return i.ctx=t.UIManager.getInstance().getContext2D(u.pixelWitdh,u.pixelHeight,!1),o==t.TextAlign.LEFT?c=this.writeFontToCtxLeft(i.ctx,n,r,0,h,s):o==t.TextAlign.RIGHT?c=this.writeFontToCtxRight(i.ctx,n,r,u.pixelWitdh,h,s):o==t.TextAlign.CENTER&&(c=this.writeFontToCtxCenten(i.ctx,n,u.pixelWitdh,r,0,h,s)),t.TextureManager.getInstance().updateTexture(i.texture,u.pixelX,u.pixelY,i.ctx),c},e.prototype.writeFontToSkinNameCenter=function(i,a,n,r,o){void 0===r&&(r=e.ORANGE_TXT),void 0===o&&(o=0);var s=i.getRec(a);i.ctx=t.UIManager.getInstance().getContext2D(s.pixelWitdh,s.pixelHeight,!1);for(var h,c=s.pixelWitdh/2,u=s.pixelHeight/2,l=this.fontData[r],d=0,p=this.getAirFontWidth(i.ctx,n,r,o)/2,f=0;f<n.length;f++){h=this.getCharId(n[f]);var m=this.getRect(h,r,l);i.ctx.drawImage(t.UIData.textImg,m.x,m.y,m.width,m.height,d+c-p,u-m.height/2,m.width,m.height),d+=m.width-o}t.TextureManager.getInstance().updateTexture(i.texture,s.pixelX,s.pixelY,i.ctx)},e.prototype.getAirFontWidth=function(t,i,a,n){if(void 0===a&&(a=e.White),void 0===n&&(n=0),null==i)return 0;for(var r,o=this.fontData[a],s=0,h=0;h<i.length;h++){r=this.getCharId(i[h]);var c=this.getRect(r,a,o);c||console.error("---$str---",i),s+=c.width-n}return s},e.prototype.getRect=function(t,e,i){return t>15?this.fontData_Unit["B"+e][t-16]:i[t]},e.prototype.upArtFont=function(i,a,n,r,o,s){void 0===r&&(r=12),void 0===o&&(o=e.White),void 0===s&&(s=t.TextAlign.LEFT);var h=r/12,c=this.fontData[o],u=i.getRec(a);i.ctx=t.UIManager.getInstance().getContext2D(u.pixelWitdh,u.pixelHeight,!1);var l=this.getTotalWandDraw(u,n,c,h,i.ctx,!1),d=this.getXpos(s,l,new t.Rectangle(0,0,u.pixelWitdh,u.pixelHeight));this.getTotalWandDraw(u,n,c,h,i.ctx,!0,d),t.TextureManager.getInstance().updateTexture(i.texture,u.pixelX,u.pixelY,i.ctx)},e.prototype.upArtBase=function(i,a,n,r,o){void 0===r&&(r=e.White),void 0===o&&(o=t.TextAlign.LEFT);var s=this.fontData[r],h=i.getRec(a);i.ctx=t.UIManager.getInstance().getContext2D(h.pixelWitdh,h.pixelHeight,!1);var c=this.getTotalWandDraw(h,n,s,1,i.ctx,!1),u=this.getXpos(o,c,new t.Rectangle(0,0,h.pixelWitdh,h.pixelHeight));this.getTotalWandDraw(h,n,s,1,i.ctx,!0,u),t.TextureManager.getInstance().updateTexture(i.texture,h.pixelX,h.pixelY,i.ctx)},e.prototype.getXpos=function(e,i,a){var n=0;return e==t.TextAlign.LEFT?n=0:e==t.TextAlign.RIGHT?n=i-a.width:e==t.TextAlign.CENTER&&(n=(a.width-i)/2),n},e.prototype.getTotalWandDraw=function(e,i,a,n,r,o,s,h){void 0===s&&(s=0),void 0===h&&(h=0);for(var c=0,u=0;u<i.length;u++){var l=a[this.getCharId(i[u])];o&&r.drawImage(t.UIData.textImg,l.x,l.y,l.width,l.height,e.x+c+s,e.y,l.width*n,l.height*n),c+=(l.width-h)*n}return c},e.prototype.getCharId=function(t){return"+"==t||"x"==t||"X"==t?10:"-"==t?11:"/"==t?12:":"==t?13:"."==t?14:"%"==t?15:"万"==t?16:"亿"==t?17:"["==t?18:"]"==t?19:(NaN==Number(t)&&alert("MeshVo,GetCharId error:"+t),Number(t))},e.Red="Red",e.Green="Green",e.Blue="Blue",e.White="White",e.Yellow="Yellow",e.BOSSBIGTXT="NUM99",e.CN1="NUM100",e.num101="NUM101",e.num102="NUM102",e.BigYellow="NUM12",e.num99="NUM99",e.GARY_TXT="NUM1",e.ORANGE_TXT="NUM19",e.num1="NUM1",e.num2="NUM2",e.num3="NUM3",e.num4="NUM4",e.num5="NUM5",e.num6="NUM6",e.num7="NUM7",e.num10="NUM10",e.num8="NUM8",e.num9="NUM9",e.num11="NUM11",e.num12="NUM12",e.num13="NUM13",e.num14="NUM14",e.num15="NUM15",e.num16="NUM16",e.num17="NUM17",e.num18="NUM18",e.num19="NUM19",e.num20="NUM20",e.num21="NUM21",e.num22="NUM22",e.num23="NUM23",e.num24="NUM24",e.num25="NUM24",e.num26="NUM26",e.num27="NUM27",e.num28="NUM28",e.num30="NUM30",e.num51="NUM51",e.num52="NUM52",e.num53="NUM53",e.num54="NUM54",e.num55="NUM55",e.num56="NUM56",e.num57="NUM57",e.num58="NUM58",e.num59="NUM59",e.num60="NUM60",e.num61="NUM61",e.numVip="NUM62",e.num63="NUM63",e.num64="NUM64",e.num65="NUM65",e.num66="NUM66",e.num76="NUM76",e.num77="NUM77",e.num81="NUM81",e}();t.ArtFont=e}(tl3d||(tl3d={})),function(t){var e=Laya.SoundManager,i=function(){function t(){}return t.playMusic=function(i){if(void 0===i&&(i="sound/battle_bgm3.mp3"),!t.MUSICPAUSE)try{t._curbgm!=i&&(t._soundChannel&&t._soundChannel.stop(),t._curbgm=i,t._soundChannel=e.playMusic(i,0))}catch(t){}},t.setPlayRate=function(t){try{e.playbackRate=t}catch(t){}},t.pauseMusic=function(){t._soundChannel&&(t._soundChannel.pause(),t.MUSICPAUSE=!0)},t.stopMusic=function(){t._soundChannel&&t._soundChannel.stop()},t.resumeMusic=function(){t._soundChannel&&t._soundChannel.resume()},t.playSound=function(i){if(void 0===i&&(i="sound/button.mp3"),!t.SOUNDSTOP)try{e.playSound(i,1)}catch(t){}},t.StopSound=function(i){if(i&&""!=i&&!t.SOUNDSTOP)try{e.stopSound(i)}catch(t){}},t.pauseSound=function(){e.stopAllSound(),t.SOUNDSTOP=!0},t.MUSICPAUSE=!1,t.SOUNDSTOP=!1,t}();t.AudioMgr=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t.encode=function(t){var e,i=new Uint8Array(t),a=i.length,n="";for(e=0;e<a;e+=3)n+=this.chars[i[e]>>2],n+=this.chars[(3&i[e])<<4|i[e+1]>>4],n+=this.chars[(15&i[e+1])<<2|i[e+2]>>6],n+=this.chars[63&i[e+2]];return a%3==2?n=n.substring(0,n.length-1)+"=":a%3==1&&(n=n.substring(0,n.length-2)+"=="),n},t.decode=function(t){var e,i,a,n,r,o=.75*t.length,s=t.length,h=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;e<s;e+=4)i=this.chars.indexOf(t[e]),a=this.chars.indexOf(t[e+1]),n=this.chars.indexOf(t[e+2]),r=this.chars.indexOf(t[e+3]),u[h++]=i<<2|a>>4,u[h++]=(15&a)<<4|n>>2,u[h++]=(3&n)<<6|63&r;return c},t}();t.Base64=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.NORMALDAMAGE=1,t.CRIT=2,t.DODGE=3,t.TREATMENT=4,t.VERTIGO=5,t.FREEZE=6,t.ATTACKADD=7,t.ATTACKREDUCE=8,t.EXPERIENCE=9,t.NORMALDAMAGEUP=11,t.CRITUP=12,t.MYNORMALDAMAGE=13,t.MYNORMALDAMAGEUP=14,t.MISS=15,t.N_NORMALDAMAGE=16,t.N_CRIT=17,t.N_RESISTANCE=18,t.N_RESISTANCES=181,t.N_IMMUNE=19,t.N_ONCEATTACK=20,t.N_PASSIVE=21,t.N_RESURGENCE=22,t.N_UPHP=23,t.N_BEATBACK=24,t.N_DOWNHP=25,t.N_BOMB=26,t.N_DIZZY=27,t.N_INVINCIBLE=28,t.N_TARGET=29,t.N_SARCASM=30,t.N_SILENCE=31,t.N_SHIELD=32,t.N_BLEED=33,t.N_SLEEP=34,t.N_CRIT_RATE_UP=35,t.N_RESIST_RATE_UP=36,t.N_ATTACK_UP=37,t.N_DEFENSE_UP=38,t.N_SPEED_UP=39,t.N_HIT_UP=40,t.N_CRIT_RATE_DOWN=41,t.N_RESIST_RATE_DOWN=42,t.N_ATTACK_DOWN=43,t.N_DEFENSE_DOWN=44,t.N_SPEED_DOWN=45,t.N_HIT_DOWN=46,t.N_SHIHUA=47,t.N_MEIHUO=48,t.N_SHUFU=49,t.N_BINGFENG=50,t.N_ZHONGDU=51,t.N_LEIDIAN=52,t.N_ANGER_DOWN=53,t.N_WANGLING=54,t.N_MABI=55,t.N_FENNU=56,t.N_FANTAN=57,t.N_SHARE=58,t.N_ZHUOSHAO=59,t}();t.TextJumpType=e;var i=function(){};t.TextJumpUiVo=i;var a=function(i){function a(){var t=null!==i&&i.apply(this,arguments)||this;return t._lastchange=[0,0,0,0,0],t}return __extends(a,i),a.prototype.makeData=function(){if(this._data){var t=this._data;switch(this.dtime=t.endtime,this.pos=t.pos,t.type){case e.EXPERIENCE:this._width=this.drawTxtBydigitalAndtext(t)}}},a.prototype.drawTxtBydigitalAndtext=function(i){var a,n=this.parent.uiAtlas.getRec(this.textureStr),r=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),o=i.type;i.type==e.EXPERIENCE&&(a=t.ArtFont.num54);var s=t.ArtFont.getInstance().getAirFontWidth(r,String(this._data.str),a);return s+=50,t.UiDraw.cxtDrawImg(r,"TYPE"+o,new t.Rectangle(n.pixelWitdh-s,n.pixelHeight-25,50,25),t.UIData.publicUi),t.ArtFont.getInstance().writeFontToCtxLeft(r,String(this._data.str),a,n.pixelWitdh-s+50+2,n.pixelHeight-25),t.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,n.pixelX,n.pixelY,r),s},a.prototype.update=function(){if(this._data){if(this.time=t.TimeUtil.getTimer(),this.time>=this.dtime)return this.ui&&this.ui.parent&&this.ui.parent.removeChild(this.ui),void(this._data=null);this._data;var e=this.changerules(this.time);this.ui.width=256*(e[2]||0),this.ui.height=50*(e[3]||0),this.ui.y=(e[1]||0)-this.ui.height,this.ui.x=(e[0]||0)-this.ui.width/2+25,this.ui.alpha=e[4]||0}},a.prototype.changerules=function(e){var i=new Array,a=this._data;e=(e-a.starttime)/1e3*60;var n=0,r=0,o=0,s=0,h=0;if(a.type==t.TextJumpType.EXPERIENCE){var c=new t.Vector2D;e<0?c.x=-9999:(c.x=300/t.UIData.Scale,c.y=t.Scene_data.stageHeight/t.UIData.Scale-50),r=c.y-=15,r-=.5*e,e<40?(n=c.x,o=1.8,s=1.8,h=1):e<60&&(n=c.x,o=1.8,s=1.8,h=1-(e-39)/20)}return i.push(n),i.push(r),i.push(o),i.push(s),i.push(h),i.push(c.x),i.push(c.y),this._lastchange=i,i},a}(t.Disp2DBaseText);t.ExpTextJumpUiDrawAndRefreash=a;var n=function(i){function a(){var t=null!==i&&i.apply(this,arguments)||this;return t._lastchange=[0,0,0,0,0],t}return __extends(a,i),a.prototype.makeData=function(){if(this._data){var i=this._data;switch(this.dtime=i.endtime,this.pos=i.pos,i.type){case e.NORMALDAMAGE:case e.TREATMENT:this._width=t.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(i.str),"NUM"+(i.type+50),t.TextAlign.RIGHT);break;case e.MYNORMALDAMAGEUP:case e.MYNORMALDAMAGE:this._width=t.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(i.str),t.ArtFont.num53,t.TextAlign.RIGHT);break;case e.NORMALDAMAGEUP:this._width=t.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(i.str),"NUM"+(i.type+40),t.TextAlign.RIGHT);break;case e.DODGE:case e.VERTIGO:case e.FREEZE:case e.MISS:this._width=this.drawTxtBytext(i);break;case e.ATTACKADD:case e.ATTACKREDUCE:case e.EXPERIENCE:case e.CRIT:case e.CRITUP:this._width=this.drawTxtBydigitalAndtext(i);break;case e.N_IMMUNE:case e.N_ONCEATTACK:case e.N_RESURGENCE:case e.N_RESISTANCES:this._width=this.drawTxtBytext(i,t.UIData.publicsUi);break;case e.N_NORMALDAMAGE:case e.N_UPHP:var a=i.type==e.N_NORMALDAMAGE?"NUM81":"NUM76";this._width=t.ArtFont.getInstance().writeFontToSkinName(this.parent.uiAtlas,this.textureStr,String(i.str),a,t.TextAlign.RIGHT,0,29);break;case e.N_PASSIVE:this._width=this.drawTxtBydigitalAndtext(i);break;case e.N_CRIT:case e.N_RESISTANCE:this._width=this.drawCritTxt(i)}i.type>=e.N_BEATBACK&&i.type<=e.N_ZHUOSHAO&&(this._width=this.drawTxtBytext(i,t.UIData.publicsUi))}},a.prototype.drawCritTxt=function(i){var a,n=this.parent.uiAtlas.getRec(this.textureStr),r=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),o=i.type,s=50,h=25;i.type==e.N_CRIT&&(a=t.ArtFont.num77,s=68,h=36),i.type==e.N_RESISTANCE&&(a=t.ArtFont.num81,s=68,h=36);var c=t.ArtFont.getInstance().getAirFontWidth(r,String(this._data.str),a),u=Math.max(c,s),l=n.pixelWitdh-u/2-s/2,d=n.pixelWitdh-u/2-c/2,p=0;return t.UiDraw.cxtDrawImg(r,"TYPE"+o,new t.Rectangle(l,p,s,h),t.UIData.publicsUi),p=n.pixelHeight-35,t.ArtFont.getInstance().writeFontToCtxLeft(r,String(this._data.str),a,d,p),t.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,n.pixelX,n.pixelY,r),u},a.prototype.drawTxtBytext=function(i,a){void 0===a&&(a=t.UIData.publicUi);var n=this.parent.uiAtlas.getRec(this.textureStr),r=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),o=84;return i.type==e.N_ONCEATTACK||i.type==e.N_DOWNHP?o=167:i.type==e.N_CRIT_RATE_UP||i.type==e.N_CRIT_RATE_DOWN?o=156:i.type!=e.N_RESIST_RATE_UP&&i.type!=e.N_RESIST_RATE_DOWN&&i.type!=e.N_ATTACK_UP&&i.type!=e.N_ATTACK_DOWN&&i.type!=e.N_SPEED_UP&&i.type!=e.N_SPEED_DOWN&&i.type!=e.N_HIT_UP&&i.type!=e.N_HIT_UP&&i.type!=e.N_DEFENSE_UP&&i.type!=e.N_DEFENSE_DOWN||(o=115),t.UiDraw.cxtDrawImg(r,"TYPE"+i.type,new t.Rectangle(n.pixelWitdh-o,n.pixelHeight-44,o,44),a),t.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,n.pixelX,n.pixelY,r),o},a.prototype.drawTxtBydigitalAndtext=function(i){var a,n=this.parent.uiAtlas.getRec(this.textureStr),r=t.UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),o=i.type,s=50,h=25;i.type==e.ATTACKREDUCE?(o=e.ATTACKADD,a=t.ArtFont.num53):i.type==e.ATTACKADD||i.type==e.EXPERIENCE?a=t.ArtFont.num54:i.type==e.CRIT?(a=t.ArtFont.num55,s=78,h=50):i.type==e.CRITUP&&(o-=10,s=78,h=50,a=t.ArtFont.num55),i.type==e.N_PASSIVE&&(a=t.ArtFont.num76,s=84,h=44);var c=t.ArtFont.getInstance().getAirFontWidth(r,String(this._data.str),a);c+=s;var u=n.pixelWitdh-c,l=n.pixelHeight-h;return t.UiDraw.cxtDrawImg(r,"TYPE"+o,new t.Rectangle(u,l,s,h),i.type>=e.N_NORMALDAMAGE?t.UIData.publicsUi:t.UIData.publicUi),t.ArtFont.getInstance().writeFontToCtxLeft(r,String(this._data.str),a,u+s+2,l+6),t.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,n.pixelX,n.pixelY,r),c},a.prototype.update=function(){if(this._data){if(this.time=t.TimeUtil.getTimer(),this.time>=this.dtime)return this.ui&&this.ui.parent&&this.ui.parent.removeChild(this.ui),void(this._data=null);this._data;var e=this.changerules(this.time);this.ui.width=256*(e[2]||0),this.ui.height=64*(e[3]||0),this.ui.y=(e[1]||0)-this.ui.height,this.ui.x=e[0]||0,this.ui.alpha=e[4]||0}},a.prototype.changerules=function(i){var a=this._data;i=(i-a.starttime)/1e3*60;var n=new Array,r=this.Vector3DToVector2D(new t.Vector3D(this.pos.x,this.pos.y,this.pos.z));a.type==t.TextJumpType.EXPERIENCE&&(r.x=300/t.UIData.Scale,r.y=t.Scene_data.stageHeight/t.UIData.Scale-50);var o=0,s=0,h=0,c=0,u=0;switch(a.type){case t.TextJumpType.NORMALDAMAGE:case t.TextJumpType.MYNORMALDAMAGE:o=r.x,i<4?(s=r.y-4*i,(h=i/4*1.3+.2)>1.5&&(h=1.5),c=h,(u=i/3*.8+.2)>1&&(u=1)):i<8?(s=this._lastchange[1]-2,c=h=this._lastchange[2]-1/6,(u=i/3*.8+.2)>1&&(u=1)):i<15?(s=this._lastchange[1]-2,c=h=this._lastchange[2]+1/6,(u=i/3*.8+.2)>1&&(u=1)):i<30?(s=this._lastchange[1]-2,c=h=this._lastchange[2]-.05,(u=i/3*.8+.2)>1&&(u=1)):i<72&&(s=i<50?this._lastchange[1]-2:this._lastchange[1]+2,o=this._lastchange[0]-1.5,c=h=this._lastchange[2],(u=this._lastchange[4]-.01)<0&&(u=0));break;case t.TextJumpType.CRIT:o=r.x,i<4?(s=r.y-4*i,(h=i/4*1.3+.2)>1.5&&(h=1.5),c=h,(u=i/3*.8+.2)>1&&(u=1)):i<8?(s=this._lastchange[1]-2,c=h=this._lastchange[2]-1/6,(u=i/3*.8+.2)>1&&(u=1)):i<15?(s=this._lastchange[1]-2,c=h=this._lastchange[2]+1/4,(u=i/3*.8+.2)>1&&(u=1)):i<30?(s=this._lastchange[1]-2,c=h=this._lastchange[2]-.05,(u=i/3*.8+.2)>1&&(u=1)):i<100&&(s=i<50?this._lastchange[1]-2:this._lastchange[1]+2,o=this._lastchange[0]-1.5,c=h=this._lastchange[2],(u=this._lastchange[4]-.01)<0&&(u=0));break;case t.TextJumpType.NORMALDAMAGEUP:case t.TextJumpType.CRITUP:case t.TextJumpType.MYNORMALDAMAGEUP:o=r.x,i<4?(s=r.y-4*i,(h=i/4*1.5+.2)>1.7&&(h=1.7),c=h,(u=i/3*.3+.2)>.5&&(u=.5)):i<8?(s=this._lastchange[1]-2,c=h=this._lastchange[2]-1/4,(u=i/3*.3+.2)>.5&&(u=.5)):i<15?(s=this._lastchange[1]-2,c=h=this._lastchange[2]+1/4,(u=i/3*.3+.2)>.5&&(u=.5)):i<30&&(s=this._lastchange[1]-2,c=h=this._lastchange[2]-1/15,(u=this._lastchange[4]-1/80)<0&&(u=0));break;case t.TextJumpType.TREATMENT:o=r.x,s=r.y-1.5*i,i<12?(c=h=Math.ceil(i)/12*.8+.2,u=Math.ceil(i)/12*.8+.2):i<60&&(c=h=1,u=1-(i-11)/48);break;case t.TextJumpType.EXPERIENCE:s=r.y-=15,s-=.5*i,i<40?(o=r.x,h=1.3,c=1.3,u=1):i<60&&(o=r.x,h=1.3,c=1.3,u=1-(i-39)/20);break;case t.TextJumpType.ATTACKADD:case t.TextJumpType.ATTACKREDUCE:o=r.x+=110,s=r.y-1.8*i,i<12?(c=h=Math.ceil(i)/12*1.3+.1,u=Math.ceil(i)/12*.8+.2):i<24?(c=h=1.4-(i-11)/12*.4,u=1):i<60&&(c=h=1,u=1-(i-23)/36);break;case t.TextJumpType.DODGE:case t.TextJumpType.MISS:case t.TextJumpType.VERTIGO:case t.TextJumpType.FREEZE:o=r.x-=50,i<12?(s=r.y-3*i,c=h=1,u=Math.ceil(i)/12):i<36?(s=r.y-33,c=h=1,u=1):i<72&&(s=r.y-33-1.5*(i-36),c=h=1,u=1-(i-35)/36);break;case e.N_NORMALDAMAGE:case e.N_UPHP:case e.N_CRIT:case e.N_RESISTANCE:i<12?(c=h=Math.ceil(i)/12*1.1+.1,u=Math.ceil(i)/12*.8+.2):i<24?(c=h=this._lastchange[2]-.008,u=1):i<60&&(c=h=this._lastchange[2],u=1-(i-23)/36),s=r.y-1.5*i,o=r.x+60-256*h/2}if(a.type==e.N_IMMUNE||a.type==e.N_ONCEATTACK||a.type==e.N_RESURGENCE||a.type==e.N_RESISTANCES||a.type==e.N_PASSIVE||a.type>=e.N_BEATBACK&&a.type<=e.N_ZHUOSHAO){var l=a.type>=e.N_CRIT_RATE_DOWN&&a.type<=e.N_HIT_DOWN;o=r.x-45,i<12?(s=l?r.y+3*i:r.y-3*i,c=h=.8,u=Math.ceil(i)/12):i<36?(s=this._lastchange[1],c=h=.8,u=1):i<72&&(s=l?this._lastchange[1]+.05:this._lastchange[1]-.05,c=h=.8,u=1-(i-35)/36)}return n.push(o),n.push(s),n.push(h),n.push(c),n.push(u),n.push(r.x),n.push(r.y),this._lastchange=n,n},a}(t.Disp2DBaseText);t.TextJumpUiDrawAndRefreash=n;var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.tempMatrix=new t.Matrix3D,i}return __extends(i,e),i.prototype.makeData=function(){this._data&&(this.charNameMeshVo=this.data,this.lastKey!=this.charNameMeshVo.name&&(this.ui.width=179.2,this.ui.height=22*.7,this.lastKey=this.charNameMeshVo.name,t.LabelTextFont.writeSingleLabel(this.parent.uiAtlas,this.textureStr,this.charNameMeshVo.name,this.charNameMeshVo.size,t.TextAlign.CENTER,this.charNameMeshVo.color,this.charNameMeshVo.scolor)),this.charNameMeshVo.needDraw=!1)},i.prototype.update=function(){if(this.charNameMeshVo){if(this.charNameMeshVo.needDraw&&this.makeData(),this.charNameMeshVo.pos)if(this.charNameMeshVo.visible){if(this.needUpData(this.charNameMeshVo.pos)||this.charNameMeshVo.visibleChange){var e=t.Scene_data.cam3D.cameraMatrix.clone(this.tempMatrix);e.append(t.Scene_data.viewMatrx3D);var i=e.transformVector(this.charNameMeshVo.pos);this.ui.x=(i.x/i.w+1)*(t.Scene_data.stageWidth/2)/t.UIData.Scale-this.ui.width/2,this.ui.y=(-i.y/i.w+1)*(t.Scene_data.stageHeight/2)/t.UIData.Scale-this.ui.height/2,this.ui.x+=this.charNameMeshVo.offsetx,this.ui.y+=this.charNameMeshVo.offsety,this.oldPos.x=this.charNameMeshVo.pos.x,this.oldPos.y=this.charNameMeshVo.pos.y,this.charNameMeshVo.visibleChange=!1}}else this.ui.x=1e4;this.charNameMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null)}},i}(t.Disp2DBaseText);t.CharNameUiVo=r;var o=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.tempMatrix=new t.Matrix3D,i}return __extends(i,e),i.prototype.makeData=function(){var e=this;this._data&&(this._charTitleMeshVo=this.data,t.LoadManager.getInstance().load(t.Scene_data.fileRoot+t.UnitFunction.getUItittleUrl(String(this._charTitleMeshVo.num)),t.LoadManager.IMG_TYPE,(function(i){var a=e.parent.uiAtlas.getRec(e.textureStr);e.parent.uiAtlas.ctx=t.UIManager.getInstance().getContext2D(a.pixelWitdh,a.pixelHeight,!1);var n=Math.min(a.pixelWitdh/i.width,a.pixelHeight/i.height);n=Math.min(n,1);var r=i.width*n,o=i.height*n;e.parent.uiAtlas.ctx.drawImage(i,(a.pixelWitdh-r)/2,(a.pixelHeight-o)/2,r,o),t.TextureManager.getInstance().updateTexture(e.parent.uiAtlas.texture,a.pixelX,a.pixelY,e.parent.uiAtlas.ctx)})))},i.prototype.update=function(){if(this._charTitleMeshVo){if(this._charTitleMeshVo.needDraw&&(this.makeData(),this._charTitleMeshVo.needDraw=!1),this._charTitleMeshVo.pos)if(this._charTitleMeshVo.visible){if(this.needUpData(this._charTitleMeshVo.pos)){var e=t.Scene_data.cam3D.cameraMatrix.clone(this.tempMatrix);e.append(t.Scene_data.viewMatrx3D);var i=e.transformVector(this._charTitleMeshVo.pos);this.ui.x=(i.x/i.w+1)*(t.Scene_data.stageWidth/2)/t.UIData.Scale-this.ui.width/2,this.ui.y=(-i.y/i.w+1)*(t.Scene_data.stageHeight/2)/t.UIData.Scale-this.ui.height/2,this.oldPos.x=this._charTitleMeshVo.pos.x,this.oldPos.y=this._charTitleMeshVo.pos.y}}else this.ui.x=1e4;this._charTitleMeshVo.clear&&(this.ui.parent.removeChild(this.ui),this._data=null)}},i}(t.Disp2DBaseText);t.CharTitleUiVo=o;var s=function(){function t(){this._visible=!0,this.visibleChange=!1,this.offsetx=0,this.offsety=0,this.clear=!1}return Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t,this.visibleChange=!0},enumerable:!0,configurable:!0}),t}();t.baseMeshVo=s}(tl3d||(tl3d={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.destory=function(){this.pos=null,this._num=null,this.clear=!0},Object.defineProperty(e.prototype,"num",{get:function(){return this._num},set:function(t){this._num=t,this.needDraw=!0},enumerable:!0,configurable:!0}),e}(t.baseMeshVo);t.CharTitleMeshVo=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color="#ffffff",e.scolor="",e.size=20,e}return __extends(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t,this.needDraw=!0},enumerable:!0,configurable:!0}),e.prototype.destory=function(){this.pos=null,this._name=null,this.needDraw=null,this.clear=!0},e}(t.baseMeshVo);t.CharNameMeshVo=i;var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.posx=-5,e}return __extends(e,t),e.prototype.destory=function(){this.pos=null,this.num=null,this.colortype=null},e}(t.baseMeshVo);t.BloodLineMeshVo=a;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.destory=function(){this.pos=null,this.clear=!0},e}(t.baseMeshVo);t.JumpTextMeshVo=n;var r=function(t){function e(e,i,a){return t.call(this,e,i,a)||this}return __extends(e,t),e}(t.Dis2DUIContianerPanel);t.JumpTxtContianerPanel=r;var o=function(){function e(){this.uiContianerItem=new Array,this._charNameContianerPanel=new t.Dis2DUIContianerPanel(t.CharNameUiVo,new t.Rectangle(0,0,256,22),10),this._jumpTxtContianerPanel=new t.AlphaUiContianer(t.TextJumpUiDrawAndRefreash,new t.Rectangle(0,0,256,64),16),this.uiContianerItem.push(this._charNameContianerPanel),this.uiContianerItem.push(this._jumpTxtContianerPanel),this.resize()}return e.prototype.clearOneTemp=function(){for(var t=0;t<this.uiContianerItem.length;t++)this.uiContianerItem[t].clearOneTemp()},e.prototype.getCharNameMeshVo=function(e){void 0===e&&(e="测试名");var a=new i;return a.name=e,a.pos=new t.Vector3D(0,50,0),this._charNameContianerPanel.showTemp(a),a},e.prototype.getBloodExtMeshVo=function(){return null},e.prototype.showFlyText=function(t){},e.prototype.setJumpNum=function(t){this._jumpTxtContianerPanel.showTemp(t)},e.prototype.update=function(){for(var t=0;t<this.uiContianerItem.length;t++){this.uiContianerItem[t].update(0);for(var e=0;e<this.uiContianerItem[t].renderList.length;e++)this.uiContianerItem[t].renderList[e].update()}},e.prototype.resize=function(){this._jumpTxtContianerPanel.resize();for(var e=0;e<this.uiContianerItem.length;e++)this.uiContianerItem[e].resize();t.Scene_data.cam3D.needChange=!0},e}();t.BloodManager=o}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._canvas=document.createElement("canvas"),this._cxt=this._canvas.getContext("2d"),this._gnt=this._cxt.createLinearGradient(0,0,128,0),this._canvas.style.zIndex="1"}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getImageData=function(e){for(var i=e.pos.length,a=new t.Vector3D,n=0;n<i;n++)t.Util.hexToArgb(e.color[n],!1,a),this._gnt.addColorStop(e.pos[n]/255,"rgba("+a.x+","+a.y+","+a.z+","+e.alpha[n]+")");return this._cxt.fillStyle=this._gnt,this._cxt.fillRect(0,0,128,2),this._cxt.getImageData(0,0,128,2)},e.prototype.getImageDataByVec=function(e,i){for(var a,n,r=this._cxt.createImageData(64,1),o=0;o<64;o++)a=4*o,n=4*t.Util.float2int(o/64*i),r.data[a]=e[n],r.data[a+1]=e[n+1],r.data[a+2]=e[n+2],r.data[a+3]=e[n+3];return r},e.prototype.setData=function(){},e}();t.ColorTransition=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._loadDic=new Object,i.scene=t,i}return __extends(i,e),i.prototype.getGroupData=function(e,i){var a=this;if(this._dic[e]){var n=this._dic[e];return n.useNum++,void i(n)}if(this._loadDic[e])this._loadDic[e].push(i);else{this._loadDic[e]=new Array,this._loadDic[e].push(i);var r=new t.GroupRes;r.load(e,(function(){for(var t=a._loadDic[e],i=0;i<t.length;i++){(0,t[i])(r)}a._dic[e]=r,delete a._loadDic[e],r.initReg()}))}},i.prototype.perLoadData=function(e,i){var a=this;if(this._dic[e])i&&i();else if(this._loadDic[e])this._loadDic[e].push(i);else{this._loadDic[e]=new Array,this._loadDic[e].push(i);var n=new t.GroupRes;n.scene=this.scene,n.load(e,(function(){a._dic[e]=n,delete a._loadDic[e],n.initReg(),i&&i()}))}},i}(t.ResGC);t.GroupDataManager=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.MouseDown="mousedown",t.MouseUp="mouseup",t.MouseMove="mousemove",t.MouseClick="mouseclick",t.KeyDown="keydown",t.KeyUp="keyup",t.MouseWheel="mousewheel",t.TouchStart="touchstart",t.TouchMove="touchmove",t.TouchEnd="touchend",t.TouchClick="touchstart",t}();t.MouseType=e;var i=function(){function i(){var e=this;this._isUpData=!0,this.speedNum=10,this._keyDic=new Object,this._lostMousePos=new t.Object3D,this._lastFousce=new t.Object3D,this._isMouseDown=!1,setInterval((function(){e.upData()}),1e3/60)}return Object.defineProperty(i,"instance",{get:function(){return this._instance||(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.init=function(){document.addEventListener(e.MouseDown,this.onMouseDown),document.addEventListener(e.MouseUp,this.onMouseUp),document.addEventListener(e.MouseMove,this.onMouseMove),document.addEventListener(e.KeyDown,this.onKeyDown),document.addEventListener(e.KeyUp,this.onKeyUp)},i.prototype.clearAllEvet=function(){document.removeEventListener(e.MouseDown,this.onMouseDown),document.removeEventListener(e.MouseUp,this.onMouseUp),document.removeEventListener(e.MouseMove,this.onMouseMove),document.removeEventListener(e.KeyDown,this.onKeyDown),document.removeEventListener(e.KeyUp,this.onKeyUp)},i.prototype.clearMouseEvent=function(){document.removeEventListener(e.MouseDown,this.onMouseDown),document.removeEventListener(e.MouseUp,this.onMouseUp),document.removeEventListener(e.MouseMove,this.onMouseMove),this._isUpData=!1},i.prototype.onMouseMove=function(e){var a=i.instance,n=new t.Object3D;n.x=e.pageX,n.y=e.pageY,a._isMouseDown&&(t.Scene_data.cam3D.rotationY=a._lastFousce.rotationY-(n.x-a._lostMousePos.x)/10,t.Scene_data.cam3D.rotationX=a._lastFousce.rotationX-(n.y-a._lostMousePos.y)/10)},i.prototype.onMouseDown=function(e){var a=i.instance;a._isMouseDown=!0,a._lostMousePos.x=e.pageX,a._lostMousePos.y=e.pageY,a._lastFousce.rotationX=t.Scene_data.cam3D.rotationX,a._lastFousce.rotationY=t.Scene_data.cam3D.rotationY},i.prototype.onMouseUp=function(t){i.instance._isMouseDown=!1},i.prototype.upData=function(){if(this._isUpData){var e=this._keyDic;e[65]&&this.tureLeft(),e[83]&&this.tureDown(),e[68]&&this.tureRight(),e[87]&&this.tureUp(),e[81]&&(t.Scene_data.cam3D.y-=this.speedNum),e[69]&&(t.Scene_data.cam3D.y+=this.speedNum),t.MathClass.MathCam(t.Scene_data.cam3D)}},i.prototype.tureLeft=function(){var e=new t.Vector3D(-this.speedNum,0,0,1);new t.Matrix3D;this.mathFocus3D(e)},i.prototype.tureRight=function(){var e=new t.Vector3D(this.speedNum,0,0,1);this.mathFocus3D(e)},i.prototype.tureUp=function(){var e=new t.Vector3D(0,0,this.speedNum,1);this.mathFocus3D(e)},i.prototype.tureDown=function(){var e=new t.Vector3D(0,0,-this.speedNum,1);this.mathFocus3D(e)},i.prototype.mathFocus3D=function(e){var i=new t.Matrix3D;i.prependRotation(-t.Scene_data.cam3D.rotationY,t.Vector3D.Y_AXIS),i.prependRotation(-t.Scene_data.cam3D.rotationX,t.Vector3D.X_AXIS),e=i.transformVector(e),t.Scene_data.cam3D.x+=e.x,t.Scene_data.cam3D.y+=e.y,t.Scene_data.cam3D.z+=e.z},i.prototype.onKeyDown=function(t){i.instance._keyDic[t.keyCode]=!0,t.keyCode},i.prototype.onKeyUp=function(t){i.instance._keyDic[t.keyCode]=!1},i}();t.KeyControl=i}(tl3d||(tl3d={})),function(t){var e=function(){function t(){}return t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.Left=37,t.Up=38,t.Right=39,t.Down=40,t.Delete=46,t.F1=112,t.F2=113,t}();t.KeyboardType=e}(tl3d||(tl3d={})),function(t){var e=function(){};t.TextRegVo=e;var i=function(){function i(){}return i.pushStr=function(t){this.item=new Array;for(var a,n=/\[\]|\[[A-Za-z0-9]{6}\]/g;null!=(a=n.exec(t));){var r=new e;r.begin=a.index,r.end=n.lastIndex,r.color=a.toString(),r.color=r.color.replace("[",""),r.color=r.color.replace("]",""),r.color.length<5?r.color=i.defaultColor:r.color="#"+r.color,this.item.push(r)}},i.pushStrCopy=function(t){this.item=new Array;for(var a,n=/\[\]|\[[A-Za-z0-9]{6}\]/g,r=t;null!=(a=n.exec(t));){var o=new e;o.begin=a.index,o.end=n.lastIndex,o.color=a.toString(),r=r.replace(o.color,"#"),o.color=o.color.replace("[",""),o.color=o.color.replace("]",""),o.color.length<5?o.color=i.defaultColor:(t.replace("["+o.color+"]","#"),o.color="#"+o.color),this.item.push(o)}return r},i.isColor=function(t,e){for(var i=0;i<this.item.length;i++)if(t>=this.item[i].begin&&t<this.item[i].end)return e&&(e.fillStyle=this.item[i].color),!0;return!1},i.getTextMetrics=function(t,e){e||(e=""),this.pushStr(e);for(var i=e,a="",n=0;n<i.length;n++)this.isColor(n,t)||(a+=i[n]);return t.measureText(a)},i.getTextOnlyTxt=function(t,e){e||(e=""),this.pushStr(e);for(var i=e,a="",n=0;n<i.length;n++)this.isColor(n,t)||(a+=i[n]);return a},i.getNextWords=function(e,i){if("/"==e[i]&&e.length>i+2)for(var a=e[i+0]+e[i+1]+e[i+2],n=0;n<t.UIData.faceItem.length;n++)if(t.UIData.faceItem[n]==a)return n+1;return-1},i.wrapText=function(e,a,n,r,o,s,h,c,u,l,d){void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=500),void 0===h&&(h=10),void 0===c&&(c=12),void 0===u&&(u=""),void 0===l&&(l=2),void 0===d&&(d=1),i.defaultColor=n,s*=.98,""!=u&&(-1!=u.indexOf("[")&&(u="#"+u.substr(1,6)),e.strokeStyle=u,e.lineWidth=l),this.pushStr(a);for(var p=a,f="",m=0,y=1,_=0;p&&_<p.length;_++)if(!this.isColor(_,e)){var v=e.measureText(f.replace("\n","")),x=this.getNextWords(p,_);if(-1==x)v.width>s||"\n"==p[_]?(m+=h,f="",y++,"\n"!=p[_]&&(""!=u&&e.strokeText(p[_],r,o+m),e.fillText(p[_],r,o+m))):(""!=u&&e.strokeText(p[_],r+v.width*d,o+m),e.fillText(p[_],r+v.width*d,o+m)),"\n"!=p[_]&&(f+=p[_]);else{var g=1.4*c,D=new t.Rectangle(r+1*v.width+0,o+m-g/10,g,g);v.width>s&&(m+=h,f="",y++,D=new t.Rectangle(r+0,o+m-g/10,g,g)),this.drawFaceIcon(e,D,x),_+=2,f+="脸1"}}return y},i.wrapTextVertical=function(t,e,a,n,r,o,s,h,c,u,l){void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=500),void 0===s&&(s=10),void 0===h&&(h=12),void 0===c&&(c=""),void 0===u&&(u=4),void 0===l&&(l=1),i.defaultColor=a,""!=c&&(-1!=c.indexOf("[")&&(c="#"+c.substr(1,6)),t.strokeStyle=c,t.lineWidth=u),this.pushStr(e);for(var d=e,p=2,f=1,m=0,y=0;d&&y<d.length;y++){if(!this.isColor(y,t))-1==this.getNextWords(d,y)&&(m>o||"\n"==d[y]?(p+=s,"",m=0,"\n"!=d[y]&&(""!=c&&t.strokeText(d[y],n+p,m),t.fillText(d[y],n+p,m)),f++):(m+=h+5,""!=c&&t.strokeText(d[y],n+p,m),t.fillText(d[y],n+p,m)),d[y])}return f},i.drawText=function(t,e,n,r,o,s){void 0===r&&(r=500),void 0===o&&(o=10),void 0===s&&(s=12),i.defaultColor=n;for(var h=this.pushStrCopy(e),c=0,u=0,l="",d=0,p=new Array,f=h.split("#"),m=0;m<f.length;m++){var y=f[m];if(""!=y){t.fillStyle=m>0?this.item[m-1].color:n;for(var _=0;_<y.length;_++)if("\n"==y[_]){var v=new a(l,u,t.measureText(l).width,t.fillStyle,r);p.push(v),d=0,l="",u+=o}else{var x=l+y[_],g=t.measureText(x).width+d;if(c=Math.min(r,g),g>r){v=new a(l,u,t.measureText(l).width,t.fillStyle,r);p.push(v),l=y[_]+"",u+=o,d=0}else l=x}d+=t.measureText(l).width;v=new a(l,u,t.measureText(l).width,t.fillStyle,r);p.push(v),l=""}}for(var D,b=-1e4,S=0;S<p.length;S++)b!=p[S].posy&&(b=p[S].posy,D=this.getStartPoint(p[S],p),D=Math.max(D,0)),t.fillStyle=p[S].color,t.fillText(p[S].str,D,b),D+=p[S].width;return[c,u+=o]},i.getStartPoint=function(t,e){for(var i=new Array,a=0;a<e.length;a++){var n=e[a];t.posy==n.posy&&i.push(n)}for(var r=0,o=0;o<i.length;o++)r+=i[o].width;return(t.maxwidth-r)/2},i.drawFaceIcon=function(e,i,a){t.UiDraw.cxtDrawImg(e,"F_FACE_"+a,i,t.UIData.publicUi)},i.defaultColor="#000000",i}();t.TextRegExp=i;var a=function(t,e,i,a,n){this.str=t,this.posy=e,this.width=i,this.color=a,this.maxwidth=n};t.TextCell=a;var n=function(){function e(){}return e.writeSingleLabel=function(e,a,n,r,o,s,h,c,u,l){void 0===r&&(r=12),void 0===o&&(o=t.TextAlign.CENTER),void 0===s&&(s="#ffffff"),void 0===h&&(h=""),void 0===c&&(c=0),void 0===u&&(u=4),void 0===l&&(l=!0),-1!=s.indexOf("[")&&(s="#"+s.substr(1,6));var d=e.getRec(a),p=t.UIManager.getInstance().getContext2D(d.pixelWitdh,d.pixelHeight,!1);p.fillStyle=s,p.font=(l?"bolder ":"")+" "+r+"px "+t.UIData.font;var f=i.getTextMetrics(p,n),m=0;return o==t.TextAlign.CENTER?m=(d.pixelWitdh-f.width)/2:o==t.TextAlign.RIGHT&&(m=d.pixelWitdh-f.width),i.wrapText(p,n,s,m,c,d.pixelWitdh-r/2,20,r,h,u),e.updateCtx(p,d.pixelX,d.pixelY),f.width},e.writeTextLabel=function(e,a,n,r,o,s,h,c,u,l,d){void 0===r&&(r=12),void 0===o&&(o="center"),void 0===s&&(s=500),void 0===h&&(h="#ffffff"),void 0===c&&(c=""),void 0===u&&(u=0),void 0===l&&(l=4),void 0===d&&(d=!0),-1!=h.indexOf("[")&&(h="#"+h.substr(1,6));var p=r+4,f=e.getRec(a),m=t.UIManager.getInstance().getContext2D(f.pixelWitdh,f.pixelHeight,!1);m.fillStyle=h,m.textAlign=o,m.font=(d?"bolder ":"")+" "+r+"px "+t.UIData.font;var y=i.getTextMetrics(m,n),_=i.wrapText(m,n,h,0,u,s,p,r,c,l);return e.updateCtx(m,f.pixelX,f.pixelY),[y.width,_*p]},e.writeSingleLabelToCtx=function(e,a,n,r,o,s,h,c,u){void 0===n&&(n=12),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=t.TextAlign.CENTER),void 0===h&&(h="#ffffff"),void 0===c&&(c=""),void 0===u&&(u=!0),-1!=h.indexOf("[")&&(h="#"+h.substr(1,6)),e.fillStyle=h,e.font=(u?"bolder ":"")+" "+n+"px "+t.UIData.font;var l=i.getTextMetrics(e,a);return s==t.TextAlign.CENTER?r+=(e.canvas.width-l.width)/2:s==t.TextAlign.RIGHT&&(r+=e.canvas.width-l.width),i.wrapText(e,a,h,r,o,9999,20,n,c),l.width},e.writeSingleLabelToCtxByVertical=function(e,a,n,r,o,s,h,c){void 0===n&&(n=12),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s="#ffffff"),void 0===h&&(h=""),void 0===c&&(c=!0),-1!=s.indexOf("[")&&(s="#"+s.substr(1,6)),e.fillStyle=s,e.font=(c?"bolder ":"")+" "+n+"px "+t.UIData.font,i.wrapTextVertical(e,a,s,r,o,9999,20,n,h)},e.writeSingleLabelToCtxSetAnchor=function(e,a,n,r,o,s,h,c,u){void 0===n&&(n=12),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=t.TextAlign.CENTER),void 0===h&&(h="#ffffff"),void 0===c&&(c=""),void 0===u&&(u=!0),-1!=h.indexOf("[")&&(h="#"+h.substr(1,6)),e.fillStyle=h,e.font=(u?"bolder ":"")+" "+n+"px "+t.UIData.font;var l=i.getTextMetrics(e,a);return s==t.TextAlign.CENTER?r-=l.width/2:s==t.TextAlign.RIGHT&&(r-=l.width),i.wrapText(e,a,h,r,o,9999,20,n,c),l.width},e.writeText=function(e,i,a,n,r,o,s,h,c,u){void 0===h&&(h=0),void 0===c&&(c=!1),void 0===u&&(u="left"),-1!=s.indexOf("[")&&(s="#"+s.substr(1,6));var l,d=e.getRec(i),p=t.UIManager.getInstance().getContext2D(d.pixelWitdh,d.pixelHeight,!1);p.fillStyle=s,p.font=(c?"bolder ":"")+o+"px "+t.UIData.font,p.textAlign=u;this.getTextxpos(u,p);return l=this.wrapText(p,r,a,n,h,o+5),e.updateCtx(p,d.pixelX,d.pixelY),l},e.writeTextAutoCenterByAnchor=function(e,a,n,r,o,s,h,c){void 0===h&&(h=!0),void 0===c&&(c=""),-1!=o.indexOf("[")&&(o="#"+o.substr(1,6));var u=e.getRec(a),l=t.UIManager.getInstance().getContext2D(u.pixelWitdh,u.pixelHeight,!1);l.fillStyle=o,l.font=(h?"bolder ":"")+r+"px "+t.UIData.font,l.textAlign="left";var d=i.drawText(l,n,o,s,r+5,r);return e.updateCtx(l,u.pixelX,u.pixelY),d},e.writeTextAutoVerticalCenter=function(e,a,n,r,o,s,h,c){void 0===h&&(h=""),void 0===c&&(c=!1),-1!=o.indexOf("[")&&(o="#"+o.substr(1,6));var u=e.getRec(a),l=t.UIManager.getInstance().getContext2D(u.pixelWitdh,u.pixelHeight,!1);l.fillStyle=o,l.font=(c?"bolder ":"")+r+"px "+t.UIData.font;var d=0;this.getTextxpos(t.TextAlign.LEFT,l);s>0&&(this.isNewline(l,n,s)||(d=u.pixelHeight/2-r/2),i.wrapText(l,n,o,0,d,s,r+3,r,h)),e.updateCtx(l,u.pixelX,u.pixelY)},e.writeTextAutoCenter=function(e,a,n,r,o,s,h){void 0===h&&(h=!1),-1!=o.indexOf("[")&&(o="#"+o.substr(1,6));var c=e.getRec(a),u=t.UIManager.getInstance().getContext2D(c.pixelWitdh,c.pixelHeight,!1);u.fillStyle=o,u.font=(h?"bolder ":"")+r+"px "+t.UIData.font;var l=0,d=0;this.getTextxpos(t.TextAlign.LEFT,u);if(s>0){if(!this.isNewline(u,n,s)){var p=u.measureText(n);d=c.pixelHeight/2-r/2,l=c.pixelWitdh/2-p.width/2}i.wrapText(u,n,o,l,d,s,r+3)}e.updateCtx(u,c.pixelX,c.pixelY)},e.isNewline=function(t,e,i){var a=e;return t.measureText(a).width>i},e.getTextxpos=function(e,i){var a=0;return e==t.TextAlign.LEFT?a=0:e==t.TextAlign.RIGHT?a=i.canvas.width:e==t.TextAlign.CENTER&&(a=i.canvas.width/2),a},e.wrapText=function(t,e,i,a,n,r){for(var o=0,s=a,h=e,c="",u=0;u<h.length;u++)if("\n"==h[u])t.fillText(c,i,s),c="",s+=r;else{var l=c+h[u],d=t.measureText(l).width;o=Math.max(o,d),d>n?(t.fillText(c,i,s),c=h[u]+"",s+=r):c=l}return t.fillText(c,i,s),[o,s=s-a+r]},e.clearLabel=function(e,i){var a=e.getRec(i),n=t.UIManager.getInstance().getContext2D(a.pixelWitdh,a.pixelHeight,!1);e.updateCtx(n,a.pixelX,a.pixelY)},e}();t.LabelTextFont=n}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._defaultVec=new Array;for(var e=[.4444730390920146,-.3834955622240026,-.33124467509627725,.09365654209093091,-.05673310882817577,.2120523322966496,.02945768486978205,-.04965996229802928,-.1136529129285836],i=0;i<9;i++)this._defaultVec.push(new t.Vector3D(e[i],e[i],e[i]))}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setLightProbeData=function(t){this._dataAry=t},e.prototype.clear=function(){this._dataAry=null},e.prototype.getData=function(e){if(!this._dataAry)return this._defaultVec;for(var i=0;i<this._dataAry.length;i++){var a=this._dataAry[i];if(this.testPoint(a,e)){var n=a.postion,r=e.subtract(n);return this.getResultData(a.posItem,t.Util.float2int(r.x/a.betweenNum),t.Util.float2int(r.z/a.betweenNum),t.Util.float2int(r.y/a.betweenNum),a.betweenNum,r)}}return this._defaultVec},e.prototype.testPoint=function(t,e){var i=(t.cubeVec.x-1)*t.betweenNum,a=(t.cubeVec.y-1)*t.betweenNum,n=(t.cubeVec.z-1)*t.betweenNum,r=e.x-t.postion.x,o=e.y-t.postion.y,s=e.z-t.postion.z;return r>=0&&r<i&&o>=0&&o<a&&s>=0&&s<n},e.prototype.getResultData=function(e,a,n,r,o,s){var h=new Array;h.push(new i(e[a][n][r],s)),h.push(new i(e[a+1][n][r],s)),h.push(new i(e[a][n+1][r],s)),h.push(new i(e[a+1][n+1][r],s)),h.push(new i(e[a][n][r+1],s)),h.push(new i(e[a+1][n][r+1],s)),h.push(new i(e[a][n+1][r+1],s)),h.push(new i(e[a+1][n+1][r+1],s));for(var c=0,u=0;u<h.length;u++)c+=h[u].dis;for(u=0;u<h.length;u++)h[u].setBais(c);var l=0;for(u=0;u<h.length;u++)l+=h[u].bais;for(u=0;u<h.length;u++)h[u].bais=h[u].bais/l;var d=new Array;for(u=0;u<9;u++){for(var p=new t.Vector3D,f=0;f<h.length;f++){var m=new t.Vector3D(h[f].vecNum[u].x,h[f].vecNum[u].y,h[f].vecNum[u].z);m.scaleBy(h[f].bais),p=p.add(m)}d.push(p)}return d},e}();t.LightProbeManager=e;var i=function(){function e(e,i){this.pos=new t.Vector3D(e.x,e.y,e.z),this.vecNum=e.resultSHVec,this.dis=t.Vector3D.distance(this.pos,i)}return e.prototype.setBais=function(t){this.bais=this.dis/t*(this.dis/t),this.bais=1/this.bais},e}()}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._loadThreadList=new Array,this._waitLoadList=new Array;for(var t=0;t<5;t++)this._loadThreadList.push(new i)}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.getVersion=function(e){return e=t.Scene_data.fileSub+e,this._versions&&this._versions[e]||e},e.prototype.load=function(e,i,n,r,o){void 0===r&&(r=null),void 0===o&&(o=null),""!=t.Scene_data.fileRoot&&(e=e.replace(t.Scene_data.fileRoot,""),e=t.Scene_data.fileRoot+this.getVersion(e));for(var s=new a(e,i,n,r,o),h=0;h<this._loadThreadList.length;h++)if(this._loadThreadList[h].idle)return void this._loadThreadList[h].load(s);this._waitLoadList.push(s)},e.prototype.loadWaitList=function(){if(!(this._waitLoadList.length<=0))for(var t=0;t<this._loadThreadList.length;t++)if(this._loadThreadList[t].idle)return void this._loadThreadList[t].load(this._waitLoadList.shift())},e.BYTE_TYPE="BYTE_TYPE",e.IMG_TYPE="IMG_TYPE",e.XML_TYPE="XML_TYPE",e}();t.LoadManager=e;var i=function(){function i(){var t=this;this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=function(){t._xhr&&4===t._xhr.readyState&&(0===t._xhr.status||200===t._xhr.status?t.loadByteXML():t.loadError())},this._xhr.onprogress=function(e){t._loadInfo.progressFun&&t._loadInfo.progressFun(e.loaded/e.total)},this._xhr.onerror=function(){t.loadError()},this._img=new Image,this._img.onload=function(){t.loadImg()},this._img.onerror=function(){t.loadError()},this.idle=!0}return i.prototype.load=function(t){this._loadInfo=t,this.idle=!1,this._url=t.url,this._loadInfo.type==e.BYTE_TYPE?(this._xhr.open("GET",t.vurl,!0),this._xhr.responseType="arraybuffer",this._xhr.send()):this._loadInfo.type==e.XML_TYPE?(this._xhr.open("GET",t.vurl,!0),this._xhr.responseType="text",this._xhr.send()):this._loadInfo.type==e.IMG_TYPE&&(this._img.url==t.vurl?this.loadImg():(this._img.url=t.vurl,this._img.src=t.vurl))},i.prototype.loadError=function(){this.idle=!0,this._loadInfo=null,e.getInstance().loadWaitList()},i.prototype.loadByteXML=function(){this._loadInfo.info?this._loadInfo.fun(this._xhr.response,this._loadInfo.info):this._loadInfo.fun(this._xhr.response),this.idle=!0,this._loadInfo=null,e.getInstance().loadWaitList()},i.prototype.loadByteImg=function(){this._img.src="data:image/png;base64,"+t.Base64.encode(this._xhr.response)},i.prototype.loadImg=function(){this._loadInfo.info?this._loadInfo.fun(this._img,this._loadInfo.info):this._loadInfo.fun(this._img),this.idle=!0,this._loadInfo=null,e.getInstance().loadWaitList()},i}();t.LoaderThread=i;var a=function(){function t(t,e,i,a,n){void 0===a&&(a=null),void 0===n&&(n=null),this.url=t,this.type=e,this.fun=i,this.info=a,this.progressFun=n}return Object.defineProperty(t.prototype,"vurl",{get:function(){return this.url},enumerable:!0,configurable:!0}),t}();t.LoadInfo=a}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._loadDic=new Object,t}return __extends(i,e),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.getMeshData=function(e,i,a){var n=this;if(void 0===a&&(a=1),this._dic[e]&&this._dic[e].ready)return i(this._dic[e]),void this._dic[e].useNum++;this._loadDic[e]?this._loadDic[e].push(i):(this._loadDic[e]=new Array,this._loadDic[e].push(i),this.loadRoleRes(t.Scene_data.fileRoot+e,(function(t){n.roleResCom(t,i)}),a))},i.prototype.loadRoleRes=function(e,i,a){var n=new t.RoleRes;n.meshBatchNum=a,n.load(e,(function(){i(n)}))},i.prototype.roleResCom=function(t,e){var i=t.roleUrl,a=this._dic[i];a.loadMaterial(),a.setAction(t.actionAry,i),a.url=i,t.ambientLightColor&&(a.lightData=[[t.ambientLightColor.x,t.ambientLightColor.y,t.ambientLightColor.z],[t.nrmDircet.x,t.nrmDircet.y,t.nrmDircet.z],[t.sunLigthColor.x,t.sunLigthColor.y,t.sunLigthColor.z]]);for(var n=0;n<this._loadDic[i].length;n++)this._loadDic[i][n](a),a.useNum++;delete this._loadDic[i],a.ready=!0},i.prototype.readData=function(e,i,a,n){var r=new t.SkinMesh;r.fileScale=e.readFloat(),r.tittleHeight=n>=19?e.readFloat():50,r.hitBox=new t.Vector2D(20,20),n>=23&&(r.hitBox.x=e.readFloat(),r.hitBox.y=e.readFloat()),r.makeHitBoxItem();for(var o=e.readInt(),s=new Object,h=0;h<o;h++){var c=new t.MeshData;n>=35&&(c.bindPosAry=this.readBindPosByte(e),c.getBindPosMatrix()),n>=21?this.readMesh2OneBuffer(e,c):(t.BaseRes.readFloatTwoByte(e,c.vertices),t.BaseRes.readFloatTwoByte(e,c.tangents),t.BaseRes.readFloatTwoByte(e,c.bitangents),t.BaseRes.readFloatTwoByte(e,c.normals),t.BaseRes.readFloatTwoByte(e,c.uvs),t.BaseRes.readIntForOneByte(e,c.boneIDAry),t.BaseRes.readFloatOneByte(e,c.boneWeightAry),t.BaseRes.readIntForTwoByte(e,c.indexs),t.BaseRes.readIntForTwoByte(e,c.boneNewIDAry),this.uploadMesh(c)),c.treNum=c.indexs.length,c.materialUrl=e.readUTF(),c.materialParamData=t.BaseRes.readMaterialParamData(e);for(var u=e.readInt(),l=0;l<u;l++){var d=new t.BindParticle(e.readUTF(),e.readUTF());c.particleAry.push(d),s[d.url]=!0}r.addMesh(c)}for(var p in s)t.ParticleManager.getInstance().registerUrl(p);if(r.allParticleDic=s,n<35)for(var f=this.readBindPosByte(e),m=0;m<r.meshAry.length;m++)r.meshAry[m].bindPosAry=f,r.meshAry[m].getBindPosMatrix();var y=e.readInt();r.boneSocketDic=new Object;for(l=0;l<y;l++){var _=new t.BoneSocketData;_.name=e.readUTF(),_.boneName=e.readUTF(),_.index=e.readInt(),_.x=e.readFloat(),_.y=e.readFloat(),_.z=e.readFloat(),_.rotationX=e.readFloat(),_.rotationY=e.readFloat(),_.rotationZ=e.readFloat(),r.boneSocketDic[_.name]=_}return this._dic[a]=r,r},i.prototype.readBindPosByte=function(t){for(var e=t.readInt(),i=new Array,a=0;a<e;a++){var n=new Array(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat());i.push(n)}return i},i.prototype.readMesh2OneBuffer=function(e,i){for(var a=e.readInt(),n=new Array,r=0,o=0;o<5;o++){var s=e.readBoolean();n.push(s),s&&(r+=1==o?2:3)}a*=4*(r+=8);var h,c=(h=n[2]?n[4]?14:8:5)+4,u=new ArrayBuffer(a),l=new DataView(u);t.BaseRes.readBytes2ArrayBuffer(e,l,3,0,r),t.BaseRes.readBytes2ArrayBuffer(e,l,2,3,r),t.BaseRes.readBytes2ArrayBuffer(e,l,3,5,r),t.BaseRes.readBytes2ArrayBuffer(e,l,3,8,r),t.BaseRes.readBytes2ArrayBuffer(e,l,3,11,r),t.BaseRes.readBytes2ArrayBuffer(e,l,4,h,r,2),t.BaseRes.readBytes2ArrayBuffer(e,l,4,c,r,1),t.BaseRes.readIntForTwoByte(e,i.indexs),t.BaseRes.readIntForTwoByte(e,i.boneNewIDAry),i.compressBuffer=!0,i.uvsOffsets=12,i.normalsOffsets=20,i.tangentsOffsets=32,i.bitangentsOffsets=44,i.boneIDOffsets=4*h,i.boneWeightOffsets=4*c,i.stride=4*r,i.vertexBuffer=t.Scene_data.context3D.uploadBuff3DArrayBuffer(u),i.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(i.indexs)},i.prototype.cloneMeshData=function(t,e){var i=t.vertices,a=t.normals,n=t.uvs,r=t.boneIDAry,o=t.boneWeightAry,s=t.indexs;t.vertices=new Array,t.normals=new Array,t.uvs=new Array,t.boneIDAry=new Array,t.boneWeightAry=new Array,t.indexs=new Array;for(var h=i.length/3,c=0;c<e;c++){t.vertices=t.vertices.concat(i),t.normals=t.normals.concat(a),t.boneIDAry=t.boneIDAry.concat(r),t.boneWeightAry=t.boneWeightAry.concat(o);for(var u=0;u<n.length;u+=2)t.uvs.push(n[u],n[u+1],c);for(u=0;u<s.length;u++)t.indexs.push(s[u]+c*h)}t.treNum=t.indexs.length},i.prototype.uploadMesh=function(e){e.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(e.vertices),e.uvBuffer=t.Scene_data.context3D.uploadBuff3D(e.uvs),e.boneIdBuffer=t.Scene_data.context3D.uploadBuff3D(e.boneIDAry),e.boneWeightBuffer=t.Scene_data.context3D.uploadBuff3D(e.boneWeightAry),e.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(e.indexs)},i.prototype.uploadPbrMesh=function(e,i){e.normalsBuffer=t.Scene_data.context3D.uploadBuff3D(e.normals),i&&(e.tangentBuffer=t.Scene_data.context3D.uploadBuff3D(e.tangents),e.bitangentBuffer=t.Scene_data.context3D.uploadBuff3D(e.bitangents))},i.prototype.preLoad=function(t){this.getMeshData(t,(function(t){t.loadMaterial()}))},i}(t.ResGC);t.MeshDataManager=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._loadList=new Object,t}return __extends(i,e),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.getObjData=function(e,i){var a=this;if(this._dic[e])return i(this._dic[e]),void this._dic[e].useNum++;this._loadList[e]||(this._loadList[e]=new Array,t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t){a.loadObjCom(t,e)}))),this._loadList[e].push(i)},i.prototype.registerUrl=function(t){this._dic[t]&&this._dic[t].useNum++},i.prototype.releaseUrl=function(t){this._dic[t]&&this._dic[t].clearUseNum()},i.prototype.readFloatNrm=function(t,e){var i=t.readInt();if(i>0)for(var a=0;a<i;a++)e.push(t.readFloat())},i.prototype.readcollisionItem=function(e,i){var a=e.readInt();if(a>0){i.collision=new t.CollisionItemVo,i.collision.collisionItem=new Array;for(var n=0;n<a;n++){var r=JSON.parse(e.readUTF()),o=new t.CollisionVo;o.scaleX=r.scale_x,o.scaleY=r.scale_y,o.scaleZ=r.scale_z,o.x=r.x,o.y=r.y,o.z=r.z,o.rotationX=r.rotationX,o.rotationY=r.rotationY,o.rotationZ=r.rotationZ,o.scaleX=this.getFloadNum(o.scaleX),o.scaleY=this.getFloadNum(o.scaleY),o.scaleZ=this.getFloadNum(o.scaleZ),o.rotationX=this.getFloadNum(o.rotationX),o.rotationY=this.getFloadNum(o.rotationY),o.rotationZ=this.getFloadNum(o.rotationZ),o.type=r.type,o.data=r.data,i.collision.collisionItem.push(o)}}},i.prototype.getFloadNum=function(t){return Math.floor(1e3*t)/1e3},i.prototype.loadObjCom=function(e,i){if(!this._dic[i]){var a=new t.ObjData,n=new t.TLByteArray(e),r=n.readInt();n.readUTF();r>=20?(this.readObj2OneBuffer(n,a),r>=37&&n.position<n.length&&this.readcollisionItem(n,a)):(t.BaseRes.readFloatTwoByte(n,a.vertices),t.BaseRes.readFloatTwoByte(n,a.uvs),t.BaseRes.readFloatOneByte(n,a.lightuvs),t.BaseRes.readFloatTwoByte(n,a.normals),t.BaseRes.readIntForTwoByte(n,a.indexs),t.BaseRes.readFloatTwoByte(n,a.tangents),t.BaseRes.readFloatTwoByte(n,a.bitangents),a.vertexBuffer=t.Scene_data.context3D.uploadBuff3D(a.vertices),a.uvBuffer=t.Scene_data.context3D.uploadBuff3D(a.uvs),a.lightUvBuffer=t.Scene_data.context3D.uploadBuff3D(a.lightuvs),a.normalsBuffer=t.Scene_data.context3D.uploadBuff3D(a.normals)),a.treNum=a.indexs.length,a.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(a.indexs),this._dic[i]=a;var o=this._loadList[i];if(o){for(var s=0;s<o.length;s++)o[s](a);delete this._loadList[i]}return a}},i.prototype.readObj2OneBuffer=function(e,i){for(var a,n=new Array,r=(n=new Array,0),o=0;o<6;o++){var s=e.readBoolean();if(n.push(s),s)switch(o){case 1:case 2:r+=2;break;default:r+=3}}a=e.readFloat();a*=4*r;var h=new ArrayBuffer(a),c=new DataView(h),u=n[2]?7:5,l=u+3,d=l+3;t.BaseRes.readBytes2ArrayBuffer(e,c,3,0,r),t.BaseRes.readBytes2ArrayBuffer(e,c,2,3,r),t.BaseRes.readBytes2ArrayBuffer(e,c,2,5,r,1),t.BaseRes.readBytes2ArrayBuffer(e,c,3,u,r),t.BaseRes.readBytes2ArrayBuffer(e,c,3,l,r),t.BaseRes.readBytes2ArrayBuffer(e,c,3,d,r),t.BaseRes.readIntForTwoByte(e,i.indexs),i.vertexBuffer=t.Scene_data.context3D.uploadBuff3DArrayBuffer(h),i.compressBuffer=!0,i.uvsOffsets=12,i.lightuvsOffsets=20,i.normalsOffsets=4*u,i.tangentsOffsets=4*l,i.bitangentsOffsets=4*d,i.stride=4*r},i.prototype.creatTBNBuffer=function(e){e.tangentBuffer=t.Scene_data.context3D.uploadBuff3D(e.tangents),e.bitangentBuffer=t.Scene_data.context3D.uploadBuff3D(e.bitangents)},i}(t.ResGC);t.ObjDataManager=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.loadSceneRes=function(e,i,a,n){var r;return this._dic[e]?r=this._dic[e]:(r=new t.SceneRes,this._dic[e]=r),r.load(e,i,a,n),this.clearSceneUse(r),r},i.prototype.getRes=function(t){return this._dic[t]},i.prototype.clearSceneUseById=function(t){var e=this._dic[t];e&&e.clearUseNum()},i.prototype.clearSceneUse=function(t){for(var e in this._dic){var i=this._dic[e];i.useNum>0&&i!=t&&(i.useNum=0)}t.useNum=1},i}(t.ResGC);t.SceneResManager=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.getTimer=function(t){return void 0===t&&(t=e.START_TIME),Date.now()-t},e.getTimerSecond=function(){return e.getTimer()/1e3},e.saveNowTime=function(){this.lastTime=this.getTimer()},e.getUseTime=function(){return this.getTimer()-this.lastTime},e.getZeroTime=function(t){var e=new Date(1e3*t);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.getTime()/1e3},e.getLocalTime=function(t){var e=new Date(1e3*t);return e.toLocaleDateString().replace(/\//g,"-")+" "+e.toTimeString().substr(0,5)},e.getLocalTime0=function(t){return new Date(1e3*t).toLocaleDateString().replace(/\//g,"-")},e.getLocalTime1=function(t){var e=new Date(1e3*t);return e.toLocaleDateString().replace(/\//g,"-")+" "+e.toTimeString().substr(0,8)},e.getLocalTime2=function(t){return new Date(1e3*t).toTimeString().substr(0,8)},e.getLocalTime6=function(t){return new Date(1e3*t).toTimeString().substr(0,5)},e.getLocalTime3=function(t){return new Date(1e3*t).toTimeString().substr(3,5)},e.getLocalTime4=function(e){return t.Util.float2int(e/60)+"分"+e%60+"秒"},e.getLocalTime5=function(t){var e=new Date(1e3*t).toTimeString().substr(0,8).split(":");return e[0]+"时"+e[1]+"分"+e[2]+"秒"},e.getDiffTime1=function(e){var i=t.Util.float2int(e/this.dayTime);e-=i*this.dayTime;var a=t.Util.float2int(e/this.HourTime);e-=a*this.HourTime;var n=t.Util.float2int(e/this.MinuteTime);return i+"天"+a+"时"+n+"分"+(e-=n*this.MinuteTime)+"秒"},e.getDiffTime2=function(e){var i=t.Util.float2int(e/this.HourTime);e-=i*this.HourTime;var a=t.Util.float2int(e/this.MinuteTime);return e-=a*this.MinuteTime,this.zeroStr(i)+":"+this.zeroStr(a)+":"+this.zeroStr(e)},e.zeroStr=function(t){return t>9?String(t):"0"+t},e.getDelayTimeStr=function(t){var e=Math.floor(t/3600);return e>24?Math.floor(e/24)+"天前":e>=1?e+"小时前":"刚刚"},e.compareTime=function(t,e){return!1},e.init=function(){e.START_TIME=Date.now()},e.removeAllTickOut=function(){e.outTimeFunAry=[]},e.addTimeTick=function(t,a,n){void 0===n&&(n=0);var r=new i;r.alltime=t,r.fun=a,r.time=t-n,e.timefunAry.push(r)},e.removeTimeTick=function(t){for(var i=0;i<e.timefunAry.length;i++)if(e.timefunAry[i]&&e.timefunAry[i].fun==t){e.timefunAry[i]=null;break}},e.addTimeOut=function(t,i,n){if(!this.hasTimeOut(i)){var r=new a;r.alltime=t,r.fun=i,r.args=n,r.time=0,e.outTimeFunAry.push(r)}},e.removeTimeOut=function(t){for(var i=0;i<e.outTimeFunAry.length;i++)if(e.outTimeFunAry[i]&&e.outTimeFunAry[i].fun==t){e.outTimeFunAry[i]=null;break}},e.hasTimeOut=function(t){for(var i=0;i<e.outTimeFunAry.length;i++)if(e.outTimeFunAry[i]&&e.outTimeFunAry[i].fun==t)return!0;return!1},e.addFrameTick=function(t){-1==e.funAry.indexOf(t)&&e.funAry.push(t)},e.hasFrameTick=function(t){return-1!=e.funAry.indexOf(t)},e.removeFrameTick=function(t){var i=e.funAry.indexOf(t);-1!=i&&(e.funAry[i]=null)},e.update=function(){for(var t=e.getTimer()-e.time,i=0;i<e.funAry.length;i++)e.funAry[i]&&e.funAry[i](t);for(i=0;i<e.timefunAry.length;i++)e.timefunAry[i]&&e.timefunAry[i].update(t);for(i=e.outTimeFunAry.length-1;i>=0;i--)e.outTimeFunAry[i]&&e.outTimeFunAry[i].update(t)&&(e.outTimeFunAry[i]=null);for(i=e.funAry.length-1;i>=0;i--)e.funAry[i]||e.funAry.splice(i,1);for(i=e.timefunAry.length-1;i>=0;i--)e.timefunAry[i]||e.timefunAry.splice(i,1);for(i=e.outTimeFunAry.length-1;i>=0;i--)e.outTimeFunAry[i]||e.outTimeFunAry.splice(i,1);e.time=e.getTimer()},e.START_TIME=0,e.funAry=new Array,e.timefunAry=new Array,e.outTimeFunAry=new Array,e.time=0,e.lastTime=0,e.dayTime=86400,e.HourTime=3600,e.MinuteTime=60,e}();t.TimeUtil=e;var i=function(){function t(){this.alltime=0,this.time=0}return t.prototype.update=function(t){this.time+=t,this.time>=this.alltime&&(this.fun(),this.time=0)},t}(),a=function(){function t(){this.alltime=0,this.time=0}return t.prototype.update=function(t){return this.time+=t,this.time>=this.alltime&&(this.fun(this.args),!0)},t}()}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.float2int=function(t){return 0|t},e.radian2angle=function(t){return t/Math.PI*180},e.angle2radian=function(t){return t/180*Math.PI},e.makeImage=function(){var t=new Image;return t.setAttribute("crossOrigin","anonymous"),t},e.hexToArgb=function(e,i,a){return void 0===i&&(i=!0),void 0===a&&(a=null),a||(a=new t.Vector3D),a.w=i?e>>24&255:0,a.x=e>>16&255,a.y=e>>8&255,a.z=255&e,a},e.hexToArgbNum=function(t,i,a){return void 0===i&&(i=!0),void 0===a&&(a=null),(a=e.hexToArgb(t,i,a)).scaleBy(1/255),a},e.getBaseUrl=function(){return t.Scene_data.supportBlob?"":"_base"},e.strokeFilter=function(t,i,a,n){for(var r=e.hexToArgb(n),o=t.getImageData(0,0,i,a),s=o.data,h=new Array,c=1;c<i-1;c++)for(var u=0;u<a-1;u++){var l=d(c,u);0==s[l+3]&&p(c,u)&&h.push(l)}for(c=0;c<h.length;c++)s[h[c]]=r.x,s[h[c]+1]=r.y,s[h[c]+2]=r.z,s[h[c]+3]=r.w;t.putImageData(o,0,0);var d=function(t,e){return 4*(e*i+t)},p=function(t,e){var i;return i=d(t-1,e),s[i+3]>0||(i=d(t+1,e),s[i+3]>0||(i=d(t,e+1),s[i+3]>0||(i=d(t,e-1),s[i+3]>0)))}},e.trim=function(t){return e.trimRight(e.trimLeft(t))},e.trimLeft=function(t){if(null==t)return"";var e=new String(" \t\n\r"),i=new String(t);if(-1!=e.indexOf(i.charAt(0))){for(var a=0,n=i.length;a<n&&-1!=e.indexOf(i.charAt(a));)a++;i=i.substring(a,n)}return i},e.trimRight=function(t){if(null==t)return"";var e=new String(" \t\n\r"),i=new String(t);if(-1!=e.indexOf(i.charAt(i.length-1))){for(var a=i.length-1;a>=0&&-1!=e.indexOf(i.charAt(a));)a--;i=i.substring(0,a+1)}return i},e.getScencdStr=function(t){var e=Math.floor(t/60%60),i=Math.floor(t%60);return String(e<10?"0":"")+String(e)+":"+String(i<10?"0":"")+String(i)},e.random=function(t){return Math.floor(Math.random()*t)},e.randomByItem=function(t){return t[e.random(t.length)]},e.getRandomNumAssgin=function(t,i,a){for(var n=new Array,r=new Array,o=i;o<a;o++)r.push(o);for(var s=0;s<t;s++)if(a>s){var h=e.random(r.length),c=r.splice(h,1);n.push(c[0])}return n},e.makeArray=function(t,e){for(var i=0;i<t.length;i++)e.push(t[i])},e.unZip=function(t){var e=new Uint8Array(t);return new Zlib.Inflate(e).decompress().buffer},e.getZipByte=function(i){var a=i.readInt(),n=i.buffer.slice(i.position,i.position+a);i.position+=a;var r=e.unZip(n);return new t.TLByteArray(r)},e.getUrlParam=function(t){if(window.wx)return null;var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?decodeURI(i[2]):null},e.copy2clipboard=function(t){var e=document.createElement("textarea");e.style.fontSize="12pt",e.style.position="absolute",e.style["z-index"]=-1,e.style.background="transparent",e.style.border="transparent",e.style.color="white",e.setAttribute("readonly",""),document.body.appendChild(e),e.value=t,e.select(),e.setSelectionRange(0,e.value.length);try{document.execCommand("copy")}catch(t){alert("不支持复制")}setTimeout((function(){document.body.removeChild(e)}),1e3)},e.getBit=function(t,e){return Boolean(t>>(31&e)&1)},e}();t.Util=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this.valueV3d=[1,1,1,1]}return e.prototype.getValue=function(e){if(!this.valueVec||-1==this.begintFrame)return this.valueV3d;var i=t.Util.float2int(e/t.Scene_data.frameTime-this.begintFrame);return i<0?i=0:i>this.maxFrame-this.begintFrame&&(i=this.maxFrame-this.begintFrame),this.valueVec[i]},e.prototype.setData=function(t){this.type=t.type,this.maxFrame=t.maxFrame,t.items.length?this.begintFrame=t.items[0].frame:this.begintFrame=-1;for(var e=t.values[0].length,i=new Array,a=0;a<e;a++){var n=new Array;if(1==this.type)n.push(t.values[0][a]);else if(2==this.type)n.push(t.values[0][a],t.values[1][a]);else if(3==this.type)n.push(t.values[0][a],t.values[1][a],t.values[2][a]);else if(4==this.type){var r=t.values[3][a];n.push(t.values[0][a]*r,t.values[1][a]*r,t.values[2][a]*r,r)}i.push(n)}this.valueVec=i},e}();t.Curve=e}(tl3d||(tl3d={})),function(t){var e=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return __extends(a,e),a.prototype.load=function(e,i){var a=this;this._fun=i,t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t){a.loadComplete(t)}))},a.prototype.loadComplete=function(e){var i=this;this.dataAry=new Array,this._byte=new t.TLByteArray(e),this._byte.position=0,this.version=this._byte.readInt(),this.read((function(){i.readNext()}))},a.prototype.readNext=function(){if(this.read(),this.read(),this.read(),this._byte.readBoolean())for(var t=this._byte.readInt(),e=0;e<t;e++)this.readItem(!0);else this.readItem(!1);this._fun(),this._fun=null,this._byte=null},a.prototype.readItem=function(e){var a=this._byte.readInt(),n=new i;n.isGroup=e,e&&(n.x=this._byte.readFloat(),n.y=this._byte.readFloat(),n.z=this._byte.readFloat(),n.scaleX=this._byte.readFloat(),n.scaleY=this._byte.readFloat(),n.scaleZ=this._byte.readFloat(),n.rotationX=this._byte.readFloat(),n.rotationY=this._byte.readFloat(),n.rotationZ=this._byte.readFloat()),a==t.BaseRes.PREFAB_TYPE?(n.objUrl=this._byte.readUTF(),n.materialUrl=this._byte.readUTF(),this.version>=4&&(n.materialInfoArr=this.readMaterialInfo()),n.types=t.BaseRes.PREFAB_TYPE):a==t.BaseRes.SCENE_PARTICLE_TYPE&&(n.particleUrl=this._byte.readUTF(),n.types=t.BaseRes.SCENE_PARTICLE_TYPE),this.dataAry.push(n)},a.prototype.initReg=function(){this._objDic=new Object,this._materialDic=new Object,this._particleDic=new Object;for(var e=0;e<this.dataAry.length;e++){var i=this.dataAry[e];i.objUrl&&(this._objDic[t.Scene_data.fileRoot+i.objUrl]=!0),i.materialUrl&&(this._materialDic[t.Scene_data.fileRoot+i.materialUrl]=!0),i.particleUrl&&(this._particleDic[t.Scene_data.fileRoot+i.particleUrl]=!0)}for(var a in this._objDic)t.ObjDataManager.getInstance().registerUrl(a);for(var a in this._materialDic)t.MaterialManager.getInstance().registerUrl(a);for(var a in this._particleDic)t.ParticleManager.getInstance().registerUrl(a)},a.prototype.destory=function(){for(var i in e.prototype.destory.call(this),this._objDic)t.ObjDataManager.getInstance().releaseUrl(i);for(var i in this._materialDic)t.MaterialManager.getInstance().releaseUrl(i);for(var i in this._particleDic)t.ParticleManager.getInstance().releaseUrl(i);this.dataAry=null,this._objDic=null,this._particleDic=null,this._materialDic=null},a}(t.BaseRes);t.GroupRes=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.Object3D);t.GroupItem=i}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.load=function(e,i){var a=this;this._fun=i,t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t){a.loadComplete(t)}))},i.prototype.loadComplete=function(e){var i=this;this._byte=new t.TLByteArray(e),this._byte.position=0,this.read((function(){i.readNexte()}))},i.prototype.readNexte=function(){this.read(),this.read(),this.objUrl=this._byte.readUTF(),this.materialUrl=this._byte.readUTF(),this._byte.readBoolean()&&(this.light=new t.LightVo,this.light.ambientColor[0]=this._byte.readFloat(),this.light.ambientColor[1]=this._byte.readFloat(),this.light.ambientColor[2]=this._byte.readFloat(),this.light.sunColor[0]=this._byte.readFloat(),this.light.sunColor[1]=this._byte.readFloat(),this.light.sunColor[2]=this._byte.readFloat(),this.light.sunDirect[0]=this._byte.readFloat(),this.light.sunDirect[1]=this._byte.readFloat(),this.light.sunDirect[2]=this._byte.readFloat()),this._fun()},i}(t.BaseRes);t.ModelRes=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.actionNum=0,t.actionIndex=0,t.resState="none",t.NONE="none",t.READ_MESH="read_mesh",t.READ_ACTION="read_action",t.READ_IMAGE="read_image",t.READ_IMAGE_LOADING="read_image_loading",t.READ_MATERIAL="read_material",t.READ_PARTICLE="read_particle",t.READ_COMPLETE="read_complete",t.updateTick=function(){t.updateState()},t.meshBatchNum=1,t}return __extends(i,e),i.prototype.load=function(e,i){var a=this;this._fun=i,t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t){a.loadComplete(t)}))},i.prototype.updateState=function(){switch(this.resState){case this.READ_MESH:this.readMesh();break;case this.READ_ACTION:this.readAction();break;case this.READ_IMAGE:this.resState=this.READ_IMAGE_LOADING,this.read();break;case this.READ_MATERIAL:case this.READ_PARTICLE:this.read();break;case this.READ_COMPLETE:t.TimeUtil.removeFrameTick(this.updateTick),this._fun&&(this._fun(),this._fun=null)}},i.prototype.loadComplete=function(e){this._byte=new t.TLByteArray(e),this._byte.position=0,this.version=this._byte.readInt(),this.resState=this.READ_MESH,t.TimeUtil.addFrameTick(this.updateTick)},i.prototype.readMesh=function(){this.roleUrl=this._byte.readUTF(),this.version>=16&&(this.ambientLightColor=new t.Vector3D,this.sunLigthColor=new t.Vector3D,this.nrmDircet=new t.Vector3D,this.ambientLightColor.x=this._byte.readFloat(),this.ambientLightColor.y=this._byte.readFloat(),this.ambientLightColor.z=this._byte.readFloat(),this.ambientLightIntensity=this._byte.readFloat(),this.ambientLightColor.scaleBy(this.ambientLightIntensity),this.sunLigthColor.x=this._byte.readFloat(),this.sunLigthColor.y=this._byte.readFloat(),this.sunLigthColor.z=this._byte.readFloat(),this.sunLigthIntensity=this._byte.readFloat(),this.sunLigthColor.scaleBy(this.sunLigthIntensity),this.nrmDircet.x=this._byte.readFloat(),this.nrmDircet.y=this._byte.readFloat(),this.nrmDircet.z=this._byte.readFloat()),t.MeshDataManager.getInstance().readData(this._byte,this.meshBatchNum,this.roleUrl,this.version),this.readActions()},i.prototype.readActions=function(){this.version>=30?this.actionByte=t.Util.getZipByte(this._byte):this.actionByte=this._byte,this.actionAry=new Array,this.actionNum=this.actionByte.readInt(),this.resState=this.READ_ACTION},i.prototype.readAction=function(){if(this.actionIndex>=this.actionNum)this.resState=this.READ_IMAGE;else{var e=this.actionByte.readUTF();t.AnimManager.getInstance().readData(this.actionByte,this.roleUrl+e),this.actionAry.push(e),this.actionIndex++}},i.prototype.allResCom=function(){this.resState=this.READ_MATERIAL,this.actionByte=null,this.actionNum=0,this.actionIndex=0},i.prototype.readMaterial=function(){e.prototype.readMaterial.call(this),this.resState=this.READ_PARTICLE},i.prototype.readParticle=function(){e.prototype.readParticle.call(this),this.resState=this.READ_COMPLETE},i}(t.BaseRes);t.RoleRes=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.meshBatchNum=1,t}return __extends(i,e),i.prototype.load=function(e,i){var a=this;this._fun=i,t.LoadManager.getInstance().load(e,t.LoadManager.BYTE_TYPE,(function(t){a.loadComplete(t)}))},i.prototype.loadComplete=function(e){var i=this;this._byte=new t.TLByteArray(e),this._byte.position=0,this.version=this._byte.readInt(),this.skillUrl=this._byte.readUTF(),this.read((function(){i.readNext()}))},i.prototype.readNext=function(){if(this.read(),this.read(),this.version<27)this._byte.readUTF();this.data=this.readData(this._byte),this._fun()},i.prototype.readData=function(e){for(var i=e.readInt(),a=new Object,n=0;n<i;n++){var r=new Object,o=e.readUTF(),s=e.readUTF();if(r.skillname=o,r.action=s,r.type=e.readFloat(),this.version>=26?(r.blood=e.readInt(),0==r.blood&&(r.blood=t.SkillVo.defaultBloodTime)):r.blood=t.SkillVo.defaultBloodTime,this.version>=32){var h=e.readInt();if(h>0){var c=e.readUTF();r.sound={time:h,name:c}}}if(this.version>=33){var u=e.readInt();if(u){for(var l=new Array,d=0;d<u;d++){var p=new Object;p.time=e.readInt(),p.lasttime=e.readInt(),p.amp=e.readFloat(),l.push(p)}r.shock=l}}r.data=new Array;for(var f=e.readInt(),m=0;m<f;m++){var y=new Object;switch(y.url=e.readUTF(),y.frame=e.readFloat(),r.type){case 1:y.beginType=e.readInt(),0==y.beginType?(y.beginPos=new t.Vector3D,y.beginPos.x=e.readFloat(),y.beginPos.y=e.readFloat(),y.beginPos.z=e.readFloat()):1==y.beginType&&(y.beginSocket=e.readUTF()),y.hitSocket=e.readUTF(),y.endParticle=e.readUTF(),y.multype=e.readInt(),y.speed=e.readFloat();break;case 3:y.beginSocket=e.readUTF(),y.beginType=e.readFloat(),y.multype=e.readFloat(),y.speed=e.readFloat();break;case 4:if(this.version>=27){var _=e.readBoolean();y.hasSocket=_,_?y.socket=e.readUTF():(y.pos=this.readV3d(e),y.rotation=this.readV3d(e))}else y.hasSocket=!1,y.pos=this.readV3d(e),y.rotation=this.readV3d(e);break;default:alert("没有类型readData")}r.data.push(y)}a[o]=r}return a},i.prototype.readV3d=function(e){var i=new t.Vector3D;return i.x=e.readFloat(),i.y=e.readFloat(),i.z=e.readFloat(),i.w=e.readFloat(),i},i}(t.BaseRes);t.SkillRes=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this._visible=!1,this.data=[0,0,0,5]}return Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t,this.display.stateChage()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.data[2]},set:function(t){this.data[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.data[3]},set:function(t){this.data[3]=t},enumerable:!0,configurable:!0}),t}();t.Shadow=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){this._displayList=new Array,t.ProgrmaManager.getInstance().registe(t.Display3DShadowShader.Display3DShadowShader,new t.Display3DShadowShader)}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.addShadow=function(){var e=this.getIdleShadow(),i=new t.Shadow;return e.addShadow(i),i},e.prototype.removeShadow=function(t){t.display.removeShadow(t)},e.prototype.update=function(){if(this._displayList.length){t.Scene_data.context3D.setWriteDepth(!1);for(var e=0;e<this._displayList.length;e++)this._displayList[e].update();t.Scene_data.context3D.setWriteDepth(!0)}},e.prototype.getIdleShadow=function(){for(var e=0;e<this._displayList.length;e++)if(this._displayList[e].hasIdle())return this._displayList[e];var i=new t.Display3dShadow;return this._displayList.push(i),i},e}();t.ShadowManager=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this.sunDirect=new Array(0,1,0),this.sunColor=new Array(2,0,0),this.ambientColor=new Array(0,0,0)}return t.prototype.setData=function(t,e,i){this.sunDirect[0]=t.x,this.sunDirect[1]=t.y,this.sunDirect[2]=t.z,this.sunColor[0]=e.x,this.sunColor[1]=e.y,this.sunColor[2]=e.z,this.ambientColor[0]=i.x,this.ambientColor[1]=i.y,this.ambientColor[2]=i.z},t}();t.LightVo=e}(tl3d||(tl3d={}));var Test=function(){function t(){}return t.prototype.readData=function(t){this._byte=t,this.type=this._byte.readShort(),this.name=this._byte.readUTF(),this.age=this._byte.readInt()},t.prototype.writeData=function(){this._byte.writeShort(t.IMG_TYPE),this._byte.writeUTF(this.name);this._byte.writeInt(90)},t.IMG_TYPE=1,t.OBJS_TYPE=2,t.MATERIAL_TYPE=3,t}();!function(t){var e=function(t,e){this.radius=t,this.height=e};t.CapsuleVo=e}(tl3d||(tl3d={})),function(t){var e=function(t){function e(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),t.call(this)||this}return __extends(e,t),e}(t.Object3D);t.CollisionVo=e;var i=function(){};t.CollisionItemVo=i;var a=function(){function t(){}return t.Polygon=0,t.BOX=1,t.BALL=2,t.Cylinder=3,t.Cone=4,t}();t.CollisionType=a}(tl3d||(tl3d={})),function(t){var e=function(){};t.DualQuatFloat32Array=e;var i=function(){function i(){this.inLoop=0,this.inter=new Array,this.bounds=new Array,this.nameHeight=0,this.posAry=new Array,this.hasProcess=!1}return i.prototype.processMesh=function(t){this.hasProcess||(this.makeArrBoneQPAry(t),this.hasProcess=!0)},i.prototype.makeArrBoneQPAry=function(e){this.meshBoneQPAryDic=new t.Dictionary([]);for(var i=0;i<e.meshAry.length;i++){for(var a=this.conleMatrixArr(),n=0;n<a.length;n++)for(var r=a[n],o=0;o<r.length;o++)e.meshAry[i].bindPosMatrixAry[o]&&r[o].prepend(e.meshAry[i].bindPosMatrixAry[o]);var s=this.makeFrameDualQuatFloatArray(e,a);this.meshBoneQPAryDic[e.meshAry[i].uid]=s,this.boneQPAry=s}this.matrixAry=a},i.prototype.getBoneQPAryByMesh=function(t){return this.meshBoneQPAryDic[t.uid]},i.prototype.conleMatrixArr=function(){for(var t=new Array,e=0;e<this.matrixAry.length;e++){for(var i=this.matrixAry[e],a=new Array,n=0;n<i.length;n++)a.push(i[n].clone());t.push(a)}return t},i.prototype.makeFrameDualQuatFloatArray=function(i,a){for(var n=new Array,r=new t.Matrix3D,o=0;o<i.meshAry.length;o++){for(var s=new Array,h=i.meshAry[o].boneNewIDAry,c=0;c<a.length;c++){var u=a[c],l=new e;l.quat=new Float32Array(4*h.length),l.pos=new Float32Array(3*h.length);for(var d=0;d<h.length;d++){var p=u[h[d]].clone(r);p.appendScale(-1,1,1);var f=new t.Quaternion;f.fromMatrix(p);var m=p.position;l.quat[4*d+0]=f.x,l.quat[4*d+1]=f.y,l.quat[4*d+2]=f.z,l.quat[4*d+3]=f.w,l.pos[3*d+0]=m.x,l.pos[3*d+1]=m.y,l.pos[3*d+2]=m.z}s.push(l)}n.push(s)}return n},i}();t.AnimData=i}(tl3d||(tl3d={})),function(t){var e=function(){};t.BoneSocketData=e}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.meshAry=new Array,i.fileScale=1,i.tittleHeight=0,i.hitBox=new t.Vector2D(0,0),i.type=0,i.animDic=new Object,i.ready=!1,i.hasDestory=!1,i}return __extends(i,e),i.prototype.makeHitBoxItem=function(){this.hitPosItem=new Array;var e=this.hitBox.x,i=this.hitBox.y,a=new t.Vector3D(-e,0,-e),n=new t.Vector3D(e,0,-e),r=new t.Vector3D(e,0,e),o=new t.Vector3D(-e,0,e);this.hitPosItem.push(a),this.hitPosItem.push(n),this.hitPosItem.push(r),this.hitPosItem.push(o);var s=new t.Vector3D(-e,i,-e),h=new t.Vector3D(e,i,-e),c=new t.Vector3D(e,i,e),u=new t.Vector3D(-e,i,e);this.hitPosItem.push(s),this.hitPosItem.push(h),this.hitPosItem.push(c),this.hitPosItem.push(u)},i.prototype.addMesh=function(t){t.uid=this.meshAry.length,this.meshAry.push(t)},i.prototype.loadParticle=function(){},i.prototype.loadMaterial=function(t){void 0===t&&(t=null);for(var e=0;e<this.meshAry.length;e++)this.loadByteMeshDataMaterial(this.meshAry[e],t)},i.prototype.loadByteMeshDataMaterial=function(e,i){void 0===i&&(i=null);var a=t.Scene_data.fileRoot+e.materialUrl;a=(a=a.replace("_byte.txt",".txt")).replace(".txt","_byte.txt"),t.MaterialManager.getInstance().getMaterialByte(a,(function(a){e.material=a,a.usePbr?t.MeshDataManager.getInstance().uploadPbrMesh(e,a.useNormal):(a.lightProbe||a.directLight)&&t.MeshDataManager.getInstance().uploadPbrMesh(e,!1),e.materialParamData&&(e.materialParam=new t.MaterialBaseParam,e.materialParam.setData(e.material,e.materialParamData)),i&&i(a)}),null,!0,t.MaterialAnimShader.MATERIAL_ANIM_SHADER,t.MaterialAnimShader)},i.prototype.setAction=function(e,i){this.animUrlAry=new Array;for(var a=0;a<e.length;a++){var n=e[a],r=i+e[a],o=t.AnimManager.getInstance().getAnimDataImmediate(r);o.processMesh(this),this.animDic[n]=o,this.animUrlAry.push(r)}},i.prototype.destory=function(){if(!this.hasDestory){if(this.allParticleDic){for(var e in this.allParticleDic)t.ParticleManager.getInstance().releaseUrl(e);this.allParticleDic=null}for(var i=0;i<this.meshAry.length;i++)this.meshAry[i].destory();if(this.meshAry.length=0,this.meshAry=null,this.boneSocketDic=null,this.animUrlAry)for(i=0;i<this.animUrlAry.length;i++)t.AnimManager.getInstance().clearAnim(this.animUrlAry[i]);for(var e in this.animDic)delete this.animDic[e];this.animDic=null,this.hasDestory=!0}},i}(t.ResCount);t.SkinMesh=e}(tl3d||(tl3d={})),function(t){var e=function(){function t(){this.processorMap=new Object}return t.prototype.getModuleName=function(){throw new Error("namespace必须复写命名")},t.prototype.listProcessors=function(){return null},t.prototype.onRegister=function(){},t.prototype.registerProcessors=function(){var t=this.listProcessors();if(null!=t&&t.length>0)for(var e=0;e<t.length;e++)this.registerProcessor(t[e])},t.prototype.registerProcessor=function(t){if(null!=this.processorMap[t.getName()])throw new Error("同一namespace不能注册两个相同的Processor");this.processorMap[t.getName()]=t,t.registerEvents()},t.registerModule=function(e){if(null!=t.namespaceMap[e.getModuleName()])throw new Error("不能注册两个相同的namespace："+e.getModuleName());t.namespaceMap[e.getModuleName()]=e,e.registerProcessors(),e.onRegister()},t.namespaceMap=new Object,t}();t.Module=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.addEvents=function(t,i,a){for(var n=0;n<t.length;n++)e._instance.addEventListener(t[n].type,i,a)},e.dispatchEvent=function(t){e._instance.dispatchEvent(t)},e.addEvent=function(t,i,a){e._instance.addEventListener(t,i,a)},e.removeEvent=function(t,i,a){e._instance.removeEventListener(t,i,a)},e.removeEventByName=function(t){e._instance.removeEventListenerByName(t)},e.removeEventByNameAndTarget=function(t,i){e._instance.removeEventListenerByNameAndTarget(t,i)},e.removeEventByTarget=function(t){e._instance.removeEventListenerByTarget(t)},e._instance=new t.EventDispatcher,e}();t.ModuleEventManager=e}(tl3d||(tl3d={})),function(t){var e=function(){function e(){}return e.prototype.getName=function(){throw new Error("process必须复写命名")},e.prototype.receivedModuleEvent=function(t){},e.prototype.listenModuleEvents=function(){return null},e.prototype.registerEvents=function(){var e=this.listenModuleEvents();null!=e&&e.length>0&&t.ModuleEventManager.addEvents(e,this.receivedModuleEvent,this)},e.prototype.getHanderMap=function(){return new Object},e}();t.Processor=e}(tl3d||(tl3d={})),function(t){var e=t.Scene_data,i=function(){function i(){this.lastPostionV2d=new t.Vector2D,this._lastMousePos=new t.Vector2D,this.tureMoveV2d=new t.Vector2D(0,0),this.initSceneFocueEvent()}return i.getInstance=function(){return this._instance||(this._instance=new i),this._instance},i.prototype.initSceneFocueEvent=function(){e.uiBlankStage.addEventListener(t.InteractiveEvent.Down,this.onMouseDown,this),e.uiBlankStage.addEventListener(t.InteractiveEvent.Up,this.onMouseUp,this),e.uiBlankStage.addEventListener(t.InteractiveEvent.Move,this.onMouseMove,this)},i.prototype.onMouseMove=function(t){this._isMouseDown&&(this.tureMoveV2d.x=this.lastPostionV2d.x+t.x-this._lastMousePos.x,this.tureMoveV2d.y=this.lastPostionV2d.y+t.y-this._lastMousePos.y,this.resetSize())},i.prototype.onMouseDown=function(e){this._lastMousePos.x=e.x,this._lastMousePos.y=e.y,this.lastPostionV2d=new t.Vector2D(this.tureMoveV2d.x,this.tureMoveV2d.y),this._isMouseDown=!0},i.prototype.onMouseUp=function(t){this._isMouseDown=!1},i.prototype.resetSize=function(){var a=.25/t.Override2dEngine.htmlScale;e.focus3D.x=0+e.stageWidth/2*a,e.focus3D.z=0-e.stageHeight/2*a/Math.sin(i.scene2dRotation45*Math.PI/180),e.focus3D.x-=this.tureMoveV2d.x*a,e.focus3D.z+=this.tureMoveV2d.y*a/Math.sin(i.scene2dRotation45*Math.PI/180),t.Ground2dBaseSprite.perentpos=this.tureMoveV2d},i.scene2dRotation45=45,i}();t.CanvasPostionModel=i}(tl3d||(tl3d={})),function(t){var e=t.Scene_data,i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"u2Texture")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec2 u2Texture;varying vec2 v_texCoord;uniform vec4 movesize;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0.xy*=movesize.zw;   vt0.xy+=movesize.xy;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return"precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor =infoUv;\n}"},e.Ground2dBaseShader="Ground2dBaseShader",e}(t.Shader3D);t.Ground2dBaseShader=i;var a=function(a){function n(){var t=a.call(this)||this;return t.x=0,t.y=0,t.width=100,t.height=100,t.initData(),t}return __extends(n,a),n.prototype.initData=function(){t.ProgrmaManager.getInstance().registe(i.Ground2dBaseShader,new i),this.shader=t.ProgrmaManager.getInstance().getProgram(i.Ground2dBaseShader),this.program=this.shader.program,this.objData=new t.ObjData,this.objData.vertices=new Array,this.objData.vertices.push(0,-1,0),this.objData.vertices.push(1,-1,0),this.objData.vertices.push(1,0,0),this.objData.vertices.push(0,0,0),this.objData.uvs=new Array,this.objData.uvs.push(0,1),this.objData.uvs.push(1,1),this.objData.uvs.push(1,0),this.objData.uvs.push(0,0),this.objData.indexs=new Array,this.objData.indexs.push(0,1,2),this.objData.indexs.push(0,2,3),this.loadTexture(),this.upToGpu()},n.prototype.loadTexture=function(){var e=t.UIManager.getInstance().getContext2D(128,128,!1);e.fillStyle="rgb(255,255,255)",e.fillRect(0,0,128,128),this._uvTextureRes=t.TextureManager.getInstance().getCanvasTexture(e)},n.prototype.setPicUrl=function(e){var i=this;t.TextureManager.getInstance().getTexture(e,(function(t){i._uvTextureRes=t}))},n.prototype.upToGpu=function(){this.objData.indexs.length&&(this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=e.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=t.Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=t.Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},n.prototype.update=function(){this.objData&&this.objData.indexBuffer&&this._uvTextureRes&&(t.Scene_data.context3D.setProgram(this.program),t.Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),t.Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),t.Scene_data.context3D.setVc4fv(this.shader,"movesize",this.getMoveSizeData()),t.Scene_data.context3D.setRenderTexture(this.shader,"s_texture",this._uvTextureRes.texture,0),t.Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},n.prototype.getMoveSizeData=function(){return[(this.x+n.perentpos.x)/(e.stageWidth/2)-1,1-(this.y+n.perentpos.y)/(e.stageHeight/2),this.width/(e.stageWidth/2),this.height/(e.stageHeight/2)]},n.perentpos=new t.Vector2D,n}(t.Display3D);t.Ground2dBaseSprite=a;var n=function(){function t(){this._groundItem=new Array}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.update=function(){e.context3D.setWriteDepth(!1),e.context3D.setDepthTest(!1);for(var t=0;t<this._groundItem.length;t++)this._groundItem[t].update()},t.prototype.addGroundPicByeUrl=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=new a;return t&&i.setPicUrl(t),e&&(i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height),this._groundItem.push(i),i},t}();t.GroundModel=n}(tl3d||(tl3d={})),function(t){var e=t.Scene_data,i=function(i){function a(){return i.call(this)||this}return __extends(a,i),a.initConfig=function(){var e=this;t.Engine.init=function(t){e.init(t)},t.Engine.resetSize=function(t,i){e.resetSize(t,i)}},a.resetSize=function(i,a){e.stageWidth=i,t.Scene_data.stageHeight=a,e.canvas3D.width=e.stageWidth,e.canvas3D.height=e.stageHeight,e.context3D.resetSize(e.stageWidth,e.stageHeight),t.UIManager.getInstance().resize(),t.Engine.resetViewMatrx3D()},a.init=function(i){e.vpMatrix=new t.Matrix3D,e.canvas3D=i,e.context3D=new t.Context3D,e.context3D.init(i),t.UIManager.getInstance().init(),e.cam3D=new t.Camera3D,e.focus3D=new t.Object3D,e.focus3D.rotationY=135,e.focus3D.rotationX=-45,e.light=new t.LightVo,t.TimeUtil.init(),e.supportBlob=!1},a}(t.Engine);t.OverrideEngine=i}(tl3d||(tl3d={})),function(t){var e=t.Scene_data,i=function(i){function a(){return i.call(this)||this}return __extends(a,i),a.initConfig=function(){var e=this;t.Engine.init=function(t){e.init(t)},t.Engine.resetSize=function(t,i){e.resetSize(t,i)},t.Engine.resetViewMatrx3D=function(){e.resetViewMatrx3D()}},a.resetSize=function(i,a){isNaN(i)&&(i=document.body.clientWidth),isNaN(a)&&(a=document.body.clientHeight),t.Scene_data.stageWidth=i,e.stageHeight=a,e.context3D.resetSize(e.stageWidth,e.stageHeight),t.UIManager.getInstance().resize(),t.Engine.resetViewMatrx3D(),t.CanvasPostionModel.getInstance().resetSize()},a.init=function(i){t.OverrideEngine.init(i),t.Scene_data.focus3D.x=0,e.focus3D.y=0,e.focus3D.z=0,t.Scene_data.focus3D.rotationY=0,e.focus3D.rotationX=-45,t.Scene_data.cam3D.distance=250},a.resetViewMatrx3D=function(){e.viewMatrx3D?e.viewMatrx3D.identity():e.viewMatrx3D=new t.Matrix3D;var i=t.Scene_data.stageWidth,a=t.Scene_data.stageHeight;t.Scene_data.sceneViewHW=Math.max(i,a),e.viewMatrx3D.appendScale(1/e.sceneViewHW*2,1/e.sceneViewHW*2,.001),e.viewMatrx3D.appendScale(e.sceneViewHW/i*2*1,i/a*(e.sceneViewHW/i*2),1),t.Scene_data.viewMatrx3D.appendScale(2*this.htmlScale,2*this.htmlScale,1)},a.htmlScale=.5,a}(t.OverrideEngine);t.Override2dEngine=i}(tl3d||(tl3d={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.drawTxtBydigitalAndtext=function(e){var i,a=this.parent.uiAtlas.getRec(this.textureStr),n=t.UIManager.getInstance().getContext2D(a.pixelWitdh,a.pixelHeight,!1),r=e.type;e.type==t.TextJumpType.EXPERIENCE&&(i=t.ArtFont.num54);var o=t.ArtFont.getInstance().getAirFontWidth(n,String(this._data.str),i);return o+=50,t.UiDraw.cxtDrawImg(n,"TYPE"+r,new t.Rectangle(a.pixelWitdh-o,a.pixelHeight-25,50,25),t.UIData.publicUi),t.ArtFont.getInstance().writeFontToCtxLeft(n,String(this._data.str),i,a.pixelWitdh-o+50+2,a.pixelHeight-25),t.TextureManager.getInstance().updateTexture(this.parent.uiAtlas.texture,a.pixelX,a.pixelY,n),o},i}(t.ExpTextJumpUiDrawAndRefreash);t.ExpTextJumpUiDrawAndRefreash256=e;var i=function(i){function a(){var a=i.call(this)||this;return a._jumpText256_256=new t.AlphaUiContianer(e,new t.Rectangle(0,0,256,256),2),a.uiContianerItem.push(a._jumpText256_256),a}return __extends(a,i),a.prototype.setExpJump256_256Num=function(t){this._jumpText256_256.showTemp(t)},a}(t.BloodManager);t.OverrideBloodManager=i}(tl3d||(tl3d={})),function(t){var e=t.ProgrmaManager,i=t.TextureManager,a=t.Scene_data,n=t.ObjDataManager,r=t.Shader3D,o=t.Display3DSprite,s=t.BaseRes,h=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2CubeTexST"),t.bindAttribLocation(this.program,2,"v3Normal")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec2 v2CubeTexST;varying vec2 v0;varying vec3 v_PositionFromLight;varying vec3 v2;varying float cosTheta;varying float onsunFace;varying vec3 ambientColorF;attribute vec3 v3Normal;uniform vec3 sunDirect;uniform vec3 sunColor;uniform vec3 ambientColor;uniform mat4 vpMatrix3D;uniform mat4 posMatrix3D;uniform mat4 shadowViewMatx3D;uniform mat3 rotationMatrix3D;void main(void){;ambientColorF =ambientColor;v0 = vec2(v2CubeTexST.x, v2CubeTexST.y); vec4 vt0= vec4(v3Position, 1.0);vt0 = posMatrix3D * vt0;vt0 = vpMatrix3D * vt0;   vec4 vt1= vec4(v3Position, 1.0);   vt1 = posMatrix3D * vt1;   vt1 = shadowViewMatx3D * vt1;   v_PositionFromLight = vec3(vt1.x, vt1.y,vt1.z);vec3 n = rotationMatrix3D * v3Normal;float suncos = dot(n.xyz,sunDirect.xyz);onsunFace = suncos;cosTheta =1.0-abs(suncos);suncos = clamp(suncos,0.0,1.0);v2 = sunColor * suncos ;gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return"precision mediump float;\nuniform sampler2D fs0;\nuniform sampler2D fs1;\nvarying vec2 v0;\nvarying vec3 v_PositionFromLight;\nvarying vec3 v2;varying float cosTheta;varying float onsunFace;varying vec3 ambientColorF;void main(void)\n{\nvec4 ft5 = texture2D(fs1, v_PositionFromLight.xy); float  bias  = 0.01*cosTheta; bias = clamp(bias, 0.003, 0.01); float visibility = (v_PositionFromLight.z > ft5.x + bias) ? 0.9 : 1.0;\nvisibility =onsunFace<0.0?1.0:visibility ; vec4 ft0 = texture2D(fs0, v0); vec4 ft1 = vec4(v2.xyz, 1.0); vec4 ft2 = vec4(1, 1, 1, 1); float isalp = (ft5.z >0.1254) ? 1.0 : 0.2;\ngl_FragColor = vec4((ft1.xyz*visibility+ambientColorF.xyz)*ft0.rgb , 1.0); }"},e.DirectShadowDisplay3DShader="DirectShadowDisplay3DShader",e}(r);t.DirectShadowDisplay3DShader=h;var c=function(r){function c(){var t=r.call(this)||this;return t.needScanShadow=!0,t.nrmFlag=0,t.initData(),t}return __extends(c,r),c.prototype.initData=function(){e.getInstance().registe(h.DirectShadowDisplay3DShader,new h),this.modelShder=e.getInstance().getProgram(h.DirectShadowDisplay3DShader)},c.prototype.setObjUrl=function(t){var e=this;n.getInstance().getObjData(a.fileRoot+t,(function(t){e.objData=t}))},c.prototype.update=function(){for(var t=0;t<this.groupItem.length;t++)this.drawTemp(this.groupItem[t])},c.prototype.drawTemp=function(e){if(this._scene.fbo&&t.ShadowModel.shadowViewMatx3D){var i=e.objData,n=this.modelShder;i&&i.indexBuffer&&this._uvTextureRes&&(a.context3D.setProgram(n.program),a.context3D.setVc3fv(n,"sunDirect",this._scene.light.sunDirect),a.context3D.setVc3fv(n,"sunColor",this._scene.light.sunColor),a.context3D.setVc3fv(n,"ambientColor",this._scene.light.ambientColor),a.context3D.setVcMatrix4fv(n,"shadowViewMatx3D",t.ShadowModel.shadowViewMatx3D.m),a.context3D.setVcMatrix3fv(n,"rotationMatrix3D",e._rotationData),a.context3D.setVcMatrix4fv(n,"vpMatrix3D",a.vpMatrix.m),a.context3D.setVcMatrix4fv(n,"posMatrix3D",this.posMatrix.m),a.context3D.renderContext.bindBuffer(a.context3D.renderContext.ARRAY_BUFFER,i.vertexBuffer),a.context3D.setVaOffset(0,3,i.stride,0),a.context3D.setVaOffset(1,2,i.stride,i.uvsOffsets),a.context3D.setVaOffset(2,3,i.stride,i.normalsOffsets),a.context3D.setRenderTexture(n,"fs0",this._uvTextureRes.texture,0),a.context3D.setRenderTexture(n,"fs1",this._scene.fbo.texture,1),a.context3D.drawCall(i.indexBuffer,i.treNum))}},c.prototype.updateRotationMatrix=function(){r.prototype.updateRotationMatrix.call(this);for(var t=0;this.groupItem&&t<this.groupItem.length;t++){var e=this.groupItem[t];e&&e._rotationData&&e._rotationData&&this._rotationMatrix.getRotaion(e._rotationData)}},c.prototype.setPicUrl=function(t){var e=this;i.getInstance().getTexture(a.fileRoot+t,(function(t){e._uvTextureRes=t}))},c.prototype.setModelById=function(e){var i=this;this.groupItem=new Array,this._scene.groupDataMgr.getGroupData(a.fileRoot+t.UnitFunction.getModelUrl(e),(function(t){for(var e=0;e<t.dataAry.length;e++){var a=t.dataAry[e];if(a.types==s.PREFAB_TYPE){var n=new o;n.setObjUrl(a.objUrl),n._rotationData=new Float32Array(9),i.groupItem.push(n),a.materialInfoArr&&a.materialInfoArr.length?i.setPicUrl(a.materialInfoArr[0].url):console.log("没有指定贴图")}}i.updateRotationMatrix()}))},c}(o);t.DirectShadowDisplay3DSprite=c}(tl3d||(tl3d={})),function(t){var e=t.ProgrmaManager,i=t.UIManager,a=t.Vector3D,n=t.TextureManager,r=t.Scene_data,o=t.Shader3D,s=t.Matrix3D,h=t.FBO,c=t.MathClass,u=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"u2Texture")},e.prototype.getVertexShaderString=function(){return"attribute vec3 v3Position;attribute vec2 u2Texture;uniform mat4 vpMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(u2Texture.x, u2Texture.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = vpMatrix3D * vt0;   gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){return"precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ngl_FragColor = vec4(gl_FragCoord.z,gl_FragCoord.z,0.1236,1);\n}"},e.BaseShadowShader="BaseShadowShader",e}(o);t.BaseShadowShader=u;var l=function(){function t(){this.sunRotationX=-90,this.sunRotationY=0,this.sunDistens100=200,this.isNeedMake=!0,this._visible=!0}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getFBO=function(){h.fw=1024,h.fh=1024,this.renderContext=r.context3D.renderContext;var t=r.context3D.renderContext,e=new h;return e.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,e.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,h.fw,h.fh,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e.frameBuffer=t.createFramebuffer(),e.depthBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,e.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,h.fw,h.fh),e},t.prototype.updateDepthTexture=function(t){var e=r.context3D.renderContext;e.bindFramebuffer(e.FRAMEBUFFER,t.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)},t.prototype.makeUseShadowView=function(){r.viewMatrx3D.appendTranslation(1,1,1),r.viewMatrx3D.appendScale(.5,.5,.5),c.updateVp(),t.shadowViewMatx3D=r.vpMatrix.clone()},t.prototype.setShowdowVisible=function(t){this._visible=t,console.log("开关阴影",this._visible)},t.prototype.updateDepth=function(e){if(t.getInstance().sunRotationY=45,e.fbo||(e.fbo=this.getFBO()),this._visible){var i=r.vpMatrix.clone(),n=r.viewMatrx3D.clone();this.updateDepthTexture(e.fbo),this.renderContext.viewport(0,0,h.fw,h.fh),this.renderContext.clearColor(1,1,1,1),this.renderContext.clearDepth(1),this.renderContext.enable(this.renderContext.DEPTH_TEST),this.renderContext.depthMask(!0),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT),r.context3D.setWriteDepth(!0),r.context3D.setDepthTest(!0),r.viewMatrx3D.identity(),r.viewMatrx3D.appendScale(.002,.002,1/600),r.cam3D.cameraMatrix.identity(),r.cam3D.cameraMatrix.prependRotation(this.sunRotationX,a.X_AXIS),r.cam3D.cameraMatrix.prependRotation(this.sunRotationY,a.Y_AXIS),r.cam3D.cameraMatrix.prependTranslation(-r.focus3D.x,0,-r.focus3D.z);var o=new a(0,0,-1),u=new s;u.appendRotation(-this.sunRotationX,a.X_AXIS),u.appendRotation(-this.sunRotationY,a.Y_AXIS),(o=u.transformVector(o)).normalize(),e.light.sunDirect[0]=o.x,e.light.sunDirect[1]=o.y,e.light.sunDirect[2]=o.z,c.updateVp(),t.shadowViewMatx3D=r.vpMatrix.clone(),r.context3D.setProgram(null);for(var l=0;l<e.displaySpriteList.length;l++){var d=e.displaySpriteList[l];this.drawTempSprite(d.objData,d.posMatrix)}for(var p=0;p<e.displayList.length;p++){var f=e.displayList[p];if(f&&f.needScanShadow)for(var m=0;m<f.groupItem.length;m++)this.drawTempSprite(f.groupItem[m].objData,f.posMatrix)}var y=r.context3D.renderContext;y.bindFramebuffer(y.FRAMEBUFFER,null),y.bindTexture(y.TEXTURE_2D,null),y.bindRenderbuffer(y.RENDERBUFFER,null),this.makeUseShadowView(),r.context3D.resetSize(r.stageWidth,r.stageHeight),r.vpMatrix=i,r.viewMatrx3D=n}},t.prototype.drawTempSprite=function(t,a){e.getInstance().registe(u.BaseShadowShader,new u);var o=e.getInstance().getProgram(u.BaseShadowShader);if(!this._uvTextureRes){var s=i.getInstance().getContext2D(128,128,!1);s.fillStyle="rgb(255,0,255)",s.fillRect(0,0,128,128),this._uvTextureRes=n.getInstance().getCanvasTexture(s)}r.context3D.setProgram(o.program),r.context3D.setVcMatrix4fv(o,"vpMatrix3D",r.vpMatrix.m),r.context3D.setVcMatrix4fv(o,"posMatrix3D",a.m);r.context3D.pushVa(t.vertexBuffer);r.context3D.setVaOffset(0,3,t.stride,0),r.context3D.setVaOffset(1,2,t.stride,t.uvsOffsets),r.context3D.setRenderTexture(o,"s_texture",this._uvTextureRes.texture,0),r.context3D.drawCall(t.indexBuffer,t.treNum)},t}();t.ShadowModel=l}(tl3d||(tl3d={}));